<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>瘦客户端 | Apache Ignite技术服务</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="stylesheet" href="/css/plugin.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <script src="https://hm.baidu.com/hm.js?9d04fe7543c80b1f04c5f9571193ac90"></script>
    <meta name="description" content="apache ignite,ignite中文,ignite官网,内存数据库,分布式数据库">
    <meta name="keywords" content="apache ignite,ignite中文,ignite官网,内存数据库,分布式数据库">
    <meta http-equiv="cache-control" content="no-store,no-cache,must-revalidate">
    <meta http-equiv="expires" content="0">
    
    <link rel="preload" href="/assets/css/0.styles.763ae045.css" as="style"><link rel="preload" href="/assets/js/app.aed0e056.js" as="script"><link rel="preload" href="/assets/js/3.d41ef727.js" as="script"><link rel="preload" href="/assets/js/1.c1604912.js" as="script"><link rel="preload" href="/assets/js/188.cd459a8e.js" as="script"><link rel="preload" href="/assets/js/11.43551a62.js" as="script"><link rel="preload" href="/assets/js/10.cd30f947.js" as="script"><link rel="preload" href="/assets/js/8.7ff96eb1.js" as="script"><link rel="prefetch" href="/assets/js/100.7e3232a9.js"><link rel="prefetch" href="/assets/js/101.4c7a780b.js"><link rel="prefetch" href="/assets/js/102.1b7af52a.js"><link rel="prefetch" href="/assets/js/103.711189c2.js"><link rel="prefetch" href="/assets/js/104.4b2ee848.js"><link rel="prefetch" href="/assets/js/105.14da88c2.js"><link rel="prefetch" href="/assets/js/106.9065addb.js"><link rel="prefetch" href="/assets/js/107.13d6293c.js"><link rel="prefetch" href="/assets/js/108.9ac67a9f.js"><link rel="prefetch" href="/assets/js/109.bafb9de2.js"><link rel="prefetch" href="/assets/js/110.8673dc8d.js"><link rel="prefetch" href="/assets/js/111.fb5e9de6.js"><link rel="prefetch" href="/assets/js/112.552aa163.js"><link rel="prefetch" href="/assets/js/113.4dd995ce.js"><link rel="prefetch" href="/assets/js/114.4a6018ca.js"><link rel="prefetch" href="/assets/js/115.20d526b9.js"><link rel="prefetch" href="/assets/js/116.47b41a50.js"><link rel="prefetch" href="/assets/js/117.1579d041.js"><link rel="prefetch" href="/assets/js/118.218cf736.js"><link rel="prefetch" href="/assets/js/119.3aa5e3e2.js"><link rel="prefetch" href="/assets/js/12.7891e08b.js"><link rel="prefetch" href="/assets/js/120.41ef1211.js"><link rel="prefetch" href="/assets/js/121.73861e86.js"><link rel="prefetch" href="/assets/js/122.ed42c5e1.js"><link rel="prefetch" href="/assets/js/123.dc097107.js"><link rel="prefetch" href="/assets/js/124.10bfbd2c.js"><link rel="prefetch" href="/assets/js/125.577a3694.js"><link rel="prefetch" href="/assets/js/126.665d8926.js"><link rel="prefetch" href="/assets/js/127.87f39fba.js"><link rel="prefetch" href="/assets/js/128.ffb46384.js"><link rel="prefetch" href="/assets/js/129.e2b9b80c.js"><link rel="prefetch" href="/assets/js/13.550a0e6d.js"><link rel="prefetch" href="/assets/js/130.12b00d5f.js"><link rel="prefetch" href="/assets/js/131.889d92f1.js"><link rel="prefetch" href="/assets/js/132.c9701db7.js"><link rel="prefetch" href="/assets/js/133.b3203000.js"><link rel="prefetch" href="/assets/js/134.a52965fa.js"><link rel="prefetch" href="/assets/js/135.ebbcf298.js"><link rel="prefetch" href="/assets/js/136.3277fd63.js"><link rel="prefetch" href="/assets/js/137.e99190a4.js"><link rel="prefetch" href="/assets/js/138.d169e22b.js"><link rel="prefetch" href="/assets/js/139.eda491d2.js"><link rel="prefetch" href="/assets/js/14.7da9e4b5.js"><link rel="prefetch" href="/assets/js/140.8368f078.js"><link rel="prefetch" href="/assets/js/141.23c6488c.js"><link rel="prefetch" href="/assets/js/142.071de2b6.js"><link rel="prefetch" href="/assets/js/143.7cac22a3.js"><link rel="prefetch" href="/assets/js/144.88ea9b2a.js"><link rel="prefetch" href="/assets/js/145.7cfead36.js"><link rel="prefetch" href="/assets/js/146.f432ce1f.js"><link rel="prefetch" href="/assets/js/147.4093eb12.js"><link rel="prefetch" href="/assets/js/148.f31105ff.js"><link rel="prefetch" href="/assets/js/149.425475f8.js"><link rel="prefetch" href="/assets/js/15.3c7b9c2f.js"><link rel="prefetch" href="/assets/js/150.87fbe97c.js"><link rel="prefetch" href="/assets/js/151.bbd8b8d9.js"><link rel="prefetch" href="/assets/js/152.4e50e1d5.js"><link rel="prefetch" href="/assets/js/153.1a5c9601.js"><link rel="prefetch" href="/assets/js/154.64543ae6.js"><link rel="prefetch" href="/assets/js/155.9b519c0b.js"><link rel="prefetch" href="/assets/js/156.e5171ed9.js"><link rel="prefetch" href="/assets/js/157.15a566b4.js"><link rel="prefetch" href="/assets/js/158.acc478df.js"><link rel="prefetch" href="/assets/js/159.2978e734.js"><link rel="prefetch" href="/assets/js/16.d2d8db9b.js"><link rel="prefetch" href="/assets/js/160.f1402393.js"><link rel="prefetch" href="/assets/js/161.bc7ba5e4.js"><link rel="prefetch" href="/assets/js/162.3a2dd2c9.js"><link rel="prefetch" href="/assets/js/163.0dd0ef3c.js"><link rel="prefetch" href="/assets/js/164.5d326d15.js"><link rel="prefetch" href="/assets/js/165.4e2f5687.js"><link rel="prefetch" href="/assets/js/166.caed9976.js"><link rel="prefetch" href="/assets/js/167.a29ebb1a.js"><link rel="prefetch" href="/assets/js/168.cbd00d24.js"><link rel="prefetch" href="/assets/js/169.4d9861b1.js"><link rel="prefetch" href="/assets/js/17.1e8642e7.js"><link rel="prefetch" href="/assets/js/170.9e1a7ebe.js"><link rel="prefetch" href="/assets/js/171.b67c0d96.js"><link rel="prefetch" href="/assets/js/172.d0e53c3d.js"><link rel="prefetch" href="/assets/js/173.abf9167c.js"><link rel="prefetch" href="/assets/js/174.ac73cb58.js"><link rel="prefetch" href="/assets/js/175.087f3cb7.js"><link rel="prefetch" href="/assets/js/176.ec0f95a1.js"><link rel="prefetch" href="/assets/js/177.9bdedac7.js"><link rel="prefetch" href="/assets/js/178.e5ebc407.js"><link rel="prefetch" href="/assets/js/179.9bdb418d.js"><link rel="prefetch" href="/assets/js/18.84176f6b.js"><link rel="prefetch" href="/assets/js/180.28291826.js"><link rel="prefetch" href="/assets/js/181.e3dbb7c1.js"><link rel="prefetch" href="/assets/js/182.2126a2fc.js"><link rel="prefetch" href="/assets/js/183.26f6aa57.js"><link rel="prefetch" href="/assets/js/184.abf35a03.js"><link rel="prefetch" href="/assets/js/185.f0df1752.js"><link rel="prefetch" href="/assets/js/186.c6c9ef1c.js"><link rel="prefetch" href="/assets/js/187.d45a597d.js"><link rel="prefetch" href="/assets/js/189.a24fea0e.js"><link rel="prefetch" href="/assets/js/19.0cae43ad.js"><link rel="prefetch" href="/assets/js/190.605307a5.js"><link rel="prefetch" href="/assets/js/191.08e771a3.js"><link rel="prefetch" href="/assets/js/192.31a67265.js"><link rel="prefetch" href="/assets/js/193.452a8407.js"><link rel="prefetch" href="/assets/js/194.f14b538c.js"><link rel="prefetch" href="/assets/js/195.b3bbe516.js"><link rel="prefetch" href="/assets/js/196.126cc5b6.js"><link rel="prefetch" href="/assets/js/197.e1c893ab.js"><link rel="prefetch" href="/assets/js/198.82b4eedb.js"><link rel="prefetch" href="/assets/js/199.2f9c1c18.js"><link rel="prefetch" href="/assets/js/20.cffe7c76.js"><link rel="prefetch" href="/assets/js/200.1e3aa29c.js"><link rel="prefetch" href="/assets/js/201.1120ab69.js"><link rel="prefetch" href="/assets/js/202.595e7191.js"><link rel="prefetch" href="/assets/js/203.ea5c2d08.js"><link rel="prefetch" href="/assets/js/204.215f257a.js"><link rel="prefetch" href="/assets/js/205.d9690844.js"><link rel="prefetch" href="/assets/js/206.c37d9f71.js"><link rel="prefetch" href="/assets/js/207.cc1e480b.js"><link rel="prefetch" href="/assets/js/208.53bff87f.js"><link rel="prefetch" href="/assets/js/209.654fe04d.js"><link rel="prefetch" href="/assets/js/21.8968e1cb.js"><link rel="prefetch" href="/assets/js/210.d48ecbc5.js"><link rel="prefetch" href="/assets/js/211.0424568c.js"><link rel="prefetch" href="/assets/js/212.1d34e766.js"><link rel="prefetch" href="/assets/js/213.a252930d.js"><link rel="prefetch" href="/assets/js/214.e9134006.js"><link rel="prefetch" href="/assets/js/215.a72493fd.js"><link rel="prefetch" href="/assets/js/216.f1b488f2.js"><link rel="prefetch" href="/assets/js/217.35382738.js"><link rel="prefetch" href="/assets/js/218.c3734a1e.js"><link rel="prefetch" href="/assets/js/219.edc2c726.js"><link rel="prefetch" href="/assets/js/22.4ef74b42.js"><link rel="prefetch" href="/assets/js/220.feb2cbeb.js"><link rel="prefetch" href="/assets/js/221.bb8b033e.js"><link rel="prefetch" href="/assets/js/222.4be84ffe.js"><link rel="prefetch" href="/assets/js/223.ec446ba4.js"><link rel="prefetch" href="/assets/js/224.8952b078.js"><link rel="prefetch" href="/assets/js/225.1e8cad4f.js"><link rel="prefetch" href="/assets/js/226.3d1a80cc.js"><link rel="prefetch" href="/assets/js/227.401f8413.js"><link rel="prefetch" href="/assets/js/228.e4a45d6b.js"><link rel="prefetch" href="/assets/js/229.4209a859.js"><link rel="prefetch" href="/assets/js/23.434622b9.js"><link rel="prefetch" href="/assets/js/230.4d258eb7.js"><link rel="prefetch" href="/assets/js/231.3ee98621.js"><link rel="prefetch" href="/assets/js/232.6c2594cc.js"><link rel="prefetch" href="/assets/js/233.079b9aa9.js"><link rel="prefetch" href="/assets/js/234.f6bcf02d.js"><link rel="prefetch" href="/assets/js/235.dbd67a55.js"><link rel="prefetch" href="/assets/js/236.2fda7064.js"><link rel="prefetch" href="/assets/js/237.77290873.js"><link rel="prefetch" href="/assets/js/238.6fc15632.js"><link rel="prefetch" href="/assets/js/239.1b3455f4.js"><link rel="prefetch" href="/assets/js/24.2d7b82f1.js"><link rel="prefetch" href="/assets/js/240.92b52b0a.js"><link rel="prefetch" href="/assets/js/241.31185d1e.js"><link rel="prefetch" href="/assets/js/242.adce35cb.js"><link rel="prefetch" href="/assets/js/243.cd818e57.js"><link rel="prefetch" href="/assets/js/244.630ea25e.js"><link rel="prefetch" href="/assets/js/245.1809455f.js"><link rel="prefetch" href="/assets/js/246.6a36f38f.js"><link rel="prefetch" href="/assets/js/247.6f146398.js"><link rel="prefetch" href="/assets/js/248.8321e95c.js"><link rel="prefetch" href="/assets/js/249.94ab7227.js"><link rel="prefetch" href="/assets/js/25.f120ca20.js"><link rel="prefetch" href="/assets/js/250.7f51ed49.js"><link rel="prefetch" href="/assets/js/251.a30c05c0.js"><link rel="prefetch" href="/assets/js/252.b1ca8a0e.js"><link rel="prefetch" href="/assets/js/253.baca393d.js"><link rel="prefetch" href="/assets/js/254.fb8064cb.js"><link rel="prefetch" href="/assets/js/255.9fb044c0.js"><link rel="prefetch" href="/assets/js/256.c5a5867e.js"><link rel="prefetch" href="/assets/js/257.7085fdc1.js"><link rel="prefetch" href="/assets/js/26.eccc00a1.js"><link rel="prefetch" href="/assets/js/27.fe376f21.js"><link rel="prefetch" href="/assets/js/28.6c153a84.js"><link rel="prefetch" href="/assets/js/29.2c3a87e0.js"><link rel="prefetch" href="/assets/js/30.5f0aa428.js"><link rel="prefetch" href="/assets/js/31.aa462b87.js"><link rel="prefetch" href="/assets/js/32.6872e770.js"><link rel="prefetch" href="/assets/js/33.3ab6c388.js"><link rel="prefetch" href="/assets/js/34.86764b0b.js"><link rel="prefetch" href="/assets/js/35.9c4cf59c.js"><link rel="prefetch" href="/assets/js/36.a23deda7.js"><link rel="prefetch" href="/assets/js/37.cd9b1a4e.js"><link rel="prefetch" href="/assets/js/38.ba68b370.js"><link rel="prefetch" href="/assets/js/39.aaa32dd9.js"><link rel="prefetch" href="/assets/js/4.51a792b3.js"><link rel="prefetch" href="/assets/js/40.d84c0ea8.js"><link rel="prefetch" href="/assets/js/41.9598fd01.js"><link rel="prefetch" href="/assets/js/42.bdf17566.js"><link rel="prefetch" href="/assets/js/43.82c2363a.js"><link rel="prefetch" href="/assets/js/44.af5d542b.js"><link rel="prefetch" href="/assets/js/45.581f794f.js"><link rel="prefetch" href="/assets/js/46.8da3ee44.js"><link rel="prefetch" href="/assets/js/47.ab0f95fb.js"><link rel="prefetch" href="/assets/js/48.7dde79ea.js"><link rel="prefetch" href="/assets/js/49.8f6aa932.js"><link rel="prefetch" href="/assets/js/5.5115f2a5.js"><link rel="prefetch" href="/assets/js/50.097b7333.js"><link rel="prefetch" href="/assets/js/51.65c42ed5.js"><link rel="prefetch" href="/assets/js/52.6d0ce70b.js"><link rel="prefetch" href="/assets/js/53.99ef1f1a.js"><link rel="prefetch" href="/assets/js/54.0b490226.js"><link rel="prefetch" href="/assets/js/55.eab77c2a.js"><link rel="prefetch" href="/assets/js/56.d8903fcc.js"><link rel="prefetch" href="/assets/js/57.d0a969e8.js"><link rel="prefetch" href="/assets/js/58.6e5d83b3.js"><link rel="prefetch" href="/assets/js/59.8808a61c.js"><link rel="prefetch" href="/assets/js/6.91cc8ac1.js"><link rel="prefetch" href="/assets/js/60.f2a1619b.js"><link rel="prefetch" href="/assets/js/61.8c906994.js"><link rel="prefetch" href="/assets/js/62.a3ba2d0e.js"><link rel="prefetch" href="/assets/js/63.43cbcaa9.js"><link rel="prefetch" href="/assets/js/64.7f307a82.js"><link rel="prefetch" href="/assets/js/65.85ad65fa.js"><link rel="prefetch" href="/assets/js/66.bf6e72d6.js"><link rel="prefetch" href="/assets/js/67.6376c6bd.js"><link rel="prefetch" href="/assets/js/68.a7a22ff6.js"><link rel="prefetch" href="/assets/js/69.2f66a4c9.js"><link rel="prefetch" href="/assets/js/7.db4f6f85.js"><link rel="prefetch" href="/assets/js/70.a0e37d99.js"><link rel="prefetch" href="/assets/js/71.1ab62514.js"><link rel="prefetch" href="/assets/js/72.a460ca74.js"><link rel="prefetch" href="/assets/js/73.d02a4888.js"><link rel="prefetch" href="/assets/js/74.4d7541ab.js"><link rel="prefetch" href="/assets/js/75.df32dd2d.js"><link rel="prefetch" href="/assets/js/76.d8125a66.js"><link rel="prefetch" href="/assets/js/77.b1ed81ec.js"><link rel="prefetch" href="/assets/js/78.e8750839.js"><link rel="prefetch" href="/assets/js/79.bb789130.js"><link rel="prefetch" href="/assets/js/80.d9ca901d.js"><link rel="prefetch" href="/assets/js/81.ff0b7ef4.js"><link rel="prefetch" href="/assets/js/82.05783848.js"><link rel="prefetch" href="/assets/js/83.1b25f66b.js"><link rel="prefetch" href="/assets/js/84.75fd70df.js"><link rel="prefetch" href="/assets/js/85.63b6dd59.js"><link rel="prefetch" href="/assets/js/86.bd968a1c.js"><link rel="prefetch" href="/assets/js/87.5fa8bbcb.js"><link rel="prefetch" href="/assets/js/88.ab52b170.js"><link rel="prefetch" href="/assets/js/89.77d1009d.js"><link rel="prefetch" href="/assets/js/9.0e08b3f1.js"><link rel="prefetch" href="/assets/js/90.0a487dbe.js"><link rel="prefetch" href="/assets/js/91.6317c6cd.js"><link rel="prefetch" href="/assets/js/92.feacde27.js"><link rel="prefetch" href="/assets/js/93.cf47406a.js"><link rel="prefetch" href="/assets/js/94.78132be4.js"><link rel="prefetch" href="/assets/js/95.ffb30cc7.js"><link rel="prefetch" href="/assets/js/96.9650f55c.js"><link rel="prefetch" href="/assets/js/97.c5eab882.js"><link rel="prefetch" href="/assets/js/98.2b3d1d60.js"><link rel="prefetch" href="/assets/js/99.cf458698.js">
    <link rel="stylesheet" href="/assets/css/0.styles.763ae045.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/doc/2.8.0/" class="home-link router-link-active"><!----> <span class="site-name">Apache Ignite技术服务</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/doc/2.8.0/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/doc/2.8.0/java/" class="nav-link router-link-active">
  Java
</a></div><div class="nav-item"><a href="/doc/2.8.0/cpp/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="/doc/2.8.0/net/" class="nav-link">
  C#/.NET
</a></div><div class="nav-item"><a href="/doc/2.8.0/sql/" class="nav-link">
  SQL
</a></div><div class="nav-item"><a href="/doc/2.8.0/integration/" class="nav-link">
  集成
</a></div><div class="nav-item"><a href="/doc/2.8.0/spark/" class="nav-link">
  Ignite&amp;Spark
</a></div><div class="nav-item"><a href="/doc/2.8.0/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">2.8.0</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">2.8.0</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  2.9.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.8.0/java/ThinClients.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  2.8.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.7.0/java/ThinClients.html" class="nav-link">
  2.7.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/java/ThinClients.html" class="nav-link">
  2.6.0
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/doc/2.8.0/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/doc/2.8.0/java/" class="nav-link router-link-active">
  Java
</a></div><div class="nav-item"><a href="/doc/2.8.0/cpp/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="/doc/2.8.0/net/" class="nav-link">
  C#/.NET
</a></div><div class="nav-item"><a href="/doc/2.8.0/sql/" class="nav-link">
  SQL
</a></div><div class="nav-item"><a href="/doc/2.8.0/integration/" class="nav-link">
  集成
</a></div><div class="nav-item"><a href="/doc/2.8.0/spark/" class="nav-link">
  Ignite&amp;Spark
</a></div><div class="nav-item"><a href="/doc/2.8.0/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">2.8.0</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">2.8.0</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  2.9.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.8.0/java/ThinClients.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  2.8.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.7.0/java/ThinClients.html" class="nav-link">
  2.7.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/java/ThinClients.html" class="nav-link">
  2.6.0
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/doc/2.8.0/java/" aria-current="page" class="sidebar-link">资源</a></li><li><a href="/doc/2.8.0/java/BasicConcepts.html" class="sidebar-link">基本概念</a></li><li><a href="/doc/2.8.0/java/InstallAndDeployment.html" class="sidebar-link">安装和部署</a></li><li><a href="/doc/2.8.0/java/KubernetesDeployment.html" class="sidebar-link">Kubernetes部署</a></li><li><a href="/doc/2.8.0/java/Clustering.html" class="sidebar-link">集群化</a></li><li><a href="/doc/2.8.0/java/Key-ValueDataGrid.html" class="sidebar-link">键-值数据网格</a></li><li><a href="/doc/2.8.0/java/DataLoadingStreaming.html" class="sidebar-link">数据注入和流处理</a></li><li><a href="/doc/2.8.0/java/DistributedDataStructures.html" class="sidebar-link">分布式数据结构</a></li><li><a href="/doc/2.8.0/java/ComputeGrid.html" class="sidebar-link">计算网格</a></li><li><a href="/doc/2.8.0/java/ServiceGrid.html" class="sidebar-link">服务网格</a></li><li><a href="/doc/2.8.0/java/MessagingEvents.html" class="sidebar-link">消息和事件</a></li><li><a href="/doc/2.8.0/java/DurableMemory.html" class="sidebar-link">固化内存</a></li><li><a href="/doc/2.8.0/java/Persistence.html" class="sidebar-link">持久化</a></li><li><a href="/doc/2.8.0/java/MachineLearning.html" class="sidebar-link">机器学习</a></li><li><a href="/doc/2.8.0/java/ThinClients.html" aria-current="page" class="active sidebar-link">瘦客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_1-瘦客户端" class="sidebar-link">1.瘦客户端</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_2-二进制客户端协议" class="sidebar-link">2.二进制客户端协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_2-1-二进制客户端协议" class="sidebar-link">2.1.二进制客户端协议</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_2-2-数据格式" class="sidebar-link">2.2.数据格式</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_2-3-键-值查询" class="sidebar-link">2.3.键-值查询</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_2-4-sql和扫描查询" class="sidebar-link">2.4.SQL和扫描查询</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_2-5-二进制类型元数据" class="sidebar-link">2.5.二进制类型元数据</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_2-6-缓存配置" class="sidebar-link">2.6.缓存配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_3-java瘦客户端" class="sidebar-link">3.Java瘦客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_3-1-java瘦客户端" class="sidebar-link">3.1.Java瘦客户端</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_3-2-初始化和配置" class="sidebar-link">3.2.初始化和配置</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_3-3-键-值" class="sidebar-link">3.3.键-值</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_3-4-sql" class="sidebar-link">3.4.SQL</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_3-5-二进制类型" class="sidebar-link">3.5.二进制类型</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_3-6-安全" class="sidebar-link">3.6.安全</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_4-node-js瘦客户端" class="sidebar-link">4.Node.js瘦客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_4-1-node-js瘦客户端" class="sidebar-link">4.1.Node.js瘦客户端</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_4-2-初始化和配置" class="sidebar-link">4.2.初始化和配置</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_4-3-键-值" class="sidebar-link">4.3.键-值</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_4-4-sql" class="sidebar-link">4.4.SQL</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_4-5-二进制类型" class="sidebar-link">4.5.二进制类型</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_4-6-安全" class="sidebar-link">4.6.安全</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_5-python瘦客户端" class="sidebar-link">5.Python瘦客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_5-1-python瘦客户端" class="sidebar-link">5.1.Python瘦客户端</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_5-2-初始化和配置" class="sidebar-link">5.2.初始化和配置</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_5-3-键-值" class="sidebar-link">5.3.键-值</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_5-4-sql" class="sidebar-link">5.4.SQL</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_5-5-二进制类型" class="sidebar-link">5.5.二进制类型</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_5-6-安全" class="sidebar-link">5.6.安全</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_6-php瘦客户端" class="sidebar-link">6.PHP瘦客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_6-1-php瘦客户端" class="sidebar-link">6.1.PHP瘦客户端</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_6-2-初始化和配置" class="sidebar-link">6.2.初始化和配置</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_6-3-键-值" class="sidebar-link">6.3.键-值</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_6-4-sql" class="sidebar-link">6.4.SQL</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_6-5-二进制对象" class="sidebar-link">6.5.二进制对象</a></li><li class="sidebar-sub-header"><a href="/doc/2.8.0/java/ThinClients.html#_6-6-安全" class="sidebar-link">6.6.安全</a></li></ul></li></ul></li><li><a href="/doc/2.8.0/java/PlatformsProtocols.html" class="sidebar-link">平台和协议</a></li><li><a href="/doc/2.8.0/java/Plugins.html" class="sidebar-link">插件</a></li><li><a href="/doc/2.8.0/java/Security.html" class="sidebar-link">安全</a></li><li><a href="/doc/2.8.0/java/TestsAndBenchmarking.html" class="sidebar-link">基准测试</a></li><li><a href="/doc/2.8.0/java/Metrics.html" class="sidebar-link">指标</a></li><li><a href="/doc/2.8.0/java/ProductionReadiness.html" class="sidebar-link">生产准备</a></li><li><a href="/doc/2.8.0/java/Legal.html" class="sidebar-link">法律条款</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="瘦客户端"><a href="#瘦客户端" class="header-anchor">#</a> 瘦客户端</h1> <h2 id="_1-瘦客户端"><a href="#_1-瘦客户端" class="header-anchor">#</a> 1.瘦客户端</h2> <p>瘦客户端是一个轻量级的Ignite客户端，通过标准的Socket连接接入集群，它不会启动一个JVM进程（不需要Java），不会成为集群拓扑的一部分，也不持有任何数据，也不会参与计算网格的计算。</p> <p>它所做的只是简单地建立一个与标准Ignite节点的Socket连接，并通过该节点执行所有操作。</p> <p>瘦客户端基于二进制客户端协议，这样任何语言都可以接入Ignite集群，目前如下的客户端可用：</p> <ul><li>Java瘦客户端</li> <li>.NET瘦客户端</li> <li>C++瘦客户端</li> <li>NodeJS瘦客户端</li> <li>Python瘦客户端</li> <li>PHP瘦客户端</li></ul> <h2 id="_2-二进制客户端协议"><a href="#_2-二进制客户端协议" class="header-anchor">#</a> 2.二进制客户端协议</h2> <h3 id="_2-1-二进制客户端协议"><a href="#_2-1-二进制客户端协议" class="header-anchor">#</a> 2.1.二进制客户端协议</h3> <h4 id="_2-1-1-概述"><a href="#_2-1-1-概述" class="header-anchor">#</a> 2.1.1.概述</h4> <p>Ignite的二进制客户端协议使得应用不用启动一个全功能的节点，就可以与已有的集群进行通信。应用使用原始的TCP套接字，就可以接入集群。连接建立之后，就可以使用定义好的格式执行缓存操作。</p> <p>与集群通信，客户端必须遵守下述的数据格式和通信细节。</p> <h4 id="_2-1-2-数据格式"><a href="#_2-1-2-数据格式" class="header-anchor">#</a> 2.1.2.数据格式</h4> <p><strong>字节序</strong></p> <p>Ignite的二进制客户端协议使用小端字节顺序。</p> <p><strong>数据对象</strong></p> <p>业务数据，比如缓存的键和值，是以Ignite的<a href="/doc/2.8.0/java/#_8-二进制编组器">二进制对象</a>表示的，一个数据对象可以是标准类型（预定义），也可以是复杂对象，具体可以看<a href="#_2-2-%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F">数据格式</a>的相关章节。</p> <h4 id="_2-1-3-消息格式"><a href="#_2-1-3-消息格式" class="header-anchor">#</a> 2.1.3.消息格式</h4> <p>所有消息的请求和响应，包括握手，都以<code>int</code>类型消息长度开始（不包括开始的4个字节），后面是消息体。</p> <p><strong>握手</strong></p> <p>二进制客户端协议需要一个连接握手，来确保客户端和服务端版本的兼容性。下表会显示请求和响应握手消息的结构，下面的示例章节中还会显示如何发送和接收握手请求及其对应的响应。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>int</code></td> <td>握手有效消息长度</td></tr> <tr><td><code>byte</code></td> <td>握手码，值为1</td></tr> <tr><td><code>short</code></td> <td>主版本号</td></tr> <tr><td><code>short</code></td> <td>次版本号</td></tr> <tr><td><code>short</code></td> <td>修订版本号</td></tr> <tr><td><code>byte</code></td> <td>客户端码，值为2</td></tr> <tr><td><code>string</code></td> <td>用户名</td></tr> <tr><td><code>string</code></td> <td>密码</td></tr></tbody></table> <table><thead><tr><th>响应类型（成功）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>int</code></td> <td>成功消息长度，1</td></tr> <tr><td><code>byte</code></td> <td>成功标志，1</td></tr></tbody></table> <table><thead><tr><th>响应类型（失败）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>int</code></td> <td>错误消息长度</td></tr> <tr><td><code>byte</code></td> <td>成功标志，0</td></tr> <tr><td><code>short</code></td> <td>服务端主版本号</td></tr> <tr><td><code>short</code></td> <td>服务端次版本号</td></tr> <tr><td><code>short</code></td> <td>服务端修订版本号</td></tr> <tr><td><code>string</code></td> <td>错误消息</td></tr></tbody></table> <p><strong>标准消息头</strong></p> <p>客户端操作消息由消息头和与操作有关的数据的消息体组成，每个操作都有自己的数据请求和响应格式，以及一个通用头。
下面的表格和示例显示了客户端操作消息头的请求和响应结构。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>int</code></td> <td>有效信息长度</td></tr> <tr><td><code>short</code></td> <td>操作码</td></tr> <tr><td><code>long</code></td> <td>请求Id，客户端生成，响应中也会返回</td></tr></tbody></table> <p>请求头：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token keyword">int</span> reqLength<span class="token punctuation">,</span> <span class="token keyword">short</span> opCode<span class="token punctuation">,</span> <span class="token keyword">long</span> reqId<span class="token punctuation">,</span> <span class="token class-name">DataOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token comment">// Message length</span>
  <span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">+</span> reqLength<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Op code</span>
  <span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span>opCode<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Request id</span>
  <span class="token function">writeLongLittleEndian</span><span class="token punctuation">(</span>reqId<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>int</code></td> <td>响应消息长度</td></tr> <tr><td><code>long</code></td> <td>请求Id</td></tr> <tr><td><code>int</code></td> <td>状态码，（0为成功，其它为错误码）</td></tr> <tr><td><code>string</code></td> <td>错误消息（只有状态码非0时才会有）</td></tr></tbody></table> <p>响应头：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">readResponseHeader</span><span class="token punctuation">(</span><span class="token class-name">DataInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token comment">// Response length</span>
  <span class="token keyword">final</span> <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Request id</span>
  <span class="token keyword">long</span> resReqId <span class="token operator">=</span> <span class="token function">readLongLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Success code</span>
  <span class="token keyword">int</span> statusCode <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-1-4-接入"><a href="#_2-1-4-接入" class="header-anchor">#</a> 2.1.4.接入</h4> <p><strong>TCP套接字</strong></p> <p>客户端应用接入服务端节点需要通过TCP套接字，连接器默认使用<code>10800</code>端口。可以在集群的<code>IgniteConfiguration</code>中的<code>clientConnectorConfiguration</code>属性中，配置端口号及其它的服务端连接参数，如下所示：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="xml" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ignite.cfg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Thin client connection configuration. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>clientConnectorConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.ClientConnectorConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>host<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>127.0.0.1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>port<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10900<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>portRange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>30<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Other Ignite Configurations. --&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code>	<span class="token class-name">IgniteConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ClientConnectorConfiguration</span> ccfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConnectorConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ccfg<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ccfg<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">10900</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ccfg<span class="token punctuation">.</span><span class="token function">setPortRange</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set client connection configuration in IgniteConfiguration</span>
cfg<span class="token punctuation">.</span><span class="token function">setClientConnectorConfiguration</span><span class="token punctuation">(</span>ccfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start Ignite node</span>
<span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <p><strong>连接握手</strong></p> <p>除了套接字连接之外，瘦客户端协议还需要连接握手，以确保客户端和服务端版本兼容。注意握手必须是连接建立后的<strong>第一条消息</strong>。</p> <p>对于握手消息的请求和响应数据结构，可以看上面的握手章节。</p> <p><strong>示例</strong></p> <p>套接字和握手连接：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">&quot;yourUsername&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">&quot;yourPassword&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Message length</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">18</span> <span class="token operator">+</span> username<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> password<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Handshake operation</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Protocol version 1.0.0</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Client code: thin client</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// username</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// password</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// send request</span>
out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Receive handshake response</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> successFlag <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Since Ignite binary protocol uses little-endian byte order,</span>
<span class="token comment">// we need to implement big-endian to little-endian</span>
<span class="token comment">// conversion methods for write and read.</span>

<span class="token comment">// Write int in little-endian byte order</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">,</span> <span class="token class-name">DataOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Write short in little-endian byte order</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">,</span> <span class="token class-name">DataOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Write byte in little-endian byte order</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">,</span> <span class="token class-name">DataOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Read int in little-endian byte order</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span><span class="token class-name">DataInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> ch1 <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> ch2 <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> ch3 <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> ch4 <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ch1 <span class="token operator">|</span> ch2 <span class="token operator">|</span> ch3 <span class="token operator">|</span> ch4<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">EOFException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ch4 <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>ch3 <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>ch2 <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>ch1 <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// Read byte in little-endian byte order</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">byte</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span><span class="token class-name">DataInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Other write and read methods</span>
</code></pre></div><h4 id="_2-1-5-客户端操作"><a href="#_2-1-5-客户端操作" class="header-anchor">#</a> 2.1.5.客户端操作</h4> <p>握手成功之后，客户端就可以执行各种缓存操作了。</p> <ul><li>键-值查询；</li> <li>SQL和扫描查询；</li> <li>二进制类型操作；</li> <li>缓存配置操作。</li></ul> <h3 id="_2-2-数据格式"><a href="#_2-2-数据格式" class="header-anchor">#</a> 2.2.数据格式</h3> <p>标准数据类型表示为类型代码和值的组合。</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>type_code</code></td> <td>1</td> <td>有符号的单字节整数代码，表示值的类型。</td></tr> <tr><td><code>value</code></td> <td>可变长度</td> <td>值本身，类型和大小取决于<code>type_code</code></td></tr></tbody></table> <p>下面会详细描述支持的类型及其格式。</p> <h4 id="_2-2-1-基础类型"><a href="#_2-2-1-基础类型" class="header-anchor">#</a> 2.2.1.基础类型</h4> <p>基础类型都是非常基本的类型，比如数值类型。</p> <p><strong>Byte</strong></p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Type</code></td> <td>1</td> <td>1</td></tr> <tr><td><code>Value</code></td> <td>1</td> <td>单字节值</td></tr></tbody></table> <p><strong>Short</strong></p> <p>类型代码：2</p> <p>2字节有符号长整形数值，小端字节顺序。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Value</code></td> <td>2</td> <td>值</td></tr></tbody></table> <p><strong>Int</strong></p> <p>类型代码：3</p> <p>4字节有符号长整形数值，小端字节顺序。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Value</code></td> <td>4</td> <td>值</td></tr></tbody></table> <p><strong>Long</strong></p> <p>类型代码：4</p> <p>8字节有符号长整形数值，小端字节顺序。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Value</code></td> <td>8</td> <td>值</td></tr></tbody></table> <p><strong>Float</strong></p> <p>类型代码：5</p> <p>4字节IEEE 754长浮点数值，小端字节顺序。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Value</code></td> <td>4</td> <td>值</td></tr></tbody></table> <p><strong>Double</strong></p> <p>类型代码：6</p> <p>8字节IEEE 754长浮点数值，小端字节顺序。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Value</code></td> <td>8</td> <td>值</td></tr></tbody></table> <p><strong>Char</strong></p> <p>类型代码：7</p> <p>单UTF-16代码单元，小端字节顺序。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Value</code></td> <td>2</td> <td>UTF-16代码单元，小端字节顺序</td></tr></tbody></table> <p><strong>Bool</strong></p> <p>类型代码：8</p> <p>布尔值，0为<code>false</code>，非零为<code>true</code>。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Value</code></td> <td>1</td> <td>0为<code>false</code>，非零为<code>true</code></td></tr></tbody></table> <p><strong>NULL</strong></p> <p>类型代码：101</p> <p>这不是一个确切的类型，只是一个空值，可以分配给任何类型的对象。</p> <p>没有实际内容，只有类型代码。</p> <h4 id="_2-2-2-标准对象"><a href="#_2-2-2-标准对象" class="header-anchor">#</a> 2.2.2.标准对象</h4> <p><strong>String</strong></p> <p>类型代码：9</p> <p>UTF-8编码的字符串，必须是有效的UTF-8编码的字符串。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>低位优先的有符号整数，字符串的长度，以UTF-8代码单位表示，即字节</td></tr> <tr><td><code>data</code></td> <td><code>length</code></td> <td>无BOM的UTF-8编码的字符串数据</td></tr></tbody></table> <p><strong>UUID（Guid）</strong></p> <p>类型代码：10</p> <p>一个统一唯一标识符（UUID）是一个128为的数值，用于在计算机系统中标识信息。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>most_significant_bits</code></td> <td>8</td> <td>低位优先的64位字节数值，表示UUID的64个最高有效位。</td></tr> <tr><td><code>least_significant_bits</code></td> <td>8</td> <td>低位优先的64位字节数值，表示UUID的64个最低有效位。</td></tr></tbody></table> <p><strong>Timestamp</strong></p> <p>类型代码：33</p> <p>比<code>Date</code>数据类型更精确。除了从epoch开始的毫秒外，包含最后一毫秒的纳秒部分，该值范围在0到999999之间。这意味着，可以通过以下表达式获得以纳秒为单位的完整时间戳：<code>msecs_since_epoch \* 1000000 + msec_fraction_in_nsecs</code>。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>纳秒时间戳计算表达式仅供评估之用。在生产中不应该使用该表达式，因为在某些语言中，表达式可能导致整数溢出。</p></div> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>msecs_since_epoch</code></td> <td>8</td> <td>低位优先的有符号整形值，该值为从<code>00:00:00 1 Jan 1970 UTC</code>开始过去的毫秒数，这个格式通常称为Unix或者POSIX时间。</td></tr> <tr><td><code>msec_fraction_in_nsecs</code></td> <td>4</td> <td>低位优先的有符号整形值，一个毫秒的纳秒部分。</td></tr></tbody></table> <p><strong>Date</strong></p> <p>类型代码：11</p> <p>日期，该值为从<code>00:00:00 1 Jan 1970 UTC</code>开始过去的毫秒数，这个格式通常称为Unix或者POSIX时间。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>msecs_since_epoch</code></td> <td>8</td> <td>低位优先的有符号整形值。</td></tr></tbody></table> <p><strong>Time</strong></p> <p>类型代码：36</p> <p>时间，表示为从午夜（即00:00:00 UTC）起经过的毫秒数。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>value</code></td> <td>8</td> <td>低位优先的有符号整形值，表示为从<code>00:00:00 UTC</code>起经过的毫秒数。</td></tr></tbody></table> <p><strong>Decimal</strong></p> <p>类型代码：30</p> <p>任何所需精度和比例的数值。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>scale</code></td> <td>4</td> <td>低位优先的有符号整形值，实际为十的幂，在此基础上原值要做除法，比如，比例为3的42为0.042，比例为-3的42为42000，比例为1的42为42。</td></tr> <tr><td><code>length</code></td> <td>4</td> <td>低位优先的有符号整形值，数字的长度（字节）。</td></tr> <tr><td><code>data</code></td> <td><code>length</code></td> <td>第一位是负数标志。如果为1，则值为负数。其它位以高位优先格式的有符号的变长整数。</td></tr></tbody></table> <p><strong>Enum</strong></p> <p>类型代码：28</p> <p>枚举类型值，这些类型只定义了有限数量的命名值。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>type_id</code></td> <td>4</td> <td>低位优先的有符号整形值，具体可以看下面的<code>Type ID</code>。</td></tr> <tr><td><code>ordinal</code></td> <td>4</td> <td>低位优先的有符号整形值，枚举值序号。它在枚举声明中的位置，初始常数为0。</td></tr></tbody></table> <h4 id="_2-2-3-基础类型数组"><a href="#_2-2-3-基础类型数组" class="header-anchor">#</a> 2.2.3.基础类型数组</h4> <p>这种数组只包含值（元素）的内容，它们类型类似，具体可以看下表的格式描述。注意数组只包含内容，没有类型代码。</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组中元素的个数。</td></tr> <tr><td><code>element_0_payload</code></td> <td>依赖于类型</td> <td>元素0的内容。</td></tr> <tr><td><code>element_1_payload</code></td> <td>依赖于类型</td> <td>元素1的内容。</td></tr> <tr><td><code>element_N_payload</code></td> <td>依赖于类型</td> <td>元素N的内容。</td></tr></tbody></table> <p><strong>Byte数组</strong></p> <p>类型代码：12</p> <p>字节数组。可以是一段原始数据，也可以是一组小的有符号整数。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code></td> <td>元素序列。每个元素都是<code>byte</code>类型。</td></tr></tbody></table> <p><strong>Short数组</strong></p> <p>类型代码：13</p> <p>有符号短整形数值数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code> × 2</td> <td>元素序列。每个元素都是<code>short</code>类型。</td></tr></tbody></table> <p><strong>Int数组</strong></p> <p>类型代码：14</p> <p>有符号整形数值数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code> × 4</td> <td>元素序列。每个元素都是<code>int</code>类型。</td></tr></tbody></table> <p><strong>Long数组</strong></p> <p>类型代码：15</p> <p>有符号长整形数值数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code> × 8</td> <td>元素序列。每个元素都是<code>long</code>类型。</td></tr></tbody></table> <p><strong>Float数组</strong></p> <p>类型代码：16</p> <p>浮点型数值数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code> × 4</td> <td>元素序列。每个元素都是<code>float</code>类型。</td></tr></tbody></table> <p><strong>Double数组</strong></p> <p>类型代码：17</p> <p>双精度浮点型数值数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code> × 8</td> <td>元素序列。每个元素都是<code>double</code>类型。</td></tr></tbody></table> <p><strong>Char数组</strong></p> <p>类型代码：18</p> <p>UTF-16编码单元数组。和<code>String</code>不同，此类型不是必须包含有效的UTF-16文本。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code> × 2</td> <td>元素序列。每个元素都是<code>char</code>类型。</td></tr></tbody></table> <p><strong>Bool数组</strong></p> <p>类型代码：19</p> <p>布尔值数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code></td> <td>元素序列。每个元素都是<code>bool</code>类型。</td></tr></tbody></table> <h4 id="_2-2-4-标准对象数组"><a href="#_2-2-4-标准对象数组" class="header-anchor">#</a> 2.2.4.标准对象数组</h4> <p>这种数组包含完整值（元素）的内容，这意味着，数组的元素包含类型代码和内容。此格式允许元素为<code>NULL</code>值。这就是它们被称为“对象”的原因。它们都有相似的格式，具体可以看下表的格式描述。</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组中元素的个数。</td></tr> <tr><td><code>element_0_full_value</code></td> <td>依赖于值类型</td> <td>元素0的完整值，包含类型代码和内容，可以为<code>NULL</code>。</td></tr> <tr><td><code>element_1_full_value</code></td> <td>依赖于值类型</td> <td>元素1的完整值或<code>NULL</code>。</td></tr> <tr><td><code>element_N_full_value</code></td> <td>依赖于值类型</td> <td>元素N的完整值或<code>NULL</code>。</td></tr></tbody></table> <p><strong>String数组</strong></p> <p>类型代码：20</p> <p>UTF-8字符串数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，取决于每个字符串的长度，对于每个元素，字符串为<code>5 + 值长度</code>，<code>NULL</code>为<code>1</code></td> <td>元素序列。每个元素都是<code>string</code>类型的完整值，包括类型代码，或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>UUID（Guid）数组</strong></p> <p>类型代码：21</p> <p>UUID（Guid）数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，对于每个元素，UUID为<code>17</code>，<code>NULL</code>为<code>1</code></td> <td>元素序列。每个元素都是<code>uuid</code>类型的完整值，包括类型代码，或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>Timestamp数组</strong></p> <p>类型代码：34</p> <p>时间戳数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，对于每个元素，Timestamp为<code>13</code>，<code>NULL</code>为<code>1</code></td> <td>元素序列。每个元素都是<code>timestamp</code>类型的完整值，包括类型代码，或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>Date数组</strong></p> <p>类型代码：22</p> <p>日期数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，对于每个元素，Date为<code>9</code>，<code>NULL</code>为<code>1</code></td> <td>元素序列。每个元素都是<code>date</code>类型的完整值，包括类型代码，或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>Time数组</strong></p> <p>类型代码：37</p> <p>时间数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，对于每个元素，Time为<code>9</code>，<code>NULL</code>为<code>1</code></td> <td>元素序列。每个元素都是<code>time</code>类型的完整值，包括类型代码，或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>Decimal数组</strong></p> <p>类型代码：31</p> <p>数值数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，对于每个元素，数值为<code>9 + 值长度</code>，<code>NULL</code>为<code>1</code></td> <td>元素序列。每个元素都是<code>decimal</code>类型的完整值，包括类型代码，或者<code>NULL</code>。</td></tr></tbody></table> <h4 id="_2-2-5-对象集合"><a href="#_2-2-5-对象集合" class="header-anchor">#</a> 2.2.5.对象集合</h4> <p><strong>对象数组</strong></p> <p>类型代码：23</p> <p>任意类型对象数组。包括任意类型的标准对象、以及各种类型的复杂对象、<code>NULL</code>值及其它们的任意组合，这也意味着，集合可以包含其它的集合。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>type_id</code></td> <td>4</td> <td>包含对象的类型描述符，比如，Java中这个类型会用于反序列化为<code>Type[]</code>，显然，数组中的所有对象都应该有个<code>Type</code>作为父类型，这是任意对象类型的父类型。比如，在Java中是<code>java.lang.Object</code>，这样的<code>根</code>对象类型的Type ID为<code>-1</code>，具体下面会详述。</td></tr> <tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，取决于对象的长度</td> <td>元素序列。每个元素都是任意类型的完整值，或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>集合</strong></p> <p>类型代码：24</p> <p>通用集合类型，和对象数组一样，包含对象，但是和数组不同，它有一个针对特定类型反序列化到平台特定集合的提示，不仅仅是个数组，它支持下面的集合类型：</p> <ul><li><code>USER_SET</code>：-1，这是常规集合类型，无法映射到更具体的集合类型。不过，众所周知，它是固定的。将这样的集合反序列化为平台上基本和更广泛使用的集合类型是有意义的，例如哈希集合；</li> <li><code>USER_COL</code>：0，这是常规集合类型，无法映射到更具体的集合类型。将这样的集合反序列化为平台上基本和更广泛使用的集合类型是有意义的，例如可变大小数组；</li> <li><code>ARR_LIST</code>：1，这实际上是一种可变大小的数组类型；</li> <li><code>LINKED_LIST</code>：2，这是链表类型；</li> <li><code>HASH_SET</code>：3，这是基本的哈希集合类型；</li> <li><code>LINKED_HASH_SET</code>：4，这是一个哈希集合类型，会维护元素的顺序；</li> <li><code>SINGLETON_LIST</code>：5，这是一个只有一个元素的集合，可供平台用于优化目的。如果不适用，则可以使用任何集合类型。</li></ul> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p>集合类型字节用作将集合反序列化为特定平台最合适类型的提示。例如在Java中，<code>HASH_SET</code>会反序列化为<code>java.util.HashSet</code>，而<code>LINKED_HASH_SET</code>会反序列化为<code>java.util.LinkedHashSet</code>。建议瘦客户端实现在序列化和反序列化时尝试使用最合适的集合类型。但是，这只是一个提示，如果它与平台无关或不适用，可以忽略它。</p></div> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>type</code></td> <td>1</td> <td>集合的类型</td></tr> <tr><td><code>elements</code></td> <td>可变长度，取决于对象的大小</td> <td>元素序列。每个元素都是任意类型的完整值，或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>映射</strong></p> <p>类型代码：25</p> <p>类似Map的集合类型，包含成对的键和值对象，键和值可以为任意类型的对象，包括各种类型的标准对象、复杂对象以及组合对象。包含一个反序列化到具体Map类型的提示，支持下面的Map类型：</p> <ul><li><code>HASH_MAP</code>：1，这是基本的哈希映射；</li> <li><code>LINKED_HASH_MAP</code>：2，这也是一个哈希映射，但是会维护元素的顺序。</li></ul> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p>映射类型字节用作将集合反序列化为特定平台最合适类型的提示。建议瘦客户端实现在序列化和反序列化时尝试使用最合适的集合类型。但是，这只是一个提示，如果它与平台无关或不适用，可以忽略它。</p></div> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>type</code></td> <td>1</td> <td>集合的类型</td></tr> <tr><td><code>elements</code></td> <td>可变长度，取决于对象的大小</td> <td>元素序列。这里的元素都有键和值，成对出现，每个元素都是任意类型的完整值或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>枚举数组</strong></p> <p>类型代码：29</p> <p>枚举类型值数组，元素要么是枚举类型值，要么是NULL，所以，任意元素要么占用9字节，要么1字节。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>type_id</code></td> <td>4</td> <td>包含对象的类型描述符，比如，Java中这个类型会用于反序列化为<code>EnumType[]</code>，显然，数组中的所有对象都应该有个<code>EnumType</code>作为父类型，这是任意枚举对象类型的父类型，具体下面会详述。</td></tr> <tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，取决于对象的长度</td> <td>元素序列。每个元素都是枚举类型的完整值，或者<code>NULL</code>。</td></tr></tbody></table> <h4 id="_2-2-6-复杂对象"><a href="#_2-2-6-复杂对象" class="header-anchor">#</a> 2.2.6.复杂对象</h4> <p>类型代码：103</p> <p>复杂对象由一个24位的头、一组字段（数据对象）以及一个模式（字段ID和位置）组成。根据操作和数据模型，一个数据对象可以为一个基础类型或者复杂类型（一组字段）。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>是否必须</th></tr></thead> <tbody><tr><td><code>version</code></td> <td>1</td> <td>是</td></tr> <tr><td><code>flags</code></td> <td>2</td> <td>是</td></tr> <tr><td><code>type_id</code></td> <td>4</td> <td>是</td></tr> <tr><td><code>hash_code</code></td> <td>4</td> <td>是</td></tr> <tr><td><code>length</code></td> <td>4</td> <td>是</td></tr> <tr><td><code>schema_id</code></td> <td>4</td> <td>是</td></tr> <tr><td><code>object_fields</code></td> <td>可变长度</td> <td>否</td></tr> <tr><td><code>schema</code></td> <td>可变长度</td> <td>否</td></tr> <tr><td><code>raw_data_offset</code></td> <td>4</td> <td>否</td></tr></tbody></table> <p><strong>version</strong></p> <p>这是一个字段，指示复杂对象布局的版本。它是必须向后兼容的。客户端应该检查这个字段并向用户指出错误（如果不知道对象布局版本），以防止数据损坏和不可预知的反序列化结果。</p> <p><strong>flags</strong></p> <p>这个字段是16位的低位优先的掩码。包含对象标志，该标志指示读取器应如何处理对象实例。有以下标志：</p> <ul><li><code>USER_TYPE = 0x0001</code>：表示类型是用户类型，应始终为任何客户端类型设置，在反序列化时可以忽略；</li> <li><code>HAS_SCHEMA = 0x0002</code>：表示对象布局在尾部是否包含模式；</li> <li><code>HAS_RAW_DATA = 0x0004</code>：表示对象是否包含原始数据；</li> <li><code>OFFSET_ONE_BYTE = 0x0008</code>：表示模式字段偏移量为一个字节长度；</li> <li><code>OFFSET_TWO_BYTES = 0x0010</code>：表示模式字段偏移量为二个字节长度；</li> <li><code>COMPACT_FOOTER = 0x0020</code>：表示尾部不包含字段ID，只有偏移量。</li></ul> <p><strong>type_id</strong></p> <p>此字段包含唯一的类型标识符。它是低位优先的4个字节长度。默认情况下，<code>Type ID</code>是通过类型名称的Java风格的哈希值获得的。<code>Type ID</code>评估算法应该在集群中的所有平台上都相同，以便所有平台都能够使用此类型的对象进行操作。下面是所有瘦客户端推荐使用的默认<code>Type ID</code>计算算法：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> len <span class="token operator">=</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

  <span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

    c <span class="token operator">=</span> <span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>

    h <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">*</span> h <span class="token operator">+</span> c<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> h<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int32_t</span> <span class="token function">HashCode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> val<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>val <span class="token operator">&amp;&amp;</span> size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">int32_t</span> hash <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">char</span> c <span class="token operator">=</span> val<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'A'</span> <span class="token operator">&lt;=</span> c <span class="token operator">&amp;&amp;</span> c <span class="token operator">&lt;=</span> <span class="token string">'Z'</span><span class="token punctuation">)</span>
      c <span class="token operator">|=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>

    hash <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">*</span> hash <span class="token operator">+</span> c<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> hash<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <p><strong>hash_code</strong></p> <p>值的哈希编码，它是低位优先的4字节长度，它由不包含头部的内容部分的Java风格的哈希编码计算得来，Ignite引擎用来作比较用，比如用作键的比较。下面是哈希值的计算算法：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">dataHashCode</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> len <span class="token operator">=</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

  <span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    h <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">*</span> h <span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> h<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int32_t</span> <span class="token function">GetDataHashCode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> data<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">int32_t</span> hash <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token keyword">int8_t</span><span class="token operator">*</span> bytes <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">int8_t</span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    hash <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">*</span> hash <span class="token operator">+</span> bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> hash<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <p><strong>length</strong></p> <p>这个字段为对象（包括头部）的整体长度，它为低位优先的4字节整型值，通过在当前数据流的位置上简单地增加本字段值的偏移量，可以轻易地忽略整个对象。</p> <p><strong>schema_id</strong></p> <p>对象模式标识符。它为低位优先4字节值，并由所有对象字段ID的哈希值计算得出。它用于复杂的对象大小优化。Ignite使用<code>schema_id</code>来避免将整个模式写入到每个复杂对象值的末尾。相反，它将所有模式存储在二进制元数据存储中，并且只向对象写入字段偏移量。这种优化有助于显著减少包含许多短字段（如整型值）的复杂对象的大小。</p> <p>如果模式缺失（例如，以原始模式写入整个对象，或者没有任何字段），则<code>schema_id</code>字段为0。</p> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p>无法使用<code>type_id</code>确定<code>schema_id</code>，因为具有相同<code>type_id</code>的对象可以具有多个模式，即字段序列。</p></div> <p><code>schema_id</code>的计算算法如下：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/** FNV1 hash offset basis. */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> FNV1_OFFSET_BASIS <span class="token operator">=</span> <span class="token number">0x811C9DC5</span><span class="token punctuation">;</span>

<span class="token comment">/** FNV1 hash prime. */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> FNV1_PRIME <span class="token operator">=</span> <span class="token number">0x01000193</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">calculateSchemaId</span><span class="token punctuation">(</span><span class="token keyword">int</span> fieldIds<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fieldIds <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> fieldIds<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">int</span> len <span class="token operator">=</span> fieldIds<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

  <span class="token keyword">int</span> schemaId <span class="token operator">=</span> FNV1_OFFSET_BASIS<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    fieldId <span class="token operator">=</span> fieldIds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

    schemaId <span class="token operator">=</span> schemaId <span class="token operator">^</span> <span class="token punctuation">(</span>fieldId <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">=</span> schemaId <span class="token operator">*</span> FNV1_PRIME<span class="token punctuation">;</span>
    schemaId <span class="token operator">=</span> schemaId <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fieldId <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">=</span> schemaId <span class="token operator">*</span> FNV1_PRIME<span class="token punctuation">;</span>
    schemaId <span class="token operator">=</span> schemaId <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fieldId <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">=</span> schemaId <span class="token operator">*</span> FNV1_PRIME<span class="token punctuation">;</span>
    schemaId <span class="token operator">=</span> schemaId <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fieldId <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">=</span> schemaId <span class="token operator">*</span> FNV1_PRIME<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/** FNV1 hash offset basis. */</span>
<span class="token keyword">enum</span> <span class="token punctuation">{</span> FNV1_OFFSET_BASIS <span class="token operator">=</span> <span class="token number">0x811C9DC5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/** FNV1 hash prime. */</span>
<span class="token keyword">enum</span> <span class="token punctuation">{</span> FNV1_PRIME <span class="token operator">=</span> <span class="token number">0x01000193</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int32_t</span> <span class="token function">CalculateSchemaId</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int32_t</span><span class="token operator">*</span> fieldIds<span class="token punctuation">,</span> size_t num<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fieldIds <span class="token operator">||</span> num <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">int32_t</span> schemaId <span class="token operator">=</span> FNV1_OFFSET_BASIS<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    fieldId <span class="token operator">=</span> fieldIds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

    schemaId <span class="token operator">^=</span> fieldId <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">*=</span> FNV1_PRIME<span class="token punctuation">;</span>
    schemaId <span class="token operator">^=</span> <span class="token punctuation">(</span>fieldId <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">*=</span> FNV1_PRIME<span class="token punctuation">;</span>
    schemaId <span class="token operator">^=</span> <span class="token punctuation">(</span>fieldId <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">*=</span> FNV1_PRIME<span class="token punctuation">;</span>
    schemaId <span class="token operator">^=</span> <span class="token punctuation">(</span>fieldId <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">*=</span> FNV1_PRIME<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <p><strong>object_fields</strong></p> <p>对象字段。每个字段都是二进制对象，可以是复杂类型，也可以是标准类型。注意，一个没有任何字段的复杂对象也是有效的，可能会遇到。每个字段的名字可有可无。对于命名字段，在对象模式中会写入一个偏移量，通过该偏移量，可以在对象中将其定位，而无需对整个对象进行反序列化。没有名字的字段总是存储在命名字段之后，并以所谓的<code>原始模式</code>写入。</p> <p>因此，以原始模式写入的字段只能按与写入相同的顺序通过顺序读取进行访问，而命名字段则可以按随机顺序读取。</p> <p><strong>schema</strong></p> <p>对象模式。复杂对象的模式可有可无，因此此字段是可选的。如果对象中没有命名字段，则对象中不存在模式。它还包括当对象根本没有字段时的情况。可以检查<code>HAS_SCHEMA</code>对象标志，以确定该对象是否具有模式。</p> <p>模式的主要目的是可以对对象字段进行快速搜索。为此，模式在对象内容中包含对象字段的偏移序列。字段偏移本身的大小可能不同。这些字段的大小由最大偏移值在写入时确定。如果它在[24..255]字节范围内，则使用1字节偏移量；如果它在[256..65535]字节范围内，则使用2字节偏移量。其它情况使用4字节偏移量。要确定读取时偏移量的大小，客户端应该检查<code>OFFSET_ONE_BYTE</code>和<code>OFFSET_TWO_BYTES</code>标志。如果设置了<code>OFFSET_ONE_BYTE</code>标志，则偏移量为1字节长，否则如果设置了<code>OFFSET_TWO_BYTES</code>标志，则偏移量为2字节长，否则偏移量为4字节长。</p> <p>支持的模式有两种：</p> <ul><li><code>完整模式方式</code>：实现更简单，但使用更多资源；</li> <li><code>压缩尾部方式</code>：更难实现，但提供更好的性能并减少内存消耗，因此建议新客户端用此方式实现。</li></ul> <p>具体下面会介绍。</p> <p>注意，客户端应该校验<code>COMPACT_FOOTER</code>标志，来确定每个对象应该使用哪个方式。</p> <p><em>完整模式方式</em></p> <p>如果使用这个方式，<code>COMPACT_FOOTER</code>标志未配置，然后整个对象模式会被写入对象的尾部，这时只有复杂对象自身需要反序列化（<code>schema_id</code>字段会被忽略，并且不需要其它的数据），这时复杂对象的<code>schema</code>字段的结构如下：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>field_id_0</code></td> <td>4</td> <td>索引值为0的字段的ID，低位优先4字节，这个ID是通过字段名字用和<code>type_id</code>一样的方式计算得来的。</td></tr> <tr><td><code>field_offset_0</code></td> <td>可变长度，依赖于对象的大小：1,2或4</td> <td>低位优先无符号整数，对象中字段的偏移量，从完整对象值的第一个字节开始（即<code>type_code</code>的位置）。</td></tr> <tr><td><code>field_id_1</code></td> <td>4</td> <td>索引值为1的字段的ID，低位优先4字节。</td></tr> <tr><td><code>field_offset_1</code></td> <td>可变长度，依赖于对象的大小：1,2或4</td> <td>低位优先无符号整数，对象中字段的偏移量。</td></tr> <tr><td><code>field_id_N</code></td> <td>4</td> <td>索引值为N的字段的ID，低位优先4字节。</td></tr> <tr><td><code>field_offset_N</code></td> <td>可变长度，依赖于对象的大小：1,2或4</td> <td>低位优先无符号整数，对象中字段的偏移量。</td></tr></tbody></table> <p><em>压缩尾部方式</em></p> <p>这个模式中，配置了<code>COMPACT_FOOTER</code>标志然后只有字段偏移量的序列会被写入对象的尾部。这时，客户端使用<code>schema_id</code>字段搜索以前存储的元数据中的对象模式，以查找字段顺序并将字段与其偏移量关联。</p> <p>如果使用了这个方式，客户端需要在一个特定的元数据中持有模式，然后将其发送/接收给/自Ignite服务端，具体可以看<a href="/doc/2.8.0/java/ThinClients.html#_2-5-二进制类型元数据">二进制类型元数据</a>的相关章节。</p> <p>这个场景中<code>schema</code>的结构如下：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>field_offset_0</code></td> <td>可变长度，依赖于对象的大小：1,2或4</td> <td>低位优先无符号整数，对象中字段0的偏移量，从完整对象值的第一个字节开始（即<code>type_code</code>的位置）。</td></tr> <tr><td><code>field_offset_1</code></td> <td>可变长度，依赖于对象的大小：1,2或4</td> <td>低位优先无符号整数，对象中字段1的偏移量。</td></tr> <tr><td><code>field_offset_N</code></td> <td>可变长度，依赖于对象的大小：1,2或4</td> <td>低位优先无符号整数，对象中字段N的偏移量。</td></tr></tbody></table> <p><strong>raw_data_offset</strong></p> <p>可选字段。仅存在于对象中，如果有任何字段，则以原始模式写入。这时，设置了<code>HAS_RAW_DATA</code>标志并且存在原始数据偏移量字段，存储为低位优先4字节。该值指向复杂对象中的原始数据偏移量，从头部的第一个字节开始（即，此字段始终大于头部的长度）。</p> <p>此字段用于用户以原始模式开始读取时对流进行定位。</p> <h4 id="_2-2-7-特殊类型"><a href="#_2-2-7-特殊类型" class="header-anchor">#</a> 2.2.7.特殊类型</h4> <p><strong>包装数据</strong></p> <p>类型代码：27</p> <p>一个或多个二进制对象可以包装成一个数组，这样可以高效地读取、存储、传输和写入对象，而不需要理解它的内容，只进行简单的字节复制即可。</p> <p>所有缓存操作都返回包装器内的复杂对象（不是基础类型）。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>低位优先的4字节有符号整数，以字节计算的包装后的数据的大小。</td></tr> <tr><td><code>payload</code></td> <td><code>length</code></td> <td>内容</td></tr> <tr><td><code>offset</code></td> <td>4</td> <td>低位优先的4字节有符号整数，数组内对象的偏移量，数组内可以包含一个对象图，这个偏移量指向根对象。</td></tr></tbody></table> <p><strong>二进制枚举</strong></p> <p>类型代码：38</p> <p>包装枚举类型，引擎可以返回此类型以替代普通枚举类型。当使用二进制API时，枚举应该以这种形式写入。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>type_id</code></td> <td>4</td> <td>低位优先的4字节有符号整数，具体可以看<code>type_id</code>相关章节的内容。</td></tr> <tr><td><code>ordinal</code></td> <td>4</td> <td>低位优先的4字节有符号整数，枚举值序号，即在枚举声明中的位置，这个序号的初始值为0</td></tr></tbody></table> <h4 id="_2-2-8-序列化和反序列化示例"><a href="#_2-2-8-序列化和反序列化示例" class="header-anchor">#</a> 2.2.8.序列化和反序列化示例</h4> <p><strong>常规对象读</strong></p> <p>下面的代码模板，显示了如何从输入的字节流中读取各种类型的数据：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span><span class="token class-name">DataInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token keyword">byte</span> code <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
      <span class="token keyword">return</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token function">readShortLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token function">readLongLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">27</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Assume 0 offset for simplicity</span>
      <span class="token class-name">Object</span> res <span class="token operator">=</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token number">103</span><span class="token operator">:</span>
      <span class="token keyword">byte</span> ver <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">assert</span> ver <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// version</span>
      <span class="token keyword">short</span> flags <span class="token operator">=</span> <span class="token function">readShortLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> typeId <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> schemaId <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> schemaOffset <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Binary Object: &quot;</span> <span class="token operator">+</span> typeId<span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Unsupported type: &quot;</span> <span class="token operator">+</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Int</strong></p> <p>下面的代码片段显示了如何进行<code>int</code>类型的数据对象的读写，使用的是基于套接字的输出/输入流：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Write int data object</span>
<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read int data object</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> typeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>String</strong></p> <p>下面的代码片段显示了如何进行<code>String</code>类型的读写，格式如下：</p> <table><thead><tr><th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>byte</td> <td>字符串类型代码，0</td></tr> <tr><td>int</td> <td>UTF-8字节模式的字符串长度</td></tr> <tr><td>bytes</td> <td>实际字符串</td></tr></tbody></table> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> writeString <span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span> <span class="token class-name">DataOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// type code for String</span>

  <span class="token keyword">int</span> strLen <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// length of the string</span>
  <span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>strLen<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

  out<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">readString</span><span class="token punctuation">(</span><span class="token class-name">DataInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> type <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// type code</span>

  <span class="token keyword">int</span> strLen <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// length of the string</span>

  <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>strLen<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">readFully</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> strLen<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-3-键-值查询"><a href="#_2-3-键-值查询" class="header-anchor">#</a> 2.3.键-值查询</h3> <p>本章节会描述可以对缓存进行的键值操作，该键值操作等同于Ignite原生的缓存操作，具体可以看<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html" target="_self" rel="noopener noreferrer">IgniteCache</a>的文档，每个操作都会有一个<a href="#_2-1-3-%E6%B6%88%E6%81%AF%E6%A0%BC%E5%BC%8F">头信息</a>及与该操作对应的数据。</p> <p>关于可用的数据类型和数据格式规范的清单，可以参见<a href="#_2-2-%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F">数据格式</a>章节的介绍。</p> <h4 id="_2-3-1-操作代码"><a href="#_2-3-1-操作代码" class="header-anchor">#</a> 2.3.1.操作代码</h4> <p>与Ignite服务端节点成功握手后，客户端可以通过发送带有特定操作代码的请求（参见下面的请求/响应结构）来开始执行各种键值操作：</p> <table><thead><tr><th>操作</th> <th>操作代码</th></tr></thead> <tbody><tr><td><code>OP_CACHE_GET</code></td> <td>1000</td></tr> <tr><td><code>OP_CACHE_PUT</code></td> <td>1001</td></tr> <tr><td><code>OP_CACHE_PUT_IF_ABSENT</code></td> <td>1002</td></tr> <tr><td><code>OP_CACHE_GET_ALL</code></td> <td>1003</td></tr> <tr><td><code>OP_CACHE_PUT_ALL</code></td> <td>1004</td></tr> <tr><td><code>OP_CACHE_GET_AND_PUT</code></td> <td>1005</td></tr> <tr><td><code>OP_CACHE_GET_AND_REPLACE</code></td> <td>1006</td></tr> <tr><td><code>OP_CACHE_GET_AND_REMOVE</code></td> <td>1007</td></tr> <tr><td><code>OP_CACHE_GET_AND_PUT_IF_ABSENT</code></td> <td>1008</td></tr> <tr><td><code>OP_CACHE_REPLACE</code></td> <td>1009</td></tr> <tr><td><code>OP_CACHE_REPLACE_IF_EQUALS</code></td> <td>1010</td></tr> <tr><td><code>OP_CACHE_CONTAINS_KEY</code></td> <td>1011</td></tr> <tr><td><code>OP_CACHE_CONTAINS_KEYS</code></td> <td>1012</td></tr> <tr><td><code>OP_CACHE_CLEAR</code></td> <td>1013</td></tr> <tr><td><code>OP_CACHE_CLEAR_KEY</code></td> <td>1014</td></tr> <tr><td><code>OP_CACHE_CLEAR_KEYS</code></td> <td>1015</td></tr> <tr><td><code>OP_CACHE_REMOVE_KEY</code></td> <td>1016</td></tr> <tr><td><code>OP_CACHE_REMOVE_IF_EQUALS</code></td> <td>1017</td></tr> <tr><td><code>OP_CACHE_REMOVE_KEYS</code></td> <td>1018</td></tr> <tr><td><code>OP_CACHE_REMOVE_ALL</code></td> <td>1019</td></tr> <tr><td><code>OP_CACHE_GET_SIZE</code></td> <td>1020</td></tr></tbody></table> <p>注意上面提到的操作代码，是请求头的一部分，具体可以看<a href="#_2-1-3-%E6%B6%88%E6%81%AF%E6%A0%BC%E5%BC%8F">头信息</a>的相关内容。</p> <h4 id="_2-3-2-op-cache-get"><a href="#_2-3-2-op-cache-get" class="header-anchor">#</a> 2.3.2.OP_CACHE_GET</h4> <p>通过键从缓存获得值，如果不存在则返回<code>null</code>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>要返回的缓存条目的主键</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>数据对象</td> <td>给定主键对应的值，如果不存在则为<code>null</code></td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> OP_CACHE_GET<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting cache value (Data Object)</span>
<span class="token keyword">int</span> resTypeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-3-op-cache-get-all"><a href="#_2-3-3-op-cache-get-all" class="header-anchor">#</a> 2.3.3.OP_CACHE_GET_ALL</h4> <p>从一个缓存中获得多个键-值对。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>int</td> <td>键数量</td></tr> <tr><td>数据对象</td> <td>缓存条目的主键，重复多次，次数为前一个参数传递的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>int</td> <td>结果数量</td></tr> <tr><td>键对象+值对象</td> <td>返回的键-值对，不包含缓存中没有的条目，重复多次，次数为前一个参数返回的值</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> OP_CACHE_GET_ALL<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Key count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Data object 1</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key1<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Data object 2</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key2<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Result count</span>
<span class="token keyword">int</span> resCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> resCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Resulting data object</span>
  <span class="token keyword">int</span> resKeyTypeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Integer type code</span>
  <span class="token keyword">int</span> resKey <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Cache key</span>

  <span class="token comment">// Resulting data object</span>
  <span class="token keyword">int</span> resValTypeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Integer type code</span>
  <span class="token keyword">int</span> resValue <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Cache value</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <h4 id="_2-3-4-op-cache-put"><a href="#_2-3-4-op-cache-put" class="header-anchor">#</a> 2.3.4.OP_CACHE_PUT</h4> <p>往缓存中写入给定的键-值对（会覆盖已有的值）。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>键</td></tr> <tr><td>数据对象</td> <td>值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_CACHE_PUT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-5-op-cache-put-all"><a href="#_2-3-5-op-cache-put-all" class="header-anchor">#</a> 2.3.5.OP_CACHE_PUT_ALL</h4> <p>往缓存中写入给定的多个键-值对（会覆盖已有的值）。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>int</td> <td>键-值对数量</td></tr> <tr><td>键对象+值对象</td> <td>键-值对，重复多次，次数为前一个参数传递的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">29</span><span class="token punctuation">,</span> OP_CACHE_PUT_ALL<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Entry Count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object 1</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key1<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object 1</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value1<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>

<span class="token comment">// Cache key data object 2</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key2<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object 2</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value2<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-6-op-cache-contains-key"><a href="#_2-3-6-op-cache-contains-key" class="header-anchor">#</a> 2.3.6.OP_CACHE_CONTAINS_KEY</h4> <p>判断缓存中是否存在给定的键。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>缓存条目的主键</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>主键存在则为true，否则为false</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> OP_CACHE_CONTAINS_KEY<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Result</span>
<span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-7-op-cache-contains-keys"><a href="#_2-3-7-op-cache-contains-keys" class="header-anchor">#</a> 2.3.7.OP_CACHE_CONTAINS_KEYS</h4> <p>判断缓存中是否存在给定的所有键。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>int</td> <td>键数量</td></tr> <tr><td>数据对象</td> <td>缓存条目的主键，重复多次，次数为前一个参数传递的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>主键存在则为true，否则为false</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> OP_CACHE_CONTAINS_KEYS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object 1</span>
<span class="token keyword">int</span> key1 <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key1<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache key data object 2</span>
<span class="token keyword">int</span> key2 <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key2<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code>
<span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting boolean value</span>
<span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-8-op-cache-get-and-put"><a href="#_2-3-8-op-cache-get-and-put" class="header-anchor">#</a> 2.3.8.OP_CACHE_GET_AND_PUT</h4> <p>往缓存中插入一个键-值对，并且返回与该键对应的原值，如果缓存中没有该键，则会创建一个新的条目并返回<code>null</code>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>要更新的键</td></tr> <tr><td>数据对象</td> <td>给定键对应的新值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>数据对象</td> <td>给定键的原有值，或者为<code>null</code></td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_CACHE_GET_AND_PUT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting cache value (Data Object)</span>
<span class="token keyword">int</span> resTypeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-9-op-cache-get-and-replace"><a href="#_2-3-9-op-cache-get-and-replace" class="header-anchor">#</a> 2.3.9.OP_CACHE_GET_AND_REPLACE</h4> <p>替换缓存中给定键的值，然后返回原值，如果缓存中该键不存在，该操作会返回<code>null</code>而缓存不会有改变。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>要更新的键</td></tr> <tr><td>数据对象</td> <td>给定键对应的新值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>数据对象</td> <td>给定键的原有值，如果该键不存在则为<code>null</code></td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_CACHE_GET_AND_REPLACE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting cache value (Data Object)</span>
<span class="token keyword">int</span> resTypeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-10-op-cache-get-and-remove"><a href="#_2-3-10-op-cache-get-and-remove" class="header-anchor">#</a> 2.3.10.OP_CACHE_GET_AND_REMOVE</h4> <p>删除缓存中给定键对应的数据，然后返回原值，如果缓存中该键不存在，该操作会返回<code>null</code>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>要删除的键</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>数据对象</td> <td>给定键的原有值，如果该键不存在则为<code>null</code></td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> OP_CACHE_GET_AND_REMOVE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting cache value (Data Object)</span>
<span class="token keyword">int</span> resTypeCode <span class="token operator">=</span> <span class="token function">readByte</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">readInt</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-11-op-cache-put-if-absent"><a href="#_2-3-11-op-cache-put-if-absent" class="header-anchor">#</a> 2.3.11.OP_CACHE_PUT_IF_ABSENT</h4> <p>在条目不存在时插入一个新的条目。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>要插入的键</td></tr> <tr><td>数据对象</td> <td>给定键对应的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>插入成功为<code>true</code>，条目已存在为<code>false</code></td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_CACHE_PUT_IF_ABSENT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache Value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code> <span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting boolean value</span>
<span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-12-op-cache-get-and-put-if-absent"><a href="#_2-3-12-op-cache-get-and-put-if-absent" class="header-anchor">#</a> 2.3.12.OP_CACHE_GET_AND_PUT_IF_ABSENT</h4> <p>在条目不存在时插入一个新的条目，否则返回已有的值。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>要插入的键</td></tr> <tr><td>数据对象</td> <td>给定键对应的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>数据对象</td> <td>如果缓存没有该条目则返回<code>null</code>（这时会创建一个新条目），或者返回给定键对应的已有值。</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_CACHE_GET_AND_PUT_IF_ABSENT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting cache value (Data Object)</span>
<span class="token keyword">int</span> resTypeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-13-op-cache-replace"><a href="#_2-3-13-op-cache-replace" class="header-anchor">#</a> 2.3.13.OP_CACHE_REPLACE</h4> <p>替换缓存中已有键的值。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>键</td></tr> <tr><td>数据对象</td> <td>给定键对应的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>表示是否替换成功</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_CACHE_REPLACE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-14-op-cache-replace-if-equals"><a href="#_2-3-14-op-cache-replace-if-equals" class="header-anchor">#</a> 2.3.14.OP_CACHE_REPLACE_IF_EQUALS</h4> <p>当在缓存中给定的键已存在且值等于给定的值时，才会用新值替换旧值。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>键</td></tr> <tr><td>数据对象</td> <td>用于和给定的键对应的值做比较的值</td></tr> <tr><td>数据对象</td> <td>给定键对应的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>表示是否替换成功</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> OP_CACHE_REPLACE_IF_EQUALS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value to compare</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// New cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-15-op-cache-clear"><a href="#_2-3-15-op-cache-clear" class="header-anchor">#</a> 2.3.15.OP_CACHE_CLEAR</h4> <p>清空缓存而不通知监听器或者缓存写入器，具体可以看对应方法的<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html#clear--" target="_self" rel="noopener noreferrer">文档</a>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> OP_CACHE_CLEAR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-16-op-cache-clear-key"><a href="#_2-3-16-op-cache-clear-key" class="header-anchor">#</a> 2.3.16.OP_CACHE_CLEAR_KEY</h4> <p>清空缓存键而不通知监听器或者缓存写入器，具体可以看对应方法的<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html#clear-K-" target="_self" rel="noopener noreferrer">文档</a>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>缓存条目的键</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> OP_CACHE_CLEAR_KEY<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-17-op-cache-clear-keys"><a href="#_2-3-17-op-cache-clear-keys" class="header-anchor">#</a> 2.3.17.OP_CACHE_CLEAR_KEYS</h4> <p>清空缓存的多个键而不通知监听器或者缓存写入器，具体可以看对应方法的<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html#clearAll-java.util.Set-" target="_self" rel="noopener noreferrer">文档</a>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>int</td> <td>键数量</td></tr> <tr><td>数据对象×键数量</td> <td>缓存条目的键</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> OP_CACHE_CLEAR_KEYS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// key count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object 1</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key1<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache key data object 2</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key2<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-18-op-cache-remove-key"><a href="#_2-3-18-op-cache-remove-key" class="header-anchor">#</a> 2.3.18.OP_CACHE_REMOVE_KEY</h4> <p>删除给定键对应的数据，通知监听器和缓存的写入器，具体可以看相关方法的<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html#remove-K-" target="_self" rel="noopener noreferrer">文档</a>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>键</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>表示是否删除成功</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> OP_CACHE_REMOVE_KEY<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key1<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting boolean value</span>
<span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-19-op-cache-remove-if-equals"><a href="#_2-3-19-op-cache-remove-if-equals" class="header-anchor">#</a> 2.3.19.OP_CACHE_REMOVE_IF_EQUALS</h4> <p>当给定的值等于当前值时，删除缓存中给定键对应的条目，然后通知监听器和缓存写入器。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>要删除条目的键</td></tr> <tr><td>数据对象</td> <td>用于和当前值比较的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>表示是否删除成功</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_CACHE_REMOVE_IF_EQUALS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting boolean value</span>
<span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-20-op-cache-get-size"><a href="#_2-3-20-op-cache-get-size" class="header-anchor">#</a> 2.3.20.OP_CACHE_GET_SIZE</h4> <p>获取缓存条目的数量，该方法等同于<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html#size-org.apache.ignite.cache.CachePeekMode...-" target="_self" rel="noopener noreferrer">IgniteCache.size(CachePeekMode... peekModes)</a>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>int</td> <td>要请求的PEEK模式数值。当设置为0时，将使用<code>CachePeekMode.ALL</code>。当设置为正值时，需要在以下字段中指定应计数的条目类型：全部、备份、主或近缓存条目。</td></tr> <tr><td>byte</td> <td>表示要统计哪种类型的条目：0：所有，1：近缓存条目，2：主条目，3：备份条目，该字段的重复次数应等于上一个参数的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>long</td> <td>缓存大小</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> OP_CACHE_GET_SIZE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Peek mode count; '0' means All</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Peek mode</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Number of entries in cache</span>
<span class="token keyword">long</span> cacheSize <span class="token operator">=</span> <span class="token function">readLongLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-21-op-cache-remove-keys"><a href="#_2-3-21-op-cache-remove-keys" class="header-anchor">#</a> 2.3.21.OP_CACHE_REMOVE_KEYS</h4> <p>删除给定键对应的条目，通知监听器和缓存写入器，具体可以看相关方法的<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html#removeAll-java.util.Set-" target="_self" rel="noopener noreferrer">文档</a>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>int</td> <td>要删除的键数量</td></tr> <tr><td>数据对象</td> <td>要删除条目的键，如果该键不存在，则会被忽略，该字段必须提供，重复次数为前一个参数的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> OP_CACHE_REMOVE_KEYS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// key count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object 1</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key1<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object 2</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key2<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting cache value (Data Object)</span>
<span class="token keyword">int</span> resTypeCode <span class="token operator">=</span> <span class="token function">readByte</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">readInt</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-3-22-op-cache-remove-all"><a href="#_2-3-22-op-cache-remove-all" class="header-anchor">#</a> 2.3.22.OP_CACHE_REMOVE_ALL</h4> <p>从缓存中删除所有的条目，通知监听器和缓存写入器，具体可以看相关方法的<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html#removeAll--" target="_self" rel="noopener noreferrer">文档</a>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> OP_CACHE_REMOVE_ALL<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response length</span>
<span class="token keyword">final</span> <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request id</span>
<span class="token keyword">long</span> resReqId <span class="token operator">=</span> <span class="token function">readLongLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Success</span>
<span class="token keyword">int</span> statusCode <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h3 id="_2-4-sql和扫描查询"><a href="#_2-4-sql和扫描查询" class="header-anchor">#</a> 2.4.SQL和扫描查询</h3> <h4 id="_2-4-1-操作代码"><a href="#_2-4-1-操作代码" class="header-anchor">#</a> 2.4.1.操作代码</h4> <p>与Ignite服务端节点成功握手后，客户端就可以通过发送带有特定操作代码的请求（请参见下面的请求/响应结构）来执行各种SQL和扫描查询了：</p> <table><thead><tr><th>操作</th> <th>操作代码</th></tr></thead> <tbody><tr><td><code>OP_QUERY_SQL</code></td> <td>2002</td></tr> <tr><td><code>OP_QUERY_SQL_CURSOR_GET_PAGE</code></td> <td>2003</td></tr> <tr><td><code>OP_QUERY_SQL_FIELDS</code></td> <td>2004</td></tr> <tr><td><code>OP_QUERY_SQL_FIELDS_CURSOR_GET_PAGE</code></td> <td>2005</td></tr> <tr><td><code>OP_QUERY_SCAN</code></td> <td>2000</td></tr> <tr><td><code>OP_QUERY_SCAN_CURSOR_GET_PAGE</code></td> <td>2001</td></tr> <tr><td><code>OP_RESOURCE_CLOSE</code></td> <td>0</td></tr></tbody></table> <p>注意上面提到的操作代码，是请求头的一部分，具体可以看<a href="#_2-1-3-%E6%B6%88%E6%81%AF%E6%A0%BC%E5%BC%8F">头信息</a>的相关内容。</p> <h4 id="_2-4-2-op-query-sql"><a href="#_2-4-2-op-query-sql" class="header-anchor">#</a> 2.4.2.OP_QUERY_SQL</h4> <p>在集群存储的数据中执行SQL查询，查询会返回所有的结果集（键-值对）。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>string</td> <td>类型或者SQL表名</td></tr> <tr><td>string</td> <td>SQL查询字符串</td></tr> <tr><td>int</td> <td>查询参数个数</td></tr> <tr><td>数据对象</td> <td>查询参数，重复多次，次数为前一个参数传递的值</td></tr> <tr><td>bool</td> <td>分布式关联标志</td></tr> <tr><td>bool</td> <td>本地查询标志</td></tr> <tr><td>bool</td> <td>复制标志，查询是否只包含复制表</td></tr> <tr><td>int</td> <td>游标页面大小</td></tr> <tr><td>long</td> <td>超时时间（毫秒），应该为非负值，值为0会禁用超时功能</td></tr></tbody></table> <p>响应只包含第一页的结果。</p> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>long</td> <td>游标ID，可以被<code>OP_RESOURSE_CLOSE</code>关闭</td></tr> <tr><td>int</td> <td>第一页的行数</td></tr> <tr><td>键数据对象+值数据对象</td> <td>键-值对形式的记录，重复多次，次数为前一个参数返回的行数值</td></tr> <tr><td>bool</td> <td>指示是否有更多结果可通过<code>OP_QUERY_SQL_CURSOR_GET_PAGE</code>获取。如果为false，则查询游标将自动关闭。</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> entityName <span class="token operator">=</span> <span class="token string">&quot;Person&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> entityNameLength <span class="token operator">=</span> <span class="token function">getStrLen</span><span class="token punctuation">(</span>entityName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// UTF-8 bytes</span>

<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;Select * from Person&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> sqlLength <span class="token operator">=</span> <span class="token function">getStrLen</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">34</span> <span class="token operator">+</span> entityNameLength <span class="token operator">+</span> sqlLength<span class="token punctuation">,</span> OP_QUERY_SQL<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token class-name">String</span> queryCacheName <span class="token operator">=</span> <span class="token string">&quot;personCache&quot;</span><span class="token punctuation">;</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>queryCacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flag = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Query Entity</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>entityName<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// SQL query</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Argument count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Joins</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Local query</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Replicated</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// cursor page size</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Timeout</span>
<span class="token function">writeLongLittleEndian</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> cursorId <span class="token operator">=</span> <span class="token function">readLongLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> rowCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read entries (as user objects)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rowCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Object</span> key <span class="token operator">=</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Object</span> val <span class="token operator">=</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;CacheEntry: &quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">boolean</span> moreResults <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-4-3-op-query-sql-cursor-get-page"><a href="#_2-4-3-op-query-sql-cursor-get-page" class="header-anchor">#</a> 2.4.3.OP_QUERY_SQL_CURSOR_GET_PAGE</h4> <p>通过<code>OP_QUERY_SQL</code>的游标ID，查询下一个游标页。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>long</td> <td>游标ID</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>long</td> <td>游标ID</td></tr> <tr><td>int</td> <td>行数</td></tr> <tr><td>键数据对象+值数据对象</td> <td>键-值对形式的记录，重复多次，次数为前一个参数返回的行数值</td></tr> <tr><td>bool</td> <td>指示是否有更多结果可通过<code>OP_QUERY_SQL_CURSOR_GET_PAGE</code>获取。如果为false，则查询游标将自动关闭。</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> OP_QUERY_SQL_CURSOR_GET_PAGE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cursor Id (received from Sql query operation)</span>
<span class="token function">writeLongLittleEndian</span><span class="token punctuation">(</span>cursorId<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> rowCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read entries (as user objects)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rowCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">Object</span> key <span class="token operator">=</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Object</span> val <span class="token operator">=</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;CacheEntry: &quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">boolean</span> moreResults <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-4-4-op-query-sql-fields"><a href="#_2-4-4-op-query-sql-fields" class="header-anchor">#</a> 2.4.4.OP_QUERY_SQL_FIELDS</h4> <p>执行SQLFieldQuery。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>string</td> <td>查询的模式，可以为空，默认为<code>PUBLIC</code>模式</td></tr> <tr><td>int</td> <td>查询游标页面大小</td></tr> <tr><td>int</td> <td>最大行数</td></tr> <tr><td>string</td> <td>SQL</td></tr> <tr><td>int</td> <td>参数个数</td></tr> <tr><td>数据对象</td> <td>重复多次，重复次数为前一个参数值</td></tr> <tr><td>byte</td> <td>语句类型。ANY：0，SELECT：1，UPDATE：2</td></tr> <tr><td>bool</td> <td>分布式关联标志</td></tr> <tr><td>bool</td> <td>本地查询标志</td></tr> <tr><td>bool</td> <td>复制标志，查询涉及的表是否都为复制表</td></tr> <tr><td>bool</td> <td>是否强制关联的顺序</td></tr> <tr><td>bool</td> <td>数据是否并置标志</td></tr> <tr><td>bool</td> <td>是否延迟查询的执行</td></tr> <tr><td>long</td> <td>超时（毫秒）</td></tr> <tr><td>bool</td> <td>是否包含字段名</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>long</td> <td>游标ID，可以被<code>OP_RESOURCE_CLOSE</code>关闭</td></tr> <tr><td>int</td> <td>字段（列）数量</td></tr> <tr><td>string（可选）</td> <td><em>只有请求中的<code>IncludeFieldNames</code>标志为true时才是必须的</em>，列名，重复多次，重复次数为前一个参数的值</td></tr> <tr><td>int</td> <td>第一页行数</td></tr> <tr><td>数据对象</td> <td>字段（列）值，字段个数重复次数为前述字段数量参数值，行数重复次数为前一个参数的值</td></tr> <tr><td>bool</td> <td>表示是否还可以通过<code>OP_QUERY_SQL_FIELDS_CURSOR_GET_PAGE</code>获得更多结果</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;Select id, salary from Person&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> sqlLength <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token class-name">String</span> sqlSchema <span class="token operator">=</span> <span class="token string">&quot;PUBLIC&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> sqlSchemaLength <span class="token operator">=</span> sqlSchema<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">43</span> <span class="token operator">+</span> sqlLength <span class="token operator">+</span> sqlSchemaLength<span class="token punctuation">,</span> OP_QUERY_SQL_FIELDS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token class-name">String</span> queryCacheName <span class="token operator">=</span> <span class="token string">&quot;personCache&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> cacheId <span class="token operator">=</span> queryCacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheId<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flag = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Schema</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>sqlSchemaLength<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
out<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>sqlSchema<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//sqlSchemaLength</span>

<span class="token comment">// cursor page size</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Max Rows</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// SQL query</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>sqlLength<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
out<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//sqlLength</span>

<span class="token comment">// Argument count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Statement type</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Joins</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Local query</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Replicated</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Enforce join order</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// collocated</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Lazy</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Timeout</span>
<span class="token function">writeLongLittleEndian</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Replicated</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> cursorId <span class="token operator">=</span> <span class="token function">readLongLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> colCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> rowCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read entries</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rowCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">long</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> salary <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Person id: &quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;; Person Salary: &quot;</span> <span class="token operator">+</span> salary<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">boolean</span> moreResults <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-4-5-op-query-sql-fields-cursor-get-page"><a href="#_2-4-5-op-query-sql-fields-cursor-get-page" class="header-anchor">#</a> 2.4.5.OP_QUERY_SQL_FIELDS_CURSOR_GET_PAGE</h4> <p>通过<code>OP_QUERY_SQL_FIELDS</code>的游标ID，获取下一页的查询结果。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>long</td> <td>从<code>OP_QUERY_SQL_FIELDS</code>获取的游标ID</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>int</td> <td>行数</td></tr> <tr><td>数据对象</td> <td>字段（列）值，字段个数重复次数为前述字段数量参数值，行数重复次数为前一个参数的值</td></tr> <tr><td>bool</td> <td>指示是否有更多结果可通过<code>OP_QUERY_SQL_FIELDS_CURSOR_GET_PAGE</code>获取。</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> QUERY_SQL_FIELDS_CURSOR_GET_PAGE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cursor Id</span>
<span class="token function">writeLongLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code> <span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> rowCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read entries (as user objects)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rowCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">// read data objects * column count.</span>
<span class="token punctuation">}</span>

<span class="token keyword">boolean</span> moreResults <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-4-6-op-query-scan"><a href="#_2-4-6-op-query-scan" class="header-anchor">#</a> 2.4.6.OP_QUERY_SCAN</h4> <p>执行扫描查询。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>标志，<code>0</code>为默认值，或者<code>1</code>为保持值的二进制形式</td></tr> <tr><td>数据对象</td> <td>过滤器对象，如果不打算在集群中过滤数据可以为<code>null</code>，过滤器类应该加入服务端节点的类路径中</td></tr> <tr><td>byte</td> <td>过滤器平台。JAVA：1，DOTNET：2，CPP：3，过滤器对象非空时，需要这个参数</td></tr> <tr><td>int</td> <td>游标页面大小</td></tr> <tr><td>int</td> <td>要查询的分区数（对于查询整个缓存为负数）</td></tr> <tr><td>bool</td> <td>本地标志，查询是否只在本地节点执行</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>long</td> <td>游标ID</td></tr> <tr><td>int</td> <td>行数</td></tr> <tr><td>键数据对象+值数据对象</td> <td>键-值对形式的记录，重复多次，次数为前一个参数返回的行数值</td></tr> <tr><td>bool</td> <td>指示是否有更多结果可通过<code>OP_QUERY_SCAN_CURSOR_GET_PAGE</code>获取。如果为false，则查询游标将自动关闭。</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_QUERY_SCAN<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token class-name">String</span> queryCacheName <span class="token operator">=</span> <span class="token string">&quot;personCache&quot;</span><span class="token punctuation">;</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>queryCacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// flags</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Filter Object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// null</span>

<span class="token comment">// Cursor page size</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Partition to query</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// local flag</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cursor id</span>
<span class="token keyword">long</span> cursorId <span class="token operator">=</span> <span class="token function">readLongLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> rowCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read entries (as user objects)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rowCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Object</span> key <span class="token operator">=</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Object</span> val <span class="token operator">=</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;CacheEntry: &quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">boolean</span> moreResults <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-4-7-op-query-scan-cursor-get-page"><a href="#_2-4-7-op-query-scan-cursor-get-page" class="header-anchor">#</a> 2.4.7.OP_QUERY_SCAN_CURSOR_GET_PAGE</h4> <p>通过<code>OP_QUERY_SCAN</code>获取的游标，查询下一页的数据。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>long</td> <td>游标ID</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>long</td> <td>游标ID</td></tr> <tr><td>int</td> <td>行数</td></tr> <tr><td>键数据对象+值数据对象</td> <td>键-值对形式的记录，重复多次，次数为前一个参数返回的行数值</td></tr> <tr><td>bool</td> <td>指示是否有更多结果可通过<code>OP_QUERY_SCAN_CURSOR_GET_PAGE</code>获取。如果为false，则查询游标将自动关闭。</td></tr></tbody></table> <h4 id="_2-4-8-op-resource-close"><a href="#_2-4-8-op-resource-close" class="header-anchor">#</a> 2.4.8.OP_RESOURCE_CLOSE</h4> <p>关闭一个资源，比如游标。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>long</td> <td>资源ID</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> OP_RESOURCE_CLOSE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resource id</span>
<span class="token keyword">long</span> cursorId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token function">writeLongLittleEndian</span><span class="token punctuation">(</span>cursorId<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h3 id="_2-5-二进制类型元数据"><a href="#_2-5-二进制类型元数据" class="header-anchor">#</a> 2.5.二进制类型元数据</h3> <h4 id="_2-5-1-操作代码"><a href="#_2-5-1-操作代码" class="header-anchor">#</a> 2.5.1.操作代码</h4> <p>与Ignite服务端节点成功握手后，客户端就可以通过发送带有特定操作代码的请求（请参见下面的请求/响应结构）来执行与二进制类型有关的各种操作了：</p> <table><thead><tr><th>操作</th> <th>操作代码</th></tr></thead> <tbody><tr><td><code>OP_GET_BINARY_TYPE_NAME</code></td> <td>3000</td></tr> <tr><td><code>OP_REGISTER_BINARY_TYPE_NAME</code></td> <td>3001</td></tr> <tr><td><code>OP_GET_BINARY_TYPE</code></td> <td>3002</td></tr> <tr><td><code>OP_PUT_BINARY_TYPE</code></td> <td>3003</td></tr></tbody></table> <p>注意上面提到的操作代码，是请求头的一部分，具体可以看<a href="#_2-1-3-%E6%B6%88%E6%81%AF%E6%A0%BC%E5%BC%8F">头信息</a>的相关内容。</p> <h4 id="_2-5-2-op-get-binary-type-name"><a href="#_2-5-2-op-get-binary-type-name" class="header-anchor">#</a> 2.5.2.OP_GET_BINARY_TYPE_NAME</h4> <p>通过ID取得和平台相关的完整二进制类型名，比如，.NET和Java都可以映射相同的类型<code>Foo</code>，但是在.NET中类型是<code>Apache.Ignite.Foo</code>，而在Java中是<code>org.apache.ignite.Foo</code>。</p> <p>名字是使用<code>OP_REGISTER_BINARY_TYPE_NAME</code>注册的。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>byte</td> <td>平台ID。Java：0，DOTNET：1</td></tr> <tr><td>int</td> <td>类型ID，Java风格类型名字的哈希值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>string</td> <td>二进制类型名</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token string">&quot;ignite.myexamples.model.Person&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> typeLen <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> OP_GET_BINARY_TYPE_NAME<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Platform id</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Type id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting String</span>
<span class="token keyword">int</span> typeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// type code</span>
<span class="token keyword">int</span> strLen <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// length</span>

<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>strLen<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">readFully</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> strLen<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-5-3-op-register-binary-type-name"><a href="#_2-5-3-op-register-binary-type-name" class="header-anchor">#</a> 2.5.3.OP_REGISTER_BINARY_TYPE_NAME</h4> <p>通过ID注册平台相关的完整二进制类型名，比如，.NET和Java都可以映射相同的类型<code>Foo</code>，但是在.NET中类型是<code>Apache.Ignite.Foo</code>，而在Java中是<code>org.apache.ignite.Foo</code>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>byte</td> <td>平台ID。Java：0，DOTNET：1</td></tr> <tr><td>int</td> <td>类型ID，Java风格类型名字的哈希值</td></tr> <tr><td>string</td> <td>类型名</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token string">&quot;ignite.myexamples.model.Person&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> typeLen <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">20</span> <span class="token operator">+</span> typeLen<span class="token punctuation">,</span> OP_PUT_BINARY_TYPE_NAME<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Platform id</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Type id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Type name</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-5-4-op-get-binary-type"><a href="#_2-5-4-op-get-binary-type" class="header-anchor">#</a> 2.5.4.OP_GET_BINARY_TYPE</h4> <p>通过ID获取二进制类型信息。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>类型ID，Java风格类型名字的哈希值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>false:二进制类型不存在，响应结束，true：二进制类型存在，内容如下</td></tr> <tr><td>int</td> <td>类型ID，Java风格类型名字的哈希值</td></tr> <tr><td>string</td> <td>类型名</td></tr> <tr><td>string</td> <td>关联键字段名</td></tr> <tr><td>int</td> <td>BinaryField计数</td></tr> <tr><td>BinaryField*count</td> <td>BinaryField结构。String：字段名；int：类型ID，Java风格类型名哈希值；int：字段ID，Java风格字段名哈希值</td></tr> <tr><td>bool</td> <td>是否枚举值，如果为true，则需要传入下面两个参数，否则会被忽略</td></tr> <tr><td>int</td> <td><em>只有在<code>enum</code>参数为<code>true</code>时才是必须</em>，枚举字段数量</td></tr> <tr><td>string+int</td> <td><em>只有在<code>enum</code>参数为<code>true</code>时才是必须</em>，枚举值，枚举值是一对字面量值（字符串）和一个数值（整型）组成。重复多次，重复次数为前一个参数的值</td></tr> <tr><td>int</td> <td>BinarySchema计数</td></tr> <tr><td>BinarySchema</td> <td>BinarySchema结构。int：唯一模式ID；int：模式中字段数；int：字段ID，Java风格字段名哈希值，重复多次，重复次数为模式中字段数量，BinarySchema重复次数为前一个参数数值</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token string">&quot;ignite.myexamples.model.Person&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> OP_BINARY_TYPE_GET<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Type id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">boolean</span> typeExist <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> typeId <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> typeName <span class="token operator">=</span> <span class="token function">readString</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> affinityFieldName <span class="token operator">=</span> <span class="token function">readString</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> fieldCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> fieldCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token function">readBinaryTypeField</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">boolean</span> isEnum <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> schemaCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read binary schemas</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> schemaCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> schemaId <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Schema Id</span>

  <span class="token keyword">int</span> fieldCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// field count</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> fieldCount<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// field id</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> readBinaryTypeField <span class="token punctuation">(</span><span class="token class-name">DataInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>
  <span class="token class-name">String</span> fieldName <span class="token operator">=</span> <span class="token function">readString</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> fieldTypeId <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> fieldId <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <h4 id="_2-5-5-op-put-binary-type"><a href="#_2-5-5-op-put-binary-type" class="header-anchor">#</a> 2.5.5.OP_PUT_BINARY_TYPE</h4> <p>在集群中注册二进制类型信息。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>类型ID，Java风格类型名字的哈希值</td></tr> <tr><td>string</td> <td>类型名</td></tr> <tr><td>string</td> <td>关联键字段名</td></tr> <tr><td>int</td> <td>BinaryField计数</td></tr> <tr><td>BinaryField</td> <td>BinaryField结构。String：字段名；int：类型ID，Java风格类型名哈希值；int：字段ID，Java风格字段名哈希值；重复多次，重复次数为前一个参数传递的值</td></tr> <tr><td>bool</td> <td>是否枚举值，如果为true，则需要传入下面两个参数，否则会被忽略</td></tr> <tr><td>int</td> <td><em>只有在<code>enum</code>参数为<code>true</code>时才是必须</em>，枚举字段数量</td></tr> <tr><td>string+int</td> <td><em>只有在<code>enum</code>参数为<code>true</code>时才是必须</em>，枚举值，枚举值是一对字面量值（字符串）和一个数值（整型）组成。重复多次，重复次数为前一个参数的值</td></tr> <tr><td>int</td> <td>BinarySchema计数</td></tr> <tr><td>BinarySchema</td> <td>BinarySchema结构。int：唯一模式ID；int：模式中字段数；int：字段ID，Java风格字段名哈希值，重复多次，重复次数为模式中字段数量，BinarySchema重复次数为前一个参数数值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token string">&quot;ignite.myexamples.model.Person&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> OP_BINARY_TYPE_PUT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Type id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Type name</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Affinity key field name</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Field count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Field 1</span>
<span class="token class-name">String</span> field1 <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">;</span>
<span class="token function">writeBinaryTypeField</span><span class="token punctuation">(</span>field1<span class="token punctuation">,</span> <span class="token string">&quot;long&quot;</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Field 2</span>
<span class="token class-name">String</span> field2 <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">;</span>
<span class="token function">writeBinaryTypeField</span><span class="token punctuation">(</span>field2<span class="token punctuation">,</span> <span class="token string">&quot;String&quot;</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Field 3</span>
<span class="token class-name">String</span> field3 <span class="token operator">=</span> <span class="token string">&quot;salary&quot;</span><span class="token punctuation">;</span>
<span class="token function">writeBinaryTypeField</span><span class="token punctuation">(</span>field3<span class="token punctuation">,</span> <span class="token string">&quot;int&quot;</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// isEnum</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Schema count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Schema</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">657</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Schema id; can be any custom value</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// field count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>field1<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>field2<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>field3<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> writeBinaryTypeField <span class="token punctuation">(</span><span class="token class-name">String</span> field<span class="token punctuation">,</span> <span class="token class-name">String</span> fieldType<span class="token punctuation">,</span> <span class="token class-name">DataOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>
  <span class="token function">writeString</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>fieldType<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h3 id="_2-6-缓存配置"><a href="#_2-6-缓存配置" class="header-anchor">#</a> 2.6.缓存配置</h3> <h4 id="_2-6-1-操作代码"><a href="#_2-6-1-操作代码" class="header-anchor">#</a> 2.6.1.操作代码</h4> <p>与Ignite服务端节点成功握手后，客户端就可以通过发送带有特定操作代码的请求（请参见下面的请求/响应结构）来执行各种缓存配置操作了：</p> <table><thead><tr><th>操作</th> <th>操作代码</th></tr></thead> <tbody><tr><td><code>OP_CACHE_GET_NAMES</code></td> <td>1050</td></tr> <tr><td><code>OP_CACHE_CREATE_WITH_NAME</code></td> <td>1051</td></tr> <tr><td><code>OP_CACHE_GET_OR_CREATE_WITH_NAME</code></td> <td>1052</td></tr> <tr><td><code>OP_CACHE_CREATE_WITH_CONFIGURATION</code></td> <td>1053</td></tr> <tr><td><code>OP_CACHE_GET_OR_CREATE_WITH_CONFIGURATION</code></td> <td>1054</td></tr> <tr><td><code>OP_CACHE_GET_CONFIGURATION</code></td> <td>1055</td></tr> <tr><td><code>OP_CACHE_DESTROY</code></td> <td>1056</td></tr></tbody></table> <p>注意上面提到的操作代码，是请求头的一部分，具体可以看<a href="#_2-1-3-%E6%B6%88%E6%81%AF%E6%A0%BC%E5%BC%8F">头信息</a>的相关内容。</p> <h4 id="_2-6-2-op-cache-create-with-name"><a href="#_2-6-2-op-cache-create-with-name" class="header-anchor">#</a> 2.6.2.OP_CACHE_CREATE_WITH_NAME</h4> <p>通过给定的名字创建缓存，如果缓存的名字中有<code>*</code>，则可以应用一个缓存模板，如果给定名字的缓存已经存在，则会抛出异常。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>string</td> <td>缓存名</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> cacheName <span class="token operator">=</span> <span class="token string">&quot;myNewCache&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> nameLength <span class="token operator">=</span> cacheName<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">+</span> nameLength<span class="token punctuation">,</span> OP_CACHE_CREATE_WITH_NAME<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache name</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send request</span>
out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-6-3-op-cache-get-or-create-with-name"><a href="#_2-6-3-op-cache-get-or-create-with-name" class="header-anchor">#</a> 2.6.3.OP_CACHE_GET_OR_CREATE_WITH_NAME</h4> <p>通过给定的名字创建缓存，如果缓存的名字中有<code>*</code>，则可以应用一个缓存模板，如果给定名字的缓存已经存在，则什么也不做。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>string</td> <td>缓存名</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> cacheName <span class="token operator">=</span> <span class="token string">&quot;myNewCache&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> nameLength <span class="token operator">=</span> cacheName<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">+</span> nameLength<span class="token punctuation">,</span> OP_CACHE_GET_OR_CREATE_WITH_NAME<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache name</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send request</span>
out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-6-4-op-cache-get-names"><a href="#_2-6-4-op-cache-get-names" class="header-anchor">#</a> 2.6.4.OP_CACHE_GET_NAMES</h4> <p>获取已有缓存的名字。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>int</td> <td>缓存数量</td></tr> <tr><td>string</td> <td>缓存名字，重复多次，重复次数为前一个参数的返回值</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> OP_CACHE_GET_NAMES<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache count</span>
<span class="token keyword">int</span> cacheCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache names</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cacheCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> type <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// type code</span>

  <span class="token keyword">int</span> strLen <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// length</span>

  <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>strLen<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">readFully</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> strLen<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cache name</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <h4 id="_2-6-5-op-cache-get-configuration"><a href="#_2-6-5-op-cache-get-configuration" class="header-anchor">#</a> 2.6.5.OP_CACHE_GET_CONFIGURATION</h4> <p>获取指定缓存的配置信息。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>type</td> <td>标志</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>int</td> <td>以字节计算的配置信息的长度（所有的配置参数）</td></tr> <tr><td>CacheConfiguration</td> <td>缓存配置的结构，具体见下表</td></tr></tbody></table> <p><strong>CacheConfiguration</strong></p> <table><thead><tr><th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>int</td> <td>备份数量</td></tr> <tr><td>int</td> <td>CacheMode。LOCAL：0；REPLICATED：1；PARTITIONED：2</td></tr> <tr><td>bool</td> <td>CopyOnRead标志</td></tr> <tr><td>string</td> <td>内存区名字</td></tr> <tr><td>bool</td> <td>EagerTTL标志</td></tr> <tr><td>bool</td> <td>指标统计标志</td></tr> <tr><td>string</td> <td>缓存组名</td></tr> <tr><td>bool</td> <td>无效标志</td></tr> <tr><td>long</td> <td>默认锁超时时间（毫秒）</td></tr> <tr><td>int</td> <td>最大查询迭代数</td></tr> <tr><td>string</td> <td>缓存名</td></tr> <tr><td>bool</td> <td>堆内缓存开启标志</td></tr> <tr><td>int</td> <td>分区丢失策略。READ_ONLY_SAFE：0；READ_ONLY_ALL：1；READ_WRITE_SAFE：2；READ_WRITE_ALL：3；IGNORE：4</td></tr> <tr><td>int</td> <td>QueryDetailMetricsSize</td></tr> <tr><td>int</td> <td>QueryParellelism</td></tr> <tr><td>bool</td> <td>是否从备份读取标志</td></tr> <tr><td>int</td> <td>再平衡缓存区大小</td></tr> <tr><td>long</td> <td>再平衡批处理预取计数</td></tr> <tr><td>long</td> <td>再平衡延迟时间（毫秒）</td></tr> <tr><td>int</td> <td>再平衡模式。SYNC：0；ASYNC：1；NONE：2</td></tr> <tr><td>int</td> <td>再平衡顺序</td></tr> <tr><td>long</td> <td>再平衡调节（毫秒）</td></tr> <tr><td>long</td> <td>再平衡超时（毫秒）</td></tr> <tr><td>bool</td> <td>SqlEscapeAll</td></tr> <tr><td>int</td> <td>SqlIndexInlineMaxSize</td></tr> <tr><td>string</td> <td>SQL模式</td></tr> <tr><td>int</td> <td>写同步模式。FULL_SYNC：0；FULL_ASYNC：1；PRIMARY_SYNC：2</td></tr> <tr><td>int</td> <td>CacheKeyConfiguration计数</td></tr> <tr><td>CacheKeyConfiguration</td> <td>CacheKeyConfiguration结构。String：类型名；String：关联键字段名。重复多次，重复次数为前一参数返回值</td></tr> <tr><td>int</td> <td>QueryEntity计数</td></tr> <tr><td>QueryEntity</td> <td>QueryEntity结构，具体见下表</td></tr></tbody></table> <p><strong>QueryEntity</strong></p> <table><thead><tr><th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>string</td> <td>键类型名</td></tr> <tr><td>string</td> <td>值类型名</td></tr> <tr><td>string</td> <td>表名</td></tr> <tr><td>string</td> <td>键字段名</td></tr> <tr><td>string</td> <td>值字段名</td></tr> <tr><td>int</td> <td>QueryField计数</td></tr> <tr><td>QueryField</td> <td>QueryField结构。String：名字；String：类型名；bool：是否键字段；bool：是否有非空约束。重复多次，重复次数为前一参数对应值</td></tr> <tr><td>int</td> <td>别名计数</td></tr> <tr><td>string+string</td> <td>字段名别名</td></tr> <tr><td>int</td> <td>QueryIndex计数</td></tr> <tr><td>QueryIndex</td> <td>QueryIndex结构。String：索引名；byte：索引类型，(SORTED：0；FULLTEXT：1；GEOSPATIAL：2)；int：内联大小；int：字段计数；(string + bool)：字段（名字+是否降序）</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> cacheName <span class="token operator">=</span> <span class="token string">&quot;myCache&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> OP_CACHE_GET_CONFIGURATION<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Config length</span>
<span class="token keyword">int</span> configLen <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// CacheAtomicityMode</span>
<span class="token keyword">int</span> cacheAtomicityMode <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Backups</span>
<span class="token keyword">int</span> backups <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// CacheMode</span>
<span class="token keyword">int</span> cacheMode <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// CopyOnRead</span>
<span class="token keyword">boolean</span> copyOnRead <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Other configurations</span>
</code></pre></div></section></div></div> <h4 id="_2-6-6-op-cache-create-with-configuration"><a href="#_2-6-6-op-cache-create-with-configuration" class="header-anchor">#</a> 2.6.6.OP_CACHE_CREATE_WITH_CONFIGURATION</h4> <p>用给定的配置创建缓存，如果该缓存已存在会抛出异常。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>按字节计算的配置的长度（所有的配置参数）</td></tr> <tr><td>short</td> <td>配置参数计数</td></tr> <tr><td>short + 属性类型</td> <td>配置属性数据。重复多次，重复次数为前一参数对应值</td></tr></tbody></table> <p>配置参数的个数没有要求，但是<code>Name</code>必须提供。</p> <p>缓存的配置数据是以键-值对的形式提供的，这里键是<code>short</code>类型的属性ID，而值是与键对应的数据，下表描述了所有可用的参数：</p> <table><thead><tr><th>属性代码</th> <th>属性类型</th> <th>描述</th></tr></thead> <tbody><tr><td>2</td> <td>int</td> <td>CacheAtomicityMode。TRANSACTIONAL：0；ATOMIC：1</td></tr> <tr><td>3</td> <td>int</td> <td>备份数量</td></tr> <tr><td>1</td> <td>int</td> <td>CacheMode。LOCAL：0；REPLICATED：1；PARTITIONED：2</td></tr> <tr><td>5</td> <td>bool</td> <td>CopyOnRead</td></tr> <tr><td>100</td> <td>String</td> <td>内存区名</td></tr> <tr><td>405</td> <td>bool</td> <td>EagerTtl</td></tr> <tr><td>406</td> <td>bool</td> <td>StatisticsEnabled</td></tr> <tr><td>400</td> <td>String</td> <td>缓存组名</td></tr> <tr><td>402</td> <td>long</td> <td>默认锁超时时间（毫秒）</td></tr> <tr><td>403</td> <td>int</td> <td>MaxConcurrentAsyncOperations</td></tr> <tr><td>206</td> <td>int</td> <td>MaxQueryIterators</td></tr> <tr><td>0</td> <td>String</td> <td>缓存名</td></tr> <tr><td>101</td> <td>bool</td> <td>堆内缓存启用标志</td></tr> <tr><td>404</td> <td>int</td> <td>PartitionLossPolicy。READ_ONLY_SAFE：0；READ_ONLY_ALL：1；READ_WRITE_SAFE：2；READ_WRITE_ALL：3；IGNORE：4</td></tr> <tr><td>202</td> <td>int</td> <td>QueryDetailMetricsSize</td></tr> <tr><td>201</td> <td>int</td> <td>QueryParallelism</td></tr> <tr><td>6</td> <td>bool</td> <td>ReadFromBackup</td></tr> <tr><td>303</td> <td>int</td> <td>再平衡批处理大小</td></tr> <tr><td>304</td> <td>long</td> <td>再平衡批处理预读计数</td></tr> <tr><td>301</td> <td>long</td> <td>再平衡延迟时间（毫秒）</td></tr> <tr><td>300</td> <td>int</td> <td>RebalanceMode。SYNC：0；ASYNC：1；NONE：2</td></tr> <tr><td>305</td> <td>int</td> <td>再平衡顺序</td></tr> <tr><td>306</td> <td>long</td> <td>再平衡调节（毫秒）</td></tr> <tr><td>302</td> <td>long</td> <td>再平衡超时（毫秒）</td></tr> <tr><td>205</td> <td>bool</td> <td>SqlEscapeAll</td></tr> <tr><td>204</td> <td>int</td> <td>SqlIndexInlineMaxSize</td></tr> <tr><td>203</td> <td>String</td> <td>SQL模式</td></tr> <tr><td>4</td> <td>int</td> <td>WriteSynchronizationMode。FULL_SYNC：0；FULL_ASYNC：1；PRIMARY_SYNC：2</td></tr> <tr><td>401</td> <td>int+CacheKeyConfiguration</td> <td>CacheKeyConfiguration计数+CacheKeyConfiguration。CacheKeyConfiguration结构。String：类型名；String：关联键字段名</td></tr> <tr><td>200</td> <td>int+QueryEntity</td> <td>QueryEntity计数+QueryEntity。QueryEntity结构如下表</td></tr></tbody></table> <p><strong>QueryEntity</strong></p> <table><thead><tr><th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>string</td> <td>键类型名</td></tr> <tr><td>string</td> <td>值类型名</td></tr> <tr><td>string</td> <td>表名</td></tr> <tr><td>string</td> <td>键字段名</td></tr> <tr><td>string</td> <td>值字段名</td></tr> <tr><td>int</td> <td>QueryField计数</td></tr> <tr><td>QueryField</td> <td>QueryField结构。String：名字；String：类型名；bool：是否键字段；bool：是否有非空约束。重复多次，重复次数为前一参数对应值</td></tr> <tr><td>int</td> <td>别名计数</td></tr> <tr><td>string+string</td> <td>字段名别名</td></tr> <tr><td>int</td> <td>QueryIndex计数</td></tr> <tr><td>QueryIndex</td> <td>QueryIndex结构。String：索引名；byte：索引类型，(SORTED：0；FULLTEXT：1；GEOSPATIAL：2)；int：内联大小；int：字段计数；(string + bool)：字段（名字+是否降序）</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> OP_CACHE_CREATE_WITH_CONFIGURATION<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Config length in bytes</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Number of properties</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Backups opcode</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Backups: 2</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Name opcode</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Name</span>
<span class="token function">writeString</span><span class="token punctuation">(</span><span class="token string">&quot;myNewCache&quot;</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-6-7-op-cache-get-or-create-with-configuration"><a href="#_2-6-7-op-cache-get-or-create-with-configuration" class="header-anchor">#</a> 2.6.7.OP_CACHE_GET_OR_CREATE_WITH_CONFIGURATION</h4> <p>根据提供的配置创建缓存，如果该缓存已存在则什么都不做。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>CacheConfiguration</td> <td>缓存配置的结构，具体见前述</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> OP_CACHE_GET_OR_CREATE_WITH_CONFIGURATION<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Config length in bytes</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Number of properties</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Backups opcode</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Backups: 2</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Name opcode</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Name</span>
<span class="token function">writeString</span><span class="token punctuation">(</span><span class="token string">&quot;myNewCache&quot;</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_2-6-8-op-cache-destroy"><a href="#_2-6-8-op-cache-destroy" class="header-anchor">#</a> 2.6.8.OP_CACHE_DESTROY</h4> <p>销毁指定的缓存。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr></tbody></table> <p>缓存ID，Java风格的缓存名的哈希值</p> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> cacheName <span class="token operator">=</span> <span class="token string">&quot;myCache&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> OP_CACHE_DESTROY<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send request</span>
out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h2 id="_3-java瘦客户端"><a href="#_3-java瘦客户端" class="header-anchor">#</a> 3.Java瘦客户端</h2> <h3 id="_3-1-java瘦客户端"><a href="#_3-1-java瘦客户端" class="header-anchor">#</a> 3.1.Java瘦客户端</h3> <h4 id="_3-1-1-概述"><a href="#_3-1-1-概述" class="header-anchor">#</a> 3.1.1.概述</h4> <p>Java瘦客户端将<a href="#_2-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8D%8F%E8%AE%AE">二进制客户端协议</a>暴露给Java开发者。</p> <p>瘦客户端是一个轻量级的Ignite客户端，通过标准的Socket连接接入集群，不会成为集群拓扑的一部分，也不持有任何数据，也不会参与计算网格的计算。它所做的只是简单地建立一个与标准Ignite节点的Socket连接，并通过该节点执行所有操作。</p> <p>按照下面的步骤操作，可以学习瘦客户端API和开发环境的基础知识。</p> <h4 id="_3-1-2-maven配置"><a href="#_3-1-2-maven配置" class="header-anchor">#</a> 3.1.2.Maven配置</h4> <p>添加<code>ignite-core</code>这一个依赖就可以使用所有的瘦客户端API。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="maven" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ignite.version</span><span class="token punctuation">&gt;</span></span>2.5.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ignite.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="gradle" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language- extra-class"><pre class="language-text"><code> def igniteVersion = '2.5.0'

dependencies {
    compile group: 'org.apache.ignite', name: 'ignite-core', version: igniteVersion
}
</code></pre></div></section></div></div> <div class="custom-block tip"><p class="custom-block-title">Ignite版本</p> <p>瘦客户端和Ignite服务端版本可以不同，只要二进制协议版本是兼容的即可。</p></div> <h4 id="_3-1-3-简单应用"><a href="#_3-1-3-简单应用" class="header-anchor">#</a> 3.1.3.简单应用</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ClientConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddresses</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:10800&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> igniteClient <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt; Thin client put-get example started.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token class-name">String</span> CACHE_NAME <span class="token operator">=</span> <span class="token string">&quot;put-get-example&quot;</span><span class="token punctuation">;</span>

        <span class="token class-name">ClientCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Address</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span>CACHE_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt; Created cache [%s].\n&quot;</span><span class="token punctuation">,</span> CACHE_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Integer</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token class-name">Address</span> val <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token string">&quot;1545 Jackson Street&quot;</span><span class="token punctuation">,</span> <span class="token number">94612</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt; Saved [%s] in the cache.\n&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Address</span> cachedVal <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt; Loaded [%s] from the cache.\n&quot;</span><span class="token punctuation">,</span> cachedVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClientException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;Unexpected failure: %s\n&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>该应用做了如下的工作：</p> <ul><li>使用<code>Ignition#startClient(clientCfg)</code>向运行在本地<code>127.0.0.1</code>上的Ignite服务端发起了一个瘦客户端连接；</li> <li>使用<code>IgniteClient#getOrCreateCache(cacheName)</code>创建了一个指定名字的缓存；</li> <li>使用<code>ClientCache#put(key, val)}</code>和<code>ClientCache#get(key)</code>存储和获取数据。</li></ul> <h4 id="_3-1-4-启动集群"><a href="#_3-1-4-启动集群" class="header-anchor">#</a> 3.1.4.启动集群</h4> <p>在本地主机上启动集群：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="linix" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$IGNITE_HOME</span>/bin/ignite.sh <span class="token variable">$IGNITE_HOME</span>/examples/config/example-ignite.xml

<span class="token punctuation">..</span>.
<span class="token punctuation">[</span><span class="token number">27</span>-02-2018 <span class="token number">19</span>:21:00<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO <span class="token punctuation">]</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token punctuation">[</span>GridDiscoveryManager<span class="token punctuation">]</span> Topology snapshot <span class="token punctuation">[</span>ver<span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">servers</span><span class="token operator">=</span><span class="token number">1</span>, <span class="token assign-left variable">clients</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">CPUs</span><span class="token operator">=</span><span class="token number">8</span>, <span class="token assign-left variable">offheap</span><span class="token operator">=</span><span class="token number">1</span>.0GB, <span class="token assign-left variable">heap</span><span class="token operator">=</span><span class="token number">1</span>.0GB<span class="token punctuation">]</span>
</code></pre></div></section> <section aria-hidden="true" id="windows" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-batch extra-class"><pre class="language-batch"><code>%IGNITE_HOME%\bin\ignite.bat %IGNITE_HOME%\examples\config\example-ignite.xml

...
[27-02-2018 19:21:00][INFO ][main][GridDiscoveryManager] Topology snapshot [ver=1, servers=1, clients=0, CPUs=8, offheap=1.0GB, heap=1.0GB]
</code></pre></div></section></div></div> <div class="custom-block tip"><p class="custom-block-title">服务端启动等待</p> <p>与Ignite客户端模式不同，它会等待服务端节点的启动，而瘦客户端在无法找到配置好的服务端时，会连接失败。</p></div> <h4 id="_3-1-5-启动应用"><a href="#_3-1-5-启动应用" class="header-anchor">#</a> 3.1.5.启动应用</h4> <p>在IDE中运行程序，然后会看到如下的输出：</p> <div class="language- extra-class"><pre class="language-text"><code>&gt;&gt;&gt; Thin client put-get example started.
&gt;&gt;&gt; Created cache [put-get-example].
&gt;&gt;&gt; Saved [Address [street=1545 Jackson Street, zip=94612]] in the cache.
&gt;&gt;&gt; Loaded [Address [street=1545 Jackson Street, zip=94612]] from the cache.
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">注意集群拓扑没有发生变化</p> <p>瘦客户端没有成为集群的一个成员，这是一个轻量级的应用，它会使用二进制客户端协议，通过TCP套接字与集群通信。</p></div> <h3 id="_3-2-初始化和配置"><a href="#_3-2-初始化和配置" class="header-anchor">#</a> 3.2.初始化和配置</h3> <p><code>IgniteClient</code>API是Java瘦客户端的入口。</p> <h4 id="_3-2-1-初始化"><a href="#_3-2-1-初始化" class="header-anchor">#</a> 3.2.1.初始化</h4> <p><code>Ignition#startClient(ClientConfiguration)</code>方法会发起一个瘦客户端连接请求。</p> <p><code>IgniteClient</code>是一个可以自动关闭的资源，因此可以使用<strong>try-with-resources</strong>语句初始化和释放<code>IgniteClient</code>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddresses</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:10800&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something here.</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-2-2-配置"><a href="#_3-2-2-配置" class="header-anchor">#</a> 3.2.2.配置</h4> <p>使用<code>ClientConfiguration</code>和<code>ClientCacheConfiguration</code>可以分别对瘦客户端和客户端缓存进行配置。</p> <h4 id="_3-2-3-clientcache-api"><a href="#_3-2-3-clientcache-api" class="header-anchor">#</a> 3.2.3.ClientCache API</h4> <p><code>ClientCache</code>API表示一个缓存，并且可以在存储数据的Ignite集群中执行键-值操作，通过如下的方法可以获得<code>ClientCache</code>的实例：</p> <ul><li><code>IgniteClient#cache(String)</code>：假定给定名字的缓存已存在，该方法不会与集群通信确认缓存是否真实存在，如果缓存不存在之后的缓存操作会报错；</li> <li><code>IgniteClient#getOrCreateCache(String)</code>，<code>IgniteClient#getOrCreateCache(ClientCacheConfiguration)</code>：获取指定名字的缓存，如果不存在则会创建该缓存，创建时会使用默认的配置；</li> <li><code>IgniteClient#createCache(String)</code>，<code>IgniteClient#createCache(ClientCacheConfiguration)</code>：创建指定名字的缓存，如果已经存在则会报错；</li></ul> <p>使用<code>IgniteClient#cacheNames()</code>可以列出所有已有的缓存。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientCacheConfiguration</span> cacheCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientCacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;References&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setCacheMode</span><span class="token punctuation">(</span><span class="token class-name">CacheMode</span><span class="token punctuation">.</span>REPLICATED<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setWriteSynchronizationMode</span><span class="token punctuation">(</span><span class="token class-name">CacheWriteSynchronizationMode</span><span class="token punctuation">.</span>FULL_SYNC<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ClientCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span>cacheCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-2-4-多线程"><a href="#_3-2-4-多线程" class="header-anchor">#</a> 3.2.4.多线程</h4> <p>瘦客户端是单线程且线程安全的。唯一的共享资源是底层的通信管道，同时只有一个线程对管道进行读写，这时其它线程会等待其完成。</p> <div class="custom-block warning"><p class="custom-block-title">使用瘦客户端连接池的多线程来改进性能</p> <p>目前瘦客户端无法通过多线程来改进吞吐量，但是可以在应用中使用瘦客户端连接池来创建多线程，以改进吞吐量。</p></div> <h4 id="_3-2-5-异步api"><a href="#_3-2-5-异步api" class="header-anchor">#</a> 3.2.5.异步API</h4> <div class="custom-block tip"><p class="custom-block-title">异步API暂不支持</p> <p>虽然二进制客户端协议设计时是支持异步API的，但是Java瘦客户端目前还不支持，异步API的功能下个版本会添加。</p></div> <h4 id="_3-2-6-客户端-服务端兼容性"><a href="#_3-2-6-客户端-服务端兼容性" class="header-anchor">#</a> 3.2.6.客户端-服务端兼容性</h4> <p>客户端<code>ignite-core</code>的版本号要小于等于服务端<code>ignite-core</code>的版本号。</p> <p>Ignite的服务端会维持二进制协议的向后兼容性，如果两者协议版本不兼容，会抛出<code>RuntimeException</code>。</p> <h4 id="_3-2-7-故障转移"><a href="#_3-2-7-故障转移" class="header-anchor">#</a> 3.2.7.故障转移</h4> <p>Ignite不支持服务器端的瘦客户端故障转移。在客户端连接到的服务端停机时，瘦客户端通过自动重连到其它服务端并重试操作来提供故障转移。</p> <p>配置多个服务端以启用故障转移机制：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAddresses</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:1080&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;127.0.0.1:1081&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;127.0.0.1:1082&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClientConnectionException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// All the servers are unavailable</span>
<span class="token punctuation">}</span>
</code></pre></div><p>瘦客户端会随机地尝试列表中所有的服务器，如果都不可用会抛出<code>ClientConnectionException</code>。</p> <p>除非所有服务端都变为不可用，否则故障转移机制对业务代码来说几乎是透明的，唯一的问题是失败的查询返回重复的条目，这与缓存语义相反。考虑此代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> qry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScanQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> p<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;Smith&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPageSize</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">QueryCursor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> cur <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>qry<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> cur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// Handle the entry ...</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>扫描和SQL SELECT查询是按页检索数据。如果客户端连接的服务端在迭代条目时停机，客户端将从头进行重试。这使得上面的代码会处理已经处理过的条目。</p> <p>解决这个问题有两种方法：</p> <ul><li>如果数据量较小足够放入内存，那么获取所有数据后可以将其放入一个Map：<code>Map&lt;Integer, Person&gt; res = cur.getAll().stream().collect(Collectors.toMap(Cache.Entry::getKey, Cache.Entry::getValue))</code>，Map会处理掉重复的条目；</li> <li>针对条目可能重复的问题，对条目进行幂等处理。</li></ul> <h3 id="_3-3-键-值"><a href="#_3-3-键-值" class="header-anchor">#</a> 3.3.键-值</h3> <h4 id="_3-3-1-支持的jcache-api"><a href="#_3-3-1-支持的jcache-api" class="header-anchor">#</a> 3.3.1.支持的JCache API</h4> <p>目前，瘦客户端只实现了<a href="https://jcp.org/aboutJava/communityprocess/final/jsr107/index.html" target="_self" rel="noopener noreferrer">JCache</a>的一个子集，因此并没有实现<code>javax.cache.Cache</code>（<code>ClientCacheConfiguration</code>也没有实现<code>javax.cache.configuration</code>）。</p> <p><code>ClientCache&lt;K, V&gt;</code>目前支持如下的JCache API：</p> <ul><li><code>V get(K key)</code>；</li> <li><code>void put(K key, V val)</code>；</li> <li><code>boolean containsKey(K key)</code>；</li> <li><code>String getName()</code>；</li> <li><code>CacheClientConfiguration getConfiguration()</code>；</li> <li><code>Map&lt;K, V&gt; getAll(Set&lt;? extends K&gt; keys)</code>；</li> <li><code>void putAll(Map&lt;? extends K, ? extends V&gt; map)</code>；</li> <li><code>boolean replace(K key, V oldVal, V newVal)</code>；</li> <li><code>boolean replace(K key, V val)</code>；</li> <li><code>boolean remove(K key)</code>；</li> <li><code>boolean remove(K key, V oldVal)</code>；</li> <li><code>void removeAll(Set&lt;? extends K&gt; keys)</code>；</li> <li><code>void removeAll()</code>；</li> <li><code>V getAndPut(K key, V val)</code>；</li> <li><code>V getAndRemove(K key)</code>；</li> <li><code>V getAndReplace(K key, V val)</code>；</li> <li><code>boolean putIfAbsent(K key, V val)</code>；</li> <li><code>void clear()</code></li></ul> <p><code>ClientCache&lt;K, V&gt;</code>暴露了JCache中没有的高级的缓存API：</p> <ul><li><code>int size(CachePeekMode... peekModes)</code></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> data <span class="token operator">=</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> i<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token operator">::</span><span class="token function">toString</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assertFalse</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assertTrue</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">&quot;101&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> cache<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">&quot;101&quot;</span><span class="token punctuation">,</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cache<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-3-2-扫描查询"><a href="#_3-3-2-扫描查询" class="header-anchor">#</a> 3.3.2.扫描查询</h4> <p>使用<code>ScanQuery&lt;K, V&gt;</code>可以在服务端使用Java谓词对数据进行过滤，然后在客户端对过滤后的结果集进行迭代。</p> <p>过滤后的条目是按页传输到客户端的，这样每次只有一个页面的数据会被加载到客户单的内存，页面大小可以通过<code>ScanQuery#setPageSize(int)</code>进行配置。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> qry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScanQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> p<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;Smith&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPageSize</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> qry <span class="token operator">:</span> queries<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">QueryCursor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> cur <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>qry<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> cur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Handle the entry ...</span>
</code></pre></div><h4 id="_3-3-3-客户端事务"><a href="#_3-3-3-客户端事务" class="header-anchor">#</a> 3.3.3.客户端事务</h4> <p>Java瘦客户端支持键-值事务，该Transactions API与Ignite原生客户端中的<a href="/doc/2.8.0/java/Key-ValueDataGrid.html#_8-1-2-ignitetransactions">事务</a>API类似。</p> <p>事务只可以在<code>AtomicityMode.TRANSACTIONAL</code><a href="/doc/2.8.0/java/Key-ValueDataGrid.html#_8-1-1-原子化模式">原子化模式</a>的缓存中执行。</p> <p><strong>事务的执行</strong></p> <p>从<code>IgniteClient</code>实例中拿到<code>ClientTransactions</code>对象，<code>ClientTransactions</code>使用<code>txStart(...)</code>方法开始事务，它会返回一个<code>ClientTransaction</code>对象。</p> <p>使用<code>ClientTransaction</code>可以提交或者回滚事务。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;my_transactional_cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ClientTransactions</span> tx <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">transactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ClientTransaction</span> t <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">txStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;new value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    t<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>事务的配置</strong></p> <p>客户端事务可以有不同的<a href="/doc/2.8.0/java/Key-ValueDataGrid.html#_8-2-并发模型和隔离级别">并发模型和隔离级别</a>，和执行超时时间，这些都可以在整体/每个事务层级进行配置。</p> <p>客户端配置对象可以为客户端接口启动的所有事务配置默认的并发模型和隔离级别和超时时间。</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token class-name">ClientConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 cfg<span class="token punctuation">.</span><span class="token function">setAddresses</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:10800&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cfg<span class="token punctuation">.</span><span class="token function">setTransactionConfiguration</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientTransactionConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">setDefaultTxTimeout</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">setDefaultTxConcurrency</span><span class="token punctuation">(</span><span class="token class-name">TransactionConcurrency</span><span class="token punctuation">.</span>OPTIMISTIC<span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">setDefaultTxIsolation</span><span class="token punctuation">(</span><span class="token class-name">TransactionIsolation</span><span class="token punctuation">.</span>REPEATABLE_READ<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>还可以为某一个事务单独指定并发模型和隔离级别以及超时时间，这时这些单独指定的值会覆盖默认的全局配置。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientTransactions</span> tx <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">transactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ClientTransaction</span> t <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">txStart</span><span class="token punctuation">(</span><span class="token class-name">TransactionConcurrency</span><span class="token punctuation">.</span>OPTIMISTIC<span class="token punctuation">,</span> <span class="token class-name">TransactionIsolation</span><span class="token punctuation">.</span>REPEATABLE_READ<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;new value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-4-sql"><a href="#_3-4-sql" class="header-anchor">#</a> 3.4.SQL</h3> <p>SQL查询共有2种：</p> <ul><li><strong>数据定义语言语句</strong>：用来管理缓存和索引，具体可以参见<a href="/doc/2.8.0/sql/SQLReference.html#_2-数据定义语言（ddl）">数据定义语言</a>；</li> <li><strong>数据操作语言语句</strong>：用来管理数据，具体请参见<a href="/doc/2.8.0/sql/SQLReference.html#_3-数据操作语言（dml）">数据操作语言</a>。</li></ul> <p>可以通过如下的方式使用瘦客户端的SQL API：</p> <ul><li><code>IgniteClient#query(SqlFieldsQuery).getAll()</code>：执行非SELECT语句（DDL或DML）；</li> <li><code>IgniteClient#query(SqlFieldsQuery)</code>：执行SELECT语句以及获取字段的子集。</li></ul> <p>SELECT查询是按页返回结果集，这样每次只有一个页面的数据加载到客户端的内存。</p> <div class="language-java extra-class"><pre class="language-java"><code>client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>
        <span class="token string">&quot;CREATE TABLE IF NOT EXISTS Person (id INT PRIMARY KEY, name VARCHAR) WITH \&quot;VALUE_TYPE=%s\&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSchema</span><span class="token punctuation">(</span><span class="token string">&quot;PUBLIC&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token class-name">Person</span> val <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;Person 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span>
    <span class="token string">&quot;INSERT INTO Person(id, name) VALUES(?, ?)&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> val<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSchema</span><span class="token punctuation">(</span><span class="token string">&quot;PUBLIC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Object</span> cachedName <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT name from Person WHERE id=?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSchema</span><span class="token punctuation">(</span><span class="token string">&quot;PUBLIC&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assertEquals</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cachedName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-5-二进制类型"><a href="#_3-5-二进制类型" class="header-anchor">#</a> 3.5.二进制类型</h3> <p>瘦客户端完全支持<a href="/doc/2.8.0/java/#_8-二进制编组器">二进制编组器</a>章节中描述的二进制对象API。</p> <p>使用<code>CacheClient#withKeepBinary()</code>将缓存切换到二进制模式，然后直接处理Ignite的二进制对象，可以避免序列化/反序列化。</p> <p>使用<code>IgniteClient#binary()</code>获取<code>IgniteBinary</code>的实例并从头构建对象。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IgniteBinary</span> binary <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">binary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">BinaryObject</span> val <span class="token operator">=</span> binary<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token string">&quot;Person&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setField</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setField</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Joe&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ClientCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">BinaryObject</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;persons&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withKeepBinary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">BinaryObject</span> cachedVal <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-6-安全"><a href="#_3-6-安全" class="header-anchor">#</a> 3.6.安全</h3> <h4 id="_3-6-1-加密"><a href="#_3-6-1-加密" class="header-anchor">#</a> 3.6.1.加密</h4> <p>通过在通信管道上开启SSL/TLS，可以确保瘦客户端上的数据是加密的。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientConfiguration</span> clientCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAddresses</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:10800&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

clientCfg
    <span class="token punctuation">.</span><span class="token function">setSslMode</span><span class="token punctuation">(</span><span class="token class-name">SslMode</span><span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setSslClientCertificateKeyStorePath</span><span class="token punctuation">(</span><span class="token string">&quot;client.jks&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setSslClientCertificateKeyStoreType</span><span class="token punctuation">(</span><span class="token string">&quot;JKS&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setSslClientCertificateKeyStorePassword</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setSslTrustCertificateKeyStorePath</span><span class="token punctuation">(</span><span class="token string">&quot;trust.jks&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setSslTrustCertificateKeyStoreType</span><span class="token punctuation">(</span><span class="token string">&quot;JKS&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setSslTrustCertificateKeyStorePassword</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setSslKeyAlgorithm</span><span class="token punctuation">(</span><span class="token string">&quot;SunX509&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setSslTrustAll</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setSslProtocol</span><span class="token punctuation">(</span><span class="token class-name">SslProtocol</span><span class="token punctuation">.</span>TLS<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>clientCfg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-6-2-认证"><a href="#_3-6-2-认证" class="header-anchor">#</a> 3.6.2.认证</h4> <p>如果服务端开启认证，那么用户必须提供凭据。</p> <p>如果认证失败，会抛出<code>ClientAuthenticationException</code>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientConfiguration</span> clientCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setAddresses</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:10800&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">&quot;joe&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setUserPassword</span><span class="token punctuation">(</span><span class="token string">&quot;passw0rd!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>clientCfg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClientAuthenticationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Handle authentication failure</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">确保开启服务端的认证</p> <p>确保<a href="/doc/2.8.0/java/Security.html#_2-高级安全">服务端的认证</a>已开启，并且在凭据存储中配置了客户端凭据。</p></div> <h4 id="_3-6-3-授权"><a href="#_3-6-3-授权" class="header-anchor">#</a> 3.6.3.授权</h4> <p>目前，Ignite本身还不直接支持授权，但是提供了授权的机制，允许开发者自定义授权的插件，或者从第三方厂家处获取插件，比如<a href="https://www.gridgain.com/docs/latest/administrators-guide/security" target="_self" rel="noopener noreferrer">这里</a>。</p> <h2 id="_4-node-js瘦客户端"><a href="#_4-node-js瘦客户端" class="header-anchor">#</a> 4.Node.js瘦客户端</h2> <h3 id="_4-1-node-js瘦客户端"><a href="#_4-1-node-js瘦客户端" class="header-anchor">#</a> 4.1.Node.js瘦客户端</h3> <h4 id="_4-1-1-概述"><a href="#_4-1-1-概述" class="header-anchor">#</a> 4.1.1.概述</h4> <p>这个瘦客户端使得Node.js应用可以通过<a href="#_2-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8D%8F%E8%AE%AE">二进制客户端协议</a>与Ignite集群进行交互。</p> <p>瘦客户端是一个轻量级的Ignite客户端，通过标准的Socket连接接入集群，它不会启动一个JVM进程（不需要Java），不会成为集群拓扑的一部分，也不持有任何数据，也不会参与计算网格的计算。</p> <p>它所做的只是简单地建立一个与标准Ignite节点的Socket连接，并通过该节点执行所有操作。</p> <h4 id="_4-1-2-入门"><a href="#_4-1-2-入门" class="header-anchor">#</a> 4.1.2.入门</h4> <p><strong>要求</strong></p> <ul><li><a href="https://nodejs.org/en/" target="_self" rel="noopener noreferrer">Node.js</a>的版本要求是8.0及以上，可以下载Node.js针对特定平台预编译好的<a href="https://nodejs.org/en/download/" target="_self" rel="noopener noreferrer">二进制安装包</a>，也可以使用<a href="https://nodejs.org/en/download/package-manager" target="_self" rel="noopener noreferrer">包管理器</a>安装Node.js；</li> <li><a href="https://ignite.apache.org/download.cgi" target="_self" rel="noopener noreferrer">最新版本</a>的Ignite。</li></ul> <p><code>node</code>和<code>npm</code>安装完之后，就可以选择下面中的一个安装选项：</p> <p><strong>通过npm进行安装</strong></p> <p>通过执行下面的命令来安装Node.js的瘦客户端包：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> -g apache-ignite-client
</code></pre></div><p><strong>通过源代码进行安装</strong></p> <p>如果希望从Ignite的仓库构建和安装瘦客户端包，可以按照如下步骤操作：</p> <ol><li>克隆或者复制Ignite的仓库<a href="https://github.com/apache/ignite.git" target="_self" rel="noopener noreferrer">https://github.com/apache/ignite.git</a>到<code>local_ignite_path</code>；</li> <li>切换到<code>local_ignite_path/modules/platforms/nodejs</code>文件夹；</li> <li>执行<code>npm link</code>命令；</li> <li>执行<code>npm link apache-ignite-client</code>命令（只针对示例和测试）。</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> local_ignite_path/modules/platforms/nodejs
<span class="token function">npm</span> <span class="token function">link</span>
<span class="token function">npm</span> <span class="token function">link</span> apache-ignite-client <span class="token comment">#linking examples (optional)</span>
</code></pre></div><h4 id="_4-1-3-运行示例"><a href="#_4-1-3-运行示例" class="header-anchor">#</a> 4.1.3.运行示例</h4> <p>为了方便入门，这里使用的是随着每个Ignite版本发布的一个现成的<a href="https://github.com/apache/ignite/tree/master/modules/platforms/nodejs/examples" target="_self" rel="noopener noreferrer">示例</a>。</p> <p>1.运行Ignite的服务端：</p> <p>在用Node.js瘦客户端接入Ignite之前，需要启动至少一个Ignite服务端节点。要使用默认的配置启动一个集群节点，打开终端，假定位于<code>IGNITE_HOME</code>（Ignite安装文件夹），只需要输入：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="linux" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-bash extra-class"><pre class="language-bash"><code>./ignite.sh
</code></pre></div></section> <section aria-hidden="true" id="windows" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">ignite</span>.bat</span>
</code></pre></div></section></div></div> <p>2.链接Ignite的Node.js示例（如果还没做）：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> <span class="token punctuation">{</span>ignite<span class="token punctuation">}</span>/modules/platforms/nodejs/examples <span class="token comment"># navigate to examples folder</span>
<span class="token function">npm</span> <span class="token function">link</span> apache-ignite-client <span class="token comment">#link examples</span>
</code></pre></div><p>必要的时候，要修改源文件中<code>ENDPOINT</code>常量，它表示一个远程的Ignite节点端点，默认值为<code>127.0.0.1:10800</code>。</p> <p>3.通过调用<code>node &lt;example_file_name&gt;.js</code>来运行这个示例，如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>node CachePutGetExample.js
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Node.js示例文件</p> <p>Node.js瘦客户端有完整的直接可用的<a href="https://github.com/apache/ignite/tree/master/modules/platforms/nodejs/examples" target="_self" rel="noopener noreferrer">示例</a>，它们可以演示客户端的行为。</p></div> <h3 id="_4-2-初始化和配置"><a href="#_4-2-初始化和配置" class="header-anchor">#</a> 4.2.初始化和配置</h3> <p>本章节会描述使用Node.js瘦客户端与Ignite集群进行交互的基本步骤。</p> <p>在用Node.js瘦客户端接入Ignite之前，需要启动至少一个Ignite服务端节点，比如，可以使用<code>ignite.sh</code>脚本：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="linux" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-bash extra-class"><pre class="language-bash"><code>./ignite.sh
</code></pre></div></section> <section aria-hidden="true" id="windows" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">ignite</span>.bat</span>
</code></pre></div></section></div></div> <h4 id="_4-2-1-初始化igniteclient"><a href="#_4-2-1-初始化igniteclient" class="header-anchor">#</a> 4.2.1.初始化IgniteClient</h4> <p>客户端的使用始于<code>IgniteClient</code>类实例的创建，它会将Node.js应用接入Ignite集群。其构造函数有一个可选的参数<code>onStateChanged</code>回调函数，每次客户端跳转到新的连接状态时都会调用该回调函数（请参见下文）。</p> <p>可以根据需要创建尽可能多的<code>IgniteClient</code>实例，它们都将独立工作。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span>onStateChanged<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">onStateChanged</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> IgniteClient<span class="token punctuation">.</span><span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">CONNECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Client is started'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> IgniteClient<span class="token punctuation">.</span><span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">DISCONNECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Client is stopped'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_4-2-2-配置igniteclient"><a href="#_4-2-2-配置igniteclient" class="header-anchor">#</a> 4.2.2.配置IgniteClient</h4> <p>下一步是为客户端连接创建配置，可以通过注入<code>IgniteClientConfiguration</code>类实例实现。</p> <p>必须要配置（在构造函数中指定）的是Ignite节点的端点列表。至少要指定一个端点。客户端只会连接到一个节点（从提供的列表中随机选一个端点）。其它节点（如果提供）由客户端用于<code>故障转移重连算法</code>：如果当前连接断开，客户端将尝试重连到列表中的下一个随机端点。</p> <p>可以使用其它方法指定其它的可选配置，这些方法包括：</p> <ul><li>通过用户名/密码进行认证；</li> <li>SSL/TLS连接；</li> <li>Node.js连接选项。</li></ul> <p>客户端默认会使用Node.js定义的默认连接选项建立一个不安全的连接，即不使用认证。</p> <p>下面的示例显示了如何对客户端进行配置：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>

<span class="token keyword">const</span> igniteClientConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下一个示例显示如何在客户端配置中添加用户名/密码和额外的连接选项：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>

<span class="token keyword">const</span> igniteClientConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">'ignite'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">'ignite'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">setConnectionOptions</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'timeout'</span> <span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_4-2-3-接入集群"><a href="#_4-2-3-接入集群" class="header-anchor">#</a> 4.2.3.接入集群</h4> <p>下一步是将客户端连接到Ignite集群。在<code>connect</code>方法中指定了客户端连接的配置，其中包括要连接到的端点。</p> <p>客户端有三种连接状态：<code>CONNECTING</code>、<code>CONNECTED</code>、<code>DISCONNECTED</code>。如果在客户端的构造函数中有回调函数，则该状态会通过<code>onStateChanged</code>回调函数反馈。</p> <p>只有在<code>CONNECTED</code>状态下，才能与Ignite集群进行交互。</p> <p>如果客户端断开连接，它会自动跳转到<code>CONNECTING</code>状态，并尝试使用<code>故障转移重连算法</code>重新连接。如果无法重连到所提供列表中的所有端点，则客户端将跳转到<code>DISCONNECTED</code>状态。</p> <p>应用程序随时都可以调用<code>disconnect</code>方法将客户端强制跳转到<code>DISCONNECTED</code>状态。</p> <p>当客户端断开连接时，应用可以使用相同或不同的配置（例如使用不同的端点列表）再次调用<code>connect</code>方法。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">connectClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span>onStateChanged<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> igniteClientConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span>
          <span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">,</span> <span class="token string">'127.0.0.1:10801'</span><span class="token punctuation">,</span> <span class="token string">'127.0.0.1:10802'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// connect to Ignite node</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>igniteClientConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">onStateChanged</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> IgniteClient<span class="token punctuation">.</span><span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">CONNECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Client is started'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> IgniteClient<span class="token punctuation">.</span><span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">CONNECTING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Client is connecting'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> IgniteClient<span class="token punctuation">.</span><span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">DISCONNECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Client is stopped'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">connectClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_4-2-4-配置缓存"><a href="#_4-2-4-配置缓存" class="header-anchor">#</a> 4.2.4.配置缓存</h4> <p>下一步是获取一个缓存实例，一个用于访问存储在Ignite中的数据的<code>CacheClient</code>类实例。</p> <p>瘦客户端提供了几种方法来处理Ignite缓存和创建缓存实例：按名称获取缓存、使用指定名称和可选缓存配置创建缓存、获取或创建缓存、销毁缓存等。</p> <p>对于相同或不同的Ignite缓存，可以根据需要获取任意数量的缓存实例，并且可以对它们并行处理。</p> <p>以下示例显示如何按名称访问缓存以及随后销毁它：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getOrCreateCacheByName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// get or create cache by name</span>
        <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// perform cache key-value operations</span>
        <span class="token comment">// ...</span>

        <span class="token comment">// destroy cache</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">destroyCache</span><span class="token punctuation">(</span><span class="token string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        igniteClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">getOrCreateCacheByName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下一个示例显示如何通过名字和配置访问缓存：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>
<span class="token keyword">const</span> CacheConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>CacheConfiguration<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createCacheByConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// create cache by name and configuration</span>
        <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">createCache</span><span class="token punctuation">(</span>
            <span class="token string">'myCache'</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSqlSchema</span><span class="token punctuation">(</span><span class="token string">'PUBLIC'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        igniteClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">createCacheByConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下面的示例显示如何通过名字获取一个已有的缓存：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getExistingCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// get existing cache by name</span>
        <span class="token keyword">const</span> cache <span class="token operator">=</span> igniteClient<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        igniteClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">getExistingCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>类型映射配置</strong></p> <p>可以为缓存的键和/或值指定具体的Ignite类型。如果键和/或值是非基础类型（如映射、集合、复杂对象等），也可以为该对象的字段指定具体的Ignite类型。</p> <p>如果没有为某些字段显式指定Ignite类型，客户端将尝试在JavaScript类型和Ignite对象类型之间进行自动默认映射。</p> <p>有关类型和映射的更多详细信息，请参见<a href="#_4-2-5-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">数据类型</a>部分。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>
<span class="token keyword">const</span> ObjectType <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>ObjectType<span class="token punctuation">;</span>
<span class="token keyword">const</span> MapObjectType <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>MapObjectType<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">setCacheKeyValueTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// set cache key/value types</span>
        cache<span class="token punctuation">.</span><span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setValueType</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MapObjectType</span><span class="token punctuation">(</span>
                MapObjectType<span class="token punctuation">.</span><span class="token constant">MAP_SUBTYPE</span><span class="token punctuation">.</span><span class="token constant">LINKED_HASH_MAP</span><span class="token punctuation">,</span>
                ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">SHORT</span><span class="token punctuation">,</span>
                ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">BYTE_ARRAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        igniteClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">setCacheKeyValueTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>到这里，就可以对存储的数据进行处理，或者将数据放入Ignite。</p> <h4 id="_4-2-5-数据类型"><a href="#_4-2-5-数据类型" class="header-anchor">#</a> 4.2.5.数据类型</h4> <p>在二进制客户端协议中定义的Ignite类型和JavaScript类型之间，客户端支持两种映射方式：</p> <ul><li>显式映射；</li> <li>默认映射；</li></ul> <p><strong>显式映射</strong></p> <p>每次应用通过客户端的API向Ignite写入或读取字段时都会发生映射。这里的字段是任何存储在Ignite中的数据，包括一个Ignite条目的全部键或值、数组或集合的元素、复杂对象的字段等。</p> <p>使用客户端API的方法，应用可以显式指定特定字段的Ignite类型。客户端使用此信息将字段从JavaScript转换为Java类型，而在读/写操作期间反之亦然。作为读取操作的结果，该字段被转换为JavaScript类型。在写操作的输入中验证相应的JavaScript类型。</p> <p>如果应用没有为字段显式指定Ignite类型，则客户端在字段读/写操作期间使用默认映射。</p> <p><strong>默认映射</strong></p> <p>Ignite和JavaScript类型之间的默认映射说明在<a href="https://rawgit.com/apache/ignite/master/modules/platforms/nodejs/api_spec/ObjectType.html" target="_self" rel="noopener noreferrer">这里</a>。</p> <p><strong>复杂对象类型支持</strong></p> <p>客户端提供了两种操作Ignite复杂对象类型的方法：反序列化形式和二进制形式。</p> <p>应用可以通过<code>ComplexObjectType</code>类的实例指定字段的Ignite类型，它是一个JavaScript对象实例的引用。这时当应用读取字段的值时，客户端将反序列化接收到的Ignite复杂对象，并将其作为相应JavaScript对象的实例返回给客户端。当应用写入字段值时，客户端需要相应的JavaScript对象的实例，并将其序列化为Ignite复杂对象。</p> <p>如果应用没有指定字段的Ignite类型并读取字段的值，客户端会将接收到的Ignite复杂对象作为<code>BinaryObject</code>类的实例返回（Ignite复杂对象的二进制形式）。<code>BinaryObject</code>无需反序列化就可以对其内容进行处理（读取和写入对象字段的值、添加和删除字段等），而且应用还可以从JavaScript对象创建<code>BinaryObject</code>类的实例。如果该字段没有显式指定的Ignite类型，则应用程序可以将二进制对象作为字段的值写入Ignite。</p> <p>客户端负责从/在Ignite集群获取或注册有关Ignite复杂对象类型的信息（包括模式）。当需要从/到Ignite点读取或写入Ignite复杂对象时，这个过程由客户端自动完成。</p> <h4 id="_4-2-6-支持的api"><a href="#_4-2-6-支持的api" class="header-anchor">#</a> 4.2.6.支持的API</h4> <p>客户端API的规范在<a href="https://rawgit.com/apache/ignite/master/modules/platforms/nodejs/api_spec/index.html" target="_self" rel="noopener noreferrer">这里</a>。</p> <p>除了下面不适用的特性之外，客户端支持<a href="#_2-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8D%8F%E8%AE%AE">二进制客户端协议</a>中的所有操作和类型：</p> <ul><li><code>OP_REGISTER_BINARY_TYPE_NAME</code>和<code>OP_GET_BINARY_TYPE_NAME</code>操作是不支持的；</li> <li><code>OP_QUERY_SCAN</code>操作的过滤器对象是不支持的，<code>OP_QUERY_SCAN</code>操作本身是支持的；</li> <li>无法注册一个新的Ignite枚举类型，对一个已有的Ignite枚举类型项目的读写是支持的；</li></ul> <p>下面的附加特性是支持的：</p> <ul><li>通过用户名/密码进行认证；</li> <li>SSL/TLS连接；</li> <li>故障转移重连算法</li></ul> <h4 id="_4-2-7-启用调试"><a href="#_4-2-7-启用调试" class="header-anchor">#</a> 4.2.7.启用调试</h4> <p>要打开/关闭客户端的调试输出开关（包括错误日志），可以调用<code>IgniteClient</code>实例的<code>setDebug()</code>方法，调试输出默认是关闭的。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
igniteClient<span class="token punctuation">.</span><span class="token function">setDebug</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-3-键-值"><a href="#_4-3-键-值" class="header-anchor">#</a> 4.3.键-值</h3> <h4 id="_4-3-1-键-值操作"><a href="#_4-3-1-键-值操作" class="header-anchor">#</a> 4.3.1.键-值操作</h4> <p><code>CacheClient</code>类为缓存的键值数据提供了键值操作的方法，<code>put</code>、<code>get</code>、<code>putAll</code>、<code>getAll</code>、<code>replace</code>等，下面是一个示例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>
<span class="token keyword">const</span> ObjectType <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>ObjectType<span class="token punctuation">;</span>
<span class="token keyword">const</span> CacheEntry <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>CacheEntry<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">performCacheKeyValueOperations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// put and get value</span>
        <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// put and get multiple values using putAll()/getAll() methods</span>
        <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'value2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'value3'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> values <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// removes all entries from the cache</span>
        <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        igniteClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">performCacheKeyValueOperations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_4-3-2-扫描查询"><a href="#_4-3-2-扫描查询" class="header-anchor">#</a> 4.3.2.扫描查询</h4> <p>Node.js客户端完全支持Ignite的扫描查询。查询方法会返回一个游标类，它可以用于对结果集的延迟迭代，或者一次获取所有的结果。</p> <p>首先，通过创建和配置一个<code>ScanQuery</code>类的实例来定义查询。</p> <p>然后，将<code>ScanQuery</code>实例传递给<code>Cache</code>实例并执行查询，最后使用<code>Cursor</code>实例来对返回的查询结果进行迭代或者获取所有数据。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>
<span class="token keyword">const</span> ObjectType <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>ObjectType<span class="token punctuation">;</span>
<span class="token keyword">const</span> CacheEntry <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>CacheEntry<span class="token punctuation">;</span>
<span class="token keyword">const</span> ScanQuery <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>ScanQuery<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">performScanQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// put multiple values using putAll()</span>
        <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'value1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'value2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'value3'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// create and configure scan query</span>
        <span class="token keyword">const</span> scanQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScanQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setPageSize</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// obtain scan query cursor</span>
        <span class="token keyword">const</span> cursor <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>scanQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// getAll cache entries returned by the scan query</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> cacheEntry <span class="token keyword">of</span> <span class="token keyword">await</span> cursor<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cacheEntry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">destroyCache</span><span class="token punctuation">(</span><span class="token string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        igniteClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">performScanQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-4-sql"><a href="#_4-4-sql" class="header-anchor">#</a> 4.4.SQL</h3> <h4 id="_4-4-1-sql查询"><a href="#_4-4-1-sql查询" class="header-anchor">#</a> 4.4.1.SQL查询</h4> <p>Node.js客户端完全支持Ignite的SQL查询，查询方法会返回一个游标类，它可以用于对结果集的延迟迭代，或者一次获取所有的结果。</p> <p>首先，通过创建和配置一个<code>SqlQuery</code>类的实例来定义查询。</p> <p>然后，将<code>SqlQuery</code>实例传递给<code>Cache</code>实例并执行查询，最后使用<code>Cursor</code>实例来对返回的查询结果进行迭代或者获取所有数据。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>
<span class="token keyword">const</span> CacheConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>CacheConfiguration<span class="token punctuation">;</span>
<span class="token keyword">const</span> QueryEntity <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>QueryEntity<span class="token punctuation">;</span>
<span class="token keyword">const</span> QueryField <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>QueryField<span class="token punctuation">;</span>
<span class="token keyword">const</span> ObjectType <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>ObjectType<span class="token punctuation">;</span>
<span class="token keyword">const</span> ComplexObjectType <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>ComplexObjectType<span class="token punctuation">;</span>
<span class="token keyword">const</span> CacheEntry <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>CacheEntry<span class="token punctuation">;</span>
<span class="token keyword">const</span> SqlQuery <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>SqlQuery<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">performSqlQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// cache configuration required for sql query execution</span>
        <span class="token keyword">const</span> cacheConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setQueryEntities</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">QueryEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                    <span class="token function">setValueTypeName</span><span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                    <span class="token function">setFields</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                        <span class="token keyword">new</span> <span class="token class-name">QueryField</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'java.lang.String'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token keyword">new</span> <span class="token class-name">QueryField</span><span class="token punctuation">(</span><span class="token string">'salary'</span><span class="token punctuation">,</span> <span class="token string">'java.lang.Double'</span><span class="token punctuation">)</span>
                    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">'sqlQueryPersonCache'</span><span class="token punctuation">,</span> cacheConfiguration<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setValueType</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ComplexObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'name'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'salary'</span> <span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'Person'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// put multiple values using putAll()</span>
        <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'name'</span> <span class="token operator">:</span> <span class="token string">'John Doe'</span><span class="token punctuation">,</span> <span class="token string">'salary'</span> <span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'name'</span> <span class="token operator">:</span> <span class="token string">'Jane Roe'</span><span class="token punctuation">,</span> <span class="token string">'salary'</span> <span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'name'</span> <span class="token operator">:</span> <span class="token string">'Mary Major'</span><span class="token punctuation">,</span> <span class="token string">'salary'</span> <span class="token operator">:</span> <span class="token number">1500</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// create and configure sql query</span>
        <span class="token keyword">const</span> sqlQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlQuery</span><span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> <span class="token string">'salary &gt; ? and salary &lt;= ?'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">900</span><span class="token punctuation">,</span> <span class="token number">1600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// obtain sql query cursor</span>
        <span class="token keyword">const</span> cursor <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sqlQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// getAll cache entries returned by the sql query</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> cacheEntry <span class="token keyword">of</span> <span class="token keyword">await</span> cursor<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cacheEntry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">destroyCache</span><span class="token punctuation">(</span><span class="token string">'sqlQueryPersonCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        igniteClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">performSqlQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_4-4-2-sql字段查询"><a href="#_4-4-2-sql字段查询" class="header-anchor">#</a> 4.4.2.SQL字段查询</h4> <p>这种类型的查询用于获取作为SQL查询结果集一部分的部分字段，执行诸如INSERT、UPDATE、DELETE、CREATE等DML和DDL语句。</p> <p>首先，通过创建和配置<code>SqlFieldsQuery</code>类的实例来定义查询。然后，将<code>SqlFieldsQuery</code>传递到<code>Cache</code>实例的查询方法，并获取<code>SqlFieldsCursor</code>类的实例。最后，使用<code>SqlFieldsCursor</code>实例迭代或获取查询返回的所有元素。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>
<span class="token keyword">const</span> CacheConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>CacheConfiguration<span class="token punctuation">;</span>
<span class="token keyword">const</span> ObjectType <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>ObjectType<span class="token punctuation">;</span>
<span class="token keyword">const</span> CacheEntry <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>CacheEntry<span class="token punctuation">;</span>
<span class="token keyword">const</span> SqlFieldsQuery <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>SqlFieldsQuery<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">performSqlFieldsQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">'myPersonCache'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setSqlSchema</span><span class="token punctuation">(</span><span class="token string">'PUBLIC'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// create table using SqlFieldsQuery</span>
        <span class="token punctuation">(</span><span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span>
           <span class="token string">'CREATE TABLE Person (id INTEGER PRIMARY KEY, firstName VARCHAR, lastName VARCHAR, salary DOUBLE)'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// insert data into the table</span>
        <span class="token keyword">const</span> insertQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token string">'INSERT INTO Person (id, firstName, lastName, salary) values (?, ?, ?, ?)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setArgTypes</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>insertQuery<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>insertQuery<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Jane'</span><span class="token punctuation">,</span> <span class="token string">'Roe'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// obtain sql fields cursor</span>
        <span class="token keyword">const</span> sqlFieldsCursor <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT concat(firstName, ' ', lastName), salary from Person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                <span class="token function">setPageSize</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// iterate over elements returned by the query</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> sqlFieldsCursor<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>sqlFieldsCursor<span class="token punctuation">.</span><span class="token function">hasMore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// drop the table</span>
        <span class="token punctuation">(</span><span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;DROP TABLE Person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        igniteClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">performSqlFieldsQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-5-二进制类型"><a href="#_4-5-二进制类型" class="header-anchor">#</a> 4.5.二进制类型</h3> <p>除了下面不适用的特性之外，客户端支持<a href="#_2-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8D%8F%E8%AE%AE">二进制客户端协议</a>中的所有操作和类型：</p> <ul><li><code>OP_REGISTER_BINARY_TYPE_NAME</code>和<code>OP_GET_BINARY_TYPE_NAME</code>操作是不支持的；</li> <li><code>OP_QUERY_SCAN</code>操作的过滤器对象是不支持的，<code>OP_QUERY_SCAN</code>操作本身是支持的；</li> <li>无法注册一个新的Ignite枚举类型，对一个已有的Ignite枚举类型项目的读写是支持的；</li></ul> <p>下面的示例显示了如何处理复杂对象和二进制对象：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>
<span class="token keyword">const</span> ObjectType <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>ObjectType<span class="token punctuation">;</span>
<span class="token keyword">const</span> CacheEntry <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>CacheEntry<span class="token punctuation">;</span>
<span class="token keyword">const</span> ComplexObjectType <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>ComplexObjectType<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">id <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> salary <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">=</span> salary<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">putGetComplexAndBinaryObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">'myPersonCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Complex Object type for JavaScript Person class instances</span>
        <span class="token keyword">const</span> personComplexObjectType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComplexObjectType</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setFieldType</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// set cache key and value types</span>
        cache<span class="token punctuation">.</span><span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setValueType</span><span class="token punctuation">(</span>personComplexObjectType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// put Complex Objects to the cache</span>
        <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'John Doe'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Jane Roe'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// get Complex Object, returned value is an instance of Person class</span>
        <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// new CacheClient instance of the same cache to operate with BinaryObjects</span>
        <span class="token keyword">const</span> binaryCache <span class="token operator">=</span> igniteClient<span class="token punctuation">.</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token string">'myPersonCache'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// get Complex Object from the cache in a binary form, returned value is an instance of BinaryObject class</span>
        <span class="token keyword">let</span> binaryPerson <span class="token operator">=</span> <span class="token keyword">await</span> binaryCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Binary form of Person:'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> fieldName <span class="token keyword">of</span> binaryPerson<span class="token punctuation">.</span><span class="token function">getFieldNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> fieldValue <span class="token operator">=</span> <span class="token keyword">await</span> binaryPerson<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fieldName <span class="token operator">+</span> <span class="token string">' : '</span> <span class="token operator">+</span> fieldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// modify Binary Object and put it to the cache</span>
        binaryPerson<span class="token punctuation">.</span><span class="token function">setField</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setField</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Mary Major'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> binaryCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> binaryPerson<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// get Binary Object from the cache and convert it to JavaScript Object</span>
        binaryPerson <span class="token operator">=</span> <span class="token keyword">await</span> binaryCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> binaryPerson<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span>personComplexObjectType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">destroyCache</span><span class="token punctuation">(</span><span class="token string">'myPersonCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        igniteClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">putGetComplexAndBinaryObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-6-安全"><a href="#_4-6-安全" class="header-anchor">#</a> 4.6.安全</h3> <h4 id="_4-6-1-认证"><a href="#_4-6-1-认证" class="header-anchor">#</a> 4.6.1.认证</h4> <p>关于如何在Ignite的集群端打开和配置认证，说明在<a href="/doc/2.8.0/java/Security.html#_2-高级安全">这里</a>。在Node.js端，将用户名/密码传递给<code>IgniteClientConfiguration</code>的方法如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">ENDPOINT</span> <span class="token operator">=</span> <span class="token string">'localhost:10800'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">USER_NAME</span> <span class="token operator">=</span> <span class="token string">'ignite'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">PASSWORD</span> <span class="token operator">=</span> <span class="token string">'ignite'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token constant">ENDPOINT</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
	<span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token constant">USER_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token constant">PASSWORD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_4-6-2-加密"><a href="#_4-6-2-加密" class="header-anchor">#</a> 4.6.2.加密</h4> <p>1.获取TLS所需的证书：</p> <ul><li>或着获取指定的Ignite服务端可用的现有证书；</li> <li>或者为正在使用的Ignite服务端生成新证书；</li></ul> <p>2.需要以下文件：</p> <ul><li><code>keystore.jks</code>，<code>truststore.jks</code> - 用于服务端；</li> <li><code>client.key</code>，<code>client.crt</code>，<code>ca.crt</code> - 用于客户端；</li></ul> <p>3.设置Ignite服务端以支持<a href="/doc/2.8.0/java/Security.html#_1-ssl和tls">SSL和TLS</a>，在启动过程中提供获得的<code>keystore.jks</code>和<code>truststore.jks</code>证书；</p> <p>4.将<code>client.key</code>、<code>client.crt</code>和<code>ca.crt</code>文件放在客户端本地的某个位置；</p> <p>5.根据需要，更新下面示例中的常量<code>TLS_KEY_FILE_NAME</code>、<code>TLS_CERT_FILE_NAME</code>和<code>TLS_CA_FILE_NAME</code>；</p> <p>6.根据需要更新下面示例中的<code>USER_NAME</code>和<code>PASSWORD</code>常量。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">FS</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ObjectType <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>ObjectType<span class="token punctuation">;</span>
<span class="token keyword">const</span> ComplexObjectType <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>ComplexObjectType<span class="token punctuation">;</span>
<span class="token keyword">const</span> BinaryObject <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>BinaryObject<span class="token punctuation">;</span>
<span class="token keyword">const</span> CacheEntry <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>CacheEntry<span class="token punctuation">;</span>
<span class="token keyword">const</span> ScanQuery <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>ScanQuery<span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">ENDPOINT</span> <span class="token operator">=</span> <span class="token string">'localhost:10800'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">USER_NAME</span> <span class="token operator">=</span> <span class="token string">'ignite'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">PASSWORD</span> <span class="token operator">=</span> <span class="token string">'ignite'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">TLS_KEY_FILE_NAME</span> <span class="token operator">=</span> __dirname <span class="token operator">+</span> <span class="token string">'/certs/client.key'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">TLS_CERT_FILE_NAME</span> <span class="token operator">=</span> __dirname <span class="token operator">+</span> <span class="token string">'/certs/client.crt'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">TLS_CA_FILE_NAME</span> <span class="token operator">=</span> __dirname <span class="token operator">+</span> <span class="token string">'/certs/ca.crt'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">CACHE_NAME</span> <span class="token operator">=</span> <span class="token string">'AuthTlsExample_cache'</span><span class="token punctuation">;</span>

<span class="token comment">// This example demonstrates how to establish a secure connection to an Ignite node and use username/password authentication,</span>
<span class="token comment">// as well as basic Key-Value Queries operations for primitive types:</span>
<span class="token comment">// - connects to a node using TLS and providing username/password</span>
<span class="token comment">// - creates a cache, if it doesn't exist</span>
<span class="token comment">//   - specifies key and value type of the cache</span>
<span class="token comment">// - put data of primitive types into the cache</span>
<span class="token comment">// - get data from the cache</span>
<span class="token comment">// - destroys the cache</span>
<span class="token keyword">class</span> <span class="token class-name">AuthTlsExample</span> <span class="token punctuation">{</span>

    <span class="token keyword">async</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onStateChanged</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> connectionOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'key'</span> <span class="token operator">:</span> <span class="token constant">FS</span><span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token constant">TLS_KEY_FILE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'cert'</span> <span class="token operator">:</span> <span class="token constant">FS</span><span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token constant">TLS_CERT_FILE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'ca'</span> <span class="token operator">:</span> <span class="token constant">FS</span><span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token constant">TLS_CA_FILE_NAME</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token constant">ENDPOINT</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                <span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token constant">USER_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                <span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token constant">PASSWORD</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                <span class="token function">setConnectionOptions</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> connectionOptions<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                <span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                <span class="token function">setValueType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">SHORT_ARRAY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">putGetData</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">destroyCache</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ERROR: '</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            igniteClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">putGetData</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> values <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateValue</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// put multiple values in parallel</span>
        <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>keys<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> values<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>keys<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> values<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Cache values put successfully'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// get values sequentially</span>
        <span class="token keyword">let</span> value<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            value <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compareValues</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Unexpected cache value!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Cache values get successfully'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">compareValues</span><span class="token punctuation">(</span><span class="token parameter">array1<span class="token punctuation">,</span> array2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> array1<span class="token punctuation">.</span>length <span class="token operator">===</span> array2<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span>
            array1<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value1<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> value1 <span class="token operator">===</span> array2<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">generateValue</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> length <span class="token operator">=</span> key <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> key <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">onStateChanged</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> IgniteClient<span class="token punctuation">.</span><span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">CONNECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Client is started'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> IgniteClient<span class="token punctuation">.</span><span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">DISCONNECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Client is stopped'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> authTlsExample <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AuthTlsExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authTlsExample<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_5-python瘦客户端"><a href="#_5-python瘦客户端" class="header-anchor">#</a> 5.Python瘦客户端</h2> <h3 id="_5-1-python瘦客户端"><a href="#_5-1-python瘦客户端" class="header-anchor">#</a> 5.1.Python瘦客户端</h3> <h4 id="_5-1-1-概述"><a href="#_5-1-1-概述" class="header-anchor">#</a> 5.1.1.概述</h4> <p>Python瘦客户端（缩写为<strong>pyignite</strong>）可以使Python应用通过<a href="#_2-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8D%8F%E8%AE%AE">二进制客户端协议</a>与Ignite集群进行交互。</p> <p>瘦客户端是一个轻量级的Ignite客户端，通过标准的Socket连接接入集群，它不会启动一个JVM进程（不需要Java），不会成为集群拓扑的一部分，也不持有任何数据，也不会参与计算网格的计算。</p> <p>它所做的只是简单地建立一个与标准Ignite节点的Socket连接，并通过该节点执行所有操作。</p> <h4 id="_5-1-2-入门"><a href="#_5-1-2-入门" class="header-anchor">#</a> 5.1.2.入门</h4> <p><strong>要求</strong></p> <ul><li>Python的3.4及以后的版本</li> <li><a href="https://ignite.apache.org/download.cgi" target="_self" rel="noopener noreferrer">最新版本</a>的Ignite。</li></ul> <p><strong>安装</strong></p> <p>可以从<a href="https://pypi.org/project/pyignite/" target="_self" rel="noopener noreferrer">PYPI</a>中安装<code>pyignite</code>：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ pip <span class="token function">install</span> pyignite
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>在MacOS平台上，需要使用<code>pip3 install pyignite</code>命令来完成安装。</p></div> <p><strong>运行一个示例</strong></p> <p>安装完<code>pyignite</code>之后，为了方便入门，这里使用的是随着每个Ignite版本发布的一个现成的<a href="https://github.com/apache/ignite/tree/master/modules/platforms/python/examples" target="_self" rel="noopener noreferrer">示例</a>。</p> <p>1.运行Ignite的服务端：</p> <p>要使用默认的配置启动一个集群节点，打开终端，假定位于<code>IGNITE_HOME</code>（Ignite安装文件夹），只需要输入：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="linux" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-bash extra-class"><pre class="language-bash"><code>./ignite.sh
</code></pre></div></section> <section aria-hidden="true" id="windows" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">ignite</span>.bat</span>
</code></pre></div></section></div></div> <p>2.在另一个终端窗口，转到<code>IGNITE_HOME/platforms/python/examples</code>，调用<code>python &lt;example_file_name&gt;.py</code>就可以运行一个示例，比如：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> IGNITE_HOME/platforms/python/examples
$ python get_and_put.py
</code></pre></div><h3 id="_5-2-初始化和配置"><a href="#_5-2-初始化和配置" class="header-anchor">#</a> 5.2.初始化和配置</h3> <p>本章节会描述使用Python瘦客户端与Ignite集群进行交互的基本步骤。</p> <p>在用Python瘦客户端接入Ignite之前，需要启动至少一个Ignite服务端节点，比如，可以使用<code>ignite.sh</code>脚本：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="linux" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-bash extra-class"><pre class="language-bash"><code>./ignite.sh
</code></pre></div></section> <section aria-hidden="true" id="windows" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">ignite</span>.bat</span>
</code></pre></div></section></div></div> <h4 id="_5-2-1-接入集群"><a href="#_5-2-1-接入集群" class="header-anchor">#</a> 5.2.1.接入集群</h4> <p>下面的代码片段显示了如何从Python瘦客户端接入Ignite集群：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client

<span class="token comment">## Open a connection</span>
client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_5-2-2-创建缓存"><a href="#_5-2-2-创建缓存" class="header-anchor">#</a> 5.2.2.创建缓存</h4> <p>使用Python瘦客户端，可以在集群中创建缓存，比如：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client

<span class="token comment">## Open a connection</span>
client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>

<span class="token comment">## Create a cache</span>
my_cache <span class="token operator">=</span> client<span class="token punctuation">.</span>create_cache<span class="token punctuation">(</span><span class="token string">'my cache'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_5-2-3-配置缓存"><a href="#_5-2-3-配置缓存" class="header-anchor">#</a> 5.2.3.配置缓存</h4> <p><code>prop_codes</code>模块包含表示各种缓存设置的顺序值列表。</p> <p>与缓存同步、再平衡、关联和其它与缓存配置相关的详细信息，可以参见<a href="/doc/2.8.0/java/Key-ValueDataGrid.html">数据网格</a>的相关文档。</p> <p>通过<code>create_cache()</code>或<code>get_or_create_cache()</code>,下面的缓存属性可用于对缓存进行配置：</p> <table><thead><tr><th>属性名</th> <th>顺序值</th> <th>属性类型</th> <th>描述</th></tr></thead> <tbody><tr><td>PROP_NAME</td> <td>0</td> <td>string</td> <td>缓存名，这是唯一必须的属性</td></tr> <tr><td>PROP_CACHE_MODE</td> <td>1</td> <td>int</td> <td>缓存模式。LOCAL：0，REPLICATED：1，PARTITIONED：2</td></tr> <tr><td>PROP_CACHE_ATOMICITY_MODE</td> <td>2</td> <td>int</td> <td>缓存原子化模式。TRANSACTIONAL：0，ATOMIC：1</td></tr> <tr><td>PROP_BACKUPS_NUMBER</td> <td>3</td> <td>int</td> <td>备份数量</td></tr> <tr><td>PROP_WRITE_SYNCHRONIZATION_MODE</td> <td>4</td> <td>int</td> <td>写同步模式。FULL_SYNC：0，FULL_ASYNC：1，PRIMARY_SYNC：2</td></tr> <tr><td>PROP_COPY_ON_READ</td> <td>5</td> <td>bool</td> <td>读时复制标志</td></tr> <tr><td>PROP_READ_FROM_BACKUP</td> <td>6</td> <td>bool</td> <td>从备份读数据标志</td></tr> <tr><td>PROP_DATA_REGION_NAME</td> <td>100</td> <td>string</td> <td>内存区名</td></tr> <tr><td>PROP_IS_ONHEAP_CACHE_ENABLED</td> <td>101</td> <td>bool</td> <td>堆内内存标志</td></tr> <tr><td>PROP_QUERY_ENTITIES</td> <td>200</td> <td>list</td> <td>查询实体列表</td></tr> <tr><td>PROP_QUERY_PARALLELISM</td> <td>210</td> <td>int</td> <td>并行查询数量</td></tr> <tr><td>PROP_QUERY_DETAIL_METRIC_SIZE</td> <td>202</td> <td>int</td> <td>查询详细指标大小</td></tr> <tr><td>PROP_SQL_SCHEMA</td> <td>203</td> <td>string</td> <td>SQL模式</td></tr> <tr><td>PROP_SQL_INDEX_INLINE_MAX_SIZE</td> <td>204</td> <td>int</td> <td>SQL内联索引最大值</td></tr> <tr><td>PROP_SQL_ESCAPE_ALL</td> <td>205</td> <td>bool</td> <td>SQL转义标志</td></tr> <tr><td>PROP_MAX_QUERY_ITERATORS</td> <td>206</td> <td>int</td> <td>查询迭代器的最大数量</td></tr> <tr><td>PROP_REBALANCE_MODE</td> <td>300</td> <td>int</td> <td>再平衡模式。SYNC：0，ASYNC：1，NONE：2</td></tr> <tr><td>PROP_REBALANCE_DELAY</td> <td>301</td> <td>int</td> <td>再平衡延迟时间（毫秒）</td></tr> <tr><td>PROP_REBALANCE_TIMEOUT</td> <td>302</td> <td>int</td> <td>再平衡超时时间（毫秒）</td></tr> <tr><td>PROP_REBALANCE_BATCH_SIZE</td> <td>303</td> <td>int</td> <td>再平衡批处理大小</td></tr> <tr><td>PROP_REBALANCE_BATCHES_PREFETCH_COUNT</td> <td>304</td> <td>int</td> <td>再平衡批处理预取计数</td></tr> <tr><td>PROP_REBALANCE_ORDER</td> <td>305</td> <td>int</td> <td>再平衡顺序</td></tr> <tr><td>PROP_REBALANCE_THROTTLE</td> <td>306</td> <td>int</td> <td>再平衡调节（毫秒）</td></tr> <tr><td>PROP_GROUP_NAME</td> <td>400</td> <td>string</td> <td>缓存组名</td></tr> <tr><td>PROP_CACHE_KEY_CONFIGURATION</td> <td>401</td> <td>list</td> <td>缓存键配置列表</td></tr> <tr><td>PROP_DEFAULT_LOCK_TIMEOUT</td> <td>402</td> <td>int</td> <td>默认锁超时时间（毫秒）</td></tr> <tr><td>PROP_MAX_CONCURRENT_ASYNC_OPERATIONS</td> <td>403</td> <td>int</td> <td>最大并行异步操作数量</td></tr> <tr><td>PROP_PARTITION_LOSS_POLICY</td> <td>404</td> <td>int</td> <td>分区丢失策略。READ_ONLY_SAFE：0，READ_ONLY_ALL：1，READ_WRITE_SAFE：2，READ_WRITE_ALL：3，IGNORE：4</td></tr> <tr><td>PROP_EAGER_TTL</td> <td>405</td> <td>bool</td> <td>Eager TTL标志</td></tr> <tr><td>PROP_STATISTICS_ENABLED</td> <td>406</td> <td>bool</td> <td>统计信息收集标志</td></tr> <tr><td>PROP_INVALIDATE</td> <td>-1</td> <td>bool</td> <td>这是个只读属性，无法赋值，但是通过<code>settings()</code>可以得到</td></tr></tbody></table> <p><strong>示例</strong></p> <div class="language-python extra-class"><pre class="language-python"><code>cache_config <span class="token operator">=</span> <span class="token punctuation">{</span>
  PROP_NAME<span class="token punctuation">:</span> <span class="token string">'my_cache'</span><span class="token punctuation">,</span>
  PROP_CACHE_KEY_CONFIGURATION<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">'type_name'</span><span class="token punctuation">:</span> <span class="token string">'my_type'</span><span class="token punctuation">,</span>
      <span class="token string">'affinity_key_field_name'</span><span class="token punctuation">:</span> <span class="token string">'my_field'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
my_cache <span class="token operator">=</span> client<span class="token punctuation">.</span>create_cache<span class="token punctuation">(</span>cache_config<span class="token punctuation">)</span>
</code></pre></div><p><strong>查询实体</strong></p> <ul><li><code>table_name</code>: SQL表名；</li> <li><code>key_field_name</code>: 键字段名；</li> <li><code>key_type_name</code>: 键类型名（Java类型或者复杂对象）；</li> <li><code>value_field_name</code>: 值字段名；</li> <li><code>value_type_name</code>: 值类型名；</li> <li><code>field_name_aliases</code>: 字段名别名列表；</li> <li><code>query_fields</code>: 查询字段名列表；</li> <li><code>query_indexes</code>: 查询索引列表。</li></ul> <p><strong>字段名别名</strong></p> <ul><li><code>field_name</code>: 字段名；</li> <li><code>alias</code>: 别名（字符串）。</li></ul> <p><strong>查询字段</strong></p> <ul><li><code>name</code>：字段名；</li> <li><code>type_name</code>：Java类型或者复杂对象名；</li> <li><code>is_key_field</code>：（可选）布尔值，默认为false；</li> <li><code>is_notnull_constraint_field</code>：布尔值；</li> <li><code>default_value</code>：（可选）任何可以转换为前述<code>type_name</code>类型的数据，默认为空（Null）；</li> <li><code>precision</code>：（可选）小数精度：小数的位数总数。默认值为-1（使用集群默认值），对于非数值SQL类型（除了<code>java.math.BigDecimal</code>）会忽略；</li> <li><code>scale</code>：（可选）小数精度：小数点后的数值位数。默认值为-1（使用集群默认值），对于非数值SQL类型（除了<code>java.math.BigDecimal</code>）会忽略；</li></ul> <p><strong>查询索引</strong></p> <ul><li><code>index_name</code>：索引名；</li> <li><code>index_type</code>：索引类型代码，为无符号字节范围内的整数值；</li> <li><code>inline_size</code>：整型值；</li> <li><code>fields</code>：索引字段的列表。</li></ul> <p><strong>字段</strong></p> <ul><li><code>name</code>: 字段名；</li> <li><code>is_descending</code>：（可选）布尔值，默认为false；</li></ul> <p><strong>缓存键</strong></p> <ul><li><code>type_name</code>：复杂对象名；</li> <li><code>affinity_key_field_name</code>：关联键字段名；</li></ul> <h4 id="_5-2-4-数据类型"><a href="#_5-2-4-数据类型" class="header-anchor">#</a> 5.2.4.数据类型</h4> <p>Ignite使用一个复杂的可序列化数据类型系统来存储和检索用户数据，并通过Ignite的二进制协议管理其缓存的配置。</p> <p>大多数Ignite数据类型都可以用标准的Python数据类型或类来表示。但是，其中一些在概念上与Python动态类型系统不一样、过于复杂或模棱两可。</p> <p>下表总结了Ignite数据类型的概念，以及它们在Python中的表示和处理。注意，解析器/构造函数类是不可实例化的。因此没有必要使用这些解析器/构造函数类。Python风格类型将足以与Ignite二进制API交互。不过在一些类型不明确的罕见场景中，以及为了实现互操作性，可能需要将一个或另一个类以及数据作为类型转换提示侵入到一些API函数中。</p> <p><strong>基础数据类型</strong></p> <table><thead><tr><th>Ignite二进制数据类型</th> <th>Python类型或类</th> <th>解析器/构造函数类</th></tr></thead> <tbody><tr><td>Byte</td> <td>int</td> <td>ByteObject</td></tr> <tr><td>Short</td> <td>int</td> <td>ShortObject</td></tr> <tr><td>Int</td> <td>int</td> <td>IntObject</td></tr> <tr><td>Long</td> <td>int</td> <td>LongObject</td></tr> <tr><td>Float</td> <td>float</td> <td>FloatObject</td></tr> <tr><td>Double</td> <td>float</td> <td>DoubleObject</td></tr> <tr><td>Char</td> <td>str</td> <td>CharObject</td></tr> <tr><td>Bool</td> <td>bool</td> <td>BoolObject</td></tr> <tr><td>Null</td> <td>NoneType</td> <td>Null</td></tr></tbody></table> <p><strong>标准对象</strong></p> <table><thead><tr><th>Ignite二进制数据类型</th> <th>Python类型或类</th> <th>解析器/构造函数类</th></tr></thead> <tbody><tr><td>String</td> <td>str</td> <td>String</td></tr> <tr><td>UUID</td> <td>uuid.UUID</td> <td>UUIDObject</td></tr> <tr><td>Timestamp</td> <td>tuple</td> <td>TimestampObject</td></tr> <tr><td>Date</td> <td>datetime.datetime</td> <td>DateObject</td></tr> <tr><td>Time</td> <td>datetime.timedelta</td> <td>TimeObject</td></tr> <tr><td>Decimal</td> <td>decimal.Decimal</td> <td>DecimalObject</td></tr> <tr><td>Enum</td> <td>tuple</td> <td>EnumObject</td></tr> <tr><td>Binaryenum</td> <td>tuple</td> <td>BinaryEnumObject</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">时间戳精度</p> <p>Python为时间戳使用微秒精度，但Ignite使用纳秒精度，这导致预期结果之间的不匹配。当将时间戳发送给Ignite时，要确保返回日期时间和代表纳秒的三位整数增量值（4字节整数，范围是0-999），示例：<code>cache_put(client, cache, 'my_key', (datetime(year=1998, month=4, day=6, hour=18, minute=30), 500), value_hint=TimestampObject)</code></p></div> <p><strong>基本类型数组</strong></p> <table><thead><tr><th>Ignite二进制数据类型</th> <th>Python类型或类</th> <th>解析器/构造函数类</th></tr></thead> <tbody><tr><td>Byte数组</td> <td>iterable/list</td> <td>ByteArrayObject</td></tr> <tr><td>Short数组</td> <td>iterable/list</td> <td>ShortArrayObject</td></tr> <tr><td>Int数组</td> <td>iterable/list</td> <td>IntArrayObject</td></tr> <tr><td>Long数组</td> <td>iterable/list</td> <td>LongArrayObject</td></tr> <tr><td>Float数组</td> <td>iterable/list</td> <td>FloatArrayObject</td></tr> <tr><td>Double数组</td> <td>iterable/list</td> <td>DoubleArrayObject</td></tr> <tr><td>Char数组</td> <td>iterable/list</td> <td>CharArrayObject</td></tr> <tr><td>Bool数组</td> <td>iterable/list</td> <td>BoolArrayObject</td></tr></tbody></table> <p><strong>标准对象数组</strong></p> <table><thead><tr><th>Ignite二进制数据类型</th> <th>Python类型或类</th> <th>解析器/构造函数类</th></tr></thead> <tbody><tr><td>String数组</td> <td>iterable/list</td> <td>StringArrayObject</td></tr> <tr><td>UUID数组</td> <td>iterable/list</td> <td>UUIDArrayObject</td></tr> <tr><td>Timestamp数组</td> <td>iterable/list</td> <td>TimestampArrayObject</td></tr> <tr><td>Date数组</td> <td>iterable/list</td> <td>DateArrayObject</td></tr> <tr><td>Time数组</td> <td>iterable/list</td> <td>TimeArrayObject</td></tr> <tr><td>Decimal数组</td> <td>iterable/list</td> <td>DecimalArrayObject</td></tr></tbody></table> <p><strong>集合对象、特定类型以及复杂对象</strong></p> <table><thead><tr><th>Ignite二进制数据类型</th> <th>Python类型或类</th> <th>解析器/构造函数类</th></tr></thead> <tbody><tr><td>Object数组</td> <td>iterable/list</td> <td>ObjectArrayObject</td></tr> <tr><td>Collection</td> <td>tuple</td> <td>CollectionObject</td></tr> <tr><td>Map</td> <td>dict, collections.OrderedDict</td> <td>MapObject</td></tr> <tr><td>Enum数组</td> <td>iterable/list</td> <td>EnumArrayObject</td></tr> <tr><td>复杂对象</td> <td>object</td> <td>BinaryObject</td></tr> <tr><td>包装数据</td> <td>tuple</td> <td>WrappedDataObject</td></tr></tbody></table> <h4 id="_5-2-5-故障转移"><a href="#_5-2-5-故障转移" class="header-anchor">#</a> 5.2.5.故障转移</h4> <p>当与服务器的连接断开或超时时，<code>Client</code>对象传播原始异常（<code>OSError</code>或<code>SocketError</code>），但保持其构造函数的参数不变，并尝试透明地重新连接。</p> <p>当<code>Client</code>无法重新连接时，会抛出一个特殊的<code>ReconnectError</code>异常。</p> <p>下面的示例提供了一个简单的节点列表遍历故障转移机制。将本地主机上的3个Ignite节点组成一个集群并运行：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client
<span class="token keyword">from</span> pyignite<span class="token punctuation">.</span>datatypes<span class="token punctuation">.</span>cache_config <span class="token keyword">import</span> CacheMode
<span class="token keyword">from</span> pyignite<span class="token punctuation">.</span>datatypes<span class="token punctuation">.</span>prop_codes <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pyignite<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> SocketError


nodes <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10801</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10802</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

client <span class="token operator">=</span> Client<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">4.0</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>nodes<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Connected to {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">)</span>

my_cache <span class="token operator">=</span> client<span class="token punctuation">.</span>get_or_create_cache<span class="token punctuation">(</span><span class="token punctuation">{</span>
    PROP_NAME<span class="token punctuation">:</span> <span class="token string">'my_cache'</span><span class="token punctuation">,</span>
    PROP_CACHE_MODE<span class="token punctuation">:</span> CacheMode<span class="token punctuation">.</span>REPLICATED<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'test_key'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># abstract main loop</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># do the work</span>
        test_value <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'test_key'</span><span class="token punctuation">)</span>
        my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'test_key'</span><span class="token punctuation">,</span> test_value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> <span class="token punctuation">(</span>OSError<span class="token punctuation">,</span> SocketError<span class="token punctuation">)</span> <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token comment"># recover from error (repeat last command, check data</span>
        <span class="token comment"># consistency or just continue − depends on the task)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Error: {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Last value: {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>my_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'test_key'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Reconnected to {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>然后尝试停止和重启节点，看看发生了什么：</p> <div class="language- extra-class"><pre class="language-text"><code># Connected to 127.0.0.1:10800
# Error: [Errno 104] Connection reset by peer
# Last value: 6999
# Reconnected to 127.0.0.1:10801
# Error: Socket connection broken.
# Last value: 12302
# Reconnected to 127.0.0.1:10802
# Error: [Errno 111] Client refused
# Traceback (most recent call last):
#     ...
# pyignite.exceptions.ReconnectError: Can not reconnect: out of nodes
</code></pre></div><p>客户端重连不需要显式用户干预，例如调用特定方法或重置参数。不过要注意，重连是延迟发生的：它只在需要时才发生。在本例中，当脚本检查最后保存的值时，会自动重新连接：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Last value: {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>my_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'test_key'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>这意味着，<code>pyignite</code>用户最好不要检查连接状态，而只是尝试假定的数据操作并捕获产生的异常。</p> <p><code>connect()</code>方法接受任何<code>iterable</code>，而不仅仅是<code>list</code>。这意味着可以使用生成器实现任何重连策略（循环、节点优先级、重新连接时暂停或优雅后退）。</p> <p><code>pyignite</code>附带了一个<code>RoundRobin</code>生成器示例。在上面的示例中，尝试将：</p> <div class="language-python extra-class"><pre class="language-python"><code>client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>nodes<span class="token punctuation">)</span>
</code></pre></div><p>替换为：</p> <div class="language-python extra-class"><pre class="language-python"><code>client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>RoundRobin<span class="token punctuation">(</span>nodes<span class="token punctuation">,</span> max_reconnects<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>这时在节点3故障后，客户端会尝试重连到节点1，然后是节点2，要让<code>RoundRobin</code>策略正常工作，要求至少有一个节点在线。</p> <h3 id="_5-3-键-值"><a href="#_5-3-键-值" class="header-anchor">#</a> 5.3.键-值</h3> <h4 id="_5-3-1-键-值操作"><a href="#_5-3-1-键-值操作" class="header-anchor">#</a> 5.3.1.键-值操作</h4> <p><code>pyignite.cache.Cache</code>类为缓存的键值数据提供了键值操作的方法，<code>put</code>、<code>get</code>、<code>putAll</code>、<code>getAll</code>、<code>replace</code>等，下面是一个示例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client

client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>

<span class="token comment">#Create cache</span>
my_cache <span class="token operator">=</span> client<span class="token punctuation">.</span>create_cache<span class="token punctuation">(</span><span class="token string">'my cache'</span><span class="token punctuation">)</span>

<span class="token comment">#Put value in cache</span>
my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'my key'</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span>

<span class="token comment">#Get value from cache</span>
result <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'my key'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment"># 42</span>

result <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'non-existent key'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment"># None</span>

<span class="token comment">#Get multiple values from cache</span>
result <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>get_all<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string">'my key'</span><span class="token punctuation">,</span>
    <span class="token string">'non-existent key'</span><span class="token punctuation">,</span>
    <span class="token string">'other-key'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment"># {'my key': 42}</span>
</code></pre></div><p><strong>使用类型提示</strong></p> <p>当pyignite方法或函数处理单个值或键时，它有一个额外的参数，比如<code>value_hint</code>或<code>key_hint</code>，它接受解析器/构造函数类。几乎任何结构元素（在dict或list中）都可以替换为两个元组（上述元素，类型提示）。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client
<span class="token keyword">from</span> pyignite<span class="token punctuation">.</span>datatypes <span class="token keyword">import</span> CharObject<span class="token punctuation">,</span> ShortObject

client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>

my_cache <span class="token operator">=</span> client<span class="token punctuation">.</span>get_or_create_cache<span class="token punctuation">(</span><span class="token string">'my cache'</span><span class="token punctuation">)</span>

my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'my key'</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span>
<span class="token comment"># value ‘42’ takes 9 bytes of memory as a LongObject</span>

my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'my key'</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> value_hint<span class="token operator">=</span>ShortObject<span class="token punctuation">)</span>
<span class="token comment"># value ‘42’ takes only 3 bytes as a ShortObject</span>

my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># ‘a’ is a key of type String</span>

my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> key_hint<span class="token operator">=</span>CharObject<span class="token punctuation">)</span>
<span class="token comment"># another key ‘a’ of type CharObject was created</span>

value <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment"># 1</span>

value <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> key_hint<span class="token operator">=</span>CharObject<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment"># 2</span>

<span class="token comment"># now let us delete both keys at once</span>
my_cache<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string">'a'</span><span class="token punctuation">,</span>                <span class="token comment"># a default type key</span>
    <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> CharObject<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># a key of type CharObject</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>参见<a href="#_5-2-4-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">数据类型</a>章节，可以了解可用作类型提示的所有解析器/构造函数类列表。</p> <h4 id="_5-3-2-扫描查询"><a href="#_5-3-2-扫描查询" class="header-anchor">#</a> 5.3.2.扫描查询</h4> <p>缓存的<code>scan()</code>查询方法可以逐元素获取缓存的全部内容。</p> <p>下面往缓存中注入部分数据：</p> <div class="language-python extra-class"><pre class="language-python"><code>my_cache<span class="token punctuation">.</span>put_all<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'key_{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span> v <span class="token keyword">for</span> v <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># {</span>
<span class="token comment">#     'key_0': 0,</span>
<span class="token comment">#     'key_1': 1,</span>
<span class="token comment">#     'key_2': 2,</span>
<span class="token comment">#     ... 20 elements in total...</span>
<span class="token comment">#     'key_18': 18,</span>
<span class="token comment">#     'key_19': 19</span>
<span class="token comment"># }</span>

result <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><code>scan()</code>方法返回一个生成键和值的两个元组的生成器。可以安全地迭代生成的对：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> result<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token comment"># 'key_17' 17</span>
<span class="token comment"># 'key_10' 10</span>
<span class="token comment"># 'key_6' 6,</span>
<span class="token comment"># ... 20 elements in total...</span>
<span class="token comment"># 'key_16' 16</span>
<span class="token comment"># 'key_12' 12</span>
</code></pre></div><p>或者，也可以一次将生成器转换为字典：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># {</span>
<span class="token comment">#     'key_17': 17,</span>
<span class="token comment">#     'key_10': 10,</span>
<span class="token comment">#     'key_6': 6,</span>
<span class="token comment">#     ... 20 elements in total...</span>
<span class="token comment">#     'key_16': 16,</span>
<span class="token comment">#     'key_12': 12</span>
<span class="token comment"># }</span>
</code></pre></div><p>注意：如果缓存包含大量数据，字典可能会消耗太多内存。</p> <h4 id="_5-3-3-清理"><a href="#_5-3-3-清理" class="header-anchor">#</a> 5.3.3.清理</h4> <p>销毁创建的缓存并且断开连接：</p> <div class="language-python extra-class"><pre class="language-python"><code>my_cache<span class="token punctuation">.</span>destroy<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-4-sql"><a href="#_5-4-sql" class="header-anchor">#</a> 5.4.SQL</h3> <p>Python瘦客户端完整支持Ignite的SQL查询，具体的示例可以看<a href="/doc/2.8.0/sql/#_2-入门">这里</a>。</p> <h4 id="_5-4-1-准备"><a href="#_5-4-1-准备" class="header-anchor">#</a> 5.4.1.准备</h4> <p>首先建立一个连接：</p> <div class="language-python extra-class"><pre class="language-python"><code>client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>
</code></pre></div><p>然后创建表，先是<code>Country</code>表，然后是<code>City</code>和<code>CountryLanguage</code>表：</p> <div class="language-python extra-class"><pre class="language-python"><code>COUNTRY_CREATE_TABLE_QUERY <span class="token operator">=</span> <span class="token triple-quoted-string string">'''CREATE TABLE Country (
    Code CHAR(3) PRIMARY KEY,
    Name CHAR(52),
    Continent CHAR(50),
    Region CHAR(26),
    SurfaceArea DECIMAL(10,2),
    IndepYear SMALLINT(6),
    Population INT(11),
    LifeExpectancy DECIMAL(3,1),
    GNP DECIMAL(10,2),
    GNPOld DECIMAL(10,2),
    LocalName CHAR(45),
    GovernmentForm CHAR(45),
    HeadOfState CHAR(60),
    Capital INT(11),
    Code2 CHAR(2)
)'''</span>

CITY_CREATE_TABLE_QUERY <span class="token operator">=</span> <span class="token triple-quoted-string string">'''CREATE TABLE City (
    ID INT(11),
    Name CHAR(35),
    CountryCode CHAR(3),
    District CHAR(20),
    Population INT(11),
    PRIMARY KEY (ID, CountryCode)
) WITH &quot;affinityKey=CountryCode&quot;'''</span>

LANGUAGE_CREATE_TABLE_QUERY <span class="token operator">=</span> <span class="token triple-quoted-string string">'''CREATE TABLE CountryLanguage (
    CountryCode CHAR(3),
    Language CHAR(30),
    IsOfficial BOOLEAN,
    Percentage DECIMAL(4,1),
    PRIMARY KEY (CountryCode, Language)
) WITH &quot;affinityKey=CountryCode&quot;'''</span>

<span class="token keyword">for</span> query <span class="token keyword">in</span> <span class="token punctuation">[</span>
    COUNTRY_CREATE_TABLE_QUERY<span class="token punctuation">,</span>
    CITY_CREATE_TABLE_QUERY<span class="token punctuation">,</span>
    LANGUAGE_CREATE_TABLE_QUERY<span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">:</span>
    client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>query<span class="token punctuation">)</span>
</code></pre></div><p>创建索引：</p> <div class="language-python extra-class"><pre class="language-python"><code>CITY_CREATE_INDEX <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
CREATE INDEX idx_country_code ON city (CountryCode)'''</span>

LANGUAGE_CREATE_INDEX <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
CREATE INDEX idx_lang_country_code ON CountryLanguage (CountryCode)'''</span>

<span class="token keyword">for</span> query <span class="token keyword">in</span> <span class="token punctuation">[</span>CITY_CREATE_INDEX<span class="token punctuation">,</span> LANGUAGE_CREATE_INDEX<span class="token punctuation">]</span><span class="token punctuation">:</span>
    client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>query<span class="token punctuation">)</span>
</code></pre></div><p>注入数据：</p> <div class="language-python extra-class"><pre class="language-python"><code>COUNTRY_INSERT_QUERY <span class="token operator">=</span> <span class="token triple-quoted-string string">'''INSERT INTO Country(
    Code, Name, Continent, Region,
    SurfaceArea, IndepYear, Population,
    LifeExpectancy, GNP, GNPOld,
    LocalName, GovernmentForm, HeadOfState,
    Capital, Code2
) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'''</span>

CITY_INSERT_QUERY <span class="token operator">=</span> <span class="token triple-quoted-string string">'''INSERT INTO City(
    ID, Name, CountryCode, District, Population
) VALUES (?, ?, ?, ?, ?)'''</span>

LANGUAGE_INSERT_QUERY <span class="token operator">=</span> <span class="token triple-quoted-string string">'''INSERT INTO CountryLanguage(
    CountryCode, Language, IsOfficial, Percentage
) VALUES (?, ?, ?, ?)'''</span>

<span class="token keyword">for</span> row <span class="token keyword">in</span> COUNTRY_DATA<span class="token punctuation">:</span>
    client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>COUNTRY_INSERT_QUERY<span class="token punctuation">,</span> query_args<span class="token operator">=</span>row<span class="token punctuation">)</span>

<span class="token keyword">for</span> row <span class="token keyword">in</span> CITY_DATA<span class="token punctuation">:</span>
    client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>CITY_INSERT_QUERY<span class="token punctuation">,</span> query_args<span class="token operator">=</span>row<span class="token punctuation">)</span>

<span class="token keyword">for</span> row <span class="token keyword">in</span> LANGUAGE_DATA<span class="token punctuation">:</span>
    client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>LANGUAGE_INSERT_QUERY<span class="token punctuation">,</span> query_args<span class="token operator">=</span>row<span class="token punctuation">)</span>
</code></pre></div><p>具体的数据示例，在<a href="https://github.com/apache/ignite/blob/master/examples/sql/world.sql" target="_self" rel="noopener noreferrer">GitHub</a>上可以获得。</p> <p>到这里准备工作就完成了。</p> <h4 id="_5-4-2-sql查询"><a href="#_5-4-2-sql查询" class="header-anchor">#</a> 5.4.2.SQL查询</h4> <p>显示指定城市的所有信息：</p> <div class="language-python extra-class"><pre class="language-python"><code>CITY_INFO_QUERY <span class="token operator">=</span> <span class="token triple-quoted-string string">'''SELECT * FROM City WHERE id = ?'''</span>

result <span class="token operator">=</span> client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>
    CITY_INFO_QUERY<span class="token punctuation">,</span>
    query_args<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">3802</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    include_field_names<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
field_names <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
field_data <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token operator">*</span>result<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'City info:'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> field_name<span class="token punctuation">,</span> field_value <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>field_names<span class="token operator">*</span><span class="token builtin">len</span><span class="token punctuation">(</span>field_data<span class="token punctuation">)</span><span class="token punctuation">,</span> field_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{}: {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>field_name<span class="token punctuation">,</span> field_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># City info:</span>
<span class="token comment"># ID: 3802</span>
<span class="token comment"># NAME: Detroit</span>
<span class="token comment"># COUNTRYCODE: USA</span>
<span class="token comment"># DISTRICT: Michigan</span>
<span class="token comment"># POPULATION: 951270</span>
</code></pre></div><h4 id="_5-4-3-sql字段查询"><a href="#_5-4-3-sql字段查询" class="header-anchor">#</a> 5.4.3.SQL字段查询</h4> <p>在样本数据中，最大的10个城市是什么？</p> <div class="language-python extra-class"><pre class="language-python"><code>MOST_POPULATED_QUERY <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
SELECT name, population FROM City ORDER BY population DESC LIMIT 10'''</span>

result <span class="token operator">=</span> client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>MOST_POPULATED_QUERY<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Most 10 populated cities:'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> result<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>

<span class="token comment"># Most 10 populated cities:</span>
<span class="token comment"># ['Mumbai (Bombay)', 10500000]</span>
<span class="token comment"># ['Shanghai', 9696300]</span>
<span class="token comment"># ['New York', 8008278]</span>
<span class="token comment"># ['Peking', 7472000]</span>
<span class="token comment"># ['Delhi', 7206704]</span>
<span class="token comment"># ['Chongqing', 6351600]</span>
<span class="token comment"># ['Tianjin', 5286800]</span>
<span class="token comment"># ['Calcutta [Kolkata]', 4399819]</span>
<span class="token comment"># ['Wuhan', 4344600]</span>
<span class="token comment"># ['Harbin', 4289800]</span>
</code></pre></div><p><code>sql()</code>函数会返回一个生成器函数，然后对结果集进行迭代。</p> <h4 id="_5-4-4-sql关联查询"><a href="#_5-4-4-sql关联查询" class="header-anchor">#</a> 5.4.4.SQL关联查询</h4> <p>在3个指定的国家中，人口最多的10个城市是什么？</p> <p>注意，如果配置了<code>include_field_names</code>参数为<code>true</code>，<code>sql()</code>方法会在第一次迭代时返回一个字段名的列表，然后可以使用Python内置的<code>next</code>函数访问它们。</p> <div class="language-python extra-class"><pre class="language-python"><code>MOST_POPULATED_IN_3_COUNTRIES_QUERY <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
SELECT country.name as country_name, city.name as city_name, MAX(city.population) AS max_pop FROM country
    JOIN city ON city.countrycode = country.code
    WHERE country.code IN ('USA','IND','CHN')
    GROUP BY country.name, city.name ORDER BY max_pop DESC LIMIT 10
'''</span>

result <span class="token operator">=</span> client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>
    MOST_POPULATED_IN_3_COUNTRIES_QUERY<span class="token punctuation">,</span>
    include_field_names<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Most 10 populated cities in USA, India and China:'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'----------------------------------------'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> result<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
<span class="token comment"># Most 10 populated cities in USA, India and China:</span>
<span class="token comment"># ['COUNTRY_NAME', 'CITY_NAME', 'MAX_POP']</span>
<span class="token comment"># ----------------------------------------</span>
<span class="token comment"># ['India', 'Mumbai (Bombay)', 10500000]</span>
<span class="token comment"># ['China', 'Shanghai', 9696300]</span>
<span class="token comment"># ['United States', 'New York', 8008278]</span>
<span class="token comment"># ['China', 'Peking', 7472000]</span>
<span class="token comment"># ['India', 'Delhi', 7206704]</span>
<span class="token comment"># ['China', 'Chongqing', 6351600]</span>
<span class="token comment"># ['China', 'Tianjin', 5286800]</span>
<span class="token comment"># ['India', 'Calcutta [Kolkata]', 4399819]</span>
<span class="token comment"># ['China', 'Wuhan', 4344600]</span>
<span class="token comment"># ['China', 'Harbin', 4289800]</span>
</code></pre></div><p>最后，使用下面的样例代码删除表：</p> <div class="language-python extra-class"><pre class="language-python"><code>DROP_TABLE_QUERY <span class="token operator">=</span> <span class="token triple-quoted-string string">'''DROP TABLE {} IF EXISTS'''</span>

<span class="token keyword">for</span> table_name <span class="token keyword">in</span> <span class="token punctuation">[</span>
    CITY_TABLE_NAME<span class="token punctuation">,</span>
    LANGUAGE_TABLE_NAME<span class="token punctuation">,</span>
    COUNTRY_TABLE_NAME<span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>DROP_TABLE_QUERY<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-5-二进制类型"><a href="#_5-5-二进制类型" class="header-anchor">#</a> 5.5.二进制类型</h3> <p>复杂对象（通常称为<code>二进制对象</code>）是一个Ignite的数据类型，设计为表示Java类。它具有以下特点：</p> <ul><li>一个唯一ID（类型ID），由类名（类型名）派生；</li> <li>描述其内部结构（字段的顺序、名称和类型）的一个或多个关联模式，每个模式都有自己的ID；</li> <li>一个可选的版本号，旨在帮助用户区分同一类型、使用不同模式序列化的对象。</li></ul> <p>不过复杂对象的这些区别性特征在Java语言之外几乎没有意义。Python类不能通过其名称（它不是唯一的）、ID（Python中的对象ID是易失性的；在CPython中，它只是解释器内存堆中的一个指针）或其复杂字段（它们没有关联的数据类型，而且可以在运行时添加或删除）来定义。对于<code>pyignite</code>用户来说，这意味着为了存储本地Python数据，最好使用Ignite的<code>CollectionObject</code>或<code>MapObject</code>数据类型。</p> <p>但是，为了实现互操作性，<code>pyignite</code>有一种机制，可以创建特殊的Python类来读取或写入复杂的对象。这些类有一个接口，它模拟复杂对象的所有特性：类型名、类型ID、模式、模式ID和版本号。</p> <p>假设表示一个复杂对象的一个具体类会严重限制用户的数据操作能力，那么上面提到的所有功能都是通过元类型<code>GenericObjectMeta</code>实现的，读取复杂对象时会自动使用。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client<span class="token punctuation">,</span> GenericObjectMeta
<span class="token keyword">from</span> pyignite<span class="token punctuation">.</span>datatypes <span class="token keyword">import</span> <span class="token operator">*</span>

client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>

person_cache <span class="token operator">=</span> client<span class="token punctuation">.</span>get_or_create_cache<span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">)</span>

person <span class="token operator">=</span> person_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
<span class="token comment"># Person</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
<span class="token comment"># Person(first_name='Ivan', last_name='Ivanov', age=33, version=1)</span>
</code></pre></div><p>这里可以看到<code>GenericObjectMeta</code>在内部如何使用<code>attrs</code>包来创建<code>__init__()</code>和<code>__repr__()</code>方法。</p> <p>这些自动生成的类，在之后的写操作中可以复用。</p> <div class="language-python extra-class"><pre class="language-python"><code>Person <span class="token operator">=</span> person<span class="token punctuation">.</span>__class__

person_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span>
    <span class="token number">1</span><span class="token punctuation">,</span> Person<span class="token punctuation">(</span>first_name<span class="token operator">=</span><span class="token string">'Ivan'</span><span class="token punctuation">,</span> last_name<span class="token operator">=</span><span class="token string">'Ivanov'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

</code></pre></div><p><code>GenericObjectMeta</code>也可以用于直接创建自定义的类：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>metaclass<span class="token operator">=</span>GenericObjectMeta<span class="token punctuation">,</span> schema<span class="token operator">=</span>OrderedDict<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">'first_name'</span><span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'last_name'</span><span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> IntObject<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre></div><p>注意<code>Person</code>类是如何定义的。<code>schema</code>是<code>GenericObjectMeta</code>元类参数。另一个重要的<code>GenericObjectMeta</code>参数是一个类型名，但它是可选的，并且默认为类名（在示例中是<code>person</code>）。</p> <p>还要注意，这个<code>Person</code>不需要定义自己的属性、方法，尽管这是完全可能的。</p> <p>当自定义的<code>Person</code>类创建完成后，就可以使用其对象发送数据到Ignite服务端了。在发送第一个复杂对象是，客户端将隐式地将其注册。如果打算先使用自定义类读取现有复杂对象的值，则必须在客户端显式注册该类：</p> <div class="language-python extra-class"><pre class="language-python"><code>client<span class="token punctuation">.</span>register_binary_type<span class="token punctuation">(</span>Person<span class="token punctuation">)</span>
</code></pre></div><p>如果已经了解了复杂对象的<code>pyignite</code>实现的基本概念，下一步就会讨论更详细的示例。</p> <h4 id="_5-5-1-读"><a href="#_5-5-1-读" class="header-anchor">#</a> 5.5.1.读</h4> <p>Ignite SQL在内部使用复杂对象来表示SQL表中的键和行。通常来说SQL数据是通过查询访问的，因此只需考虑下面的示例就可以了解二进制对象（而不是Ignite SQL）是如何工作的。</p> <p>在前面的示例中创建了一些SQL表。这里再做一次，然后检查Ignite存储：</p> <div class="language-python extra-class"><pre class="language-python"><code>result <span class="token operator">=</span> client<span class="token punctuation">.</span>get_cache_names<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token comment"># [</span>
<span class="token comment">#     'SQL_PUBLIC_CITY',</span>
<span class="token comment">#     'SQL_PUBLIC_COUNTRY',</span>
<span class="token comment">#     'PUBLIC',</span>
<span class="token comment">#     'SQL_PUBLIC_COUNTRYLANGUAGE'</span>
<span class="token comment"># ]</span>
</code></pre></div><p>可以看到Ignite为每个表创建了一个缓存。缓存的命名统一为<code>SQL_&lt;schema name&gt;_&lt;table name&gt;</code>模式。</p> <p>下面会通过<code>settings</code>属性来显示缓存的配置：</p> <div class="language-python extra-class"><pre class="language-python"><code>city_cache <span class="token operator">=</span> client<span class="token punctuation">.</span>get_or_create_cache<span class="token punctuation">(</span><span class="token string">'SQL_PUBLIC_CITY'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>city_cache<span class="token punctuation">.</span>settings<span class="token punctuation">[</span>PROP_NAME<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 'SQL_PUBLIC_CITY'</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>city_cache<span class="token punctuation">.</span>settings<span class="token punctuation">[</span>PROP_QUERY_ENTITIES<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># {</span>
<span class="token comment">#     'key_type_name': (</span>
<span class="token comment">#         'SQL_PUBLIC_CITY_9ac8e17a_2f99_45b7_958e_06da32882e9d_KEY'</span>
<span class="token comment">#     ),</span>
<span class="token comment">#     'value_type_name': (</span>
<span class="token comment">#         'SQL_PUBLIC_CITY_9ac8e17a_2f99_45b7_958e_06da32882e9d'</span>
<span class="token comment">#     ),</span>
<span class="token comment">#     'table_name': 'CITY',</span>
<span class="token comment">#     'query_fields': [</span>
<span class="token comment">#         ...</span>
<span class="token comment">#     ],</span>
<span class="token comment">#     'field_name_aliases': [</span>
<span class="token comment">#         ...</span>
<span class="token comment">#     ],</span>
<span class="token comment">#     'query_indexes': []</span>
<span class="token comment"># }</span>
</code></pre></div><p><code>value_type_name</code>和<code>key_type_name</code>的值是二进制类型的名称。City表的键字段使用<code>key_type_name</code>类型存储，其它字段使用<code>value_type_name</code>类型存储。</p> <p>在有了存储数据的缓存，以及键和值数据类型的名称后，就可以不使用SQL函数来读取数据，并验证结果的正确性。</p> <p>可以看到的是从缓存中提取的键和值的元组，键和值都表示为复杂对象。数据类名称与<code>value_type_name</code>和<code>key_type_name</code>缓存设置相同。对象的字段对应于SQL查询。</p> <div class="language-python extra-class"><pre class="language-python"><code>result <span class="token operator">=</span> city_cache<span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># (</span>
<span class="token comment">#     SQL_PUBLIC_CITY_6fe650e1_700f_4e74_867d_58f52f433c43_KEY(</span>
<span class="token comment">#         ID=1890,</span>
<span class="token comment">#         COUNTRYCODE='CHN',</span>
<span class="token comment">#         version=1</span>
<span class="token comment">#     ),</span>
<span class="token comment">#     SQL_PUBLIC_CITY_6fe650e1_700f_4e74_867d_58f52f433c43(</span>
<span class="token comment">#         NAME='Shanghai',</span>
<span class="token comment">#         DISTRICT='Shanghai',</span>
<span class="token comment">#         POPULATION=9696300,</span>
<span class="token comment">#         version=1</span>
<span class="token comment">#     )</span>
<span class="token comment"># )</span>
</code></pre></div><h4 id="_5-5-2-创建"><a href="#_5-5-2-创建" class="header-anchor">#</a> 5.5.2.创建</h4> <p>现在，在了解了Ignite SQL存储的内部结构后，就可以创建一个表，只使用键-值函数将数据放入其中。</p> <p>例如创建一个表来注册高中生：大致相当于以下SQL DDL语句：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student <span class="token punctuation">(</span>
    sid <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    login <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    age <span class="token keyword">INTEGER</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    gpa <span class="token keyword">REAL</span>
<span class="token punctuation">)</span>
</code></pre></div><p>为了完成这个任务，如下的步骤必不可少：
1.创建缓存：</p> <div class="language-python extra-class"><pre class="language-python"><code>client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>

student_cache <span class="token operator">=</span> client<span class="token punctuation">.</span>create_cache<span class="token punctuation">(</span><span class="token punctuation">{</span>
        PROP_NAME<span class="token punctuation">:</span> <span class="token string">'SQL_PUBLIC_STUDENT'</span><span class="token punctuation">,</span>
        PROP_SQL_SCHEMA<span class="token punctuation">:</span> <span class="token string">'PUBLIC'</span><span class="token punctuation">,</span>
        PROP_QUERY_ENTITIES<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">'table_name'</span><span class="token punctuation">:</span> <span class="token string">'Student'</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'key_field_name'</span><span class="token punctuation">:</span> <span class="token string">'SID'</span><span class="token punctuation">,</span>
                <span class="token string">'key_type_name'</span><span class="token punctuation">:</span> <span class="token string">'java.lang.Integer'</span><span class="token punctuation">,</span>
                <span class="token string">'field_name_aliases'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'query_fields'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'SID'</span><span class="token punctuation">,</span>
                        <span class="token string">'type_name'</span><span class="token punctuation">:</span> <span class="token string">'java.lang.Integer'</span><span class="token punctuation">,</span>
                        <span class="token string">'is_key_field'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                        <span class="token string">'is_notnull_constraint_field'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'NAME'</span><span class="token punctuation">,</span>
                        <span class="token string">'type_name'</span><span class="token punctuation">:</span> <span class="token string">'java.lang.String'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'LOGIN'</span><span class="token punctuation">,</span>
                        <span class="token string">'type_name'</span><span class="token punctuation">:</span> <span class="token string">'java.lang.String'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'AGE'</span><span class="token punctuation">,</span>
                        <span class="token string">'type_name'</span><span class="token punctuation">:</span> <span class="token string">'java.lang.Integer'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'GPA'</span><span class="token punctuation">,</span>
                        <span class="token string">'type_name'</span><span class="token punctuation">:</span> <span class="token string">'java.math.Double'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'query_indexes'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'value_type_name'</span><span class="token punctuation">:</span> <span class="token string">'SQL_PUBLIC_STUDENT_TYPE'</span><span class="token punctuation">,</span>
                <span class="token string">'value_field_name'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>2.定义复杂对象数据类：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>
    metaclass<span class="token operator">=</span>GenericObjectMeta<span class="token punctuation">,</span>
    type_name<span class="token operator">=</span><span class="token string">'SQL_PUBLIC_STUDENT_TYPE'</span><span class="token punctuation">,</span>
    schema<span class="token operator">=</span>OrderedDict<span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token punctuation">(</span><span class="token string">'NAME'</span><span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">'LOGIN'</span><span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">'AGE'</span><span class="token punctuation">,</span> IntObject<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">'GPA'</span><span class="token punctuation">,</span> DoubleObject<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre></div><p>3.插入数据：</p> <div class="language-python extra-class"><pre class="language-python"><code>student_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span>
    <span class="token number">1</span><span class="token punctuation">,</span>
    Student<span class="token punctuation">(</span>LOGIN<span class="token operator">=</span><span class="token string">'jdoe'</span><span class="token punctuation">,</span> NAME<span class="token operator">=</span><span class="token string">'John Doe'</span><span class="token punctuation">,</span> AGE<span class="token operator">=</span><span class="token number">17</span><span class="token punctuation">,</span> GPA<span class="token operator">=</span><span class="token number">4.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    key_hint<span class="token operator">=</span>IntObject
<span class="token punctuation">)</span>
</code></pre></div><p>现在要确认SQL函数已经可以使用这个缓存了：</p> <div class="language-python extra-class"><pre class="language-python"><code>result <span class="token operator">=</span> client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>
    <span class="token string">r'SELECT * FROM Student'</span><span class="token punctuation">,</span>
    include_field_names<span class="token operator">=</span><span class="token boolean">True</span>
<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ['SID', 'NAME', 'LOGIN', 'AGE', 'GPA']</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token operator">*</span>result<span class="token punctuation">)</span>
<span class="token comment"># [1, 'John Doe', 'jdoe', 17, 4.25]</span>
</code></pre></div><p>不过，这个缓存无法使用DDL命令进行删除。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># DROP_QUERY = 'DROP TABLE Student'</span>
<span class="token comment"># client.sql(DROP_QUERY)</span>
<span class="token comment">#</span>
<span class="token comment"># pyignite.exceptions.SQLError: class org.apache.ignite.IgniteCheckedException:</span>
<span class="token comment"># Only cache created with CREATE TABLE may be removed with DROP TABLE</span>
<span class="token comment"># [cacheName=SQL_PUBLIC_STUDENT]</span>
</code></pre></div><p>它可以使用<code>destroy</code>方法进行删除：</p> <div class="language-python extra-class"><pre class="language-python"><code>student_cache<span class="token punctuation">.</span>destroy<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_5-5-3-迁移"><a href="#_5-5-3-迁移" class="header-anchor">#</a> 5.5.3.迁移</h4> <p>假设有一个会计应用程序，它以键-值格式存储数据。目标是对原始费用凭证的格式和数据进行以下更改：</p> <ul><li>将<code>date</code>重命名为<code>expense_date</code>；</li> <li>添加<code>report_date</code>；</li> <li>如果<code>reported</code>为<code>true</code>，则将<code>report_date</code>设置为当前日期，否则设置为空；</li> <li>删除<code>reported</code>。</li></ul> <p>首先获取优惠券的缓存：</p> <div class="language-python extra-class"><pre class="language-python"><code>client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>

accounting <span class="token operator">=</span> client<span class="token punctuation">.</span>get_or_create_cache<span class="token punctuation">(</span><span class="token string">'accounting'</span><span class="token punctuation">)</span>
</code></pre></div><p>如果代码中没有存储复杂对象的模式，可以使用<code>query_binary_type()</code>方法获取并将其作为数据类：</p> <div class="language-python extra-class"><pre class="language-python"><code>data_classes <span class="token operator">=</span> client<span class="token punctuation">.</span>query_binary_type<span class="token punctuation">(</span><span class="token string">'ExpenseVoucher'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data_classes<span class="token punctuation">)</span>
<span class="token comment"># {</span>
<span class="token comment">#     -231598180: &lt;class '__main__.ExpenseVoucher'&gt;</span>
<span class="token comment"># }</span>

s_id<span class="token punctuation">,</span> data_class <span class="token operator">=</span> data_classes<span class="token punctuation">.</span>popitem<span class="token punctuation">(</span><span class="token punctuation">)</span>
schema <span class="token operator">=</span> data_class<span class="token punctuation">.</span>schema
</code></pre></div><p>下面会修改模式，并通过更新后的模式来创建一个新的复杂对象：</p> <div class="language-python extra-class"><pre class="language-python"><code>schema<span class="token punctuation">[</span><span class="token string">'expense_date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> schema<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span>
<span class="token keyword">del</span> schema<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span>
schema<span class="token punctuation">[</span><span class="token string">'report_date'</span><span class="token punctuation">]</span> <span class="token operator">=</span> DateObject
<span class="token keyword">del</span> schema<span class="token punctuation">[</span><span class="token string">'reported'</span><span class="token punctuation">]</span>
schema<span class="token punctuation">[</span><span class="token string">'sum'</span><span class="token punctuation">]</span> <span class="token operator">=</span> DecimalObject


<span class="token comment"># define new data class</span>
<span class="token keyword">class</span> <span class="token class-name">ExpenseVoucherV2</span><span class="token punctuation">(</span>
    metaclass<span class="token operator">=</span>GenericObjectMeta<span class="token punctuation">,</span>
    type_name<span class="token operator">=</span><span class="token string">'ExpenseVoucher'</span><span class="token punctuation">,</span>
    schema<span class="token operator">=</span>schema<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre></div><p>下面将数据从旧模式迁移到新的：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">migrate</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> data<span class="token punctuation">,</span> new_class<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; Migrate given data pages. &quot;&quot;&quot;</span>
    <span class="token keyword">for</span> key<span class="token punctuation">,</span> old_value <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        <span class="token comment"># read data</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>old_value<span class="token punctuation">)</span>
        <span class="token comment"># ExpenseVoucher(</span>
        <span class="token comment">#     date=datetime(2017, 9, 21, 0, 0),</span>
        <span class="token comment">#     reported=True,</span>
        <span class="token comment">#     purpose='Praesent eget fermentum massa',</span>
        <span class="token comment">#     sum=Decimal('666.67'),</span>
        <span class="token comment">#     recipient='John Doe',</span>
        <span class="token comment">#     cashier_id=8,</span>
        <span class="token comment">#     version=1</span>
        <span class="token comment"># )</span>

        <span class="token comment"># create new binary object</span>
        new_value <span class="token operator">=</span> new_class<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># process data</span>
        new_value<span class="token punctuation">.</span><span class="token builtin">sum</span> <span class="token operator">=</span> old_value<span class="token punctuation">.</span><span class="token builtin">sum</span>
        new_value<span class="token punctuation">.</span>purpose <span class="token operator">=</span> old_value<span class="token punctuation">.</span>purpose
        new_value<span class="token punctuation">.</span>recipient <span class="token operator">=</span> old_value<span class="token punctuation">.</span>recipient
        new_value<span class="token punctuation">.</span>cashier_id <span class="token operator">=</span> old_value<span class="token punctuation">.</span>cashier_id
        new_value<span class="token punctuation">.</span>expense_date <span class="token operator">=</span> old_value<span class="token punctuation">.</span>date
        new_value<span class="token punctuation">.</span>report_date <span class="token operator">=</span> date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> old_value<span class="token punctuation">.</span>reported <span class="token keyword">else</span> <span class="token boolean">None</span>

        <span class="token comment"># replace data</span>
        cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span>key<span class="token punctuation">,</span> new_value<span class="token punctuation">)</span>

        <span class="token comment"># verify data</span>
        verify <span class="token operator">=</span> cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>verify<span class="token punctuation">)</span>
        <span class="token comment"># ExpenseVoucherV2(</span>
        <span class="token comment">#     purpose='Praesent eget fermentum massa',</span>
        <span class="token comment">#     sum=Decimal('666.67'),</span>
        <span class="token comment">#     recipient='John Doe',</span>
        <span class="token comment">#     cashier_id=8,</span>
        <span class="token comment">#     expense_date=datetime(2017, 9, 21, 0, 0),</span>
        <span class="token comment">#     report_date=datetime(2018, 8, 29, 0, 0),</span>
        <span class="token comment">#     version=1,</span>
        <span class="token comment"># )</span>


<span class="token comment"># migrate data</span>
result <span class="token operator">=</span> accounting<span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token punctuation">)</span>
migrate<span class="token punctuation">(</span>accounting<span class="token punctuation">,</span> result<span class="token punctuation">,</span> ExpenseVoucherV2<span class="token punctuation">)</span>

<span class="token comment"># cleanup</span>
accounting<span class="token punctuation">.</span>destroy<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>此时，在两个模式中定义的所有字段都可以在生成的二进制对象中使用，这取决于使用<code>put()</code>或类似方法写入时使用的模式。Ignite二进制API没有删除复杂对象模式的方法，所有定义过的模式都将保留在集群中，直到关闭。</p> <p>这个版本控制机制非常简单和健壮，但是它有其局限性。主要是：不能更改现有字段的类型。如果做了，将会收到以下消息：<code>org.apache.ignite.binary.BinaryObjectException: Wrong value has been set [typeName=SomeType, fieldName=f1, fieldType=String, assignedValueType=int]</code></p> <p>或者，可以重命名字段或创建新的复杂对象。</p> <h3 id="_5-6-安全"><a href="#_5-6-安全" class="header-anchor">#</a> 5.6.安全</h3> <h4 id="_5-6-1-ssl-tls"><a href="#_5-6-1-ssl-tls" class="header-anchor">#</a> 5.6.1.SSL/TLS</h4> <p>测试SSL连接有一些特殊的要求。</p> <p>Ignite服务端必须配置为保护二进制协议端口，服务端配置过程可以分为以下若干个基本步骤：</p> <ol><li>使用Java的<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html" target="_self" rel="noopener noreferrer">keytool</a>创建密钥存储和信任存储。创建信任存储时，可能需要客户端X.509证书。还需要导出服务端X.509证书以包含在客户端信任链中；</li> <li>根据本章节：<a href="/doc/2.8.0/java/Security.html#_1-1-保护节点间的连接">保护节点之间的连接</a>，打开Ignite集群的<code>SSLContextFactory</code>；</li> <li>通知Ignite使用<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/configuration/ClientConnectorConfiguration.html" target="_self" rel="noopener noreferrer">ClientConnectorConfiguration</a>的配置在其瘦客户端端口上加密数据。如果只想加密连接，而不验证客户端的证书，需要将<code>sslClientAuth</code>属性设置为<code>false</code>。不过还是需要在步骤1中设置信任库。</li></ol> <p>要在没有证书验证的情况下使用SSL加密，需要使用<code>use_ssl</code>参数：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client

client <span class="token operator">=</span> Client<span class="token punctuation">(</span>use_ssl<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>
</code></pre></div><p>要识别客户端，请使用<a href="https://www.openssl.org/docs/manmaster/man1/openssl.html" target="_self" rel="noopener noreferrer">openssl</a>命令创建一个SSL密钥对和一个证书，并以下面的方式使用它们：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client

client <span class="token operator">=</span> Client<span class="token punctuation">(</span>
    use_ssl<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    ssl_keyfile<span class="token operator">=</span><span class="token string">'etc/.ssl/keyfile.key'</span><span class="token punctuation">,</span>
    ssl_certfile<span class="token operator">=</span><span class="token string">'etc/.ssl/certfile.crt'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'ignite-example.com'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>
</code></pre></div><p>要检查服务端的真实性，请获取服务端证书或证书链，并在<code>ssl_ca_certfile</code>参数中提供其路径：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> ssl

<span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client

client <span class="token operator">=</span> Client<span class="token punctuation">(</span>
    use_ssl<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    ssl_ca_certfile<span class="token operator">=</span><span class="token string">'etc/.ssl/ca_certs'</span><span class="token punctuation">,</span>
    ssl_cert_reqs<span class="token operator">=</span>ssl<span class="token punctuation">.</span>CERT_REQUIRED<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'ignite-example.com'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>
</code></pre></div><p>如果默认值（ssl._DEFAULT_CIPHERS和TLS 1.1）不适合，还可以提供诸如密码集（ssl_ciphers）和SSL版本（ssl_version）等参数。</p> <h4 id="_5-6-2-密码认证"><a href="#_5-6-2-密码认证" class="header-anchor">#</a> 5.6.2.密码认证</h4> <p>要进行身份验证，必须在Ignite的XML配置文件中将<code>authenticationEnabled</code>属性设置为<code>true</code>，并启用持久化，具体请参见<a href="/doc/2.8.0/java/Security.html#_2-1-认证">认证</a>中的相关内容。</p> <p>注意，不鼓励通过开放通道发送凭据，因为它们很容易被拦截。提供凭据会自动从客户端打开SSL。强烈建议保护到Ignite服务端的连接，如<a href="#_5-6-1-ssl-tls">SSL/TLS</a>示例中所述，以便使用密码验证。</p> <p>然后只需向<code>Client</code>构造函数提供用户名和密码参数即可：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client

client <span class="token operator">=</span> Client<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'ignite'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">'ignite'</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'ignite-example.com'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>
</code></pre></div><p>如果希望即使出现警告也不使用安全的连接，需要在创建客户端对象时显式禁用SSL：</p> <div class="language-python extra-class"><pre class="language-python"><code>client <span class="token operator">=</span> Client<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'ignite'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">'ignite'</span><span class="token punctuation">,</span> use_ssl<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre></div><p>注意，Ignite瘦客户端无法通过二进制协议获得集群的身份验证设置。服务端会简单地忽略意外的凭据。在相反的情况下，用户会收到以下消息：<code>pyignite.exceptions.HandshakeError: Handshake error: Unauthenticated sessions are prohibited. Expected protocol version: 0.0.0</code>。</p> <h2 id="_6-php瘦客户端"><a href="#_6-php瘦客户端" class="header-anchor">#</a> 6.PHP瘦客户端</h2> <h3 id="_6-1-php瘦客户端"><a href="#_6-1-php瘦客户端" class="header-anchor">#</a> 6.1.PHP瘦客户端</h3> <h4 id="_6-1-1-概述"><a href="#_6-1-1-概述" class="header-anchor">#</a> 6.1.1.概述</h4> <p>这个瘦客户端使得PHP应用可以通过<a href="#_2-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8D%8F%E8%AE%AE">二进制客户端协议</a>与Ignite集群进行交互。</p> <p>瘦客户端是一个轻量级的Ignite客户端，通过标准的Socket连接接入集群，它不会启动一个JVM进程（不需要Java），不会成为集群拓扑的一部分，也不持有任何数据，也不会参与计算网格的计算。</p> <p>它所做的只是简单地建立一个与标准Ignite节点的Socket连接，并通过该节点执行所有操作。</p> <h4 id="_6-1-2-入门"><a href="#_6-1-2-入门" class="header-anchor">#</a> 6.1.2.入门</h4> <p><strong>要求</strong></p> <ul><li><a href="http://php.net/manual/en/install.php" target="_self" rel="noopener noreferrer">PHP</a>的7.2及其以后的版本和<a href="https://getcomposer.org/download/" target="_self" rel="noopener noreferrer">Composer依赖管理器</a>；</li> <li><a href="http://php.net/manual/en/mbstring.installation.php" target="_self" rel="noopener noreferrer">PHP多字节字符串扩展</a>，根据PHP的配置，可能需要额外地安装/配置这个扩展；</li> <li><a href="https://ignite.apache.org/download.cgi" target="_self" rel="noopener noreferrer">最新版本</a>的Ignite。</li></ul> <p><strong>从源代码进行安装</strong></p> <ol><li>克隆或者下载Ignite的仓库到<code>local_ignite_path</code>；</li> <li>切换到<code>local_ignite_path/modules/platforms/php</code>文件夹；</li> <li>执行<code>composer install --no-dev</code>命令。</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> local_ignite_path/modules/platforms/php
composer <span class="token function">install</span> --no-dev
</code></pre></div><p>如果要在应用中使用这个客户端，源代码中需要包含Composer生成的<code>vendor/autoload.php</code>文件，比如：</p> <div class="language- extra-class"><pre class="language-text"><code>require_once &quot;&lt;local_ignite_path&gt;/vendor/autoload.php&quot;;
</code></pre></div><p><strong>运行一个示例</strong></p> <p>安装完PHP瘦客户端后，为了方便入门，这里使用的是随着每个Ignite版本发布的一个现成的<a href="https://github.com/apache/ignite/tree/master/modules/platforms/php/examples" target="_self" rel="noopener noreferrer">示例</a>。</p> <p>1.运行Ignite的服务端：</p> <p>要使用默认的配置启动一个集群节点，打开终端，假定位于<code>IGNITE_HOME</code>（Ignite安装文件夹），只需要输入：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="linux" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-bash extra-class"><pre class="language-bash"><code>./ignite.sh
</code></pre></div></section> <section aria-hidden="true" id="windows" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">ignite</span>.bat</span>
</code></pre></div></section></div></div> <p>2.在另一个终端窗口，转到<code>IGNITE_HOME/platforms/php/examples</code>，调用<code>php &lt;example_file_name&gt;.php</code>就可以运行一个示例，比如：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> IGNITE_HOME/platforms/php/examples
php CachePutGetExample.php
</code></pre></div><h3 id="_6-2-初始化和配置"><a href="#_6-2-初始化和配置" class="header-anchor">#</a> 6.2.初始化和配置</h3> <p>本章节会描述使用PHP瘦客户端与Ignite集群进行交互的基本步骤。</p> <p>在用PHP瘦客户端接入Ignite之前，需要启动至少一个Ignite服务端节点，比如，可以使用<code>ignite.sh</code>脚本：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="linux" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-bash extra-class"><pre class="language-bash"><code>./ignite.sh
</code></pre></div></section> <section aria-hidden="true" id="windows" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">ignite</span>.bat</span>
</code></pre></div></section></div></div> <h4 id="_6-2-1-实例化ignite客户端"><a href="#_6-2-1-实例化ignite客户端" class="header-anchor">#</a> 6.2.1.实例化Ignite客户端</h4> <p>这个客户端的使用，是以<code>Client</code>对象的创建开始的，它负责将一个PHP应用接入Ignite集群。</p> <p>如果需要，可以创建很多个客户端对象，它们之间互相独立。</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>

<span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-2-2-配置ignite客户端"><a href="#_6-2-2-配置ignite客户端" class="header-anchor">#</a> 6.2.2.配置Ignite客户端</h4> <p>下一步是通过注入<code>ClientConfiguration</code>对象来定义客户端连接的配置。</p> <p>必须要配置（在构造函数中指定）的是Ignite节点的端点列表。必须至少指定一个端点。客户端只会从提供的列表中随机选一个端点连接。其它节点（如果提供）由客户端用于<code>故障转移重连算法</code>：如果当前连接丢失，客户端将尝试重连到列表中的下一个随机端点。</p> <p>可以使用其它方法指定其它的可选配置，包括：</p> <ul><li>使用用户名/密码进行身份验证；</li> <li>SSL/TLS连接；</li> <li>PHP连接选项。默认情况下，客户端使用默认连接选项建立的是非安全连接，不使用身份验证；</li></ul> <p>下面的示例显示如何配置客户端：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>ClientConfiguration</span><span class="token punctuation">;</span>

<span class="token variable">$clientConfiguration</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下一个示例显示如何使用用户名/密码身份验证和其它连接选项来配置Ignite客户端：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>ClientConfiguration</span><span class="token punctuation">;</span>

<span class="token variable">$clientConfiguration</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'ignite'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'ignite'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-2-3-接入集群"><a href="#_6-2-3-接入集群" class="header-anchor">#</a> 6.2.3.接入集群</h4> <p>下一步是将客户端接入Ignite集群。在<code>connect</code>方法中指定了客户端连接的配置，其中包括要连接到的端点。</p> <p>如果客户端无法连接（包括使用<code>故障转移重连算法</code>无法成功重连的情况），则会针对Ignite集群的任何操作抛出<code>NoConnectionException</code>。</p> <p>如果客户端在操作之前或期间意外断开连接，则会抛出<code>OperationStatusUnknownException</code>异常。这时不知道该操作是否已在集群中实际执行。注意，<code>故障转移重连算法</code>将在应用调用下一个操作时才会执行。</p> <p>应用随时都可以通过调用<code>disconnect</code>方法强制断开客户端的连接。</p> <p>当客户端断开连接时，应用可以使用相同或不同的配置（例如使用不同的端点列表）再次调用<code>connect</code>方法。</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>ClientConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>ClientException</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">connectClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token variable">$clientConfiguration</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span>
            <span class="token single-quoted-string string">'127.0.0.1:10800'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'127.0.0.1:10801'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'127.0.0.1:10802'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// connect to Ignite node</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token variable">$clientConfiguration</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ClientException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">connectClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-2-4-缓存的使用和配置"><a href="#_6-2-4-缓存的使用和配置" class="header-anchor">#</a> 6.2.4.缓存的使用和配置</h4> <p>下一步是获取一个表示Ignite缓存的对象。它是一个具有<code>CacheInterface</code>的PHP类的实例。</p> <p>瘦客户端提供了若干方法来处理Ignite缓存和使用<code>CacheInterface</code>获取对象：按名称获取缓存、使用指定名称和可选缓存配置创建缓存、获取或创建缓存、销毁缓存等。</p> <p>对于相同或不同的Ignite缓存，可以根据需要使用<code>CacheInterface</code>获取任意数量的对象，并并行处理它们。</p> <p>下面的示例显示如何通过名称访问缓存并在以后销毁它：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>ClientConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>ClientException</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getOrCreateCacheByName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// get or create cache by name</span>
        <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// perform cache key-value operations</span>
        <span class="token comment">// ...</span>

        <span class="token comment">// destroy cache</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">destroyCache</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ClientException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">getOrCreateCacheByName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下一个示例显示如何通过名称和配置访问缓存：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>ClientConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Cache<span class="token punctuation">\</span>CacheConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>ClientException</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">createCacheByConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// create cache by name and configuration</span>
        <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">createCache</span><span class="token punctuation">(</span>
            <span class="token single-quoted-string string">'myCache'</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setSqlSchema</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUBLIC'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ClientException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">createCacheByConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下面的示例显示如何通过名称获取已有缓存：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>ClientConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Cache<span class="token punctuation">\</span>CacheConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>ClientException</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getExistingCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// create cache by name and configuration</span>
        <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ClientException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">getExistingCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>类型映射配置</strong></p> <p>可以为键和/或值指定具体的Ignite类型。如果键和/或值是非基础类型（如映射、集合、复杂对象等），也可以为该对象的字段指定具体的Ignite类型。</p> <p>如果没有为某些字段显式指定Ignite类型，客户端将尝试在PHP类型和Ignite对象类型之间进行默认的自动映射。</p> <p>有关类型和映射的更多详细信息，请参见数据类型映射部分。</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>ClientConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>ObjectType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>MapObjectType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>ClientException</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">setCacheKeyValueTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
            <span class="token function">setValueType</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MapObjectType</span><span class="token punctuation">(</span>
                MapObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">LINKED_HASH_MAP</span><span class="token punctuation">,</span>
                ObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">SHORT</span><span class="token punctuation">,</span>
                ObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">BYTE_ARRAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ClientException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">setCacheKeyValueTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-2-5-数据类型"><a href="#_6-2-5-数据类型" class="header-anchor">#</a> 6.2.5.数据类型</h4> <p>每当应用通过客户端的API在Ignite中写入或读取字段时，都会在二进制客户端协议定义的Ignite类型和PHP类型之间进行映射。这里的字段是任何存储在Ignite中的数据，包括Ignite条目的全部键或值、数组或集合的元素、复杂对象的字段等。</p> <p>客户端支持两种映射模式：</p> <ul><li>显式映射：使用客户端的API方法，应用可以显式指定特定字段的Ignite类型。在读/写操作期间，客户端使用这些信息将字段从PHP类型转换为Ignite类型，反之亦然；</li> <li>默认映射：它定义如果应用不为字段使用显式类型映射时会发生什么。</li></ul> <p><a href="https://rawgit.com/nobitlost/ignite/ignite-7783-docs/modules/platforms/php/api_docs/html/class_apache_1_1_ignite_1_1_type_1_1_object_type.html" target="_self" rel="noopener noreferrer">这里</a>描述了在读/写操作期间，Ignite和PHP类型之间的映射关系。</p> <p><strong>复杂对象类型支持</strong></p> <p>客户端提供了两种处理Ignite复杂对象类型的方法：反序列化形式和二进制形式。</p> <p>应用可以通过引用PHP类的<code>ComplexObjectType</code>类的实例来指定字段的Ignite类型。当应用程序读取字段的值时，客户端会反序列化接收到的Ignite复杂对象，并将其作为引用的PHP类的实例返回给客户端。当应用程序写入字段值时，客户端需要引用的PHP类的一个实例，并将其序列化为Ignite复杂对象。</p> <p>如果应用没有指定字段的Ignite类型并读取字段的值，客户端将返回接收到的Ignite复杂对象作为<code>BinaryObject</code>类（Ignite复杂对象的二进制形式）的实例。<code>BinaryObject</code>不需要反序列化就可以对其内容（对象字段值的读写、添加和删除字段等）进行处理。此外，如果该字段没有显式指定的Ignite类型，应用可以从PHP对象创建<code>BinaryObject</code>类的实例，也可以将二进制对象作为字段的值写入Ignite。</p> <p>客户端负责从/在Ignite集群获取或注册有关Ignite复杂对象类型的信息，包括模式。当需要从/往Ignite读取或写入Ignite复杂对象时，这个过程由客户端自动完成。</p> <h4 id="_6-2-6-支持的api"><a href="#_6-2-6-支持的api" class="header-anchor">#</a> 6.2.6.支持的API</h4> <p>客户端API规范可以在<a href="https://rawgit.com/nobitlost/ignite/ignite-7783-docs/modules/platforms/php/api_docs/html/index.html" target="_self" rel="noopener noreferrer">这里</a>找到。</p> <p>除了下面不适用的特性之外，客户端支持<a href="#_2-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8D%8F%E8%AE%AE">二进制客户端协议</a>中的所有操作和类型：</p> <ul><li>不支持<code>OP_REGISTER_BINARY_TYPE_NAME</code>和<code>OP_GET_BINARY_TYPE_NAME</code>操作；</li> <li>不支持<code>OP_QUERY_SCAN</code>操作的过滤器对象，但是<code>OP_QUERY_SCAN</code>操作本身是支持的；</li> <li>无法注册新的Ignite枚举类型。支持对已有的Ignite枚举类型的项目进行读写；</li> <li>复杂对象中不支持原始数据；</li></ul> <p>以下的附加功能是支持的：</p> <ul><li>SSL/TLS连接；</li> <li>故障转移重连算法；</li> <li>所有API方法调用都是同步的。</li></ul> <h4 id="_6-2-7-开启调试"><a href="#_6-2-7-开启调试" class="header-anchor">#</a> 6.2.7.开启调试</h4> <p>要打开/关闭客户端的调试输出（包括错误日志记录），请调用Ignite客户端对象的<code>setDebug()</code>方法。默认情况下调试输出是禁用的：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>

<span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setDebug</span><span class="token punctuation">(</span><span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-3-键-值"><a href="#_6-3-键-值" class="header-anchor">#</a> 6.3.键-值</h3> <h4 id="_6-3-1-键-值操作"><a href="#_6-3-1-键-值操作" class="header-anchor">#</a> 6.3.1.键-值操作</h4> <p><code>CacheInterface</code>为缓存的键值数据提供了键值操作的方法，<code>put</code>、<code>get</code>、<code>putAll</code>、<code>getAll</code>、<code>replace</code>等，下面是一个示例：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>ClientConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>ObjectType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Cache<span class="token punctuation">\</span>CacheEntry</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>ClientException</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">performCacheKeyValueOperations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'myCache'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
            <span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// put and get value</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// put and get multiple values using putAll()/getAll() methods</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'value2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'value3'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$values</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// removes all entries from the cache</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ClientException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">performCacheKeyValueOperations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-3-2-扫描查询"><a href="#_6-3-2-扫描查询" class="header-anchor">#</a> 6.3.2.扫描查询</h4> <p>PHP客户端支持Ignite扫描查询。查询方法返回一个带有标准PHP迭代器接口的游标对象，它可以用于对结果集的延迟迭代，或者一次获取所有的结果。</p> <p>首先，通过创建和配置<code>ScanQuery</code>类的实例来定义查询；</p> <p>然后，将<code>ScanQuery</code>实例传递给<code>CacheInterface</code>的查询方法；</p> <p>最后，将返回的对象与<code>CursorInterface</code>一起使用，以迭代或获取查询返回的所有缓存项。</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>ClientConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>ObjectType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Cache<span class="token punctuation">\</span>CacheEntry</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Query<span class="token punctuation">\</span>ScanQuery</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>ClientException</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">performScanQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'myCache'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
            <span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// put multiple values using putAll()</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'value1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'value2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'value3'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// create and configure scan query</span>
        <span class="token variable">$scanQuery</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ScanQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
            <span class="token function">setPageSize</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// obtain scan query cursor</span>
        <span class="token variable">$cursor</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$scanQuery</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// getAll cache entries returned by the scan query</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$cursor</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$cacheEntry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$cacheEntry</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">destroyCache</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ClientException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">performScanQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-4-sql"><a href="#_6-4-sql" class="header-anchor">#</a> 6.4.SQL</h3> <h4 id="_6-4-1-sql查询"><a href="#_6-4-1-sql查询" class="header-anchor">#</a> 6.4.1.SQL查询</h4> <p>PHP客户端支持Ignite的SQL查询。查询方法返回一个带有标准PHP迭代器接口的游标对象，它可以用于对结果集的延迟迭代，或者一次获取所有的结果。</p> <p>首先，通过创建和配置<code>SqlQuery</code>类的实例来定义查询；</p> <p>然后，将<code>SqlQuery</code>实例传递给<code>CacheInterface</code>的查询方法；</p> <p>最后，将返回的对象与<code>CursorInterface</code>一起使用，以迭代或获取查询返回的所有缓存项。</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>ClientConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Cache<span class="token punctuation">\</span>CacheConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>ObjectType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Query<span class="token punctuation">\</span>SqlFieldsQuery</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>ClientException</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">performSqlFieldsQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'myPersonCache'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
        <span class="token function">setSqlSchema</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUBLIC'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// create table using SqlFieldsQuery</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span>
            <span class="token single-quoted-string string">'CREATE TABLE Person (id INTEGER PRIMARY KEY, firstName VARCHAR, lastName VARCHAR, salary DOUBLE)'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// insert data into the table</span>
        <span class="token variable">$insertQuery</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'INSERT INTO Person (id, firstName, lastName, salary) values (?, ?, ?, ?)'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
            <span class="token function">setArgTypes</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$insertQuery</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Doe'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$insertQuery</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Jane'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Roe'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// obtain sql fields cursor</span>
        <span class="token variable">$sqlFieldsCursor</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;SELECT concat(firstName, ' ', lastName), salary from Person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
                <span class="token function">setPageSize</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// iterate over elements returned by the query</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$sqlFieldsCursor</span> <span class="token keyword">as</span> <span class="token variable">$fields</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$fields</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// drop the table</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;DROP TABLE Person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ClientException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">performSqlFieldsQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-4-2-sql字段查询"><a href="#_6-4-2-sql字段查询" class="header-anchor">#</a> 6.4.2.SQL字段查询</h4> <p>这种类型的查询用于获取作为SQL查询结果集一部分的各个字段，执行诸如INSERT、UPDATE、DELETE、CREATE等DML和DDL语句。</p> <p>首先，通过创建和配置<code>SqlFieldsQuery</code>类的实例来定义查询；</p> <p>然后，将<code>SqlFieldsQuery</code>实例传递给<code>CacheInterface</code>的查询方法；</p> <p>最后，将返回的对象与<code>SqlFieldsCursorInterface</code>一起使用，以迭代或获取查询返回的所有元素。</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>ClientConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Cache<span class="token punctuation">\</span>CacheConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>ObjectType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Query<span class="token punctuation">\</span>SqlFieldsQuery</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>ClientException</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">performSqlFieldsQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'myPersonCache'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
        <span class="token function">setSqlSchema</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUBLIC'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// create table using SqlFieldsQuery</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span>
            <span class="token single-quoted-string string">'CREATE TABLE Person (id INTEGER PRIMARY KEY, firstName VARCHAR, lastName VARCHAR, salary DOUBLE)'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// insert data into the table</span>
        <span class="token variable">$insertQuery</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'INSERT INTO Person (id, firstName, lastName, salary) values (?, ?, ?, ?)'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
            <span class="token function">setArgTypes</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$insertQuery</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Doe'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$insertQuery</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Jane'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Roe'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// obtain sql fields cursor</span>
        <span class="token variable">$sqlFieldsCursor</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;SELECT concat(firstName, ' ', lastName), salary from Person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
                <span class="token function">setPageSize</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// iterate over elements returned by the query</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$sqlFieldsCursor</span> <span class="token keyword">as</span> <span class="token variable">$fields</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$fields</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// drop the table</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;DROP TABLE Person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ClientException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">performSqlFieldsQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-5-二进制对象"><a href="#_6-5-二进制对象" class="header-anchor">#</a> 6.5.二进制对象</h3> <p>除了下面不适用的特性之外，客户端支持<a href="#_2-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8D%8F%E8%AE%AE">二进制客户端协议</a>中的所有操作和类型：</p> <ul><li>不支持<code>OP_REGISTER_BINARY_TYPE_NAME</code>和<code>OP_GET_BINARY_TYPE_NAME</code>操作；</li> <li>不支持<code>OP_QUERY_SCAN</code>操作的过滤器对象，但是<code>OP_QUERY_SCAN</code>操作本身是支持的；</li> <li>无法注册新的Ignite枚举类型。支持对已有的Ignite枚举类型的项目进行读写；</li> <li>复杂对象中不支持原始数据；</li></ul> <p>下面的示例显示了如何获取/保存复杂对象和二进制对象：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>ClientConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>ObjectType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>ComplexObjectType</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>ClientException</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$salary</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>int <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> string <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">,</span> float <span class="token variable">$salary</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">=</span> <span class="token variable">$id</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">salary</span> <span class="token operator">=</span> <span class="token variable">$salary</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">putGetComplexAndBinaryObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'myPersonCache'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
            <span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Complex Object type for PHP Person class instances</span>
        <span class="token variable">$personComplexObjectType</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ComplexObjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
            <span class="token function">setFieldType</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">,</span> ObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// set cache key and value types</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
            <span class="token function">setValueType</span><span class="token punctuation">(</span><span class="token variable">$personComplexObjectType</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// put Complex Objects to the cache</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John Doe'</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Jane Roe'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// get Complex Object, returned value is an instance of Person class</span>
        <span class="token variable">$person</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$person</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// new CacheClient instance of the same cache to operate with BinaryObjects</span>
        <span class="token variable">$binaryCache</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getCache</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'myPersonCache'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
            <span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// get Complex Object from the cache in a binary form, returned value is an instance of BinaryObject class</span>
        <span class="token variable">$binaryPerson</span> <span class="token operator">=</span> <span class="token variable">$binaryCache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Binary form of Person:'</span> <span class="token punctuation">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$binaryPerson</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getFieldNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$fieldName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$fieldValue</span> <span class="token operator">=</span> <span class="token variable">$binaryPerson</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token variable">$fieldName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$fieldName</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">' : '</span> <span class="token punctuation">.</span> <span class="token variable">$fieldValue</span> <span class="token punctuation">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// modify Binary Object and put it to the cache</span>
        <span class="token variable">$binaryPerson</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setField</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> ObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
            <span class="token function">setField</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Mary Major'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$binaryCache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token variable">$binaryPerson</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// get Binary Object from the cache and convert it to PHP object</span>
        <span class="token variable">$binaryPerson</span> <span class="token operator">=</span> <span class="token variable">$binaryCache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$binaryPerson</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token variable">$personComplexObjectType</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">destroyCache</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'myPersonCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ClientException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">putGetComplexAndBinaryObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-6-安全"><a href="#_6-6-安全" class="header-anchor">#</a> 6.6.安全</h3> <h4 id="_6-6-1-认证"><a href="#_6-6-1-认证" class="header-anchor">#</a> 6.6.1.认证</h4> <p>关于如何在Ignite的集群端打开和配置认证，说明在<a href="/doc/2.8.0/java/Security.html#_2-高级安全">这里</a>。在PHP端，将用户名/密码传递给<code>ClientConfiguration</code>的方法如下：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">const</span> <span class="token constant">ENDPOINT</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'localhost:10800'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">USER_NAME</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'ignite'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">PASSWORD</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'ignite'</span><span class="token punctuation">;</span>

<span class="token variable">$config</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span>AuthTlsExample<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ENDPOINT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token function">setUserName</span><span class="token punctuation">(</span>AuthTlsExample<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">USER_NAME</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
    <span class="token function">setPassword</span><span class="token punctuation">(</span>AuthTlsExample<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">PASSWORD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-6-2-加密"><a href="#_6-6-2-加密" class="header-anchor">#</a> 6.6.2.加密</h4> <p>1.获取TLS所需的证书：</p> <ul><li>或着获取指定的Ignite服务端可用的现有证书；</li> <li>或者为正在使用的Ignite服务端生成新证书；</li></ul> <p>2.需要以下文件：</p> <ul><li><code>keystore.jks</code>，<code>truststore.jks</code> - 用于服务端；</li> <li><code>client.key</code>，<code>client.crt</code>，<code>ca.crt</code> - 用于客户端；</li></ul> <p>3.设置Ignite服务端以支持<a href="/doc/2.8.0/java/Security.html#_1-ssl和tls">SSL和TLS</a>，在启动过程中提供获得的<code>keystore.jks</code>和<code>truststore.jks</code>证书；</p> <p>4.将<code>client.key</code>、<code>client.crt</code>和<code>ca.crt</code>文件放在客户端本地的某个位置；</p> <p>5.根据需要，更新下面示例中的常量<code>TLS_KEY_FILE_NAME</code>、<code>TLS_CERT_FILE_NAME</code>和<code>TLS_CA_FILE_NAME</code>；</p> <p>6.根据需要更新下面示例中的<code>USER_NAME</code>和<code>PASSWORD</code>常量。</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>ClientConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Cache<span class="token punctuation">\</span>CacheInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>ClientException</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Type<span class="token punctuation">\</span>ObjectType</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AuthTlsExample</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token constant">ENDPOINT</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'localhost:10800'</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token constant">USER_NAME</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'ignite'</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token constant">PASSWORD</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'ignite'</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token constant">TLS_CLIENT_CERT_FILE_NAME</span> <span class="token operator">=</span> <span class="token constant">__DIR__</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'/certs/client.pem'</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token constant">TLS_CA_FILE_NAME</span> <span class="token operator">=</span> <span class="token constant">__DIR__</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'/certs/ca.pem'</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token constant">CACHE_NAME</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'AuthTlsExample_cache'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
    <span class="token punctuation">{</span>
        <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token variable">$tlsOptions</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token single-quoted-string string">'local_cert'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> AuthTlsExample<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TLS_CLIENT_CERT_FILE_NAME</span><span class="token punctuation">,</span>
                <span class="token single-quoted-string string">'cafile'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> AuthTlsExample<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">TLS_CA_FILE_NAME</span>
            <span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span>AuthTlsExample<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ENDPOINT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
                <span class="token function">setUserName</span><span class="token punctuation">(</span>AuthTlsExample<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">USER_NAME</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
                <span class="token function">setPassword</span><span class="token punctuation">(</span>AuthTlsExample<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">PASSWORD</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
                <span class="token function">setTLSOptions</span><span class="token punctuation">(</span><span class="token variable">$tlsOptions</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Client connected successfully (with TLS and authentication enabled)&quot;</span> <span class="token punctuation">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span>AuthTlsExample<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
                <span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">BYTE</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>
                <span class="token function">setValueType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">SHORT_ARRAY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">putGetData</span><span class="token punctuation">(</span><span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">destroyCache</span><span class="token punctuation">(</span>AuthTlsExample<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ClientException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'ERROR: '</span> <span class="token punctuation">.</span> <span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">putGetData</span><span class="token punctuation">(</span>CacheInterface <span class="token variable">$cache</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
    <span class="token punctuation">{</span>
        <span class="token variable">$values</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token number">1</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">generateValue</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">2</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">generateValue</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token number">3</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">generateValue</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// put values</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$values</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Cache values put successfully:'</span> <span class="token punctuation">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$values</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">printValue</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// get and compare values</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Cache values get:'</span> <span class="token punctuation">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$values</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$cacheValue</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">printValue</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$cacheValue</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">compareValues</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$cacheValue</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Unexpected cache value!'</span> <span class="token punctuation">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Cache values compared successfully'</span> <span class="token punctuation">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">compareValues</span><span class="token punctuation">(</span><span class="token keyword">array</span> <span class="token variable">$array1</span><span class="token punctuation">,</span> <span class="token keyword">array</span> <span class="token variable">$array2</span><span class="token punctuation">)</span><span class="token punctuation">:</span> bool
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token function">array_diff</span><span class="token punctuation">(</span><span class="token variable">$array1</span><span class="token punctuation">,</span> <span class="token variable">$array2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">generateValue</span><span class="token punctuation">(</span>int <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">array</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$length</span> <span class="token operator">=</span> <span class="token variable">$key</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$length</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">,</span> <span class="token variable">$key</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">printValue</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
    <span class="token punctuation">{</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'  %d =&gt; [%s]%s'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token single-quoted-string string">', '</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token variable">$authTlsExample</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AuthTlsExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$authTlsExample</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="right-pale"><div class="right-content"><div class="bbox tell-box"><button class="btn btn-circle btn-success right-tell"><i class="fa fa-lg fa-phone"></i></button> <p class="tell-hide">
            18624049226
        </p></div> <div class="bbox weixin-box"><button class="btn btn-circle btn-success right-weixin"><i class="fa fa-weixin"></i></button> <p class="tell-hide" style="padding:5px;"><img src="/img/weixin.jpg"></p></div></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间：:</span> <span class="time">11/8/2020, 11:11:14 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/doc/2.8.0/java/MachineLearning.html" class="prev">
        机器学习
      </a></span> <span class="next"><a href="/doc/2.8.0/java/PlatformsProtocols.html">
        平台和协议
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.aed0e056.js" defer></script><script src="/assets/js/3.d41ef727.js" defer></script><script src="/assets/js/1.c1604912.js" defer></script><script src="/assets/js/188.cd459a8e.js" defer></script><script src="/assets/js/11.43551a62.js" defer></script><script src="/assets/js/10.cd30f947.js" defer></script><script src="/assets/js/8.7ff96eb1.js" defer></script>
  </body>
</html>
