<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>分布式计算 | Apache Ignite技术服务</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="stylesheet" href="/css/plugin.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <script src="https://hm.baidu.com/hm.js?8e93516f96b603fac3e2738ca002c88a"></script>
    <meta name="description" content="apache ignite,ignite中文,ignite官网,内存数据库,分布式数据库">
    <meta name="keywords" content="apache ignite,ignite中文,ignite官网,内存数据库,分布式数据库">
    <meta http-equiv="cache-control" content="no-store,no-cache,must-revalidate">
    <meta http-equiv="expires" content="0">
    
    <link rel="preload" href="/assets/css/0.styles.763ae045.css" as="style"><link rel="preload" href="/assets/js/app.f95eba89.js" as="script"><link rel="preload" href="/assets/js/3.d41ef727.js" as="script"><link rel="preload" href="/assets/js/1.c1604912.js" as="script"><link rel="preload" href="/assets/js/232.063058e6.js" as="script"><link rel="preload" href="/assets/js/11.43551a62.js" as="script"><link rel="preload" href="/assets/js/10.cd30f947.js" as="script"><link rel="preload" href="/assets/js/8.7ff96eb1.js" as="script"><link rel="prefetch" href="/assets/js/100.dd64134d.js"><link rel="prefetch" href="/assets/js/101.d2e3f658.js"><link rel="prefetch" href="/assets/js/102.8e70745a.js"><link rel="prefetch" href="/assets/js/103.6c2662c1.js"><link rel="prefetch" href="/assets/js/104.4b2ee848.js"><link rel="prefetch" href="/assets/js/105.6eb36a3e.js"><link rel="prefetch" href="/assets/js/106.c0129421.js"><link rel="prefetch" href="/assets/js/107.9dcad7ed.js"><link rel="prefetch" href="/assets/js/108.c44bb1fd.js"><link rel="prefetch" href="/assets/js/109.9ebb2305.js"><link rel="prefetch" href="/assets/js/110.c55f5a85.js"><link rel="prefetch" href="/assets/js/111.9b4f77ab.js"><link rel="prefetch" href="/assets/js/112.552aa163.js"><link rel="prefetch" href="/assets/js/113.57c1c738.js"><link rel="prefetch" href="/assets/js/114.f3d9f637.js"><link rel="prefetch" href="/assets/js/115.031892fc.js"><link rel="prefetch" href="/assets/js/116.668eb1b3.js"><link rel="prefetch" href="/assets/js/117.9fcca2eb.js"><link rel="prefetch" href="/assets/js/118.6fc27095.js"><link rel="prefetch" href="/assets/js/119.1763e2a7.js"><link rel="prefetch" href="/assets/js/12.7891e08b.js"><link rel="prefetch" href="/assets/js/120.5d17c163.js"><link rel="prefetch" href="/assets/js/121.db5e0a95.js"><link rel="prefetch" href="/assets/js/122.d41d5f10.js"><link rel="prefetch" href="/assets/js/123.dc097107.js"><link rel="prefetch" href="/assets/js/124.75ff2317.js"><link rel="prefetch" href="/assets/js/125.577a3694.js"><link rel="prefetch" href="/assets/js/126.270f73d5.js"><link rel="prefetch" href="/assets/js/127.f6837161.js"><link rel="prefetch" href="/assets/js/128.eeca9057.js"><link rel="prefetch" href="/assets/js/129.e2b9b80c.js"><link rel="prefetch" href="/assets/js/13.550a0e6d.js"><link rel="prefetch" href="/assets/js/130.12b00d5f.js"><link rel="prefetch" href="/assets/js/131.b349c2b2.js"><link rel="prefetch" href="/assets/js/132.f9bf1f05.js"><link rel="prefetch" href="/assets/js/133.3a706529.js"><link rel="prefetch" href="/assets/js/134.d022fb56.js"><link rel="prefetch" href="/assets/js/135.1652d314.js"><link rel="prefetch" href="/assets/js/136.b68c7f75.js"><link rel="prefetch" href="/assets/js/137.61e1e61c.js"><link rel="prefetch" href="/assets/js/138.34a0121f.js"><link rel="prefetch" href="/assets/js/139.a6b1250b.js"><link rel="prefetch" href="/assets/js/14.7da9e4b5.js"><link rel="prefetch" href="/assets/js/140.c00db03c.js"><link rel="prefetch" href="/assets/js/141.23c6488c.js"><link rel="prefetch" href="/assets/js/142.071de2b6.js"><link rel="prefetch" href="/assets/js/143.27da034a.js"><link rel="prefetch" href="/assets/js/144.078455b1.js"><link rel="prefetch" href="/assets/js/145.7cfead36.js"><link rel="prefetch" href="/assets/js/146.6481436d.js"><link rel="prefetch" href="/assets/js/147.df3252a4.js"><link rel="prefetch" href="/assets/js/148.9cbc96d9.js"><link rel="prefetch" href="/assets/js/149.d61ac107.js"><link rel="prefetch" href="/assets/js/15.3fcf7697.js"><link rel="prefetch" href="/assets/js/150.c99cf7d2.js"><link rel="prefetch" href="/assets/js/151.8b054147.js"><link rel="prefetch" href="/assets/js/152.4e50e1d5.js"><link rel="prefetch" href="/assets/js/153.1a5c9601.js"><link rel="prefetch" href="/assets/js/154.64543ae6.js"><link rel="prefetch" href="/assets/js/155.9b519c0b.js"><link rel="prefetch" href="/assets/js/156.e5171ed9.js"><link rel="prefetch" href="/assets/js/157.42809de6.js"><link rel="prefetch" href="/assets/js/158.ce6e0cab.js"><link rel="prefetch" href="/assets/js/159.4dc98865.js"><link rel="prefetch" href="/assets/js/16.774f17c1.js"><link rel="prefetch" href="/assets/js/160.571ae889.js"><link rel="prefetch" href="/assets/js/161.8500d70f.js"><link rel="prefetch" href="/assets/js/162.37707136.js"><link rel="prefetch" href="/assets/js/163.e6dfbfc4.js"><link rel="prefetch" href="/assets/js/164.cde14289.js"><link rel="prefetch" href="/assets/js/165.4e2f5687.js"><link rel="prefetch" href="/assets/js/166.caed9976.js"><link rel="prefetch" href="/assets/js/167.1007be32.js"><link rel="prefetch" href="/assets/js/168.75ac2cd0.js"><link rel="prefetch" href="/assets/js/169.e1fdf1a0.js"><link rel="prefetch" href="/assets/js/17.6e096f47.js"><link rel="prefetch" href="/assets/js/170.a64c8df1.js"><link rel="prefetch" href="/assets/js/171.5f553b26.js"><link rel="prefetch" href="/assets/js/172.da2d4de9.js"><link rel="prefetch" href="/assets/js/173.bf05e539.js"><link rel="prefetch" href="/assets/js/174.3d8623ec.js"><link rel="prefetch" href="/assets/js/175.2a013c69.js"><link rel="prefetch" href="/assets/js/176.d2fae53a.js"><link rel="prefetch" href="/assets/js/177.9bdedac7.js"><link rel="prefetch" href="/assets/js/178.a6a8188f.js"><link rel="prefetch" href="/assets/js/179.9bdb418d.js"><link rel="prefetch" href="/assets/js/18.4591d43e.js"><link rel="prefetch" href="/assets/js/180.55f887c6.js"><link rel="prefetch" href="/assets/js/181.4cc3f728.js"><link rel="prefetch" href="/assets/js/182.91557ee7.js"><link rel="prefetch" href="/assets/js/183.2eefb5de.js"><link rel="prefetch" href="/assets/js/184.6864be6e.js"><link rel="prefetch" href="/assets/js/185.f0df1752.js"><link rel="prefetch" href="/assets/js/186.ffcd2148.js"><link rel="prefetch" href="/assets/js/187.9a2554ad.js"><link rel="prefetch" href="/assets/js/188.65615588.js"><link rel="prefetch" href="/assets/js/189.a3052b05.js"><link rel="prefetch" href="/assets/js/19.01668f6f.js"><link rel="prefetch" href="/assets/js/190.4987fd24.js"><link rel="prefetch" href="/assets/js/191.942d19f7.js"><link rel="prefetch" href="/assets/js/192.ac982c75.js"><link rel="prefetch" href="/assets/js/193.627fbce1.js"><link rel="prefetch" href="/assets/js/194.47eb2713.js"><link rel="prefetch" href="/assets/js/195.12dd3386.js"><link rel="prefetch" href="/assets/js/196.1b35d98a.js"><link rel="prefetch" href="/assets/js/197.6a1c2ffb.js"><link rel="prefetch" href="/assets/js/198.f642e4c1.js"><link rel="prefetch" href="/assets/js/199.b56a1ccb.js"><link rel="prefetch" href="/assets/js/20.cffe7c76.js"><link rel="prefetch" href="/assets/js/200.6c11d1ad.js"><link rel="prefetch" href="/assets/js/201.90c66963.js"><link rel="prefetch" href="/assets/js/202.0b052147.js"><link rel="prefetch" href="/assets/js/203.51b115de.js"><link rel="prefetch" href="/assets/js/204.0eedb40b.js"><link rel="prefetch" href="/assets/js/205.a2a59c0d.js"><link rel="prefetch" href="/assets/js/206.d18c1480.js"><link rel="prefetch" href="/assets/js/207.23803fcf.js"><link rel="prefetch" href="/assets/js/208.be876e21.js"><link rel="prefetch" href="/assets/js/209.affeeef5.js"><link rel="prefetch" href="/assets/js/21.8968e1cb.js"><link rel="prefetch" href="/assets/js/210.493b3abe.js"><link rel="prefetch" href="/assets/js/211.0149c636.js"><link rel="prefetch" href="/assets/js/212.7c5d9377.js"><link rel="prefetch" href="/assets/js/213.ecf099d3.js"><link rel="prefetch" href="/assets/js/214.d0df16eb.js"><link rel="prefetch" href="/assets/js/215.80d31c6e.js"><link rel="prefetch" href="/assets/js/216.f1b488f2.js"><link rel="prefetch" href="/assets/js/217.e73dc956.js"><link rel="prefetch" href="/assets/js/218.4cb4df30.js"><link rel="prefetch" href="/assets/js/219.c62ae5e2.js"><link rel="prefetch" href="/assets/js/22.713394a9.js"><link rel="prefetch" href="/assets/js/220.feb2cbeb.js"><link rel="prefetch" href="/assets/js/221.bb8b033e.js"><link rel="prefetch" href="/assets/js/222.4bd244b7.js"><link rel="prefetch" href="/assets/js/223.ec446ba4.js"><link rel="prefetch" href="/assets/js/224.957b97ac.js"><link rel="prefetch" href="/assets/js/225.4dac351b.js"><link rel="prefetch" href="/assets/js/226.31ed041b.js"><link rel="prefetch" href="/assets/js/227.ce7e6b66.js"><link rel="prefetch" href="/assets/js/228.73f66951.js"><link rel="prefetch" href="/assets/js/229.0134f96a.js"><link rel="prefetch" href="/assets/js/23.46a7d273.js"><link rel="prefetch" href="/assets/js/230.a8c04fb3.js"><link rel="prefetch" href="/assets/js/231.3ee98621.js"><link rel="prefetch" href="/assets/js/233.5e397359.js"><link rel="prefetch" href="/assets/js/234.043fc77c.js"><link rel="prefetch" href="/assets/js/235.f2967514.js"><link rel="prefetch" href="/assets/js/236.de7c4b53.js"><link rel="prefetch" href="/assets/js/237.905f98f7.js"><link rel="prefetch" href="/assets/js/238.36857ca5.js"><link rel="prefetch" href="/assets/js/239.554807a8.js"><link rel="prefetch" href="/assets/js/24.7d738306.js"><link rel="prefetch" href="/assets/js/240.a2d51ac4.js"><link rel="prefetch" href="/assets/js/241.e38bd78b.js"><link rel="prefetch" href="/assets/js/242.82b2ef43.js"><link rel="prefetch" href="/assets/js/243.cd818e57.js"><link rel="prefetch" href="/assets/js/244.630ea25e.js"><link rel="prefetch" href="/assets/js/245.9b4f32f9.js"><link rel="prefetch" href="/assets/js/246.5f161eb3.js"><link rel="prefetch" href="/assets/js/247.286ef9af.js"><link rel="prefetch" href="/assets/js/248.7e18becc.js"><link rel="prefetch" href="/assets/js/249.9a65ff1d.js"><link rel="prefetch" href="/assets/js/25.24a22469.js"><link rel="prefetch" href="/assets/js/250.7f51ed49.js"><link rel="prefetch" href="/assets/js/251.a86aaa66.js"><link rel="prefetch" href="/assets/js/252.b1ca8a0e.js"><link rel="prefetch" href="/assets/js/253.baca393d.js"><link rel="prefetch" href="/assets/js/254.84e91845.js"><link rel="prefetch" href="/assets/js/255.cc2cf042.js"><link rel="prefetch" href="/assets/js/256.a03de29d.js"><link rel="prefetch" href="/assets/js/257.1d96de72.js"><link rel="prefetch" href="/assets/js/26.4f3e0ea1.js"><link rel="prefetch" href="/assets/js/27.fe376f21.js"><link rel="prefetch" href="/assets/js/28.6c153a84.js"><link rel="prefetch" href="/assets/js/29.70ee46c1.js"><link rel="prefetch" href="/assets/js/30.001c4a10.js"><link rel="prefetch" href="/assets/js/31.aa462b87.js"><link rel="prefetch" href="/assets/js/32.c22012c3.js"><link rel="prefetch" href="/assets/js/33.6b198417.js"><link rel="prefetch" href="/assets/js/34.7a34b7d7.js"><link rel="prefetch" href="/assets/js/35.2e5775c1.js"><link rel="prefetch" href="/assets/js/36.0d0fc383.js"><link rel="prefetch" href="/assets/js/37.cfb832f3.js"><link rel="prefetch" href="/assets/js/38.ba68b370.js"><link rel="prefetch" href="/assets/js/39.aaa32dd9.js"><link rel="prefetch" href="/assets/js/4.51a792b3.js"><link rel="prefetch" href="/assets/js/40.d84c0ea8.js"><link rel="prefetch" href="/assets/js/41.bdbd47a6.js"><link rel="prefetch" href="/assets/js/42.bdf17566.js"><link rel="prefetch" href="/assets/js/43.24b26ca7.js"><link rel="prefetch" href="/assets/js/44.9f2a3bfd.js"><link rel="prefetch" href="/assets/js/45.a4297d82.js"><link rel="prefetch" href="/assets/js/46.5cadc469.js"><link rel="prefetch" href="/assets/js/47.e6613404.js"><link rel="prefetch" href="/assets/js/48.b263f5e0.js"><link rel="prefetch" href="/assets/js/49.eb22b86a.js"><link rel="prefetch" href="/assets/js/5.5115f2a5.js"><link rel="prefetch" href="/assets/js/50.cdfd4ff3.js"><link rel="prefetch" href="/assets/js/51.89ef07ae.js"><link rel="prefetch" href="/assets/js/52.43da4e0a.js"><link rel="prefetch" href="/assets/js/53.1ca339d7.js"><link rel="prefetch" href="/assets/js/54.0b490226.js"><link rel="prefetch" href="/assets/js/55.49db8070.js"><link rel="prefetch" href="/assets/js/56.ddc31e25.js"><link rel="prefetch" href="/assets/js/57.ede1534c.js"><link rel="prefetch" href="/assets/js/58.7eeaa0f4.js"><link rel="prefetch" href="/assets/js/59.4717783a.js"><link rel="prefetch" href="/assets/js/6.91cc8ac1.js"><link rel="prefetch" href="/assets/js/60.5f8210aa.js"><link rel="prefetch" href="/assets/js/61.6c3ca67b.js"><link rel="prefetch" href="/assets/js/62.54c0f272.js"><link rel="prefetch" href="/assets/js/63.43cbcaa9.js"><link rel="prefetch" href="/assets/js/64.cb43a402.js"><link rel="prefetch" href="/assets/js/65.7ebe1cc2.js"><link rel="prefetch" href="/assets/js/66.2d161e2e.js"><link rel="prefetch" href="/assets/js/67.56144d28.js"><link rel="prefetch" href="/assets/js/68.a7a22ff6.js"><link rel="prefetch" href="/assets/js/69.2f66a4c9.js"><link rel="prefetch" href="/assets/js/7.db4f6f85.js"><link rel="prefetch" href="/assets/js/70.a0e37d99.js"><link rel="prefetch" href="/assets/js/71.1ab62514.js"><link rel="prefetch" href="/assets/js/72.a329b21d.js"><link rel="prefetch" href="/assets/js/73.fbcc6538.js"><link rel="prefetch" href="/assets/js/74.b7ef64c5.js"><link rel="prefetch" href="/assets/js/75.e009a648.js"><link rel="prefetch" href="/assets/js/76.f7de624f.js"><link rel="prefetch" href="/assets/js/77.4a6e4c76.js"><link rel="prefetch" href="/assets/js/78.3e735921.js"><link rel="prefetch" href="/assets/js/79.bb789130.js"><link rel="prefetch" href="/assets/js/80.1283ae02.js"><link rel="prefetch" href="/assets/js/81.022ec16f.js"><link rel="prefetch" href="/assets/js/82.05783848.js"><link rel="prefetch" href="/assets/js/83.e2994430.js"><link rel="prefetch" href="/assets/js/84.75fd70df.js"><link rel="prefetch" href="/assets/js/85.63b6dd59.js"><link rel="prefetch" href="/assets/js/86.bd968a1c.js"><link rel="prefetch" href="/assets/js/87.5fa8bbcb.js"><link rel="prefetch" href="/assets/js/88.ab52b170.js"><link rel="prefetch" href="/assets/js/89.158a603c.js"><link rel="prefetch" href="/assets/js/9.bab0bdef.js"><link rel="prefetch" href="/assets/js/90.cf7a8848.js"><link rel="prefetch" href="/assets/js/91.d68f011e.js"><link rel="prefetch" href="/assets/js/92.29ecf4f6.js"><link rel="prefetch" href="/assets/js/93.771b0881.js"><link rel="prefetch" href="/assets/js/94.78132be4.js"><link rel="prefetch" href="/assets/js/95.654821a2.js"><link rel="prefetch" href="/assets/js/96.f5e3b5bb.js"><link rel="prefetch" href="/assets/js/97.00137fb9.js"><link rel="prefetch" href="/assets/js/98.2b3d1d60.js"><link rel="prefetch" href="/assets/js/99.86d6ca43.js">
    <link rel="stylesheet" href="/assets/css/0.styles.763ae045.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Apache Ignite技术服务</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/Service.html" class="nav-link">
  服务&amp;报价
</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link router-link-active">
  文档
</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/confluent/" class="nav-link">
  Confluent平台
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">最新版本</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">最新版本</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/java/DistributedComputing.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  2.9.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.8.0/" class="nav-link">
  2.8.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.7.0/" class="nav-link">
  2.7.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/" class="nav-link">
  2.6.0
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/Service.html" class="nav-link">
  服务&amp;报价
</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link router-link-active">
  文档
</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/confluent/" class="nav-link">
  Confluent平台
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">最新版本</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">最新版本</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/java/DistributedComputing.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  2.9.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.8.0/" class="nav-link">
  2.8.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.7.0/" class="nav-link">
  2.7.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/" class="nav-link">
  2.6.0
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/doc/java/" aria-current="page" class="sidebar-link">前言</a></li><li><a href="/doc/java/QuickStartGuide.html" class="sidebar-link">快速入门</a></li><li><a href="/doc/java/Installation.html" class="sidebar-link">安装</a></li><li><a href="/doc/java/SettingUp.html" class="sidebar-link">Ignite配置入门</a></li><li><a href="/doc/java/StartingNodes.html" class="sidebar-link">启动和停止节点</a></li><li><a href="/doc/java/Clustering.html" class="sidebar-link">集群化</a></li><li><a href="/doc/java/ThinClients.html" class="sidebar-link">瘦客户端</a></li><li><a href="/doc/java/DataModeling.html" class="sidebar-link">数据建模</a></li><li><a href="/doc/java/ConfiguringMemory.html" class="sidebar-link">配置内存</a></li><li><a href="/doc/java/Persistence.html" class="sidebar-link">配置持久化</a></li><li><a href="/doc/java/ConfiguringCaches.html" class="sidebar-link">配置缓存</a></li><li><a href="/doc/java/DataRebalancing.html" class="sidebar-link">数据再平衡</a></li><li><a href="/doc/java/DataStreaming.html" class="sidebar-link">数据流处理</a></li><li><a href="/doc/java/UsingKeyValueApi.html" class="sidebar-link">键-值API</a></li><li><a href="/doc/java/Transactions.html" class="sidebar-link">Ignite事务</a></li><li><a href="/doc/java/WorkingwithSQL.html" class="sidebar-link">使用SQL</a></li><li><a href="/doc/java/SQLReference.html" class="sidebar-link">SQL参考</a></li><li><a href="/doc/java/DistributedComputing.html" aria-current="page" class="active sidebar-link">分布式计算</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_1-分布式计算api" class="sidebar-link">1.分布式计算API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_1-1-获取计算接口实例" class="sidebar-link">1.1.获取计算接口实例</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_1-2-指定计算节点集" class="sidebar-link">1.2.指定计算节点集</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_1-3-执行任务" class="sidebar-link">1.3.执行任务</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_1-4-任务执行超时" class="sidebar-link">1.4.任务执行超时</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_1-5-本地节点内作业共享状态" class="sidebar-link">1.5.本地节点内作业共享状态</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_1-6-从计算任务访问数据" class="sidebar-link">1.6.从计算任务访问数据</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_2-集群组" class="sidebar-link">2.集群组</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_3-executorservice" class="sidebar-link">3.ExecutorService</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_4-mapreduce-api" class="sidebar-link">4.MapReduce API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_4-1-概述" class="sidebar-link">4.1.概述</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_4-2-computetask接口" class="sidebar-link">4.2.ComputeTask接口</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_4-3-执行计算任务" class="sidebar-link">4.3.执行计算任务</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_4-4-处理作业故障" class="sidebar-link">4.4.处理作业故障</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_4-5-计算任务适配器" class="sidebar-link">4.5.计算任务适配器</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_4-6-分布式任务会话" class="sidebar-link">4.6.分布式任务会话</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_4-7-计算任务示例" class="sidebar-link">4.7.计算任务示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_5-负载平衡" class="sidebar-link">5.负载平衡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_5-1-轮询式负载均衡" class="sidebar-link">5.1.轮询式负载均衡</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_5-2-随机和加权式负载平衡" class="sidebar-link">5.2.随机和加权式负载平衡</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_5-3-作业窃取" class="sidebar-link">5.3.作业窃取</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_6-容错" class="sidebar-link">6.容错</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_7-作业调度" class="sidebar-link">7.作业调度</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_7-1-fifo排序" class="sidebar-link">7.1.FIFO排序</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_7-2-优先级排序" class="sidebar-link">7.2.优先级排序</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_8-计算和数据并置" class="sidebar-link">8.计算和数据并置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_8-1-通过键并置" class="sidebar-link">8.1.通过键并置</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_8-2-通过分区并置" class="sidebar-link">8.2.通过分区并置</a></li><li class="sidebar-sub-header"><a href="/doc/java/DistributedComputing.html#_8-3-entryprocessor" class="sidebar-link">8.3.EntryProcessor</a></li></ul></li></ul></li><li><a href="/doc/java/CodeDeployment.html" class="sidebar-link">代码部署</a></li><li><a href="/doc/java/MachineLearning.html" class="sidebar-link">机器学习</a></li><li><a href="/doc/java/ContinuousQueries.html" class="sidebar-link">Ignite持续查询</a></li><li><a href="/doc/java/Service.html" class="sidebar-link">Ignite服务</a></li><li><a href="/doc/java/Messaging.html" class="sidebar-link">Ignite消息</a></li><li><a href="/doc/java/DataStructures.html" class="sidebar-link">Ignite分布式数据结构</a></li><li><a href="/doc/java/DistributedLocks.html" class="sidebar-link">Ignite分布式锁</a></li><li><a href="/doc/java/RESTAPI.html" class="sidebar-link">REST API</a></li><li><a href="/doc/java/DotnetSpecific.html" class="sidebar-link">Ignite.NET</a></li><li><a href="/doc/java/CppSpecific.html" class="sidebar-link">Ignite C++</a></li><li><a href="/doc/java/Monitoring.html" class="sidebar-link">监控</a></li><li><a href="/doc/java/WorkingwithEvents.html" class="sidebar-link">Ignite事件</a></li><li><a href="/doc/java/Tools.html" class="sidebar-link">工具</a></li><li><a href="/doc/java/Security.html" class="sidebar-link">安全</a></li><li><a href="/doc/java/ExtensionsIntegrations.html" class="sidebar-link">扩展和集成</a></li><li><a href="/doc/java/Plugins.html" class="sidebar-link">插件</a></li><li><a href="/doc/java/PerformanceTroubleshooting.html" class="sidebar-link">性能和故障排除</a></li><li><a href="/doc/java/Legal.html" class="sidebar-link">法律条款</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="分布式计算"><a href="#分布式计算" class="header-anchor">#</a> 分布式计算</h1> <h2 id="_1-分布式计算api"><a href="#_1-分布式计算api" class="header-anchor">#</a> 1.分布式计算API</h2> <p>Ignite提供了一套API，用于在集群范围以容错和负载平衡的方式执行分布式计算。可以提交单个任务执行，也可以通过自动任务拆分实施MapReduce模式的并行计算，该API可以进行细粒度的控制。</p> <h3 id="_1-1-获取计算接口实例"><a href="#_1-1-获取计算接口实例" class="header-anchor">#</a> 1.1.获取计算接口实例</h3> <p>执行分布式计算的主要入口是计算接口，该接口可通过<code>Ignite</code>实例获得：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Ignite</span> ignite <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteCompute</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="c++" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-cpp extra-class"><pre class="language-cpp"><code>Ignite ignite <span class="token operator">=</span> Ignition<span class="token operator">::</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

Compute compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <p>该接口提供了在集群范围分发不同类型计算任务然后执行<a href="#_8-%E8%AE%A1%E7%AE%97%E5%92%8C%E6%95%B0%E6%8D%AE%E5%B9%B6%E7%BD%AE">并置计算</a>的方法。</p> <h3 id="_1-2-指定计算节点集"><a href="#_1-2-指定计算节点集" class="header-anchor">#</a> 1.2.指定计算节点集</h3> <p>每个计算接口的实例都是与一组执行任务的<a href="#_2-%E9%9B%86%E7%BE%A4%E7%BB%84">节点集</a>相关联的。如果没有参数，<code>ignite.compute()</code>返回的计算接口是与所有的服务端节点关联的，要获得与特定节点集关联的实例，需要使用<code>Ignite.compute(ClusterGroup group)</code>。在下面的示例中，计算接口只绑定到远程节点，即除了运行本代码的所有节点。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Ignite</span> ignite <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteCompute</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span>ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forRemotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ForRemotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h3 id="_1-3-执行任务"><a href="#_1-3-执行任务" class="header-anchor">#</a> 1.3.执行任务</h3> <p>Ignite提供了3个接口，用于实现具体的任务并通过计算接口执行。</p> <ul><li><code>IgniteRunnable</code>：一个<code>java.lang.Runnable</code>的扩展，可用于实现没有输入参数和返回值的计算；</li> <li><code>IgniteCallable</code>：一个<code>java.util.concurrent.Callable</code>的扩展，会有一个返回值；</li> <li><code>IgniteClosure</code>：一个函数式接口，可以接受一个参数，并且有返回值。</li></ul> <p>一个任务可以执行一次（在某个节点上），或者广播到所有的节点。</p> <div class="custom-block warning"><p class="custom-block-title">警告</p> <p>为了能在远程节点执行任务，一定要确保任务的类定义在节点上可用，具体有两种方式：</p> <ul><li>将类文件添加到节点的类路径；</li> <li>开启<a href="/doc/java/CodeDeployment.html#_2-对等类加载">对等类加载</a>。</li></ul></div> <h4 id="_1-3-1-执行runnable任务"><a href="#_1-3-1-执行runnable任务" class="header-anchor">#</a> 1.3.1.执行Runnable任务</h4> <p>要执行Runnable任务，需要使用计算接口的<code>run(…​)</code>方法，这时该任务会被发送到与计算接口关联的某个节点上。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IgniteCompute</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Iterate through all words and print</span>
<span class="token comment">// each word on a different cluster node.</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> word <span class="token operator">:</span> <span class="token string">&quot;Print words on different cluster nodes&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compute<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">PrintWordAction</span> <span class="token punctuation">:</span> <span class="token class-name">IComputeAction</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">var</span> s <span class="token keyword">in</span> <span class="token string">&quot;Print words on different cluster nodes&quot;</span><span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">ComputeRunDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
        <span class="token punctuation">{</span>
            DiscoverySpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoverySpi</span>
            <span class="token punctuation">{</span>
                LocalPort <span class="token operator">=</span> <span class="token number">48500</span><span class="token punctuation">,</span>
                LocalPortRange <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
                IpFinder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoveryStaticIpFinder</span>
                <span class="token punctuation">{</span>
                    Endpoints <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
                    <span class="token punctuation">{</span>
                        <span class="token string">&quot;127.0.0.1:48500..48520&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrintWordAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c++" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/*
 * Function class.
 */</span>
<span class="token keyword">class</span> <span class="token class-name">PrintWord</span> <span class="token operator">:</span> <span class="token keyword">public</span> compute<span class="token operator">::</span>ComputeFunc<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">friend</span> <span class="token keyword">struct</span> <span class="token class-name">ignite</span><span class="token operator">::</span>binary<span class="token operator">::</span>BinaryType<span class="token operator">&lt;</span>PrintWord<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">/*
     * Default constructor.
     */</span>
    <span class="token function">PrintWord</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// No-op.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
     * Constructor.
     *
     * @param text Text.
     */</span>
    <span class="token function">PrintWord</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> word<span class="token punctuation">)</span> <span class="token operator">:</span>
        <span class="token function">word</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// No-op.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Callback.
     */</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> word <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/** Word to print. */</span>
    std<span class="token operator">::</span>string word<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Binary type structure. Defines a set of functions required for type to be serialized and deserialized.
 */</span>
<span class="token keyword">namespace</span> ignite
<span class="token punctuation">{</span>
    <span class="token keyword">namespace</span> binary
    <span class="token punctuation">{</span>
        <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>
        <span class="token keyword">struct</span> <span class="token class-name">BinaryType</span><span class="token operator">&lt;</span>PrintWord<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetTypeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">GetBinaryStringHashCode</span><span class="token punctuation">(</span><span class="token string">&quot;PrintWord&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetTypeName</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst <span class="token operator">=</span> <span class="token string">&quot;PrintWord&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetFieldId</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">GetBinaryStringHashCode</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetHashCode</span><span class="token punctuation">(</span><span class="token keyword">const</span> PrintWord<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token keyword">const</span> PrintWord<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetNull</span><span class="token punctuation">(</span>PrintWord<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst <span class="token operator">=</span> <span class="token function">PrintWord</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Write</span><span class="token punctuation">(</span>BinaryWriter<span class="token operator">&amp;</span> writer<span class="token punctuation">,</span> <span class="token keyword">const</span> PrintWord<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                writer<span class="token punctuation">.</span><span class="token function">RawWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>word<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Read</span><span class="token punctuation">(</span>BinaryReader<span class="token operator">&amp;</span> reader<span class="token punctuation">,</span> PrintWord<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst<span class="token punctuation">.</span>word <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">RawReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    IgniteConfiguration cfg<span class="token punctuation">;</span>
    cfg<span class="token punctuation">.</span>springCfgPath <span class="token operator">=</span> <span class="token string">&quot;/path/to/configuration.xml&quot;</span><span class="token punctuation">;</span>

    Ignite ignite <span class="token operator">=</span> Ignition<span class="token operator">::</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get binding instance.</span>
    IgniteBinding binding <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Registering our class as a compute function.</span>
    binding<span class="token punctuation">.</span>RegisterComputeFunc<span class="token operator">&lt;</span>PrintWord<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get compute instance.</span>
    compute<span class="token operator">::</span>Compute compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    std<span class="token operator">::</span>istringstream <span class="token function">iss</span><span class="token punctuation">(</span><span class="token string">&quot;Print words on different cluster nodes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span> <span class="token function">words</span><span class="token punctuation">(</span><span class="token punctuation">(</span>std<span class="token operator">::</span>istream_iterator<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span>iss<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        std<span class="token operator">::</span>istream_iterator<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Iterate through all words and print</span>
    <span class="token comment">// each word on a different cluster node.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>string word <span class="token operator">:</span> words<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Run compute task.</span>
        compute<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token function">PrintWord</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <h4 id="_1-3-2-执行callable任务"><a href="#_1-3-2-执行callable任务" class="header-anchor">#</a> 1.3.2.执行Callable任务</h4> <p>要执行Callable任务，需要使用计算接口的<code>call(…​)</code>方法。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IgniteCallable</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> calls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Iterate through all words in the sentence and create callable jobs.</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> word <span class="token operator">:</span> <span class="token string">&quot;How many characters&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    calls<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>word<span class="token operator">::</span><span class="token function">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Execute the collection of callables on the cluster.</span>
<span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> res <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>calls<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add all the word lengths received from cluster nodes.</span>
<span class="token keyword">int</span> total <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">intValue</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">CharCounter</span> <span class="token punctuation">:</span> <span class="token class-name">IComputeFunc</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token keyword">string</span> arg<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CharCounter</span><span class="token punctuation">(</span><span class="token keyword">string</span> arg<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>arg <span class="token operator">=</span> arg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> arg<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">ComputeFuncDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
        <span class="token punctuation">{</span>
            DiscoverySpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoverySpi</span>
            <span class="token punctuation">{</span>
                LocalPort <span class="token operator">=</span> <span class="token number">48500</span><span class="token punctuation">,</span>
                LocalPortRange <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
                IpFinder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoveryStaticIpFinder</span>
                <span class="token punctuation">{</span>
                    Endpoints <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
                    <span class="token punctuation">{</span>
                        <span class="token string">&quot;127.0.0.1:48500..48520&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Iterate through all words in the sentence and create callable jobs.</span>
    <span class="token keyword">var</span> calls <span class="token operator">=</span> <span class="token string">&quot;How many characters&quot;</span><span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">CharCounter</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Execute the collection of calls on the cluster.</span>
    <span class="token keyword">var</span> res <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>calls<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Add all the word lengths received from cluster nodes.</span>
    <span class="token keyword">var</span> total <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c++" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/*
 * Function class.
 */</span>
<span class="token keyword">class</span> <span class="token class-name">CountLength</span> <span class="token operator">:</span> <span class="token keyword">public</span> compute<span class="token operator">::</span>ComputeFunc<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">friend</span> <span class="token keyword">struct</span> <span class="token class-name">ignite</span><span class="token operator">::</span>binary<span class="token operator">::</span>BinaryType<span class="token operator">&lt;</span>CountLength<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">/*
     * Default constructor.
     */</span>
    <span class="token function">CountLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// No-op.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
     * Constructor.
     *
     * @param text Text.
     */</span>
    <span class="token function">CountLength</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> word<span class="token punctuation">)</span> <span class="token operator">:</span>
        <span class="token function">word</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// No-op.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Callback.
     * Counts number of characters in provided word.
     *
     * @return Word's length.
     */</span>
    <span class="token keyword">virtual</span> <span class="token keyword">int32_t</span> <span class="token function">Call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/** Word to print. */</span>
    std<span class="token operator">::</span>string word<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Binary type structure. Defines a set of functions required for type to be serialized and deserialized.
 */</span>
<span class="token keyword">namespace</span> ignite
<span class="token punctuation">{</span>
    <span class="token keyword">namespace</span> binary
    <span class="token punctuation">{</span>
        <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>
        <span class="token keyword">struct</span> <span class="token class-name">BinaryType</span><span class="token operator">&lt;</span>CountLength<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetTypeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">GetBinaryStringHashCode</span><span class="token punctuation">(</span><span class="token string">&quot;CountLength&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetTypeName</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst <span class="token operator">=</span> <span class="token string">&quot;CountLength&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetFieldId</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">GetBinaryStringHashCode</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetHashCode</span><span class="token punctuation">(</span><span class="token keyword">const</span> CountLength<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token keyword">const</span> CountLength<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetNull</span><span class="token punctuation">(</span>CountLength<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst <span class="token operator">=</span> <span class="token function">CountLength</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Write</span><span class="token punctuation">(</span>BinaryWriter<span class="token operator">&amp;</span> writer<span class="token punctuation">,</span> <span class="token keyword">const</span> CountLength<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                writer<span class="token punctuation">.</span><span class="token function">RawWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>word<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Read</span><span class="token punctuation">(</span>BinaryReader<span class="token operator">&amp;</span> reader<span class="token punctuation">,</span> CountLength<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst<span class="token punctuation">.</span>word <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">RawReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    IgniteConfiguration cfg<span class="token punctuation">;</span>
    cfg<span class="token punctuation">.</span>springCfgPath <span class="token operator">=</span> <span class="token string">&quot;/path/to/configuration.xml&quot;</span><span class="token punctuation">;</span>

    Ignite ignite <span class="token operator">=</span> Ignition<span class="token operator">::</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get binding instance.</span>
    IgniteBinding binding <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Registering our class as a compute function.</span>
    binding<span class="token punctuation">.</span>RegisterComputeFunc<span class="token operator">&lt;</span>CountLength<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get compute instance.</span>
    compute<span class="token operator">::</span>Compute compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    std<span class="token operator">::</span>istringstream <span class="token function">iss</span><span class="token punctuation">(</span><span class="token string">&quot;How many characters&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span> <span class="token function">words</span><span class="token punctuation">(</span><span class="token punctuation">(</span>std<span class="token operator">::</span>istream_iterator<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span>iss<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        std<span class="token operator">::</span>istream_iterator<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int32_t</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// Iterate through all words in the sentence, create and call jobs.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>string word <span class="token operator">:</span> words<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Add word length received from cluster node.</span>
        total <span class="token operator">+=</span> compute<span class="token punctuation">.</span>Call<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function">CountLength</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <h4 id="_1-3-3-执行igniteclosure任务"><a href="#_1-3-3-执行igniteclosure任务" class="header-anchor">#</a> 1.3.3.执行IgniteClosure任务</h4> <p>执行<code>IgniteClosure</code>，需要调用计算接口的<code>apply(…​)</code>方法。该方法接受一个任务及其输入参数，该参数会在执行时传给<code>IgniteClosure</code>。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IgniteCompute</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Execute closure on all cluster nodes.</span>
<span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> res <span class="token operator">=</span> compute<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">length</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;How many characters&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add all the word lengths received from cluster nodes.</span>
<span class="token keyword">int</span> total <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">intValue</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">CharCountingFunc</span> <span class="token punctuation">:</span> <span class="token class-name">IComputeFunc</span><span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">string</span> arg<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> arg<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
        <span class="token punctuation">{</span>
            DiscoverySpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoverySpi</span>
            <span class="token punctuation">{</span>
                LocalPort <span class="token operator">=</span> <span class="token number">48500</span><span class="token punctuation">,</span>
                LocalPortRange <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
                IpFinder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoveryStaticIpFinder</span>
                <span class="token punctuation">{</span>
                    Endpoints <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
                    <span class="token punctuation">{</span>
                        <span class="token string">&quot;127.0.0.1:48500..48520&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> res <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CharCountingFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;How many characters&quot;</span><span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> total <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <h4 id="_1-3-4-执行广播任务"><a href="#_1-3-4-执行广播任务" class="header-anchor">#</a> 1.3.4.执行广播任务</h4> <p><code>broadcast()</code>方法会在与计算实例相关联的所有节点上执行任务。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Limit broadcast to remote nodes only.</span>
<span class="token class-name">IgniteCompute</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span>ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forRemotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Print out hello message on remote nodes in the cluster group.</span>
compute<span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Node: &quot;</span> <span class="token operator">+</span> ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">localNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">PrintNodeIdAction</span> <span class="token punctuation">:</span> <span class="token class-name">IComputeAction</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Hello node: &quot;</span> <span class="token operator">+</span>
                          Ignition<span class="token punctuation">.</span><span class="token function">GetIgnite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetLocalNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">BroadcastDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
        <span class="token punctuation">{</span>
            DiscoverySpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoverySpi</span>
            <span class="token punctuation">{</span>
                LocalPort <span class="token operator">=</span> <span class="token number">48500</span><span class="token punctuation">,</span>
                LocalPortRange <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
                IpFinder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoveryStaticIpFinder</span>
                <span class="token punctuation">{</span>
                    Endpoints <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
                    <span class="token punctuation">{</span>
                        <span class="token string">&quot;127.0.0.1:48500..48520&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Limit broadcast to remote nodes only.</span>
    <span class="token keyword">var</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ForRemotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Print out hello message on remote nodes in the cluster group.</span>
    compute<span class="token punctuation">.</span><span class="token function">Broadcast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrintNodeIdAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c++" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/*
 * Function class.
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token operator">:</span> <span class="token keyword">public</span> compute<span class="token operator">::</span>ComputeFunc<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">friend</span> <span class="token keyword">struct</span> <span class="token class-name">ignite</span><span class="token operator">::</span>binary<span class="token operator">::</span>BinaryType<span class="token operator">&lt;</span>Hello<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">/*
     * Default constructor.
     */</span>
    <span class="token function">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// No-op.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Callback.
     */</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Hello&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Binary type structure. Defines a set of functions required for type to be serialized and deserialized.
 */</span>
<span class="token keyword">namespace</span> ignite
<span class="token punctuation">{</span>
    <span class="token keyword">namespace</span> binary
    <span class="token punctuation">{</span>
        <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>
        <span class="token keyword">struct</span> <span class="token class-name">BinaryType</span><span class="token operator">&lt;</span>Hello<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetTypeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">GetBinaryStringHashCode</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetTypeName</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetFieldId</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">GetBinaryStringHashCode</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetHashCode</span><span class="token punctuation">(</span><span class="token keyword">const</span> Hello<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token keyword">const</span> Hello<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetNull</span><span class="token punctuation">(</span>Hello<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst <span class="token operator">=</span> <span class="token function">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Write</span><span class="token punctuation">(</span>BinaryWriter<span class="token operator">&amp;</span> writer<span class="token punctuation">,</span> <span class="token keyword">const</span> Hello<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// No-op.</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Read</span><span class="token punctuation">(</span>BinaryReader<span class="token operator">&amp;</span> reader<span class="token punctuation">,</span> Hello<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// No-op.</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    IgniteConfiguration cfg<span class="token punctuation">;</span>
    cfg<span class="token punctuation">.</span>springCfgPath <span class="token operator">=</span> <span class="token string">&quot;/path/to/configuration.xml&quot;</span><span class="token punctuation">;</span>

    Ignite ignite <span class="token operator">=</span> Ignition<span class="token operator">::</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get binding instance.</span>
    IgniteBinding binding <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Registering our class as a compute function.</span>
    binding<span class="token punctuation">.</span>RegisterComputeFunc<span class="token operator">&lt;</span>Hello<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Broadcast to all nodes.</span>
    compute<span class="token operator">::</span>Compute compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Declaring function instance.</span>
    Hello hello<span class="token punctuation">;</span>

    <span class="token comment">// Print out hello message on nodes in the cluster group.</span>
    compute<span class="token punctuation">.</span><span class="token function">Broadcast</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <h4 id="_1-3-5-异步执行"><a href="#_1-3-5-异步执行" class="header-anchor">#</a> 1.3.5.异步执行</h4> <p>前述所有方法都有对应的异步实现。</p> <ul><li><code>callAsync(…​)</code>；</li> <li><code>runAsync(…​)</code>;</li> <li><code>applyAsync(…​)</code>;</li> <li><code>broadcastAsync(…​)</code>。</li></ul> <p>异步方法会返回一个表示执行结果的<code>IgniteFuture</code>，在下面的示例中，会异步执行一组Callable任务：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IgniteCompute</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IgniteCallable</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> calls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Iterate through all words in the sentence and create callable jobs.</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> word <span class="token operator">:</span> <span class="token string">&quot;Count characters using a callable&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    calls<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>word<span class="token operator">::</span><span class="token function">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Collection</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> compute<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span>calls<span class="token punctuation">)</span><span class="token punctuation">;</span>

future<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>fut <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Total number of characters.</span>
    <span class="token keyword">int</span> total <span class="token operator">=</span> fut<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">intValue</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Total number of characters: &quot;</span> <span class="token operator">+</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">CharCounter</span> <span class="token punctuation">:</span> <span class="token class-name">IComputeFunc</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token keyword">string</span> arg<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CharCounter</span><span class="token punctuation">(</span><span class="token keyword">string</span> arg<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>arg <span class="token operator">=</span> arg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> arg<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">AsyncDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
        <span class="token punctuation">{</span>
            DiscoverySpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoverySpi</span>
            <span class="token punctuation">{</span>
                LocalPort <span class="token operator">=</span> <span class="token number">48500</span><span class="token punctuation">,</span>
                LocalPortRange <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
                IpFinder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoveryStaticIpFinder</span>
                <span class="token punctuation">{</span>
                    Endpoints <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
                    <span class="token punctuation">{</span>
                        <span class="token string">&quot;127.0.0.1:48500..48520&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> calls <span class="token operator">=</span> <span class="token string">&quot;Count character using async compute&quot;</span>
        <span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">CharCounter</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> future <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">CallAsync</span><span class="token punctuation">(</span>calls<span class="token punctuation">)</span><span class="token punctuation">;</span>

    future<span class="token punctuation">.</span><span class="token function">ContinueWith</span><span class="token punctuation">(</span>fut <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> total <span class="token operator">=</span> fut<span class="token punctuation">.</span>Result<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Total number of characters: &quot;</span> <span class="token operator">+</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c++" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/*
 * Function class.
 */</span>
<span class="token keyword">class</span> <span class="token class-name">CountLength</span> <span class="token operator">:</span> <span class="token keyword">public</span> compute<span class="token operator">::</span>ComputeFunc<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">friend</span> <span class="token keyword">struct</span> <span class="token class-name">ignite</span><span class="token operator">::</span>binary<span class="token operator">::</span>BinaryType<span class="token operator">&lt;</span>CountLength<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">/*
     * Default constructor.
     */</span>
    <span class="token function">CountLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// No-op.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
     * Constructor.
     *
     * @param text Text.
     */</span>
    <span class="token function">CountLength</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> word<span class="token punctuation">)</span> <span class="token operator">:</span>
        <span class="token function">word</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// No-op.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Callback.
     * Counts number of characters in provided word.
     *
     * @return Word's length.
     */</span>
    <span class="token keyword">virtual</span> <span class="token keyword">int32_t</span> <span class="token function">Call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/** Word to print. */</span>
    std<span class="token operator">::</span>string word<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Binary type structure. Defines a set of functions required for type to be serialized and deserialized.
 */</span>
<span class="token keyword">namespace</span> ignite
<span class="token punctuation">{</span>
    <span class="token keyword">namespace</span> binary
    <span class="token punctuation">{</span>
        <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>
        <span class="token keyword">struct</span> <span class="token class-name">BinaryType</span><span class="token operator">&lt;</span>CountLength<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetTypeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">GetBinaryStringHashCode</span><span class="token punctuation">(</span><span class="token string">&quot;CountLength&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetTypeName</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst <span class="token operator">=</span> <span class="token string">&quot;CountLength&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetFieldId</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">GetBinaryStringHashCode</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetHashCode</span><span class="token punctuation">(</span><span class="token keyword">const</span> CountLength<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token keyword">const</span> CountLength<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetNull</span><span class="token punctuation">(</span>CountLength<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst <span class="token operator">=</span> <span class="token function">CountLength</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Write</span><span class="token punctuation">(</span>BinaryWriter<span class="token operator">&amp;</span> writer<span class="token punctuation">,</span> <span class="token keyword">const</span> CountLength<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                writer<span class="token punctuation">.</span><span class="token function">RawWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>word<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Read</span><span class="token punctuation">(</span>BinaryReader<span class="token operator">&amp;</span> reader<span class="token punctuation">,</span> CountLength<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst<span class="token punctuation">.</span>word <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">RawReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    IgniteConfiguration cfg<span class="token punctuation">;</span>
    cfg<span class="token punctuation">.</span>springCfgPath <span class="token operator">=</span> <span class="token string">&quot;/path/to/configuration.xml&quot;</span><span class="token punctuation">;</span>

    Ignite ignite <span class="token operator">=</span> Ignition<span class="token operator">::</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get binding instance.</span>
    IgniteBinding binding <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Registering our class as a compute function.</span>
    binding<span class="token punctuation">.</span>RegisterComputeFunc<span class="token operator">&lt;</span>CountLength<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get compute instance.</span>
    compute<span class="token operator">::</span>Compute asyncCompute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    std<span class="token operator">::</span>istringstream <span class="token function">iss</span><span class="token punctuation">(</span><span class="token string">&quot;Count characters using callable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span> <span class="token function">words</span><span class="token punctuation">(</span><span class="token punctuation">(</span>std<span class="token operator">::</span>istream_iterator<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span>iss<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        std<span class="token operator">::</span>istream_iterator<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>Future<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token operator">&gt;&gt;</span> futures<span class="token punctuation">;</span>

    <span class="token comment">// Iterate through all words in the sentence, create and call jobs.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>string word <span class="token operator">:</span> words<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Counting number of characters remotely.</span>
        futures<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>asyncCompute<span class="token punctuation">.</span>CallAsync<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function">CountLength</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int32_t</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// Counting total number of characters.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>Future<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token operator">&gt;</span> future <span class="token operator">:</span> futures<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Waiting for results.</span>
        future<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        total <span class="token operator">+=</span> future<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Printing result.</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Total number of characters: &quot;</span> <span class="token operator">&lt;&lt;</span> total <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <h3 id="_1-4-任务执行超时"><a href="#_1-4-任务执行超时" class="header-anchor">#</a> 1.4.任务执行超时</h3> <p>任务执行可以配置一个超时时间，如果任务未在指定时间段内完成，该任务会被停止，并且由该任务生成的作业也都会被取消。</p> <p>要执行带有超时限制的任务，需要使用计算接口的<code>withTimeout(…​)</code>方法。该方法会返回一个计算接口，然后以给定的时限执行第一个任务，后续的任务并没有超时限制，需要为每一个需要超时限制的任务调用<code>withTimeout(…​)</code>方法。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IgniteCompute</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

compute<span class="token punctuation">.</span><span class="token function">withTimeout</span><span class="token punctuation">(</span><span class="token number">300_000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// your computation</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-5-本地节点内作业共享状态"><a href="#_1-5-本地节点内作业共享状态" class="header-anchor">#</a> 1.5.本地节点内作业共享状态</h3> <p>通常来说在一个节点内的不同的计算作业之间共享状态是很有用的，为此Ignite在每个节点上提供了一个共享节点局部变量。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IgniteCluster</span> cluster <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> nodeLocalMap <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">nodeLocalMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>节点局部变量类似于非分布式的线程局部变量，它只会保持在本地节点上。节点局部变量可以用于计算任务在不同的执行中共享状态，也可以用于部署的服务。</p> <p>在下面的示例中，作业每次在某个节点上执行时，都会在本地节点上增加一个计数器。结果是每个节点上的本地节点计数器会显示该作业在该节点上执行了多少次。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IgniteCallable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> job <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteCallable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@IgniteInstanceResource</span>
    <span class="token keyword">private</span> <span class="token class-name">Ignite</span> ignite<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Get a reference to node local.</span>
        <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">&gt;</span></span> nodeLocalMap <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nodeLocalMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">AtomicLong</span> cntr <span class="token operator">=</span> nodeLocalMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;counter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>cntr <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">AtomicLong</span> old <span class="token operator">=</span> nodeLocalMap<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span><span class="token string">&quot;counter&quot;</span><span class="token punctuation">,</span> cntr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>old <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                cntr <span class="token operator">=</span> old<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> cntr<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-6-从计算任务访问数据"><a href="#_1-6-从计算任务访问数据" class="header-anchor">#</a> 1.6.从计算任务访问数据</h3> <p>如果计算任务需要访问Ignite中存储的数据，那么可以通过<code>Ignite</code>实例实现：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCallableTask</span> <span class="token keyword">implements</span> <span class="token class-name">IgniteCallable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@IgniteInstanceResource</span>
    <span class="token keyword">private</span> <span class="token class-name">Ignite</span> ignite<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">IgniteCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Get the data you need</span>
        <span class="token class-name">Person</span> person <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// do with the data what you need to do</span>

        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">FuncWithDataAccess</span> <span class="token punctuation">:</span> <span class="token class-name">IComputeFunc</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token class-name">InstanceResource</span><span class="token punctuation">]</span> <span class="token keyword">private</span> <span class="token class-name">IIgnite</span> _ignite<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> cache <span class="token operator">=</span> _ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;someCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// get the data you need</span>
        <span class="token keyword">string</span> cached <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// do with data what you need to do, for example:</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>cached<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c++" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/*
 * Function class.
 */</span>
<span class="token keyword">class</span> <span class="token class-name">GetValue</span> <span class="token operator">:</span> <span class="token keyword">public</span> compute<span class="token operator">::</span>ComputeFunc<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">friend</span> <span class="token keyword">struct</span> <span class="token class-name">ignite</span><span class="token operator">::</span>binary<span class="token operator">::</span>BinaryType<span class="token operator">&lt;</span>GetValue<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">/*
     * Default constructor.
     */</span>
    <span class="token function">GetValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// No-op.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Callback.
     */</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Ignite<span class="token operator">&amp;</span> node <span class="token operator">=</span> <span class="token function">GetIgnite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Get the data you need</span>
        Cache<span class="token operator">&lt;</span><span class="token keyword">int64_t</span><span class="token punctuation">,</span> Person<span class="token operator">&gt;</span> cache <span class="token operator">=</span> node<span class="token punctuation">.</span>GetCache<span class="token operator">&lt;</span><span class="token keyword">int64_t</span><span class="token punctuation">,</span> Person<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// do with the data what you need to do</span>
        Person person <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <p>注意，上面的示例可能不是最有效的方法。原因是与键<code>1</code>相对应的<code>Person</code>对象可能不在当前任务执行的节点上。这时对象是通过网络获取的，通过将<a href="#_8-%E8%AE%A1%E7%AE%97%E5%92%8C%E6%95%B0%E6%8D%AE%E5%B9%B6%E7%BD%AE">计算与数据并置</a>可以避免这种情况。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>如果要在<code>IgniteCallable</code>和<code>IgniteRunnable</code>任务中使用键和值对象，那么要确保相关的类定义部署在所有的节点上。</p></div> <h2 id="_2-集群组"><a href="#_2-集群组" class="header-anchor">#</a> 2.集群组</h2> <p><code>ClusterGroup</code>表示集群内节点的一个逻辑组。当希望把特定的操作限定在一个节点子集中时（而不是整个集群），可以在Ignite的许多API中使用该接口。例如希望仅在远程节点上部署服务，或者仅在具有特定属性的节点集上执行作业等。</p> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p>注意<code>IgniteCluster</code>接口也是一个集群组，只不过包括集群内的所有节点。</p></div> <p>可以限制作业执行、服务部署、消息、事件以及其它任务只在部分集群组内执行，比如，下面的示例只把作业广播到远程节点（除了本地节点）：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Ignite</span> ignite <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">ignite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteCluster</span> cluster <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get compute instance which will only execute</span>
<span class="token comment">// over remote nodes, i.e. all the nodes except for this one.</span>
<span class="token class-name">IgniteCompute</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span>cluster<span class="token punctuation">.</span><span class="token function">forRemotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Broadcast to all remote nodes and print the ID of the node</span>
<span class="token comment">// on which this closure is executing.</span>
compute<span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Node: &quot;</span> <span class="token operator">+</span> ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">localNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">PrintNodeIdAction</span> <span class="token punctuation">:</span> <span class="token class-name">IComputeAction</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Hello node: &quot;</span> <span class="token operator">+</span>
                          Ignition<span class="token punctuation">.</span><span class="token function">GetIgnite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetLocalNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">RemotesBroadcastDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> cluster <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get compute instance which will only execute</span>
    <span class="token comment">// over remote nodes, i.e. all the nodes except for this one.</span>
    <span class="token keyword">var</span> compute <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">ForRemotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Broadcast to all remote nodes and print the ID of the node</span>
    <span class="token comment">// on which this closure is executing.</span>
    compute<span class="token punctuation">.</span><span class="token function">Broadcast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrintNodeIdAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <p>为了方便，Ignite也有一些预定义的集群组：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IgniteCluster</span> cluster <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All nodes on which the cache with name &quot;myCache&quot; is deployed,</span>
<span class="token comment">// either in client or server mode.</span>
<span class="token class-name">ClusterGroup</span> cacheGroup <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">forCacheNodes</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All data nodes responsible for caching data for &quot;myCache&quot;.</span>
<span class="token class-name">ClusterGroup</span> dataGroup <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">forDataNodes</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All client nodes that can access &quot;myCache&quot;.</span>
<span class="token class-name">ClusterGroup</span> clientGroup <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">forClientNodes</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cluster <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All nodes on which cache with name &quot;myCache&quot; is deployed,</span>
<span class="token comment">// either in client or server mode.</span>
<span class="token keyword">var</span> cacheGroup <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">ForCacheNodes</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All data nodes responsible for caching data for &quot;myCache&quot;.</span>
<span class="token keyword">var</span> dataGroup <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">ForDataNodes</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// All client nodes that access &quot;myCache&quot;.</span>
<span class="token keyword">var</span> clientGroup <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">ForClientNodes</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h2 id="_3-executorservice"><a href="#_3-executorservice" class="header-anchor">#</a> 3.ExecutorService</h2> <p>Ignite提供了一个<code>java.util.concurrent.ExecutorService</code>接口的分布式实现，该实现将任务提交到集群的服务端节点执行。任务在整个集群中负载平衡，只要集群中至少有一个节点，就可以保证任务得到执行。</p> <p><code>ExecutorService</code>可以通过<code>Ignite</code>实例获得：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Get cluster-enabled executor service.</span>
<span class="token class-name">ExecutorService</span> exec <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">executorService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Iterate through all words in the sentence and create jobs.</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> word <span class="token operator">:</span> <span class="token string">&quot;Print words using runnable&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Execute runnable on some node.</span>
    exec<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt; Printing '&quot;</span> <span class="token operator">+</span> word <span class="token operator">+</span> <span class="token string">&quot;' on this node from grid job.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>也可以限制作业在一个<a href="#_2-%E9%9B%86%E7%BE%A4%E7%BB%84">集群组</a>中执行：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// A group for nodes where the attribute 'worker' is defined.</span>
<span class="token class-name">ClusterGroup</span> workerGrp <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;ROLE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;worker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get an executor service for the cluster group.</span>
<span class="token class-name">ExecutorService</span> exec <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">executorService</span><span class="token punctuation">(</span>workerGrp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_4-mapreduce-api"><a href="#_4-mapreduce-api" class="header-anchor">#</a> 4.MapReduce API</h2> <h3 id="_4-1-概述"><a href="#_4-1-概述" class="header-anchor">#</a> 4.1.概述</h3> <p>Ignite提供了用于执行简化的MapReduce操作的API。MapReduce范式基于以下假设：要执行的任务可以被拆分为多个作业（映射阶段），并分别执行每个作业，然后每个作业的结果汇总到最终结果中（汇总阶段）。</p> <p>Ignite中，作业是根据预配置的<a href="#_5-%E8%B4%9F%E8%BD%BD%E5%B9%B3%E8%A1%A1">负载平衡策略</a>在节点间分配的，结果会被汇总在提交任务的节点上。</p> <p>MapReduce范式由<code>ComputeTask</code>接口提供。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p><code>ComputeTask</code>仅在需要对作业到节点的映射或自定义故障转移逻辑进行细粒度控制时使用，对于其他情况，都建议使用简单的<a href="#_1-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97api">闭包</a>。</p></div> <h3 id="_4-2-computetask接口"><a href="#_4-2-computetask接口" class="header-anchor">#</a> 4.2.ComputeTask接口</h3> <p><code>ComputeTask</code>接口提供了一种实现自定义映射和汇总逻辑的方法，该接口有3个方法：<code>map(…​)</code>、<code>result()</code>和<code>reduce()</code>。</p> <p><code>map()</code>用于根据输入参数创建计算作业并将其映射到工作节点。该方法参数为要在其上运行任务的集群节点集合以及任务的输入参数。该方法会返回一个映射，其中作业为键，映射的工作节点为值，然后将作业发送到映射的节点并在其中执行。</p> <p><code>result()</code>会在完成每个作业后调用，并返回一个<code>ComputeJobResultPolicy</code>指示如何继续执行任务的实例。该方法参数为作业的结果以及到目前为止接收到的所有作业结果的列表，该方法可能返回以下值之一：</p> <ul><li><code>WAIT</code>：等待所有剩余工作完成（如果有）；</li> <li><code>REDUCE</code>：立即进入汇总阶段，丢弃所有剩余的作业和尚未收到的结果；</li> <li><code>FAILOVER</code>：将作业故障转移到另一个节点（请参见<a href="#_6-%E5%AE%B9%E9%94%99">容错</a>章节的介绍）。</li></ul> <p>当所有作业都已完成（或<code>result()</code>方法中某个作业返回<code>REDUCE</code>策略）时，在汇总阶段中会调用<code>reduce()</code>方法。该方法参数为具有所有完成结果的列表，并返回计算的最终结果。</p> <h3 id="_4-3-执行计算任务"><a href="#_4-3-执行计算任务" class="header-anchor">#</a> 4.3.执行计算任务</h3> <p>要执行计算任务，需调用<code>IgniteCompute.execute(…​)</code>方法，并将输入参数作为最后一个参数传入。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Ignite</span> ignite <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteCompute</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> count <span class="token operator">=</span> compute<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CharacterCountTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello Grid Enabled World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">CharCountComputeJob</span> <span class="token punctuation">:</span> <span class="token class-name">IComputeJob</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token keyword">string</span> _arg<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CharCountComputeJob</span><span class="token punctuation">(</span><span class="token keyword">string</span> arg<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt; Printing '&quot;</span> <span class="token operator">+</span> arg <span class="token operator">+</span> <span class="token string">&quot;' from compute job.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_arg <span class="token operator">=</span> arg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _arg<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">System<span class="token punctuation">.</span>NotImplementedException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">CharCountTask</span> <span class="token punctuation">:</span> <span class="token class-name">IComputeTask</span><span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> IDictionary<span class="token operator">&lt;</span>IComputeJob<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> IClusterNode<span class="token operator">&gt;</span> <span class="token function">Map</span><span class="token punctuation">(</span>IList<span class="token operator">&lt;</span>IClusterNode<span class="token operator">&gt;</span> subgrid<span class="token punctuation">,</span> <span class="token keyword">string</span> arg<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dictionary</span><span class="token operator">&lt;</span>IComputeJob<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> IClusterNode<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> enumerator <span class="token operator">=</span> subgrid<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">var</span> s <span class="token keyword">in</span> arg<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>enumerator<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    enumerator<span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    enumerator<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                map<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CharCountComputeJob</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span> enumerator<span class="token punctuation">.</span>Current<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">ComputeJobResultPolicy</span> <span class="token function">OnResult</span><span class="token punctuation">(</span>IComputeJobResult<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> res<span class="token punctuation">,</span> IList<span class="token operator">&lt;</span>IComputeJobResult<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span> rcvd<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// If there is no exception, wait for all job results.</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span>Exception <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">?</span> ComputeJobResultPolicy<span class="token punctuation">.</span>Failover <span class="token punctuation">:</span> ComputeJobResultPolicy<span class="token punctuation">.</span>Wait<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">Reduce</span><span class="token punctuation">(</span>IList<span class="token operator">&lt;</span>IComputeJobResult<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span> results<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> results<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">MapReduceComputeJobDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
    <span class="token punctuation">{</span>
        DiscoverySpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoverySpi</span>
        <span class="token punctuation">{</span>
            LocalPort <span class="token operator">=</span> <span class="token number">48500</span><span class="token punctuation">,</span>
            LocalPortRange <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
            IpFinder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoveryStaticIpFinder</span>
            <span class="token punctuation">{</span>
                Endpoints <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;127.0.0.1:48500..48520&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> res <span class="token operator">=</span> compute<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CharCountTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello Grid Please Count Chars In These Words&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;res=&quot;</span> <span class="token operator">+</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <p>通过使用<a href="#_2-%E9%9B%86%E7%BE%A4%E7%BB%84">集群组</a>，可以将作业的执行限制在节点的子集上。</p> <h3 id="_4-4-处理作业故障"><a href="#_4-4-处理作业故障" class="header-anchor">#</a> 4.4.处理作业故障</h3> <p>如果节点在任务执行期间故障，则为该节点安排的所有作业都会自动发送到另一个可用节点（由于内置的故障转移机制）。但是，如果作业引发异常，则可以将作业视为失败，然后将其转移到另一个节点以重新执行，该行为可通过在<code>result(…​)</code>方法中返回<code>FAILOVER</code>实现：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">ComputeJobResultPolicy</span> <span class="token function">result</span><span class="token punctuation">(</span><span class="token class-name">ComputeJobResult</span> res<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComputeJobResult</span><span class="token punctuation">&gt;</span></span> rcvd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">IgniteException</span> err <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">getException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token class-name">ComputeJobResultPolicy</span><span class="token punctuation">.</span>FAILOVER<span class="token punctuation">;</span>

    <span class="token comment">// If there is no exception, wait for all job results.</span>
    <span class="token keyword">return</span> <span class="token class-name">ComputeJobResultPolicy</span><span class="token punctuation">.</span>WAIT<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-5-计算任务适配器"><a href="#_4-5-计算任务适配器" class="header-anchor">#</a> 4.5.计算任务适配器</h3> <p>有几个辅助类，可以提供<code>result(…​)</code>和<code>map(…​)</code>的常用实现。</p> <ul><li><code>ComputeTaskAdapter</code>：其定义了一个默认的<code>result(...)</code>方法实现，它在当一个作业抛出异常时返回一个<code>FAILOVER</code>策略，否则会返回一个<code>WAIT</code>策略，这样会等待所有的作业完成，并且有结果；</li> <li><code>ComputeTaskSplitAdapter</code>：其继承了<code>ComputeTaskAdapter</code>,然后实现了<code>map(...)</code>以将作业自动分配给节点。他引入了一个新的<code>split(...)</code>方法，可以实现根据输入的数据生成作业的逻辑。</li></ul> <h3 id="_4-6-分布式任务会话"><a href="#_4-6-分布式任务会话" class="header-anchor">#</a> 4.6.分布式任务会话</h3> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>该功能在.NET/C#/C++中不可用。</p></div> <p>对于每个任务，Ignite会创建一个分布式会话，该会话保存有关任务的信息，并且对任务本身及其派生的所有作业都可见。可以使用此会话在作业之间共享属性，属性可以在作业执行之前或期间分配，并且可以按照设置它们的顺序对其他作业可见。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ComputeTaskSessionFullSupport</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">TaskSessionAttributesTask</span> <span class="token keyword">extends</span> <span class="token class-name">ComputeTaskSplitAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">ComputeJob</span><span class="token punctuation">&gt;</span></span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">int</span> gridSize<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComputeJob</span><span class="token punctuation">&gt;</span></span> jobs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Generate jobs by number of nodes in the grid.</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> gridSize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            jobs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ComputeJobAdapter</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Auto-injected task session.</span>
                <span class="token annotation punctuation">@TaskSessionResource</span>
                <span class="token keyword">private</span> <span class="token class-name">ComputeTaskSession</span> ses<span class="token punctuation">;</span>

                <span class="token comment">// Auto-injected job context.</span>
                <span class="token annotation punctuation">@JobContextResource</span>
                <span class="token keyword">private</span> <span class="token class-name">ComputeJobContext</span> jobCtx<span class="token punctuation">;</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// Perform STEP1.</span>
                    <span class="token comment">// ...</span>

                    <span class="token comment">// Tell other jobs that STEP1 is complete.</span>
                    ses<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>jobCtx<span class="token punctuation">.</span><span class="token function">getJobId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;STEP1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// Wait for other jobs to complete STEP1.</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ComputeJobSibling</span> sibling <span class="token operator">:</span> ses<span class="token punctuation">.</span><span class="token function">getJobSiblings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            ses<span class="token punctuation">.</span><span class="token function">waitForAttribute</span><span class="token punctuation">(</span>sibling<span class="token punctuation">.</span><span class="token function">getJobId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;STEP1&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                    <span class="token comment">// Move on to STEP2.</span>
                    <span class="token comment">// ...</span>

                    <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> jobs<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComputeJobResult</span><span class="token punctuation">&gt;</span></span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// No-op.</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-7-计算任务示例"><a href="#_4-7-计算任务示例" class="header-anchor">#</a> 4.7.计算任务示例</h3> <p>下面的示例演示了一个字符计数应用，他将一个给定的字符串拆分为单词，然后在单独的作业中计算每个单词的长度，作业会分发到所有的集群节点上。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ComputeTaskExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CharacterCountTask</span> <span class="token keyword">extends</span> <span class="token class-name">ComputeTaskSplitAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. Splits the received string into words</span>
        <span class="token comment">// 2. Creates a child job for each word</span>
        <span class="token comment">// 3. Sends the jobs to other nodes for processing.</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComputeJob</span><span class="token punctuation">&gt;</span></span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">int</span> gridSize<span class="token punctuation">,</span> <span class="token class-name">String</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> words <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComputeJob</span><span class="token punctuation">&gt;</span></span> jobs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>words<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> word <span class="token operator">:</span> words<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                jobs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ComputeJobAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt; Printing '&quot;</span> <span class="token operator">+</span> word <span class="token operator">+</span> <span class="token string">&quot;' on from compute job.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">// Return the number of letters in the word.</span>
                        <span class="token keyword">return</span> word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> jobs<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComputeJobResult</span><span class="token punctuation">&gt;</span></span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ComputeJobResult</span> res <span class="token operator">:</span> results<span class="token punctuation">)</span>
                sum <span class="token operator">+=</span> res<span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Ignite</span> ignite <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">IgniteCompute</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Execute the task on the cluster and wait for its completion.</span>
        <span class="token keyword">int</span> cnt <span class="token operator">=</span> compute<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">CharacterCountTask</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello Grid Enabled World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt; Total number of characters in the phrase is '&quot;</span> <span class="token operator">+</span> cnt <span class="token operator">+</span> <span class="token string">&quot;'.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">CharCountComputeJob</span> <span class="token punctuation">:</span> <span class="token class-name">IComputeJob</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token keyword">string</span> _arg<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CharCountComputeJob</span><span class="token punctuation">(</span><span class="token keyword">string</span> arg<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt; Printing '&quot;</span> <span class="token operator">+</span> arg <span class="token operator">+</span> <span class="token string">&quot;' from compute job.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_arg <span class="token operator">=</span> arg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _arg<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">System<span class="token punctuation">.</span>NotImplementedException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ComputeTaskExample</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">CharacterCountTask</span> <span class="token punctuation">:</span> <span class="token class-name">ComputeTaskSplitAdapter</span><span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token keyword">int</span> <span class="token function">Reduce</span><span class="token punctuation">(</span>IList<span class="token operator">&lt;</span>IComputeJobResult<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span> results<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> results<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">override</span> ICollection<span class="token operator">&lt;</span>IComputeJob<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span> <span class="token function">Split</span><span class="token punctuation">(</span><span class="token keyword">int</span> gridSize<span class="token punctuation">,</span> <span class="token keyword">string</span> arg<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> arg<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>word <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">CharCountComputeJob</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span>Cast<span class="token operator">&lt;</span>IComputeJob<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">RunComputeTaskExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
        <span class="token punctuation">{</span>
            DiscoverySpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoverySpi</span>
            <span class="token punctuation">{</span>
                LocalPort <span class="token operator">=</span> <span class="token number">48500</span><span class="token punctuation">,</span>
                LocalPortRange <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>
                IpFinder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoveryStaticIpFinder</span>
                <span class="token punctuation">{</span>
                    Endpoints <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
                    <span class="token punctuation">{</span>
                        <span class="token string">&quot;127.0.0.1:48500..48520&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">var</span> cnt <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CharacterCountTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello Grid Enabled World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt; Total number of characters in the phrase is '&quot;</span> <span class="token operator">+</span> cnt <span class="token operator">+</span> <span class="token string">&quot;'.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <h2 id="_5-负载平衡"><a href="#_5-负载平衡" class="header-anchor">#</a> 5.负载平衡</h2> <p>Ignite会对由<a href="#_4-mapreduce-api">计算任务</a>产生的作业以及通过分布式计算API提交的单个任务自动负载平衡，通过<code>IgniteCompute.run(…​)</code>和其他计算方法提交的单个任务会被视为单个作业的任务。</p> <p>Ignite默认使用轮询算法（<code>RoundRobinLoadBalancingSpi</code>），该算法在为计算任务指定的节点上按顺序分配作业。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>负载平衡不适用于<a href="#_8-%E8%AE%A1%E7%AE%97%E5%92%8C%E6%95%B0%E6%8D%AE%E5%B9%B6%E7%BD%AE">并置计算</a>。</p></div> <p>负载平衡算法由<code>IgniteConfiguration.loadBalancingSpi</code>属性控制。</p> <h3 id="_5-1-轮询式负载均衡"><a href="#_5-1-轮询式负载均衡" class="header-anchor">#</a> 5.1.轮询式负载均衡</h3> <p><code>RoundRobinLoadBalancingSpi</code>以轮询方式遍历并选择下一个可用的节点，可用节点是在执行任务<a href="#_1-1-%E8%8E%B7%E5%8F%96%E8%AE%A1%E7%AE%97%E6%8E%A5%E5%8F%A3%E5%AE%9E%E4%BE%8B">获取计算实例</a>时定义的。</p> <p>轮询式负载平衡支持两种操作模式：任务级和全局级。</p> <p>如果配置成任务级模式，当任务开始执行时实现会随机地选择一个节点，然后会顺序地迭代拓扑中所有的节点，对于任务拆分的大小等同于节点的数量时，这个模式保证所有的节点都会参与任务的执行。</p> <div class="custom-block warning"><p class="custom-block-title">警告</p> <p>在任务级模式中需要启用以下事件类型：<code>EVT_TASK_FAILED</code>、<code>EVT_TASK_FINISHED</code>、<code>EVT_JOB_MAPPED</code>。</p></div> <p>如果配置成全局级模式，对于所有的任务都会维护一个节点的单一连续队列然后每次都会从队列中选择一个节点。这个模式中（不像每任务模式），当多个任务并发执行时，即使任务的拆分大小等同于节点的数量，同一个任务的某些作业仍然可能被赋予同一个节点。</p> <p>默认使用全局级模式。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="xml" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token comment">&lt;!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the &quot;License&quot;); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>util</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/util<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>         http://www.springframework.org/schema/beans
         http://www.springframework.org/schema/beans/spring-beans.xsd
         http://www.springframework.org/schema/util
         http://www.springframework.org/schema/util/spring-util.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>includeEventTypes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!--these events are required for the per-task mode--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">util:</span>constant</span> <span class="token attr-name">static-field</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.events.EventType.EVT_TASK_FINISHED<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">util:</span>constant</span> <span class="token attr-name">static-field</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.events.EventType.EVT_TASK_FAILED<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">util:</span>constant</span> <span class="token attr-name">static-field</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.events.EventType.EVT_JOB_MAPPED<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>loadBalancingSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.loadbalancing.roundrobin.RoundRobinLoadBalancingSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- Activate the per-task round-robin mode. --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>perTask<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">RoundRobinLoadBalancingSpi</span> spi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoundRobinLoadBalancingSpi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
spi<span class="token punctuation">.</span><span class="token function">setPerTask</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// these events are required for the per-task mode</span>
cfg<span class="token punctuation">.</span><span class="token function">setIncludeEventTypes</span><span class="token punctuation">(</span><span class="token class-name">EventType</span><span class="token punctuation">.</span>EVT_TASK_FINISHED<span class="token punctuation">,</span> <span class="token class-name">EventType</span><span class="token punctuation">.</span>EVT_TASK_FAILED<span class="token punctuation">,</span> <span class="token class-name">EventType</span><span class="token punctuation">.</span>EVT_JOB_MAPPED<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Override default load balancing SPI.</span>
cfg<span class="token punctuation">.</span><span class="token function">setLoadBalancingSpi</span><span class="token punctuation">(</span>spi<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start a node.</span>
<span class="token class-name">Ignite</span> ignite <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h3 id="_5-2-随机和加权式负载平衡"><a href="#_5-2-随机和加权式负载平衡" class="header-anchor">#</a> 5.2.随机和加权式负载平衡</h3> <p><code>WeightedRandomLoadBalancingSpi</code>会为作业的执行从可用节点列表中随机选择一个节点，也可以选择为节点赋予权值，这样有更高权重的节点最终会使将作业分配给它的机会更多，所有节点的权重默认值都是10。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="xml" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>loadBalancingSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.loadbalancing.weightedrandom.WeightedRandomLoadBalancingSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>useWeights<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>nodeWeight<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">WeightedRandomLoadBalancingSpi</span> spi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeightedRandomLoadBalancingSpi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Configure SPI to use the weighted random load balancing algorithm.</span>
spi<span class="token punctuation">.</span><span class="token function">setUseWeights</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set weight for the local node.</span>
spi<span class="token punctuation">.</span><span class="token function">setNodeWeight</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Override default load balancing SPI.</span>
cfg<span class="token punctuation">.</span><span class="token function">setLoadBalancingSpi</span><span class="token punctuation">(</span>spi<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start a node.</span>
<span class="token class-name">Ignite</span> ignite <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h3 id="_5-3-作业窃取"><a href="#_5-3-作业窃取" class="header-anchor">#</a> 5.3.作业窃取</h3> <p>通常集群由很多计算机组成，这就可能存在配置不均衡的情况，这时开启<code>JobStealingCollisionSpi</code>就会有助于避免作业聚集在过载的节点，因为它们将被未充分利用的节点窃取。</p> <p><code>JobStealingCollisionSpi</code>可以将作业从高负载节点移动到低负载节点，当部分作业完成得很快，而其它的作业还在高负载节点中排队时，这个SPI就会非常有用，这时等待作业就会被移动到更快/低负载的节点。</p> <p><code>JobStealingCollisionSpi</code>采用的是后负载技术，它可以在任务已经被调度在节点A执行后重新分配到节点B。</p> <div class="custom-block warning"><p class="custom-block-title">警告</p> <p>如果要启用作业窃取，则必须将故障转移SPI配置为<code>JobStealingFailoverSpi</code>。具体请参见<a href="#_6-%E5%AE%B9%E9%94%99">容错</a>。</p></div> <p>下面是配置<code>JobStealingCollisionSpi</code>的示例：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="xml" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Enabling the required Failover SPI. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>failoverSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.failover.jobstealing.JobStealingFailoverSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Enabling the JobStealingCollisionSpi for late load balancing. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>collisionSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.collision.jobstealing.JobStealingCollisionSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>activeJobsThreshold<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>50<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>waitJobsThreshold<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>messageExpireTime<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>maximumStealingAttempts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stealingEnabled<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stealingAttributes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>node.segment<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>foobar<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">JobStealingCollisionSpi</span> spi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JobStealingCollisionSpi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Configure number of waiting jobs</span>
<span class="token comment">// in the queue for job stealing.</span>
spi<span class="token punctuation">.</span><span class="token function">setWaitJobsThreshold</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Configure message expire time (in milliseconds).</span>
spi<span class="token punctuation">.</span><span class="token function">setMessageExpireTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Configure stealing attempts number.</span>
spi<span class="token punctuation">.</span><span class="token function">setMaximumStealingAttempts</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Configure number of active jobs that are allowed to execute</span>
<span class="token comment">// in parallel. This number should usually be equal to the number</span>
<span class="token comment">// of threads in the pool (default is 100).</span>
spi<span class="token punctuation">.</span><span class="token function">setActiveJobsThreshold</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Enable stealing.</span>
spi<span class="token punctuation">.</span><span class="token function">setStealingEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set stealing attribute to steal from/to nodes that have it.</span>
spi<span class="token punctuation">.</span><span class="token function">setStealingAttributes</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">&quot;node.segment&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foobar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Enable `JobStealingFailoverSpi`</span>
<span class="token class-name">JobStealingFailoverSpi</span> failoverSpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JobStealingFailoverSpi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Override default Collision SPI.</span>
cfg<span class="token punctuation">.</span><span class="token function">setCollisionSpi</span><span class="token punctuation">(</span>spi<span class="token punctuation">)</span><span class="token punctuation">;</span>

cfg<span class="token punctuation">.</span><span class="token function">setFailoverSpi</span><span class="token punctuation">(</span>failoverSpi<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h2 id="_6-容错"><a href="#_6-容错" class="header-anchor">#</a> 6.容错</h2> <p>Ignite支持作业的自动故障转移，当一个节点崩溃时，作业会被转移到其它可用节点再次执行。集群中只要有一个节点在线，作业就不会丢失。</p> <p>全局故障转移策略由<code>IgniteConfiguration.failoverSpi</code>属性控制。</p> <p>可用的实现包括：</p> <ul><li><code>AlwaysFailoverSpi</code>：该实现会将一个故障的作业路由到另一个节点，这也是默认的模式。当来自一个计算任务的作业失败后，首先会尝试将故障的作业路由到该任务还没有被执行过的节点上，如果没有可用的节点，然后会试图将故障的作业路由到可能运行同一个任务中其它的作业的节点上，如果上述的尝试都失败了，那么该作业就不会被故障转移。</li></ul> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="xml" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>failoverSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.failover.always.AlwaysFailoverSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>maximumFailoverAttempts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">AlwaysFailoverSpi</span> failSpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlwaysFailoverSpi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Override maximum failover attempts.</span>
failSpi<span class="token punctuation">.</span><span class="token function">setMaximumFailoverAttempts</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Override the default failover SPI.</span>
<span class="token class-name">IgniteConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFailoverSpi</span><span class="token punctuation">(</span>failSpi<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start a node.</span>
<span class="token class-name">Ignite</span> ignite <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <ul><li><code>NeverFailoverSpi</code>：该实现不对失败的作业故障转移；</li></ul> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="xml" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>failoverSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.failover.never.NeverFailoverSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">NeverFailoverSpi</span> failSpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NeverFailoverSpi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Override the default failover SPI.</span>
cfg<span class="token punctuation">.</span><span class="token function">setFailoverSpi</span><span class="token punctuation">(</span>failSpi<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start a node.</span>
<span class="token class-name">Ignite</span> ignite <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <ul><li><code>JobStealingFailoverSpi</code>：只有在希望启用<a href="#_5-3-%E4%BD%9C%E4%B8%9A%E7%AA%83%E5%8F%96">作业窃取</a>时，才需要使用这个实现。</li></ul> <h2 id="_7-作业调度"><a href="#_7-作业调度" class="header-anchor">#</a> 7.作业调度</h2> <p>当作业到达目标节点时，会被提交到一个线程池并以随机顺序调度执行，但是通过配置<code>CollisionSpi</code>可以更改作业顺序。<code>CollisionSpi</code>接口提供了一种在每个节点调度作业执行的方法。</p> <p>Ignite提供了<code>CollisionSpi</code>接口的几种实现：</p> <ul><li><code>FifoQueueCollisionSpi</code>：在多个线程中进行简单的FIFO排序，这时默认的实现；</li> <li><code>PriorityQueueCollisionSpi</code>：按优先级排序；</li> <li><code>JobStealingFailoverSpi</code>：该实现用于开启<a href="#_5-3-%E4%BD%9C%E4%B8%9A%E7%AA%83%E5%8F%96">作业窃取</a>。</li></ul> <p><code>CollisionSpi</code>通过<code>IgniteConfiguration.collisionSpi</code>属性来配置。</p> <h3 id="_7-1-fifo排序"><a href="#_7-1-fifo排序" class="header-anchor">#</a> 7.1.FIFO排序</h3> <p><code>FifoQueueCollisionSpi</code>提供了作业到达时的FIFO排序，作业以多线程模式执行。线程数由<code>parallelJobsNumber</code>参数控制，默认值为CPU核数的2倍。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="xml" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>collisionSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.collision.fifoqueue.FifoQueueCollisionSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- Execute one job at a time. --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>parallelJobsNumber<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">FifoQueueCollisionSpi</span> colSpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FifoQueueCollisionSpi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Execute jobs sequentially, one at a time,</span>
<span class="token comment">// by setting parallel job number to 1.</span>
colSpi<span class="token punctuation">.</span><span class="token function">setParallelJobsNumber</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Override default collision SPI.</span>
cfg<span class="token punctuation">.</span><span class="token function">setCollisionSpi</span><span class="token punctuation">(</span>colSpi<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start a node.</span>
<span class="token class-name">Ignite</span> ignite <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h3 id="_7-2-优先级排序"><a href="#_7-2-优先级排序" class="header-anchor">#</a> 7.2.优先级排序</h3> <p>使用<code>PriorityQueueCollisionSpi</code>可以为单独的作业分配优先级，因此高优先级的作业会比低优先级的作业先执行，也可以指定要处理作业的线程数。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="xml" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>collisionSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.collision.priorityqueue.PriorityQueueCollisionSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- Change the parallel job number if needed.
                 Default is number of cores times 2. --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>parallelJobsNumber<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">PriorityQueueCollisionSpi</span> colSpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PriorityQueueCollisionSpi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Change the parallel job number if needed.</span>
<span class="token comment">// Default is number of cores times 2.</span>
colSpi<span class="token punctuation">.</span><span class="token function">setParallelJobsNumber</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Override default collision SPI.</span>
cfg<span class="token punctuation">.</span><span class="token function">setCollisionSpi</span><span class="token punctuation">(</span>colSpi<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start a node.</span>
<span class="token class-name">Ignite</span> ignite <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <p>任务优先级是在任务会话中通过<code>grid.task.priority</code>属性配置的，如果任务未分配优先级，那么会使用默认优先级0。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyUrgentTask</span> <span class="token keyword">extends</span> <span class="token class-name">ComputeTaskSplitAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// Auto-injected task session.</span>
    <span class="token annotation punctuation">@TaskSessionResource</span>
    <span class="token keyword">private</span> <span class="token class-name">ComputeTaskSession</span> taskSes <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComputeJob</span><span class="token punctuation">&gt;</span></span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">int</span> gridSize<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Set high task priority.</span>
        taskSes<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;grid.task.priority&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComputeJob</span><span class="token punctuation">&gt;</span></span> jobs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>gridSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> gridSize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            jobs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ComputeJobAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IgniteException</span> <span class="token punctuation">{</span>

                    <span class="token comment">//your implementation goes here</span>

                    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// These jobs will be executed with higher priority.</span>
        <span class="token keyword">return</span> jobs<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComputeJobResult</span><span class="token punctuation">&gt;</span></span> results<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IgniteException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_8-计算和数据并置"><a href="#_8-计算和数据并置" class="header-anchor">#</a> 8.计算和数据并置</h2> <p>并置计算是一种分布式数据处理模式，其会将在特定数据集上执行的计算任务发送到待处理数据所在的节点，并且仅将计算结果返回。这样可以最大程度减少节点之间的数据传输，并可以显著缩短任务执行时间。</p> <p>Ignite提供了几种执行并置计算的方法，所有这些方法都使用关联函数来确定数据的位置。</p> <p>计算接口提供了<code>affinityCall(…​)</code>和<code>affinityRun(…​)</code>方法，可以通过键或分区将任务和数据并置在一起。</p> <div class="custom-block warning"><p class="custom-block-title">提示</p> <p><code>affinityCall(…​)</code>和<code>affinityRun(…​)</code>方法保证在任务执行期间，给定的键或分区中的数据在目标节点上是存在的。</p></div> <div class="custom-block warning"><p class="custom-block-title">提示</p> <p>待执行任务的类定义必须在远程节点上可用，可以通过两种方式确保这一点：</p> <ul><li>将类添加到节点的类路径；</li> <li>启用<a href="/doc/java/CodeDeployment.html#_2-对等类加载">对等类加载</a>。</li></ul></div> <h3 id="_8-1-通过键并置"><a href="#_8-1-通过键并置" class="header-anchor">#</a> 8.1.通过键并置</h3> <p>要将计算任务发送到给定键所在的节点，可以使用以下方法：</p> <ul><li><code>IgniteCompute.affinityCall(String cacheName, Object key, IgniteCallable&lt;R&gt; job)</code>；</li> <li><code>IgniteCompute.affinityRun(String cacheName, Object key, IgniteRunnable job)</code>；</li></ul> <p>Ignite会调用配置好的关联函数来确定给定键的位置。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IgniteCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteCompute</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">// This closure will execute on the remote node where</span>
<span class="token comment">// data for the given 'key' is located.</span>
compute<span class="token punctuation">.</span><span class="token function">affinityRun</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Peek is a local memory lookup.</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Co-located [key= &quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;, value= &quot;</span> <span class="token operator">+</span> cache<span class="token punctuation">.</span><span class="token function">localPeek</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">MyComputeAction</span> <span class="token punctuation">:</span> <span class="token class-name">IComputeAction</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token class-name">InstanceResource</span><span class="token punctuation">]</span> <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IIgnite</span> _ignite<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> Key <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> cache <span class="token operator">=</span> _ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Peek is a local memory lookup</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Co-located [key= &quot;</span> <span class="token operator">+</span> Key <span class="token operator">+</span> <span class="token string">&quot;, value= &quot;</span> <span class="token operator">+</span> cache<span class="token punctuation">.</span><span class="token function">LocalPeek</span><span class="token punctuation">(</span>Key<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">AffinityRunDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetOrCreateCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;baz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> keyCnt <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> key <span class="token operator">&lt;</span> keyCnt<span class="token punctuation">;</span> key<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// This closure will execute on the remote node where</span>
        <span class="token comment">// data for the given 'key' is located.</span>
        compute<span class="token punctuation">.</span><span class="token function">AffinityRun</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MyComputeAction</span> <span class="token punctuation">{</span>Key <span class="token operator">=</span> key<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c++" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/*
 * Function class.
 */</span>
<span class="token keyword">struct</span> <span class="token class-name">FuncAffinityRun</span> <span class="token operator">:</span> compute<span class="token operator">::</span>ComputeFunc<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">/*
    * Default constructor.
    */</span>
    <span class="token function">FuncAffinityRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// No-op.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
    * Parameterized constructor.
    */</span>
    <span class="token function">FuncAffinityRun</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string cacheName<span class="token punctuation">,</span> <span class="token keyword">int32_t</span> key<span class="token punctuation">)</span> <span class="token operator">:</span>
        <span class="token function">cacheName</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">key</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// No-op.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Callback.
     */</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Ignite<span class="token operator">&amp;</span> node <span class="token operator">=</span> <span class="token function">GetIgnite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Cache<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">&gt;</span> cache <span class="token operator">=</span> node<span class="token punctuation">.</span>GetCache<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Peek is a local memory lookup.</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Co-located [key= &quot;</span> <span class="token operator">&lt;&lt;</span> key <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;, value= &quot;</span> <span class="token operator">&lt;&lt;</span> cache<span class="token punctuation">.</span><span class="token function">LocalPeek</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> CachePeekMode<span class="token operator">::</span>ALL<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;]&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    std<span class="token operator">::</span>string cacheName<span class="token punctuation">;</span>
    <span class="token keyword">int32_t</span> key<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Binary type structure. Defines a set of functions required for type to be serialized and deserialized.
 */</span>
<span class="token keyword">namespace</span> ignite
<span class="token punctuation">{</span>
    <span class="token keyword">namespace</span> binary
    <span class="token punctuation">{</span>
        <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>
        <span class="token keyword">struct</span> <span class="token class-name">BinaryType</span><span class="token operator">&lt;</span>FuncAffinityRun<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetTypeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">GetBinaryStringHashCode</span><span class="token punctuation">(</span><span class="token string">&quot;FuncAffinityRun&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetTypeName</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst <span class="token operator">=</span> <span class="token string">&quot;FuncAffinityRun&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetFieldId</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">GetBinaryStringHashCode</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetHashCode</span><span class="token punctuation">(</span><span class="token keyword">const</span> FuncAffinityRun<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token keyword">const</span> FuncAffinityRun<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetNull</span><span class="token punctuation">(</span>FuncAffinityRun<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst <span class="token operator">=</span> <span class="token function">FuncAffinityRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Write</span><span class="token punctuation">(</span>BinaryWriter<span class="token operator">&amp;</span> writer<span class="token punctuation">,</span> <span class="token keyword">const</span> FuncAffinityRun<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                writer<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">&quot;cacheName&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                writer<span class="token punctuation">.</span><span class="token function">WriteInt32</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Read</span><span class="token punctuation">(</span>BinaryReader<span class="token operator">&amp;</span> reader<span class="token punctuation">,</span> FuncAffinityRun<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst<span class="token punctuation">.</span>cacheName <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token string">&quot;cacheName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                dst<span class="token punctuation">.</span>key <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadInt32</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    IgniteConfiguration cfg<span class="token punctuation">;</span>
    cfg<span class="token punctuation">.</span>springCfgPath <span class="token operator">=</span> <span class="token string">&quot;/path/to/configuration.xml&quot;</span><span class="token punctuation">;</span>

    Ignite ignite <span class="token operator">=</span> Ignition<span class="token operator">::</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get cache instance.</span>
    Cache<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">&gt;</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span>GetOrCreateCache<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get binding instance.</span>
    IgniteBinding binding <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Registering our class as a compute function.</span>
    binding<span class="token punctuation">.</span>RegisterComputeFunc<span class="token operator">&lt;</span>FuncAffinityRun<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get compute instance.</span>
    compute<span class="token operator">::</span>Compute compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">// This closure will execute on the remote node where</span>
    <span class="token comment">// data for the given 'key' is located.</span>
    compute<span class="token punctuation">.</span><span class="token function">AffinityRun</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token function">FuncAffinityRun</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <h3 id="_8-2-通过分区并置"><a href="#_8-2-通过分区并置" class="header-anchor">#</a> 8.2.通过分区并置</h3> <p><code>affinityCall(Collection&lt;String&gt; cacheNames, int partId, IgniteRunnable job)</code>和<code>affinityRun(Collection&lt;String&gt; cacheNames, int partId, IgniteRunnable job)</code>会将任务发送到给定ID的分区所在的节点。当需要检索多个键的对象并且知道这些键属于同一分区时，这很有用。这时可以为每个键创建一个任务，而不是多个任务。</p> <p>例如，假设要计算特定键子集的特定字段的算术平均值。如果要分发计算，则可以按分区对键进行分组，并将每组键发送到分区所在的节点以获取值。组的数量（即任务的数量）不会超过分区的总数（默认为1024）。下面是说明此示例的代码段：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// this task sums up the values of the salary field for the given set of keys</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SumTask</span> <span class="token keyword">implements</span> <span class="token class-name">IgniteCallable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BigDecimal</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> keys<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">SumTask</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>keys <span class="token operator">=</span> keys<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@IgniteInstanceResource</span>
    <span class="token keyword">private</span> <span class="token class-name">Ignite</span> ignite<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">IgniteCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">BinaryObject</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withKeepBinary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">BigDecimal</span> sum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> k <span class="token operator">:</span> keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">BinaryObject</span> person <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">localPeek</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token class-name">CachePeekMode</span><span class="token punctuation">.</span>PRIMARY<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>person <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                sum <span class="token operator">=</span> sum<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> person<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;salary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">calculateAverage</span><span class="token punctuation">(</span><span class="token class-name">Ignite</span> ignite<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// get the affinity function configured for the cache</span>
    <span class="token class-name">Affinity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> affinityFunc <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">affinity</span><span class="token punctuation">(</span><span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// this map stores collections of keys for each partition</span>
    <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> partMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    keys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>k <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> partId <span class="token operator">=</span> affinityFunc<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> keysByPartition <span class="token operator">=</span> partMap<span class="token punctuation">.</span><span class="token function">computeIfAbsent</span><span class="token punctuation">(</span>partId<span class="token punctuation">,</span> key <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        keysByPartition<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">BigDecimal</span> total <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">IgniteCompute</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> caches <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// iterate over all partitions</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> pair <span class="token operator">:</span> partMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// send a task that gets specific keys for the partition</span>
        <span class="token class-name">BigDecimal</span> sum <span class="token operator">=</span> compute<span class="token punctuation">.</span><span class="token function">affinityCall</span><span class="token punctuation">(</span>caches<span class="token punctuation">,</span> pair<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SumTask</span><span class="token punctuation">(</span>pair<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        total <span class="token operator">=</span> total<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;the average salary is &quot;</span> <span class="token operator">+</span> total<span class="token punctuation">.</span><span class="token function">floatValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> keys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果要处理缓存中的所有数据，可以迭代缓存中的所有分区，并发送处理每个单独分区上存储的数据的任务。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// this task sums up the value of the 'salary' field for all objects stored in</span>
<span class="token comment">// the given partition</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SumByPartitionTask</span> <span class="token keyword">implements</span> <span class="token class-name">IgniteCallable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BigDecimal</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> partId<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">SumByPartitionTask</span><span class="token punctuation">(</span><span class="token keyword">int</span> partId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>partId <span class="token operator">=</span> partId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@IgniteInstanceResource</span>
    <span class="token keyword">private</span> <span class="token class-name">Ignite</span> ignite<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// use binary objects to avoid deserialization</span>
        <span class="token class-name">IgniteCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">BinaryObject</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withKeepBinary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">BigDecimal</span> total <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">QueryCursor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">BinaryObject</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> cursor <span class="token operator">=</span> cache
                <span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ScanQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">BinaryObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>partId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setLocal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">BinaryObject</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                total <span class="token operator">=</span> total<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;salary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> total<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">性能考量</p> <p>当要处理的数据量足够大时，并置计算有性能优势。在某些情况下，当数据量较小时，<a href="/doc/java/UsingKeyValueApi.html#_3-使用扫描查询">扫描查询</a>可能会执行得更好。</p></div> <h3 id="_8-3-entryprocessor"><a href="#_8-3-entryprocessor" class="header-anchor">#</a> 8.3.EntryProcessor</h3> <p><code>EntryProcessor</code>用于在存储缓存条目的节点上处理该缓存条目并返回处理结果。对于<code>EntryProcessor</code>，不必传输整个对象来执行操作，可以远程执行操作，并且只传输结果。</p> <p>如果<code>EntryProcessor</code>为不存在的条目设置值，则该条目将添加到缓存中。</p> <p>对于给定的键，<code>EntryProcessor</code>在一个锁内以原子方式执行。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IgniteCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;mycache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Increment the value for a specific key by 1.</span>
<span class="token comment">// The operation will be performed on the node where the key is stored.</span>
<span class="token comment">// Note that if the cache does not contain an entry for the given key, it will</span>
<span class="token comment">// be created.</span>
cache<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">&quot;mykey&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>entry<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">Integer</span> val <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    entry<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>val <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> val <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">void</span> <span class="token function">CacheInvoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetOrCreateCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> proc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Processor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Increment cache value 10 times</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        cache<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> proc<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Processor</span> <span class="token punctuation">:</span> <span class="token class-name">ICacheEntryProcessor</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">Process</span><span class="token punctuation">(</span>IMutableCacheEntry<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span> entry<span class="token punctuation">,</span> <span class="token keyword">int</span> arg<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        entry<span class="token punctuation">.</span>Value <span class="token operator">=</span> entry<span class="token punctuation">.</span>Exists <span class="token punctuation">?</span> arg <span class="token punctuation">:</span> entry<span class="token punctuation">.</span>Value <span class="token operator">+</span> arg<span class="token punctuation">;</span>

        <span class="token keyword">return</span> entry<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c++" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/**
 * Processor for invoke method.
 */</span>
<span class="token keyword">class</span> <span class="token class-name">IncrementProcessor</span> <span class="token operator">:</span> <span class="token keyword">public</span> cache<span class="token operator">::</span>CacheEntryProcessor<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token punctuation">,</span> <span class="token keyword">int32_t</span><span class="token punctuation">,</span> <span class="token keyword">int32_t</span><span class="token punctuation">,</span> <span class="token keyword">int32_t</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">/**
     * Constructor.
     */</span>
    <span class="token function">IncrementProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// No-op.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Copy constructor.
     *
     * @param other Other instance.
     */</span>
    <span class="token function">IncrementProcessor</span><span class="token punctuation">(</span><span class="token keyword">const</span> IncrementProcessor<span class="token operator">&amp;</span> other<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// No-op.</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Assignment operator.
     *
     * @param other Other instance.
     * @return This instance.
     */</span>
    IncrementProcessor<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> IncrementProcessor<span class="token operator">&amp;</span> other<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Call instance.
     */</span>
    <span class="token keyword">virtual</span> <span class="token keyword">int32_t</span> <span class="token function">Process</span><span class="token punctuation">(</span>MutableCacheEntry<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token punctuation">,</span> <span class="token keyword">int32_t</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> entry<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> arg<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Increment the value for a specific key by 1.</span>
        <span class="token comment">// The operation will be performed on the node where the key is stored.</span>
        <span class="token comment">// Note that if the cache does not contain an entry for the given key, it will</span>
        <span class="token comment">// be created.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>entry<span class="token punctuation">.</span><span class="token function">IsExists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            entry<span class="token punctuation">.</span><span class="token function">SetValue</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            entry<span class="token punctuation">.</span><span class="token function">SetValue</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> entry<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Binary type structure. Defines a set of functions required for type to be serialized and deserialized.
 */</span>
<span class="token keyword">namespace</span> ignite
<span class="token punctuation">{</span>
    <span class="token keyword">namespace</span> binary
    <span class="token punctuation">{</span>
        <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>
        <span class="token keyword">struct</span> <span class="token class-name">BinaryType</span><span class="token operator">&lt;</span>IncrementProcessor<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetTypeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">GetBinaryStringHashCode</span><span class="token punctuation">(</span><span class="token string">&quot;IncrementProcessor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetTypeName</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst <span class="token operator">=</span> <span class="token string">&quot;IncrementProcessor&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetFieldId</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">GetBinaryStringHashCode</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">int32_t</span> <span class="token function">GetHashCode</span><span class="token punctuation">(</span><span class="token keyword">const</span> IncrementProcessor<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token keyword">const</span> IncrementProcessor<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">GetNull</span><span class="token punctuation">(</span>IncrementProcessor<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                dst <span class="token operator">=</span> <span class="token function">IncrementProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Write</span><span class="token punctuation">(</span>BinaryWriter<span class="token operator">&amp;</span> writer<span class="token punctuation">,</span> <span class="token keyword">const</span> IncrementProcessor<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// No-op.</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Read</span><span class="token punctuation">(</span>BinaryReader<span class="token operator">&amp;</span> reader<span class="token punctuation">,</span> IncrementProcessor<span class="token operator">&amp;</span> dst<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// No-op.</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    IgniteConfiguration cfg<span class="token punctuation">;</span>
    cfg<span class="token punctuation">.</span>springCfgPath <span class="token operator">=</span> <span class="token string">&quot;platforms/cpp/examples/put-get-example/config/example-cache.xml&quot;</span><span class="token punctuation">;</span>

    Ignite ignite <span class="token operator">=</span> Ignition<span class="token operator">::</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get cache instance.</span>
    Cache<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token punctuation">,</span> <span class="token keyword">int32_t</span><span class="token operator">&gt;</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span>GetOrCreateCache<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token punctuation">,</span> <span class="token keyword">int32_t</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Get binding instance.</span>
    IgniteBinding binding <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Registering our class as a cache entry processor.</span>
    binding<span class="token punctuation">.</span>RegisterCacheEntryProcessor<span class="token operator">&lt;</span>IncrementProcessor<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    std<span class="token operator">::</span>string <span class="token function">key</span><span class="token punctuation">(</span><span class="token string">&quot;mykey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IncrementProcessor inc<span class="token punctuation">;</span>

    cache<span class="token punctuation">.</span>Invoke<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> inc<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <div class="right-pale"><div class="right-content"><div class="bbox tell-box"><button class="btn btn-circle btn-success right-tell"><i class="fa fa-lg fa-phone"></i></button> <p class="tell-hide">
            18624049226
        </p></div> <div class="bbox weixin-box"><button class="btn btn-circle btn-success right-weixin"><i class="fa fa-weixin"></i></button> <p class="tell-hide" style="padding:5px;"><img src="/img/weixin.jpg"></p></div></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间：:</span> <span class="time">12/11/2020, 12:32:20 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/doc/java/SQLReference.html" class="prev">
        SQL参考
      </a></span> <span class="next"><a href="/doc/java/CodeDeployment.html">
        代码部署
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.f95eba89.js" defer></script><script src="/assets/js/3.d41ef727.js" defer></script><script src="/assets/js/1.c1604912.js" defer></script><script src="/assets/js/232.063058e6.js" defer></script><script src="/assets/js/11.43551a62.js" defer></script><script src="/assets/js/10.cd30f947.js" defer></script><script src="/assets/js/8.7ff96eb1.js" defer></script>
  </body>
</html>
