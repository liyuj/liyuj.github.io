<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ignite.NET | Apache Ignite技术服务</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="/css/plugin.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <script src="https://hm.baidu.com/hm.js?76e2d8c51e8068e025053bc59d51045b"></script>
    <meta name="description" content="apache ignite,ignite中文,ignite官网,内存数据库,分布式数据库">
    <meta name="keywords" content="apache ignite,ignite中文,ignite官网,内存数据库,分布式数据库">
    <meta http-equiv="cache-control" content="no-store,no-cache,must-revalidate">
    <meta http-equiv="expires" content="0">
    
    <link rel="preload" href="/assets/css/0.styles.cb5acd6d.css" as="style"><link rel="preload" href="/assets/js/app.c0c83703.js" as="script"><link rel="preload" href="/assets/js/3.b95bc49f.js" as="script"><link rel="preload" href="/assets/js/1.5c509afc.js" as="script"><link rel="preload" href="/assets/js/272.bbeb18e9.js" as="script"><link rel="preload" href="/assets/js/11.2830eec0.js" as="script"><link rel="preload" href="/assets/js/10.41a5f603.js" as="script"><link rel="preload" href="/assets/js/8.85f43835.js" as="script"><link rel="prefetch" href="/assets/js/100.8dd9717f.js"><link rel="prefetch" href="/assets/js/101.5d033903.js"><link rel="prefetch" href="/assets/js/102.940e9f50.js"><link rel="prefetch" href="/assets/js/103.206d714d.js"><link rel="prefetch" href="/assets/js/104.830b7843.js"><link rel="prefetch" href="/assets/js/105.ed393f31.js"><link rel="prefetch" href="/assets/js/106.c83204cd.js"><link rel="prefetch" href="/assets/js/107.f6c1d245.js"><link rel="prefetch" href="/assets/js/108.b8dce9d3.js"><link rel="prefetch" href="/assets/js/109.9bcb5d83.js"><link rel="prefetch" href="/assets/js/110.3f29305c.js"><link rel="prefetch" href="/assets/js/111.a8fecfe6.js"><link rel="prefetch" href="/assets/js/112.93b32a8f.js"><link rel="prefetch" href="/assets/js/113.b07589d5.js"><link rel="prefetch" href="/assets/js/114.e877c9d4.js"><link rel="prefetch" href="/assets/js/115.7caf74bd.js"><link rel="prefetch" href="/assets/js/116.31bc4866.js"><link rel="prefetch" href="/assets/js/117.9e072997.js"><link rel="prefetch" href="/assets/js/118.fde5922b.js"><link rel="prefetch" href="/assets/js/119.ec5f8340.js"><link rel="prefetch" href="/assets/js/12.3d2f4947.js"><link rel="prefetch" href="/assets/js/120.b36cc227.js"><link rel="prefetch" href="/assets/js/121.e694c142.js"><link rel="prefetch" href="/assets/js/122.a1e9a116.js"><link rel="prefetch" href="/assets/js/123.70c3a199.js"><link rel="prefetch" href="/assets/js/124.e19bc179.js"><link rel="prefetch" href="/assets/js/125.c9fbcb09.js"><link rel="prefetch" href="/assets/js/126.a16a4201.js"><link rel="prefetch" href="/assets/js/127.8705550a.js"><link rel="prefetch" href="/assets/js/128.aa283696.js"><link rel="prefetch" href="/assets/js/129.b6d9c72f.js"><link rel="prefetch" href="/assets/js/13.1af33d82.js"><link rel="prefetch" href="/assets/js/130.20ba6d10.js"><link rel="prefetch" href="/assets/js/131.105a3bb1.js"><link rel="prefetch" href="/assets/js/132.032a3698.js"><link rel="prefetch" href="/assets/js/133.3e9ba3d4.js"><link rel="prefetch" href="/assets/js/134.c873c596.js"><link rel="prefetch" href="/assets/js/135.26201ad6.js"><link rel="prefetch" href="/assets/js/136.d7478bdc.js"><link rel="prefetch" href="/assets/js/137.127c739a.js"><link rel="prefetch" href="/assets/js/138.5459b04a.js"><link rel="prefetch" href="/assets/js/139.668b25bf.js"><link rel="prefetch" href="/assets/js/14.1dc71b94.js"><link rel="prefetch" href="/assets/js/140.3765f87c.js"><link rel="prefetch" href="/assets/js/141.a75a7670.js"><link rel="prefetch" href="/assets/js/142.48a9e1b0.js"><link rel="prefetch" href="/assets/js/143.310ab63a.js"><link rel="prefetch" href="/assets/js/144.f6bbe8a8.js"><link rel="prefetch" href="/assets/js/145.26e07ae6.js"><link rel="prefetch" href="/assets/js/146.861d3d58.js"><link rel="prefetch" href="/assets/js/147.f75cd531.js"><link rel="prefetch" href="/assets/js/148.89cf3a05.js"><link rel="prefetch" href="/assets/js/149.63186424.js"><link rel="prefetch" href="/assets/js/15.3c26aae2.js"><link rel="prefetch" href="/assets/js/150.de648a23.js"><link rel="prefetch" href="/assets/js/151.56587c64.js"><link rel="prefetch" href="/assets/js/152.5611d146.js"><link rel="prefetch" href="/assets/js/153.2dc63725.js"><link rel="prefetch" href="/assets/js/154.f604aeb3.js"><link rel="prefetch" href="/assets/js/155.3aeb14c7.js"><link rel="prefetch" href="/assets/js/156.da0af49c.js"><link rel="prefetch" href="/assets/js/157.b6d5dc0f.js"><link rel="prefetch" href="/assets/js/158.2d81a2fb.js"><link rel="prefetch" href="/assets/js/159.b3e504a0.js"><link rel="prefetch" href="/assets/js/16.81b2b43f.js"><link rel="prefetch" href="/assets/js/160.a4619c14.js"><link rel="prefetch" href="/assets/js/161.b441753a.js"><link rel="prefetch" href="/assets/js/162.651d3401.js"><link rel="prefetch" href="/assets/js/163.7a79d069.js"><link rel="prefetch" href="/assets/js/164.561053cb.js"><link rel="prefetch" href="/assets/js/165.f8e0913d.js"><link rel="prefetch" href="/assets/js/166.e2dac5b9.js"><link rel="prefetch" href="/assets/js/167.2ceb4964.js"><link rel="prefetch" href="/assets/js/168.6fec639a.js"><link rel="prefetch" href="/assets/js/169.fcc123fa.js"><link rel="prefetch" href="/assets/js/17.9c35369a.js"><link rel="prefetch" href="/assets/js/170.885355a7.js"><link rel="prefetch" href="/assets/js/171.e0cc6ce0.js"><link rel="prefetch" href="/assets/js/172.fd46d761.js"><link rel="prefetch" href="/assets/js/173.58933873.js"><link rel="prefetch" href="/assets/js/174.6ab9d835.js"><link rel="prefetch" href="/assets/js/175.34b55d92.js"><link rel="prefetch" href="/assets/js/176.87a2249f.js"><link rel="prefetch" href="/assets/js/177.57fef2c6.js"><link rel="prefetch" href="/assets/js/178.9e6b3a37.js"><link rel="prefetch" href="/assets/js/179.f839a7a6.js"><link rel="prefetch" href="/assets/js/18.c43a3e2d.js"><link rel="prefetch" href="/assets/js/180.17e02e51.js"><link rel="prefetch" href="/assets/js/181.63a9440e.js"><link rel="prefetch" href="/assets/js/182.59757147.js"><link rel="prefetch" href="/assets/js/183.e20cef4b.js"><link rel="prefetch" href="/assets/js/184.2c7807e7.js"><link rel="prefetch" href="/assets/js/185.c01e28b8.js"><link rel="prefetch" href="/assets/js/186.f5c4c482.js"><link rel="prefetch" href="/assets/js/187.eac0602b.js"><link rel="prefetch" href="/assets/js/188.1126eae2.js"><link rel="prefetch" href="/assets/js/189.74b8ab82.js"><link rel="prefetch" href="/assets/js/19.439b7581.js"><link rel="prefetch" href="/assets/js/190.8993d360.js"><link rel="prefetch" href="/assets/js/191.3a71a33f.js"><link rel="prefetch" href="/assets/js/192.a46ed292.js"><link rel="prefetch" href="/assets/js/193.b676c18d.js"><link rel="prefetch" href="/assets/js/194.452eb1b0.js"><link rel="prefetch" href="/assets/js/195.04a1111e.js"><link rel="prefetch" href="/assets/js/196.21b49d41.js"><link rel="prefetch" href="/assets/js/197.e665219d.js"><link rel="prefetch" href="/assets/js/198.307e5a43.js"><link rel="prefetch" href="/assets/js/199.e2751a61.js"><link rel="prefetch" href="/assets/js/20.744a4442.js"><link rel="prefetch" href="/assets/js/200.82d39d02.js"><link rel="prefetch" href="/assets/js/201.dc6064d2.js"><link rel="prefetch" href="/assets/js/202.9932406e.js"><link rel="prefetch" href="/assets/js/203.ff8dd31b.js"><link rel="prefetch" href="/assets/js/204.c0aca0b5.js"><link rel="prefetch" href="/assets/js/205.83913c70.js"><link rel="prefetch" href="/assets/js/206.49174d6a.js"><link rel="prefetch" href="/assets/js/207.60662bbf.js"><link rel="prefetch" href="/assets/js/208.74785879.js"><link rel="prefetch" href="/assets/js/209.af0428c0.js"><link rel="prefetch" href="/assets/js/21.55a0b721.js"><link rel="prefetch" href="/assets/js/210.71317685.js"><link rel="prefetch" href="/assets/js/211.d150b8e4.js"><link rel="prefetch" href="/assets/js/212.a93805d6.js"><link rel="prefetch" href="/assets/js/213.2c264217.js"><link rel="prefetch" href="/assets/js/214.7f6e87c2.js"><link rel="prefetch" href="/assets/js/215.a9a37472.js"><link rel="prefetch" href="/assets/js/216.43428d49.js"><link rel="prefetch" href="/assets/js/217.3083f7e0.js"><link rel="prefetch" href="/assets/js/218.79774c74.js"><link rel="prefetch" href="/assets/js/219.b77a8a1c.js"><link rel="prefetch" href="/assets/js/22.e1ae2ebc.js"><link rel="prefetch" href="/assets/js/220.9fa4386a.js"><link rel="prefetch" href="/assets/js/221.bfdd2f10.js"><link rel="prefetch" href="/assets/js/222.3884b04e.js"><link rel="prefetch" href="/assets/js/223.4d5d17b8.js"><link rel="prefetch" href="/assets/js/224.661ea60e.js"><link rel="prefetch" href="/assets/js/225.89cce153.js"><link rel="prefetch" href="/assets/js/226.7d41380a.js"><link rel="prefetch" href="/assets/js/227.89a8090e.js"><link rel="prefetch" href="/assets/js/228.7ab726e0.js"><link rel="prefetch" href="/assets/js/229.1a592e36.js"><link rel="prefetch" href="/assets/js/23.208f00a1.js"><link rel="prefetch" href="/assets/js/230.b3d14c50.js"><link rel="prefetch" href="/assets/js/231.8c4f9061.js"><link rel="prefetch" href="/assets/js/232.3abb8973.js"><link rel="prefetch" href="/assets/js/233.e0337817.js"><link rel="prefetch" href="/assets/js/234.da119007.js"><link rel="prefetch" href="/assets/js/235.3046b7a1.js"><link rel="prefetch" href="/assets/js/236.84f2dacf.js"><link rel="prefetch" href="/assets/js/237.d2bc0ed1.js"><link rel="prefetch" href="/assets/js/238.6750c6ff.js"><link rel="prefetch" href="/assets/js/239.ea55607e.js"><link rel="prefetch" href="/assets/js/24.11c40bca.js"><link rel="prefetch" href="/assets/js/240.9dce89b3.js"><link rel="prefetch" href="/assets/js/241.cd2219a6.js"><link rel="prefetch" href="/assets/js/242.a255ba0d.js"><link rel="prefetch" href="/assets/js/243.3294372d.js"><link rel="prefetch" href="/assets/js/244.ea9614d4.js"><link rel="prefetch" href="/assets/js/245.893b9979.js"><link rel="prefetch" href="/assets/js/246.976be3a8.js"><link rel="prefetch" href="/assets/js/247.82d511cb.js"><link rel="prefetch" href="/assets/js/248.3d0b1a1b.js"><link rel="prefetch" href="/assets/js/249.be4ae178.js"><link rel="prefetch" href="/assets/js/25.4b26eb08.js"><link rel="prefetch" href="/assets/js/250.8500bd7f.js"><link rel="prefetch" href="/assets/js/251.a5048fb7.js"><link rel="prefetch" href="/assets/js/252.d63e7357.js"><link rel="prefetch" href="/assets/js/253.51fed392.js"><link rel="prefetch" href="/assets/js/254.e396aeb2.js"><link rel="prefetch" href="/assets/js/255.e1cf98d5.js"><link rel="prefetch" href="/assets/js/256.f1a6b238.js"><link rel="prefetch" href="/assets/js/257.e1cba5a5.js"><link rel="prefetch" href="/assets/js/258.0cdac641.js"><link rel="prefetch" href="/assets/js/259.37d26110.js"><link rel="prefetch" href="/assets/js/26.99794fbc.js"><link rel="prefetch" href="/assets/js/260.6ef3681c.js"><link rel="prefetch" href="/assets/js/261.fe834fea.js"><link rel="prefetch" href="/assets/js/262.0aa94951.js"><link rel="prefetch" href="/assets/js/263.e8168964.js"><link rel="prefetch" href="/assets/js/264.bbc8114d.js"><link rel="prefetch" href="/assets/js/265.88eac1d6.js"><link rel="prefetch" href="/assets/js/266.be205453.js"><link rel="prefetch" href="/assets/js/267.7c1f080f.js"><link rel="prefetch" href="/assets/js/268.74cc2201.js"><link rel="prefetch" href="/assets/js/269.03724997.js"><link rel="prefetch" href="/assets/js/27.a023f451.js"><link rel="prefetch" href="/assets/js/270.8a6f7abc.js"><link rel="prefetch" href="/assets/js/271.b2940c7a.js"><link rel="prefetch" href="/assets/js/273.74980d47.js"><link rel="prefetch" href="/assets/js/274.894570ba.js"><link rel="prefetch" href="/assets/js/275.49de03a1.js"><link rel="prefetch" href="/assets/js/276.7ab94734.js"><link rel="prefetch" href="/assets/js/277.ca966325.js"><link rel="prefetch" href="/assets/js/278.c16711fa.js"><link rel="prefetch" href="/assets/js/279.b398be35.js"><link rel="prefetch" href="/assets/js/28.76a90833.js"><link rel="prefetch" href="/assets/js/280.d1d4273f.js"><link rel="prefetch" href="/assets/js/281.75bac5a7.js"><link rel="prefetch" href="/assets/js/282.ca60cf6b.js"><link rel="prefetch" href="/assets/js/283.bfb0d5e1.js"><link rel="prefetch" href="/assets/js/284.b2c33b92.js"><link rel="prefetch" href="/assets/js/285.e36f399e.js"><link rel="prefetch" href="/assets/js/286.8e8aec23.js"><link rel="prefetch" href="/assets/js/287.51cb4316.js"><link rel="prefetch" href="/assets/js/288.da42e912.js"><link rel="prefetch" href="/assets/js/289.b03013f1.js"><link rel="prefetch" href="/assets/js/29.f0f4d791.js"><link rel="prefetch" href="/assets/js/290.9c8680a9.js"><link rel="prefetch" href="/assets/js/291.a1119d1f.js"><link rel="prefetch" href="/assets/js/292.8277d9ce.js"><link rel="prefetch" href="/assets/js/293.a659e882.js"><link rel="prefetch" href="/assets/js/294.56aef13e.js"><link rel="prefetch" href="/assets/js/295.8c0df040.js"><link rel="prefetch" href="/assets/js/30.ed97af1f.js"><link rel="prefetch" href="/assets/js/31.f464b981.js"><link rel="prefetch" href="/assets/js/32.ade4fc62.js"><link rel="prefetch" href="/assets/js/33.f45de406.js"><link rel="prefetch" href="/assets/js/34.fb567ebb.js"><link rel="prefetch" href="/assets/js/35.995dd5b1.js"><link rel="prefetch" href="/assets/js/36.ebd63a8c.js"><link rel="prefetch" href="/assets/js/37.8271e61a.js"><link rel="prefetch" href="/assets/js/38.0d349678.js"><link rel="prefetch" href="/assets/js/39.129ba990.js"><link rel="prefetch" href="/assets/js/4.03c84a3c.js"><link rel="prefetch" href="/assets/js/40.0b1253e4.js"><link rel="prefetch" href="/assets/js/41.eee22b52.js"><link rel="prefetch" href="/assets/js/42.755aca61.js"><link rel="prefetch" href="/assets/js/43.306afbb1.js"><link rel="prefetch" href="/assets/js/44.2b74ff3d.js"><link rel="prefetch" href="/assets/js/45.f011e76a.js"><link rel="prefetch" href="/assets/js/46.b190d321.js"><link rel="prefetch" href="/assets/js/47.30331587.js"><link rel="prefetch" href="/assets/js/48.6668dba4.js"><link rel="prefetch" href="/assets/js/49.ad6cd677.js"><link rel="prefetch" href="/assets/js/5.dc64067c.js"><link rel="prefetch" href="/assets/js/50.05a55da7.js"><link rel="prefetch" href="/assets/js/51.d88e317e.js"><link rel="prefetch" href="/assets/js/52.d6e778fa.js"><link rel="prefetch" href="/assets/js/53.4bd5b1e2.js"><link rel="prefetch" href="/assets/js/54.a78aaa0b.js"><link rel="prefetch" href="/assets/js/55.5af47d03.js"><link rel="prefetch" href="/assets/js/56.b2e7ab6e.js"><link rel="prefetch" href="/assets/js/57.ee86351c.js"><link rel="prefetch" href="/assets/js/58.9b9f07c7.js"><link rel="prefetch" href="/assets/js/59.a79a5956.js"><link rel="prefetch" href="/assets/js/6.a365e315.js"><link rel="prefetch" href="/assets/js/60.dc851f10.js"><link rel="prefetch" href="/assets/js/61.a403058c.js"><link rel="prefetch" href="/assets/js/62.6b5a007d.js"><link rel="prefetch" href="/assets/js/63.0f7fdd37.js"><link rel="prefetch" href="/assets/js/64.992ae837.js"><link rel="prefetch" href="/assets/js/65.63c58056.js"><link rel="prefetch" href="/assets/js/66.e7a6a465.js"><link rel="prefetch" href="/assets/js/67.82e8c6f5.js"><link rel="prefetch" href="/assets/js/68.98939881.js"><link rel="prefetch" href="/assets/js/69.e4abc89d.js"><link rel="prefetch" href="/assets/js/7.bdfa8241.js"><link rel="prefetch" href="/assets/js/70.08dacaaf.js"><link rel="prefetch" href="/assets/js/71.2ad91bd3.js"><link rel="prefetch" href="/assets/js/72.813a25ca.js"><link rel="prefetch" href="/assets/js/73.3b8f8ec8.js"><link rel="prefetch" href="/assets/js/74.1c65e8b3.js"><link rel="prefetch" href="/assets/js/75.2bb6561f.js"><link rel="prefetch" href="/assets/js/76.1e99847e.js"><link rel="prefetch" href="/assets/js/77.4dc5b562.js"><link rel="prefetch" href="/assets/js/78.52205ee0.js"><link rel="prefetch" href="/assets/js/79.1e83f7b4.js"><link rel="prefetch" href="/assets/js/80.26785724.js"><link rel="prefetch" href="/assets/js/81.442378a1.js"><link rel="prefetch" href="/assets/js/82.f2524fbf.js"><link rel="prefetch" href="/assets/js/83.9bac75ae.js"><link rel="prefetch" href="/assets/js/84.0b6772e4.js"><link rel="prefetch" href="/assets/js/85.3df73729.js"><link rel="prefetch" href="/assets/js/86.e2b07e7d.js"><link rel="prefetch" href="/assets/js/87.2b92085b.js"><link rel="prefetch" href="/assets/js/88.77eb29c4.js"><link rel="prefetch" href="/assets/js/89.bb094d97.js"><link rel="prefetch" href="/assets/js/9.5a050820.js"><link rel="prefetch" href="/assets/js/90.324f10ea.js"><link rel="prefetch" href="/assets/js/91.4c9d25cb.js"><link rel="prefetch" href="/assets/js/92.dc3df5c8.js"><link rel="prefetch" href="/assets/js/93.93d819e9.js"><link rel="prefetch" href="/assets/js/94.c0901e7d.js"><link rel="prefetch" href="/assets/js/95.7c544fc5.js"><link rel="prefetch" href="/assets/js/96.1e4f5c43.js"><link rel="prefetch" href="/assets/js/97.8f8e0dcb.js"><link rel="prefetch" href="/assets/js/98.0c8aaa27.js"><link rel="prefetch" href="/assets/js/99.ec06ce11.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cb5acd6d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Apache Ignite技术服务</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/Service.html" class="nav-link">
  服务&amp;报价
</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link router-link-active">
  文档
</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/confluent/" class="nav-link">
  Confluent平台
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">最新版本</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">最新版本</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/java/DotnetSpecific.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  2.10.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.9.1/" class="nav-link">
  2.9.1
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.8.0/" class="nav-link">
  2.8.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.7.0/" class="nav-link">
  2.7.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/" class="nav-link">
  2.6.0
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/Service.html" class="nav-link">
  服务&amp;报价
</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link router-link-active">
  文档
</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/confluent/" class="nav-link">
  Confluent平台
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">最新版本</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">最新版本</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/java/DotnetSpecific.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  2.10.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.9.1/" class="nav-link">
  2.9.1
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.8.0/" class="nav-link">
  2.8.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.7.0/" class="nav-link">
  2.7.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/" class="nav-link">
  2.6.0
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/doc/java/" aria-current="page" class="sidebar-link">前言</a></li><li><a href="/doc/java/QuickStartGuide.html" class="sidebar-link">快速入门</a></li><li><a href="/doc/java/Installation.html" class="sidebar-link">安装</a></li><li><a href="/doc/java/SettingUp.html" class="sidebar-link">Ignite配置入门</a></li><li><a href="/doc/java/StartingNodes.html" class="sidebar-link">启动和停止节点</a></li><li><a href="/doc/java/Clustering.html" class="sidebar-link">集群化</a></li><li><a href="/doc/java/ThinClients.html" class="sidebar-link">瘦客户端</a></li><li><a href="/doc/java/DataModeling.html" class="sidebar-link">数据建模</a></li><li><a href="/doc/java/ConfiguringMemory.html" class="sidebar-link">配置内存</a></li><li><a href="/doc/java/Persistence.html" class="sidebar-link">配置持久化</a></li><li><a href="/doc/java/ConfiguringCaches.html" class="sidebar-link">配置缓存</a></li><li><a href="/doc/java/DataRebalancing.html" class="sidebar-link">数据再平衡</a></li><li><a href="/doc/java/DataStreaming.html" class="sidebar-link">数据流处理</a></li><li><a href="/doc/java/UsingKeyValueApi.html" class="sidebar-link">键-值API</a></li><li><a href="/doc/java/Transactions.html" class="sidebar-link">Ignite事务</a></li><li><a href="/doc/java/WorkingwithSQL.html" class="sidebar-link">处理SQL</a></li><li><a href="/doc/java/SQLReference.html" class="sidebar-link">SQL参考</a></li><li><a href="/doc/java/DistributedComputing.html" class="sidebar-link">分布式计算</a></li><li><a href="/doc/java/CodeDeployment.html" class="sidebar-link">代码部署</a></li><li><a href="/doc/java/MachineLearning.html" class="sidebar-link">机器学习</a></li><li><a href="/doc/java/ContinuousQueries.html" class="sidebar-link">Ignite持续查询</a></li><li><a href="/doc/java/Service.html" class="sidebar-link">Ignite服务</a></li><li><a href="/doc/java/Messaging.html" class="sidebar-link">Ignite消息</a></li><li><a href="/doc/java/DataStructures.html" class="sidebar-link">Ignite分布式数据结构</a></li><li><a href="/doc/java/DistributedLocks.html" class="sidebar-link">Ignite分布式锁</a></li><li><a href="/doc/java/RESTAPI.html" class="sidebar-link">REST API</a></li><li><a href="/doc/java/DotnetSpecific.html" aria-current="page" class="active sidebar-link">Ignite.NET</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_1-配置选项" class="sidebar-link">1.配置选项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_1-1-概述" class="sidebar-link">1.1.概述</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_1-2-通过编程方式配置" class="sidebar-link">1.2.通过编程方式配置</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_1-3-通过应用或web配置文件方式配置" class="sidebar-link">1.3.通过应用或Web配置文件方式配置</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_1-4-通过spring-xml方式配置" class="sidebar-link">1.4.通过Spring XML方式配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_2-部署选项" class="sidebar-link">2.部署选项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_2-1-概述" class="sidebar-link">2.1.概述</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_2-2-完整二进制包部署" class="sidebar-link">2.2.完整二进制包部署</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_2-3-nuget部署" class="sidebar-link">2.3.NuGet部署</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_2-4-自定义部署" class="sidebar-link">2.4.自定义部署</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_2-5-asp-net部署" class="sidebar-link">2.5.ASP.NET部署</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_2-6-iis程序池生命周期、appdomains和ignite-net" class="sidebar-link">2.6.IIS程序池生命周期、AppDomains和Ignite.NET</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_3-独立节点" class="sidebar-link">3.独立节点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_3-1-概述" class="sidebar-link">3.1.概述</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_3-2-通过命令行配置独立节点" class="sidebar-link">3.2.通过命令行配置独立节点</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_3-3-通过xml文件配置独立节点" class="sidebar-link">3.3.通过XML文件配置独立节点</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_3-4-加载用户程序集" class="sidebar-link">3.4.加载用户程序集</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_3-5-ignite-net作为windows服务" class="sidebar-link">3.5.Ignite.NET作为Windows服务</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_4-日志" class="sidebar-link">4.日志</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_4-1-概述" class="sidebar-link">4.1.概述</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_4-2-自定义logger" class="sidebar-link">4.2.自定义Logger</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_4-3-nlog和log4net日志" class="sidebar-link">4.3.NLog和log4net日志</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_5-linq实现" class="sidebar-link">5.LINQ实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_5-1-概述" class="sidebar-link">5.1.概述</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_5-2-安装" class="sidebar-link">5.2.安装</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_5-3-配置" class="sidebar-link">5.3.配置</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_5-4-用法" class="sidebar-link">5.4.用法</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_5-5-内省" class="sidebar-link">5.5.内省</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_5-6-投影" class="sidebar-link">5.6.投影</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_5-7-编译查询" class="sidebar-link">5.7.编译查询</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_5-8-关联" class="sidebar-link">5.8.关联</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_5-9-包含" class="sidebar-link">5.9.包含</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_5-10-支持的sql函数" class="sidebar-link">5.10.支持的SQL函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_6-执行java服务" class="sidebar-link">6.执行Java服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_6-1-概述" class="sidebar-link">6.1.概述</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_6-2-示例" class="sidebar-link">6.2.示例</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_6-3-接口方法映射" class="sidebar-link">6.3.接口方法映射</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_7-net平台缓存" class="sidebar-link">7..NET平台缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_7-1-配置平台缓存" class="sidebar-link">7.1.配置平台缓存</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_7-2-支持的api" class="sidebar-link">7.2.支持的API</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_7-3-直接访问平台缓存数据" class="sidebar-link">7.3.直接访问平台缓存数据</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_7-4-高级配置" class="sidebar-link">7.4.高级配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_8-插件" class="sidebar-link">8.插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_8-1-概述" class="sidebar-link">8.1.概述</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_8-2-igniteconfiguration-pluginconfigurations" class="sidebar-link">8.2.IgniteConfiguration.PluginConfigurations</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_8-3-ipluginprovider" class="sidebar-link">8.3.IPluginProvider</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_8-4-iignite-getplugin" class="sidebar-link">8.4.IIgnite.GetPlugin</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_8-5-与java交互" class="sidebar-link">8.5.与Java交互</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_9-序列化" class="sidebar-link">9.序列化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_9-1-ibinarizable" class="sidebar-link">9.1.IBinarizable</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_9-2-ibinaryserializer" class="sidebar-link">9.2.IBinarySerializer</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_9-3-iserializable" class="sidebar-link">9.3.ISerializable</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_9-4-ignite反射式序列化" class="sidebar-link">9.4.Ignite反射式序列化</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_9-5-使用entity-framework-pocos" class="sidebar-link">9.5.使用Entity Framework POCOs</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_9-6-更多信息" class="sidebar-link">9.6.更多信息</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_10-跨平台支持" class="sidebar-link">10.跨平台支持</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_10-1-概述" class="sidebar-link">10.1.概述</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_10-2-net-core" class="sidebar-link">10.2..NET Core</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_10-3-java检测" class="sidebar-link">10.3.Java检测</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_10-4-已知问题" class="sidebar-link">10.4.已知问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_11-平台互操作性" class="sidebar-link">11.平台互操作性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_11-1-标识符" class="sidebar-link">11.1.标识符</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_11-2-默认行为" class="sidebar-link">11.2.默认行为</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_11-3-类型兼容性" class="sidebar-link">11.3.类型兼容性</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_11-4-集合兼容性" class="sidebar-link">11.4.集合兼容性</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_11-5-混合平台集群" class="sidebar-link">11.5.混合平台集群</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_11-6-混合平台集群中的计算" class="sidebar-link">11.6.混合平台集群中的计算</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_12-远程程序集加载" class="sidebar-link">12.远程程序集加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_12-1-概述" class="sidebar-link">12.1.概述</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_12-2-currentappdomain模式" class="sidebar-link">12.2.CurrentAppDomain模式</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_12-3-示例" class="sidebar-link">12.3.示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_13-问题解决" class="sidebar-link">13.问题解决</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_13-1-概述" class="sidebar-link">13.1.概述</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_13-2-使用控制台排除故障" class="sidebar-link">13.2.使用控制台排除故障</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_13-3-获取有关异常的更多信息" class="sidebar-link">13.3.获取有关异常的更多信息</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_13-4-常见问题" class="sidebar-link">13.4.常见问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_14-集成" class="sidebar-link">14.集成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_14-1-asp-net输出缓存" class="sidebar-link">14.1.ASP.NET输出缓存</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_14-2-asp-net会话状态缓存" class="sidebar-link">14.2.ASP.NET会话状态缓存</a></li><li class="sidebar-sub-header"><a href="/doc/java/DotnetSpecific.html#_14-3-entity-framework二级缓存" class="sidebar-link">14.3.Entity Framework二级缓存</a></li></ul></li></ul></li><li><a href="/doc/java/CppSpecific.html" class="sidebar-link">Ignite C++</a></li><li><a href="/doc/java/Monitoring.html" class="sidebar-link">监控</a></li><li><a href="/doc/java/WorkingwithEvents.html" class="sidebar-link">处理事件</a></li><li><a href="/doc/java/Tools.html" class="sidebar-link">工具</a></li><li><a href="/doc/java/Security.html" class="sidebar-link">安全</a></li><li><a href="/doc/java/ExtensionsIntegrations.html" class="sidebar-link">扩展和集成</a></li><li><a href="/doc/java/Plugins.html" class="sidebar-link">插件</a></li><li><a href="/doc/java/PerformanceTroubleshooting.html" class="sidebar-link">性能和故障排除</a></li><li><a href="/doc/java/Legal.html" class="sidebar-link">法律条款</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ignite-net"><a href="#ignite-net" class="header-anchor">#</a> Ignite.NET</h1> <h2 id="_1-配置选项"><a href="#_1-配置选项" class="header-anchor">#</a> 1.配置选项</h2> <h3 id="_1-1-概述"><a href="#_1-1-概述" class="header-anchor">#</a> 1.1.概述</h3> <p>Ignite.NET节点可以通过各种方式进行配置，然后通过<code>Ignition.Start*</code>方法用指定的配置就可以启动。</p> <h3 id="_1-2-通过编程方式配置"><a href="#_1-2-通过编程方式配置" class="header-anchor">#</a> 1.2.通过编程方式配置</h3> <p>在C#应用中，使用<code>Ignition.Start(IgniteConfiguration)</code>方法可以配置一个Ignite.NET节点。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    DiscoverySpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoverySpi</span>
    <span class="token punctuation">{</span>
        IpFinder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoveryStaticIpFinder</span>
        <span class="token punctuation">{</span>
            Endpoints <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;127.0.0.1:47500..47509&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        SocketTimeout <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    IncludedEventTypes <span class="token operator">=</span> EventType<span class="token punctuation">.</span>CacheAll<span class="token punctuation">,</span>
    JvmOptions <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;-Xms1024m&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-Xmx1024m&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-3-通过应用或web配置文件方式配置"><a href="#_1-3-通过应用或web配置文件方式配置" class="header-anchor">#</a> 1.3.通过应用或Web配置文件方式配置</h3> <p><code>Ignition.StartFromApplicationConfiguration</code>方法可以从<code>app.config</code>或<code>web.config</code>文件的<code>Apache.Ignite.Core.IgniteConfigurationSection</code>中读取配置。</p> <p><code>IgniteConfigurationSection.xsd</code>模式文件位于二进制包和<code>Apache.Ignite.Schema</code>NuGet包的<code>Apache.Ignite.Core.dll</code>同级目录处，在Visual Studio中通过<code>None</code>构建操作将其包含在项目中，这样当编辑配置文件的<code>IgniteConfigurationSection</code>段时，可以开启智能提示。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="app.config配置" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configSections</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>igniteConfiguration<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Apache.Ignite.Core.IgniteConfigurationSection, Apache.Ignite.Core<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configSections</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>runtime</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gcServer</span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>runtime</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://ignite.apache.org/schema/dotnet/IgniteConfigurationSection<span class="token punctuation">&quot;</span></span> <span class="token attr-name">gridName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myGrid1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>discoverySpi</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>TcpDiscoverySpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ipFinder</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>TcpDiscoveryStaticIpFinder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>endpoints</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>127.0.0.1:47500..47509<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>endpoints</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ipFinder</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>discoverySpi</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span> <span class="token attr-name">cacheMode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Replicated<span class="token punctuation">'</span></span> <span class="token attr-name">readThrough</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>true<span class="token punctuation">'</span></span> <span class="token attr-name">writeThrough</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>true<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>secondCache<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includedEventTypes</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span>42<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>int</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span>TaskFailed<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>int</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span>JobFinished<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>int</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includedEventTypes</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>userAttributes</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pair</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>myNode<span class="token punctuation">'</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>true<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>userAttributes</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>JvmOptions</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>-Xms1024m<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>-Xmx1024m<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>JvmOptions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="c#中的用法" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">StartFromApplicationConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;igniteConfiguration&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>要将<code>IgniteConfigurationSection.xsd</code>模式文件添加到Visual Studio项目中，可以转到<code>Projects</code>菜单，单击<code>Add Existing Item...</code>菜单项，之后找到Apache Ignite包中的<code>IgniteConfigurationSection.xsd</code>并且选中。</p> <p>或者，安装NuGet软件包：<code>Install-Package Apache.Ignite.Schema</code>，这将自动将xsd文件添加到项目中。</p> <p>为了改善编辑体验，需要在<code>Tools ⇒ Options ⇒ Text Editor ⇒ XML</code>中启用了<code>Statement Completion</code>选项。</p></div> <h4 id="_1-3-1-ignite配置段语法"><a href="#_1-3-1-ignite配置段语法" class="header-anchor">#</a> 1.3.1.Ignite配置段语法</h4> <p>Ignite的配置段直接映射到<code>IgniteConfiguration</code>类。</p> <ul><li>简单属性（字符串、基础类型、枚举）映射到XML属性（属性名为驼峰式的C#属性名）；</li> <li>复杂属性映射到嵌套的XML元素（元素名为驼峰式的C#属性名）；</li> <li>当复杂属性是接口或抽象类时，<code>type</code>属性将用于指定类型，需要使用程序集限定名。对于内置类型（例如上面代码示例中的<code>TcpDiscoverySpi</code>），可以省略程序集名和命名空间；</li> <li>如有疑问，可以查询<code>IgniteConfigurationSection.xsd</code>。</li></ul> <h3 id="_1-4-通过spring-xml方式配置"><a href="#_1-4-通过spring-xml方式配置" class="header-anchor">#</a> 1.4.通过Spring XML方式配置</h3> <p>Spring的XML文件可以使用原生的基于Java的Ignite配置，Spring的配置文件可以通过<code>Ignition.Start(string)</code>方法以及<code>IgniteConfiguration.SpringConfigUrl</code>属性传入。这样在Ignite.NET不直接支持某些Java属性时，此功能会有用。</p> <p>使用<code>IgniteConfiguration.SpringConfigUrl</code>属性时，Spring的配置会首先加载，在其之上才会应用其他的<code>IgniteConfiguration</code>属性。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="spring-xml配置" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>util</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/util<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/util
                           http://www.springframework.org/schema/util/spring-util.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>grid.cfg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>localHost<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>127.0.0.1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>gridName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>grid1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userAttributes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>my_attr<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>value1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.CacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cache1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>startSize<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>discoverySpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ipFinder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.discovery.tcp.ipfinder.vm.TcpDiscoveryVmIpFinder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>addresses<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>127.0.0.1:47500..47509<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>socketTimeout<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>300<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="c#中的用法" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token string">&quot;spring-config.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h2 id="_2-部署选项"><a href="#_2-部署选项" class="header-anchor">#</a> 2.部署选项</h2> <h3 id="_2-1-概述"><a href="#_2-1-概述" class="header-anchor">#</a> 2.1.概述</h3> <p>Ignite.NET由.NET程序集和Java jar文件组成。.NET程序集由具体的项目引用，并在自动化构建过程中复制到输出文件夹。Jar文件需要手工复制，Ignite.NET通过<code>IgniteHome</code>或<code>JvmClasspath</code>配置发现它们。</p> <p>本章节会介绍Ignite.NET节点的几种最常用的部署选项。</p> <h3 id="_2-2-完整二进制包部署"><a href="#_2-2-完整二进制包部署" class="header-anchor">#</a> 2.2.完整二进制包部署</h3> <ul><li>复制从<a href="https://ignite.apache.org" target="_self" rel="noopener noreferrer">https://ignite.apache.org</a>下载的整个发行版内容以及自己的应用；</li> <li>配置<code>IGNITE_HOME</code>环境变量或<code>IgniteConfiguration.IgniteHome</code>以指向该文件夹。</li></ul> <h3 id="_2-3-nuget部署"><a href="#_2-3-nuget部署" class="header-anchor">#</a> 2.3.NuGet部署</h3> <p>在Ignite.NET NuGet软件包安装过程中，将自动更新构建后事件，以将jar文件复制到输出目录中的Libs文件夹中（具体参见<a href="/doc/java/QuickStartGuide.html#_2-c-net">入门</a>），分发二进制文件时，要确保包括该<code>Libs</code>文件夹。</p> <p>确认未全局配置<code>IGNITE_HOME</code>，除了ASP.NET环境（参见下文）外，通常不需要使用NuGet配置<code>IGNITE_HOME</code>。</p> <p>构建后事件：</p> <div class="language- extra-class"><pre class="language-text"><code>if not exist &quot;$(TargetDir)Libs&quot; md &quot;$(TargetDir)Libs&quot;
xcopy /s /y &quot;$(SolutionDir)packages\Apache.Ignite.1.6.0\Libs\*.*&quot; &quot;$(TargetDir)Libs&quot;
</code></pre></div><h3 id="_2-4-自定义部署"><a href="#_2-4-自定义部署" class="header-anchor">#</a> 2.4.自定义部署</h3> <p>Jar文件位于二进制包的<code>libs</code>文件夹和NuGet包中。</p> <p>Ignite.NET必需的最小Jar集合是：</p> <ul><li><code>ignite-core-{VER}.jar</code>；</li> <li><code>cache-api-1.0.0.jar</code>；</li> <li><code>ignite-indexing</code>文件夹（如果使用缓存查询）；</li> <li><code>ignite-spring</code>文件夹（如果使用基于spring的配置）。</li></ul> <p><strong>将jar部署到默认位置：</strong></p> <ul><li>将jar文件复制到<code>Apache.Ignite.Core.dll</code>旁边的<code>Libs</code>文件夹中；</li> <li>不要配置<code>IgniteConfiguration.JvmClasspath</code>、<code>IgniteConfiguration.IgniteHome</code>属性和<code>IGNITE_HOME</code>环境变量。</li></ul> <p><strong>将jar文件部署到任意位置：</strong></p> <ul><li>将jar文件复制到某处；</li> <li>将<code>IgniteConfiguration.JvmClasspath</code>属性配置为指向每个jar文件路径的字符串，多个用分号分割；</li> <li>不要设置<code>IGNITE_HOME</code>环境变量和<code>IgniteConfiguration.IgniteHome</code>属性。</li></ul> <p>IgniteConfiguration.JvmClasspath示例：</p> <div class="language- extra-class"><pre class="language-text"><code>c:\ignite-jars\ignite-core-1.5.0.final.jar;c:\ignite-jars\cache-api-1.0.0.jar
</code></pre></div><h3 id="_2-5-asp-net部署"><a href="#_2-5-asp-net部署" class="header-anchor">#</a> 2.5.ASP.NET部署</h3> <p>在Web环境（IIS和IIS Express）中使用Ignite时，<code>JvmClasspath</code>或<code>IgniteHome</code>必须显式配置，因为dll文件复制到了临时文件夹，而Ignite无法自动定位这些jar文件。</p> <p>在ASP.NET环境中可以像下面这样配置<code>IgniteHome</code>：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    IgniteHome <span class="token operator">=</span> HttpContext<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Server<span class="token punctuation">.</span><span class="token function">MapPath</span><span class="token punctuation">(</span>@&quot;<span class="token operator">~</span>\bin\&quot;<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>或者，可以全局配置<code>IGNITE_HOME</code>，将下面这行代码添加到<code>Global.asax.cs</code>中<code>Application_Start</code>方法的顶部：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Environment<span class="token punctuation">.</span><span class="token function">SetEnvironmentVariable</span><span class="token punctuation">(</span><span class="token string">&quot;IGNITE_HOME&quot;</span><span class="token punctuation">,</span> HttpContext<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Server<span class="token punctuation">.</span><span class="token function">MapPath</span><span class="token punctuation">(</span>@&quot;<span class="token operator">~</span>\bin\&quot;<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>或者，可以使用以下方法填充<code>JvmClasspath</code>：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token keyword">string</span> <span class="token function">GetDefaultWebClasspath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> dir <span class="token operator">=</span> HttpContext<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Server<span class="token punctuation">.</span><span class="token function">MapPath</span><span class="token punctuation">(</span><span class="token string">@&quot;~\bin\libs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;;&quot;</span><span class="token punctuation">,</span> Directory<span class="token punctuation">.</span><span class="token function">GetFiles</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token string">&quot;*.jar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-6-iis程序池生命周期、appdomains和ignite-net"><a href="#_2-6-iis程序池生命周期、appdomains和ignite-net" class="header-anchor">#</a> 2.6.IIS程序池生命周期、AppDomains和Ignite.NET</h3> <p>IIS有一个已知的问题：当重启Web应用时（由于代码更改或手动重启），程序池进程仍然在线，而AppDomain被回收。</p> <p>卸载AppDomain后，Ignite.NET会自动停止。不过在旧域卸载过程中，可能会启动新域，因此，旧域中的节点可能与新域中的节点发生<code>IgniteConfiguration.IgniteInstanceName</code>冲突。</p> <p>要解决此问题，需要确保为<code>IgniteInstanceName</code>分配唯一值或将<code>IgniteConfiguration.AutoGenerateIgniteInstanceName</code>属性设置为<code>true</code>：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="c#" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span> <span class="token punctuation">{</span> AutoGenerateIgniteInstanceName <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="web.config" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span> <span class="token attr-name">autoGenerateIgniteInstanceName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section></div></div> <h2 id="_3-独立节点"><a href="#_3-独立节点" class="header-anchor">#</a> 3.独立节点</h2> <h3 id="_3-1-概述"><a href="#_3-1-概述" class="header-anchor">#</a> 3.1.概述</h3> <p>Ignite.NET节点可以在.NET应用的代码中通过使用<code>Ignition.Start()</code>启动，也可以使用可执行的<code>Apache.Ignite.exe</code>（位于<code>{apache_ignite_release}\platforms\dotnet\bin</code>文件夹下）作为单独的进程启动。像通常一样，在内部<code>Apache.Ignite.exe</code>引用<code>Apache.Ignite.Core.dll</code>和使用<code>Ignition.Start()</code>，并且可以使用下面列出的命令行参数进行配置，方法是将它们作为命令行选项传递或直接在<code>Apache.Ignite.exe.config</code>文件中进行设置。</p> <p>通常以独立模式启动服务端节点，Ignite集群是一组互连在一起的服务端节点，目的是为应用提供RAM和CPU等共享资源。</p> <h3 id="_3-2-通过命令行配置独立节点"><a href="#_3-2-通过命令行配置独立节点" class="header-anchor">#</a> 3.2.通过命令行配置独立节点</h3> <p>下面是基本的Ignite参数，当使用<code>Apache.Ignite.exe</code>程序启动节点时，这些参数可以作为命令行参数传入：</p> <table><thead><tr><th>命令行参数</th> <th>含义</th></tr></thead> <tbody><tr><td><code>-IgniteHome</code></td> <td>Ignite安装目录路径（如果未提供会使用<code>IGNITE_HOME</code>环境变量）</td></tr> <tr><td><code>-ConfigFileName</code></td> <td><code>app.config</code>文件路径（如果未提供会使用<code>Apache.Ignite.exe.config</code>）</td></tr> <tr><td><code>-ConfigFileName</code></td> <td>配置文件中<code>IgniteConfigurationSection</code>的名字</td></tr> <tr><td><code>-SpringConfigUrl</code></td> <td>Spring配置文件路径</td></tr> <tr><td><code>-JvmDllPath</code></td> <td>JVM库<code>jvm.dll</code>的路径（如果未提供会使用<code>JAVA_HOME</code>环境变量）</td></tr> <tr><td><code>-JvmClasspath</code></td> <td>传递给JVM的类路径（在这里注册其它的jar文件）</td></tr> <tr><td><code>-SuppressWarnings</code></td> <td>是否输出警告信息</td></tr> <tr><td><code>-J&lt;javaOption&gt;</code></td> <td>JVM参数</td></tr> <tr><td><code>-Assembly</code></td> <td>要加载的其它.NET程序集</td></tr> <tr><td><code>-JvmInitialMemoryMB</code></td> <td>初始Java堆大小（MB），对应于<code>-Xms</code>Java参数</td></tr> <tr><td><code>-JvmMaxMemoryMB</code></td> <td>最大Java堆大小（MB），对应于<code>-Xmx</code>Java参数</td></tr> <tr><td><code>/install</code></td> <td>根据指定的参数将Ignite安装为Windows服务</td></tr> <tr><td><code>/uninstall</code></td> <td>卸载Ignite Windows服务</td></tr></tbody></table> <p>示例：</p> <div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">Apache</span>.Ignite.exe -ConfigFileName=c:\ignite\my-config.xml -ConfigSectionName=igniteConfiguration -Assembly=c:\ignite\my-code.dll <span class="token parameter attr-name">-J</span>-Xms1024m <span class="token parameter attr-name">-J</span>-Xmx2048m</span>
</code></pre></div><h3 id="_3-3-通过xml文件配置独立节点"><a href="#_3-3-通过xml文件配置独立节点" class="header-anchor">#</a> 3.3.通过XML文件配置独立节点</h3> <p>通过<code>app.config</code>XML文件或/和Spring配置文件，也可以配置独立节点。上面列出的每个命令行参数，也可以用于<code>Apache.Ignite.exe.config</code>的<code>appSettings</code>段。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configSections</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>igniteConfiguration<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Apache.Ignite.Core.IgniteConfigurationSection, Apache.Ignite.Core<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configSections</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span> <span class="token attr-name">springConfigUrl</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>c:\ignite\spring.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myCache<span class="token punctuation">&quot;</span></span> <span class="token attr-name">cacheMode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Replicated<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appSettings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Ignite.Assembly.1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>my-assembly.dll<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Ignite.Assembly.2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>my-assembly2.dll<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Ignite.ConfigSectionName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>igniteConfiguration<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appSettings</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这个示例定义了<code>igniteConfiguration</code>段，并通过<code>Ignite.ConfigSectionName</code>配置用其启动Ignite，它还引用了一个Spring配置文件，两者最终会组合在一起。</p> <h3 id="_3-4-加载用户程序集"><a href="#_3-4-加载用户程序集" class="header-anchor">#</a> 3.4.加载用户程序集</h3> <p>某些Ignite的API涉及了远程代码执行，因此需要将代码和程序集一起加载到<code>Apache.Ignite.exe</code>，这可以通过<code>-Assembly</code>命令行参数或者<code>Ignite.Assembly</code>应用配置来实现。</p> <p>以下功能要求在所有节点上加载相应的程序集：</p> <ul><li><code>ICompute</code>（支持自动加载，具体可以参见<a href="/doc/2.8.0/net/Clustering.html#_7_远程程序集加载">远程程序集加载</a>）。</li> <li>带过滤器的扫描查询；</li> <li>带过滤器的持续查询；</li> <li><code>远程程序集加载</code>方法；</li> <li>带过滤器的<code>ICache.LoadCache</code>；</li> <li><code>IServices</code>；</li> <li><code>IMessaging.RemoteListen</code>；</li> <li><code>IEvents.RemoteQuery</code>。</li></ul> <div class="custom-block warning"><p class="custom-block-title">缺失用户程序集</p> <p>如果一个用户程序集无法加载，会抛出<code>Could not load file or assembly 'MyAssembly' or one of its dependencies</code>异常。</p> <p>注意任何程序集的依赖也是必须要加入该列表的。</p></div> <h3 id="_3-5-ignite-net作为windows服务"><a href="#_3-5-ignite-net作为windows服务" class="header-anchor">#</a> 3.5.Ignite.NET作为Windows服务</h3> <p><code>Apache.Ignite.exe</code>可以安装为Windows的服务，因此可以通过<code>/install</code>命令行参数自动启动。每次服务启动时，所有其它命令行参数将被保留和使用。使用<code>/uninstall</code>可以卸载服务。</p> <div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">Apache</span>.Ignite.exe <span class="token parameter attr-name">/install</span> <span class="token parameter attr-name">-J</span>-Xms513m <span class="token parameter attr-name">-J</span>-Xmx555m -ConfigSectionName=igniteConfiguration</span>
</code></pre></div><h2 id="_4-日志"><a href="#_4-日志" class="header-anchor">#</a> 4.日志</h2> <h3 id="_4-1-概述"><a href="#_4-1-概述" class="header-anchor">#</a> 4.1.概述</h3> <p>Ignite默认使用底层的Java Log4j日志记录系统，.NET和Java端的日志消息都会记录在那里，开发者也可以通过<code>IIgnite.Logger</code>记录日志。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ignite<span class="token punctuation">.</span>Logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>LoggerExtensions</code>类提供了访问<code>ILogger.Log</code>方法的各种便捷方式。</p> <h3 id="_4-2-自定义logger"><a href="#_4-2-自定义logger" class="header-anchor">#</a> 4.2.自定义Logger</h3> <p>通过<code>IgniteConfiguration.Logger</code>和<code>ILogger</code>接口，开发者可以自定义日志记录器实现，.NET和Java端的日志消息都会转发到这里。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="c#" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
  Logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MemoryLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MemoryLogger</span> <span class="token punctuation">:</span> <span class="token class-name">ILogger</span>
<span class="token punctuation">{</span>
  <span class="token comment">// Logger can be called from multiple threads, use concurrent collection</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> ConcurrentBag<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> _messages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">ConcurrentBag</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Log</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span> level<span class="token punctuation">,</span> <span class="token keyword">string</span> message<span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span>
                  <span class="token class-name">IFormatProvider</span> formatProvider<span class="token punctuation">,</span> <span class="token keyword">string</span> category<span class="token punctuation">,</span>
                  <span class="token keyword">string</span> nativeErrorInfo<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    _messages<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">bool</span> <span class="token function">IsEnabled</span><span class="token punctuation">(</span><span class="token class-name">LogLevel</span> level<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Accept any level.</span>
    <span class="token keyword">return</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="app.config" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>MyNamespace.MemoryLogger, MyAssembly<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section></div></div> <h3 id="_4-3-nlog和log4net日志"><a href="#_4-3-nlog和log4net日志" class="header-anchor">#</a> 4.3.NLog和log4net日志</h3> <p>Ignite.NET为<a href="http://nlog-project.org/" target="_self" rel="noopener noreferrer">NLog</a>和<a href="https://logging.apache.org/log4net/" target="_self" rel="noopener noreferrer">log4net</a>提供了<code>ILogger</code>实现，他们位于二进制包（<code>Apache.Ignite.NLog.dll</code>和<code>Apache.Ignite.Log4Net.dll</code>）中并且可以通过NuGet安装：</p> <ul><li><code>Install-Package Apache.Ignite.NLog</code>；</li> <li><code>Install-Package Apache.Ignite.Log4Net</code>。</li></ul> <p>NLog和Log4Net使用静态预定义的配置，因此在Ignite中无需配置<code>IgniteConfiguration.Logger</code>：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="c#" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
  Logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteNLogLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// or IgniteLog4NetLogger</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="app.config" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Apache.Ignite.NLog.IgniteNLogLogger, Apache.Ignite.NLog<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section></div></div> <p>使用NLog可以配置基于文件的简单日志，如下所示：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> nlogConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoggingConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> fileTarget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileTarget</span>
<span class="token punctuation">{</span>
  FileName <span class="token operator">=</span> <span class="token string">&quot;ignite_nlog.log&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
nlogConfig<span class="token punctuation">.</span><span class="token function">AddTarget</span><span class="token punctuation">(</span><span class="token string">&quot;logfile&quot;</span><span class="token punctuation">,</span> fileTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>

nlogConfig<span class="token punctuation">.</span>LoggingRules<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoggingRule</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> LogLevel<span class="token punctuation">.</span>Trace<span class="token punctuation">,</span> fileTarget<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
LogManager<span class="token punctuation">.</span>Configuration <span class="token operator">=</span> nlogConfig<span class="token punctuation">;</span>

<span class="token keyword">var</span> igniteConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
  Logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteNLogLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>igniteConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_5-linq实现"><a href="#_5-linq实现" class="header-anchor">#</a> 5.LINQ实现</h2> <h3 id="_5-1-概述"><a href="#_5-1-概述" class="header-anchor">#</a> 5.1.概述</h3> <p>Ignite.NET包含了一个与Ignite SQL API集成的LINQ实现。可以避免直接处理SQL语法，而是在C#中使用LINQ编写查询。Ignite LINQ实现支持ANSI-99 SQL的所有功能，包括分布式关联、分组、聚合、排序等。</p> <h3 id="_5-2-安装"><a href="#_5-2-安装" class="header-anchor">#</a> 5.2.安装</h3> <ul><li>如果使用的是Ignite二进制包：需要添加<code>Apache.Ignite.Linq.dll</code>引用；</li> <li>如果使用的是NuGet：<code>Install-Package Apache.Ignite.Linq</code>。</li></ul> <h3 id="_5-3-配置"><a href="#_5-3-配置" class="header-anchor">#</a> 5.3.配置</h3> <p>SQL索引的配置方式与常规SQL查询相同，具体请参见<a href="/doc/java/WorkingwithSQL.html#_3-定义索引">定义索引</a>章节的介绍。</p> <h3 id="_5-4-用法"><a href="#_5-4-用法" class="header-anchor">#</a> 5.4.用法</h3> <p><code>Apache.Ignite.Linq.CacheLinqExtensions</code>类是LINQ实现的入口。通过调用<code>AsCacheQueryable</code>方法可以在Ignite缓存上获取可查询实例，并在其上使用LINQ：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>ICache<span class="token operator">&lt;</span>EmployeeKey<span class="token punctuation">,</span> Employee<span class="token operator">&gt;</span> employeeCache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCache</span><span class="token punctuation">&lt;</span><span class="token class-name">EmployeeKey</span><span class="token punctuation">,</span> <span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>CacheName<span class="token punctuation">)</span><span class="token punctuation">;</span>

IQueryable<span class="token operator">&lt;</span>ICacheEntry<span class="token operator">&lt;</span>EmployeeKey<span class="token punctuation">,</span> Employee<span class="token operator">&gt;&gt;</span> queryable <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">AsCacheQueryable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Employee<span class="token punctuation">[</span><span class="token punctuation">]</span> interns <span class="token operator">=</span> queryable<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>emp <span class="token operator">=&gt;</span> emp<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>IsIntern<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">警告</p> <p>可以直接在缓存实例上使用LINQ，而无需调用<code>AsCacheQueryable()</code>。但是，这将导致LINQ到对象的查询在本地获取并处理整个缓存数据集，这是非常低效的。</p></div> <h3 id="_5-5-内省"><a href="#_5-5-内省" class="header-anchor">#</a> 5.5.内省</h3> <p>Ignite LINQ实现底层使用的是<code>ICache.QueryFields</code>。在物化语句（<code>ToList</code>、<code>ToArray</code>等）之前，都可以通过将<code>IQueryable</code>转换为<code>ICacheQueryable</code>来检查生成的<code>SqlFieldsQuery</code>：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// Create query</span>
<span class="token keyword">var</span> query <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCache</span><span class="token punctuation">&lt;</span><span class="token class-name">EmployeeKey</span><span class="token punctuation">,</span> <span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>CacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsCacheQueryable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>emp <span class="token operator">=&gt;</span> emp<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>IsIntern<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cast to ICacheQueryable</span>
<span class="token keyword">var</span> cacheQueryable <span class="token operator">=</span> <span class="token punctuation">(</span>ICacheQueryable<span class="token punctuation">)</span> query<span class="token punctuation">;</span>

<span class="token comment">// Get resulting fields query</span>
<span class="token class-name">SqlFieldsQuery</span> fieldsQuery <span class="token operator">=</span> cacheQueryable<span class="token punctuation">.</span><span class="token function">GetFieldsQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Examine generated SQL</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>fieldsQuery<span class="token punctuation">.</span>Sql<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Output: select _T0._key, _T0._val from &quot;persons&quot;.Person as _T0 where _T0.IsIntern</span>
</code></pre></div><h3 id="_5-6-投影"><a href="#_5-6-投影" class="header-anchor">#</a> 5.6.投影</h3> <p>在<code>ICacheEntry</code>对象上的简单<code>Where</code>查询操作，可以分别查询键、值或任何键和值的字段，可以使用匿名类型查询多个字段。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> query <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCache</span><span class="token punctuation">&lt;</span><span class="token class-name">EmployeeKey</span><span class="token punctuation">,</span> <span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>CacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsCacheQueryable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>emp <span class="token operator">=&gt;</span> emp<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>IsIntern<span class="token punctuation">)</span><span class="token punctuation">;</span>

IQueryable<span class="token operator">&lt;</span>EmployeeKey<span class="token operator">&gt;</span> keys <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>emp <span class="token operator">=&gt;</span> emp<span class="token punctuation">.</span>Key<span class="token punctuation">)</span><span class="token punctuation">;</span>

IQueryable<span class="token operator">&lt;</span>Employee<span class="token operator">&gt;</span> values <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>emp <span class="token operator">=&gt;</span> emp<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>

IQueryable<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> names <span class="token operator">=</span> values<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>emp <span class="token operator">=&gt;</span> emp<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> custom <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>emp <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token punctuation">{</span>Id <span class="token operator">=</span> emp<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> Name <span class="token operator">=</span> emp<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> Age <span class="token operator">=</span> emp<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Age<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-7-编译查询"><a href="#_5-7-编译查询" class="header-anchor">#</a> 5.7.编译查询</h3> <p>LINQ实现在表达式解析和SQL生成上有一些开销，因此对于经常使用的查询需要消除这个开销。</p> <p><code>Apache.Ignite.Linq.CompiledQuery</code>类支持查询的编译，调用其<code>Compile</code>方法后可以创建一个新的表示已编译查询的委托，所有的查询参数都在委托参数中。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> queryable <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCache</span><span class="token punctuation">&lt;</span><span class="token class-name">EmployeeKey</span><span class="token punctuation">,</span> <span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>CacheName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsCacheQueryable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Regular query</span>
<span class="token keyword">var</span> persons <span class="token operator">=</span> queryable<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>emp <span class="token operator">=&gt;</span> emp<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Age <span class="token operator">&gt;</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> persons<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Corresponding compiled query</span>
<span class="token keyword">var</span> compiledQuery <span class="token operator">=</span> CompiledQuery<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> queryable<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>emp <span class="token operator">=&gt;</span> emp<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Age <span class="token operator">&gt;</span> age<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
IQueryCursor<span class="token operator">&lt;</span>ICacheEntry<span class="token operator">&lt;</span>EmployeeKey<span class="token punctuation">,</span> Employee<span class="token operator">&gt;&gt;</span> cursor <span class="token operator">=</span> <span class="token function">compiledQuery</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
result <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>关于LINQ实现在性能方面的更多信息，请参见<a href="https://ptupitsyn.github.io/LINQ-vs-SQL-in-Ignite/" target="_self" rel="noopener noreferrer">LINQ和SQL</a>这篇博客文章。</p> <h3 id="_5-8-关联"><a href="#_5-8-关联" class="header-anchor">#</a> 5.8.关联</h3> <p>LINQ实现支持跨越多个缓存/表和节点的关联。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> persons <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;personCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsCacheQueryable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> orgs <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">Organization</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;orgCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsCacheQueryable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// SQL join on Person and Organization to find persons working for Apache</span>
<span class="token keyword">var</span> qry <span class="token operator">=</span> <span class="token keyword">from</span> person <span class="token keyword">in</span> persons <span class="token keyword">from</span> org <span class="token keyword">in</span> orgs
          <span class="token keyword">where</span> person<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>OrgId <span class="token operator">==</span> org<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Id
          <span class="token operator">&amp;&amp;</span> org<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">&quot;Apache&quot;</span>
          <span class="token keyword">select</span> person

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">var</span> cacheEntry <span class="token keyword">in</span> qry<span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>cacheEntry<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Same query with method syntax</span>
qry <span class="token operator">=</span> persons<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>orgs<span class="token punctuation">,</span> person <span class="token operator">=&gt;</span> person<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>OrgId<span class="token punctuation">,</span> org <span class="token operator">=&gt;</span> org<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>
<span class="token punctuation">(</span>person<span class="token punctuation">,</span> org<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token punctuation">{</span>person<span class="token punctuation">,</span> org<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>org<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">&quot;Apache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-9-包含"><a href="#_5-9-包含" class="header-anchor">#</a> 5.9.包含</h3> <p>支持<code>ICollection.Contains</code>，当需要通过一组ID检索数据时，这很有用，例如：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> persons <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;personCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsCacheQueryable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ids <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> personsByIds <span class="token operator">=</span> persons<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> ids<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>该查询会被转换为<code>…​ where Id IN (?, ?, ?)</code>命令。但是要注意，由于变量数目可变，因此无法使用编译查询。更好的替代方法是在<code>ids</code>集合上使用关联：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> persons <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;personCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AsCacheQueryable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ids <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> personsByIds <span class="token operator">=</span> persons<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>ids<span class="token punctuation">,</span>
                                person <span class="token operator">=&gt;</span> person<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>
                                id <span class="token operator">=&gt;</span> id<span class="token punctuation">,</span>
                                <span class="token punctuation">(</span>person<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> person<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>该LINQ查询会被转换为临时表关联：<code>select _T0._KEY, _T0._VAL from &quot;person&quot;.Person as _T0 inner join table (F0 int = ?) _T1 on (_T1.F0 = _T0.ID)</code>，并且只有一个数组参数，因此可以正确地缓存计划，还可以使用编译查询。</p> <h3 id="_5-10-支持的sql函数"><a href="#_5-10-支持的sql函数" class="header-anchor">#</a> 5.10.支持的SQL函数</h3> <p>以下是Ignite LINQ实现支持的.NET函数及其等价的SQL列表：</p> <table><thead><tr><th>.NET函数</th> <th>SQL函数</th></tr></thead> <tbody><tr><td><code>String.Length</code></td> <td><code>LENGTH</code></td></tr> <tr><td><code>String.ToLower</code></td> <td><code>LOWER</code></td></tr> <tr><td><code>String.ToUpper</code></td> <td><code>UPPER</code></td></tr> <tr><td><code>String.StartsWith(&quot;foo&quot;)</code></td> <td><code>LIKE 'foo%'</code></td></tr> <tr><td><code>String.EndsWith(&quot;foo&quot;)</code></td> <td><code>LIKE '%foo'</code></td></tr> <tr><td><code>String.Contains(&quot;foo&quot;)</code></td> <td><code>LIKE '%foo%'</code></td></tr> <tr><td><code>String.IndexOf(&quot;abc&quot;)</code></td> <td><code>INSTR(MyField, 'abc') - 1</code></td></tr> <tr><td><code>String.IndexOf(&quot;abc&quot;, 3)</code></td> <td><code>INSTR(MyField, 'abc', 3) - 1</code></td></tr> <tr><td><code>String.Substring(&quot;abc&quot;, 4)</code></td> <td><code>SUBSTRING(MyField, 4 + 1)</code></td></tr> <tr><td><code>String.Substring(&quot;abc&quot;, 4, 7)</code></td> <td><code>SUBSTRING(MyField, 4 + 1, 7)</code></td></tr> <tr><td><code>String.Trim()</code></td> <td><code>TRIM</code></td></tr> <tr><td><code>String.TrimStart()</code></td> <td><code>LTRIM</code></td></tr> <tr><td><code>String.TrimEnd()</code></td> <td><code>RTRIM</code></td></tr> <tr><td><code>String.Trim('x')</code></td> <td><code>TRIM(MyField, 'x')</code></td></tr> <tr><td><code>String.TrimStart('x')</code></td> <td><code>LTRIM(MyField, 'x')</code></td></tr> <tr><td><code>String.TrimEnd('x')</code></td> <td><code>RTRIM(MyField, 'x')</code></td></tr> <tr><td><code>String.Replace</code></td> <td><code>REPLACE</code></td></tr> <tr><td><code>String.PadLeft</code></td> <td><code>LPAD</code></td></tr> <tr><td><code>String.PadRight</code></td> <td><code>RPAD</code></td></tr> <tr><td><code>Regex.Replace</code></td> <td><code>REGEXP_REPLACE</code></td></tr> <tr><td><code>Regex.IsMatch</code></td> <td><code>REGEXP_LIKE</code></td></tr> <tr><td><code>Math.Abs</code></td> <td><code>ABS</code></td></tr> <tr><td><code>Math.Acos</code></td> <td><code>ACOS</code></td></tr> <tr><td><code>Math.Asin</code></td> <td><code>ASIN</code></td></tr> <tr><td><code>Math.Atan</code></td> <td><code>ATAN</code></td></tr> <tr><td><code>Math.Atan2</code></td> <td><code>ATAN2</code></td></tr> <tr><td><code>Math.Ceiling</code></td> <td><code>CEILING</code></td></tr> <tr><td><code>Math.Cos</code></td> <td><code>COS</code></td></tr> <tr><td><code>Math.Cosh</code></td> <td><code>COSH</code></td></tr> <tr><td><code>Math.Exp</code></td> <td><code>EXP</code></td></tr> <tr><td><code>Math.Floor</code></td> <td><code>FLOOR</code></td></tr> <tr><td><code>Math.Log</code></td> <td><code>LOG</code></td></tr> <tr><td><code>Math.Log10</code></td> <td><code>LOG10</code></td></tr> <tr><td><code>Math.Pow</code></td> <td><code>POWER</code></td></tr> <tr><td><code>Math.Round</code></td> <td><code>ROUND</code></td></tr> <tr><td><code>Math.Sign</code></td> <td><code>SIGN</code></td></tr> <tr><td><code>Math.Sin</code></td> <td><code>SIN</code></td></tr> <tr><td><code>Math.Sinh</code></td> <td><code>SINH</code></td></tr> <tr><td><code>Math.Sqrt</code></td> <td><code>SQRT</code></td></tr> <tr><td><code>Math.Tan</code></td> <td><code>TAN</code></td></tr> <tr><td><code>Math.Tanh</code></td> <td><code>TANH</code></td></tr> <tr><td><code>Math.Truncate</code></td> <td><code>TRUNCATE</code></td></tr> <tr><td><code>DateTime.Year</code></td> <td><code>YEAR</code></td></tr> <tr><td><code>DateTime.Month</code></td> <td><code>MONTH</code></td></tr> <tr><td><code>DateTime.Day</code></td> <td><code>DAY_OF_MONTH</code></td></tr> <tr><td><code>DateTime.DayOfYear</code></td> <td><code>DAY_OF_YEAR</code></td></tr> <tr><td><code>DateTime.DayOfWeek</code></td> <td><code>DAY_OF_WEEK - 1</code></td></tr> <tr><td><code>DateTime.Hour</code></td> <td><code>HOUR</code></td></tr> <tr><td><code>DateTime.Minute</code></td> <td><code>MINUTE</code></td></tr> <tr><td><code>DateTime.Second</code></td> <td><code>SECOND</code></td></tr></tbody></table> <h2 id="_6-执行java服务"><a href="#_6-执行java服务" class="header-anchor">#</a> 6.执行Java服务</h2> <h3 id="_6-1-概述"><a href="#_6-1-概述" class="header-anchor">#</a> 6.1.概述</h3> <p>Ignite.NET可以与.NET服务一样使用Java服务，要从.NET应用调用Java服务，需要了解服务的接口。</p> <h3 id="_6-2-示例"><a href="#_6-2-示例" class="header-anchor">#</a> 6.2.示例</h3> <p>下面通过一个示例了解如何使用此功能。</p> <h4 id="_6-2-1-创建java服务"><a href="#_6-2-1-创建java服务" class="header-anchor">#</a> 6.2.1.创建Java服务</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyJavaService</span> <span class="token keyword">implements</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>
  <span class="token comment">// Service method to be called from .NET</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testToUpper</span><span class="token punctuation">(</span><span class="token class-name">String</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Service interface implementation</span>
  <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token class-name">ServiceContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// No-op.  }</span>
  <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">ServiceContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span> <span class="token comment">// No-op. }</span>
  <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">ServiceContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span> <span class="token comment">// No-op. }</span>
<span class="token punctuation">}</span>
</code></pre></div><p>该Java服务可以部署在任何节点（.NET、C++、仅Java）上，因此对部署没有限制：</p> <div class="language-java extra-class"><pre class="language-java"><code>ignite<span class="token punctuation">.</span><span class="token function">services</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deployClusterSingleton</span><span class="token punctuation">(</span><span class="token string">&quot;myJavaSvc&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MyJavaService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-2-2-net端调用java服务"><a href="#_6-2-2-net端调用java服务" class="header-anchor">#</a> 6.2.2..NET端调用Java服务</h4> <p>创建服务接口的.NET版本：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// Interface can have any name</span>
<span class="token keyword">interface</span> <span class="token class-name">IJavaService</span>
<span class="token punctuation">{</span>
  <span class="token comment">// Method must have the same name (case-sensitive) and same signature:</span>
  <span class="token comment">// argument types and order.</span>
  <span class="token comment">// Argument names and return type do not matter.</span>
  <span class="token keyword">string</span> <span class="token function">testToUpper</span><span class="token punctuation">(</span><span class="token keyword">string</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>获取服务代理并调用该方法：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
  <span class="token comment">// Make sure that Java service class is in classpath on all nodes, including .NET</span>
  JvmClasspath <span class="token operator">=</span> <span class="token string">@&quot;c:\my-project\src\Java\target\classes\&quot;
}

var ignite = Ignition.Start(config);

// Make sure to use the same service name as in deployment
var prx = ignite.GetServices().GetServiceProxy&lt;IJavaService&gt;(&quot;</span>myJavaSvc&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">string</span> result <span class="token operator">=</span> prx<span class="token punctuation">.</span><span class="token function">testToUpper</span><span class="token punctuation">(</span><span class="token string">&quot;invoking Java service...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-3-接口方法映射"><a href="#_6-3-接口方法映射" class="header-anchor">#</a> 6.3.接口方法映射</h3> <p>.NET服务接口动态映射到其对应的Java对象，这是在方法调用时发生的：</p> <ul><li>不必在.NET接口中指定所有Java服务方法；</li> <li>.NET接口可以包含Java服务中不存在的成员，除非调用这些缺少的方法，否则不会抛出任何异常。</li></ul> <p>Java方法解析方式如下：</p> <ul><li>Ignite寻找具有指定名称和参数计数的方法。如果只找到一个，Ignite将使用它；</li> <li>在匹配的方法中，Ignite会寻找参数兼容的方法（通过<code>Class.isAssignableFrom</code>）。如果兼容Ignite会调用该方法，如果不兼容则会抛出异常；</li> <li>方法返回类型将被忽略，因为.NET和Java不允许同一个方法有不同的返回类型。</li></ul> <p>有关方法参数和结果映射的详细信息，请参见<a href="#_11-3-%E7%B1%BB%E5%9E%8B%E5%85%BC%E5%AE%B9%E6%80%A7">类型兼容性</a>章节的介绍。注意<code>params/varargs</code>也是支持的，因为在.NET和Java中，它们是对象数组的语法糖。</p> <h2 id="_7-net平台缓存"><a href="#_7-net平台缓存" class="header-anchor">#</a> 7..NET平台缓存</h2> <div class="custom-block warning"><p class="custom-block-title">警告</p> <p>这是一个试验性API。</p></div> <p>Ignite.NET在<a href="https://docs.microsoft.com/en-us/dotnet/standard/clr" target="_self" rel="noopener noreferrer">CLR</a>堆中提供了额外的缓存层，平台缓存会保留当前节点上存在的每个缓存条目的反序列化副本，从而以增加内存使用为代价大大提高了缓存读取性能。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>事务中绕过平台缓存：在事务中<code>cache.Get</code>以及下面列出的其他API不会使用平台缓存，事务支持后续会推出。</p></div> <h3 id="_7-1-配置平台缓存"><a href="#_7-1-配置平台缓存" class="header-anchor">#</a> 7.1.配置平台缓存</h3> <h4 id="_7-1-1-服务端节点"><a href="#_7-1-1-服务端节点" class="header-anchor">#</a> 7.1.1.服务端节点</h4> <p>通过设置<code>CacheConfiguration.PlatformCacheConfiguration</code>为非空值，可以为所有服务端节点配置平台缓存。服务端节点上的平台缓存将分配给该节点的所有主缓存和备份缓存项存储在.NET内存中。条目是实时更新的，在任何时刻都保证是最新的，甚至在用户代码访问它们之前。</p> <div class="custom-block warning"><p class="custom-block-title">警告</p> <p>平台缓存导致服务端节点上的内存使用量翻倍，每个缓存项存储两次：在堆外内存中序列化，在CLR堆中反序列化。</p></div> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cacheCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;my-cache&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    PlatformCacheConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PlatformCacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CreateCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>cacheCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_7-1-2-客户端节点"><a href="#_7-1-2-客户端节点" class="header-anchor">#</a> 7.1.2.客户端节点</h4> <p>客户端节点上的平台缓存需要配置<a href="/doc/java/ConfiguringCaches.html#_8-近缓存">近缓存</a>，因为客户端节点不会存储数据。客户端节点上的平台缓存与该节点上的近缓存保持相同的条目集，近缓存的退出策略也适用于平台缓存。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> nearCacheCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NearCacheConfiguration</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Keep up to 1000 most recently used entries in Near and Platform caches.</span>
    EvictionPolicy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LruEvictionPolicy</span>
    <span class="token punctuation">{</span>
        MaxSize <span class="token operator">=</span> <span class="token number">1000</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CreateNearCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;my-cache&quot;</span><span class="token punctuation">,</span>
    nearCacheCfg<span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">PlatformCacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-2-支持的api"><a href="#_7-2-支持的api" class="header-anchor">#</a> 7.2.支持的API</h3> <p>下面的<code>ICache&lt;K, V&gt;</code>API会使用平台缓存（包括对应的异步版本）：</p> <ul><li><code>Get</code>、<code>TryGet</code>、索引（<code>ICache[k]</code>）；</li> <li><code>GetAll</code>（首先从平台缓存读取，并在必要时回退到分布式缓存）；</li> <li><code>ContainsKey</code>、<code>ContainsKeys</code>；</li> <li><code>LocalPeek</code>、<code>TryLocalPeek</code>；</li> <li><code>GetLocalEntries</code>；</li> <li><code>GetLocalSize</code>；</li> <li>使用<code>ScanQuery</code>的<code>Query</code>：
<ul><li>使用平台缓存将值传递给<code>ScanQuery.Filter</code>；</li> <li>在<code>ScanQuery.Local</code>为<code>true</code>以及<code>ScanQuery.Partition</code>不为空时直接迭代平台缓存。</li></ul></li></ul> <h3 id="_7-3-直接访问平台缓存数据"><a href="#_7-3-直接访问平台缓存数据" class="header-anchor">#</a> 7.3.直接访问平台缓存数据</h3> <p>无需修改代码即可利用平台缓存。已有的对<code>ICache.Get</code>以及上面列出的其他API的调用，都会尽可能从平台缓存读取来改进性能，当平台缓存中不存在该条目时，Ignite会退回到正常路径并从集群中检索数据。</p> <p>但是，有时可能希望专门访问平台缓存，从而避免Java和网络调用，<code>Local</code>API结合<code>CachePeekMode.Platform</code>可以做到这一点：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;my-cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get value from platform cache.</span>
<span class="token keyword">bool</span> hasKey <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">TryLocalPeek</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token keyword">var</span> val<span class="token punctuation">,</span> CachePeekMode<span class="token punctuation">.</span>Platform<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get platform cache size (current number of entries on local node).</span>
<span class="token keyword">int</span> size <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">GetLocalSize</span><span class="token punctuation">(</span>CachePeekMode<span class="token punctuation">.</span>Platform<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get all values from platform cache.</span>
IEnumerable<span class="token operator">&lt;</span>ICacheEntry<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token operator">&gt;&gt;</span> entries <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">GetLocalEntries</span><span class="token punctuation">(</span>CachePeekMode<span class="token punctuation">.</span>Platform<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-4-高级配置"><a href="#_7-4-高级配置" class="header-anchor">#</a> 7.4.高级配置</h3> <h4 id="_7-4-1-二进制模式"><a href="#_7-4-1-二进制模式" class="header-anchor">#</a> 7.4.1.二进制模式</h4> <p>如果要在平台缓存中使用<a href="/doc/java/UsingKeyValueApi.html#_2-使用二进制对象">二进制对象</a>，需要将<code>PlatformCacheConfiguration.KeepBinary</code>配置为<code>true</code>：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cacheCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;people&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    PlatformCacheConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PlatformCacheConfiguration</span>
    <span class="token punctuation">{</span>
        KeepBinary <span class="token operator">=</span> <span class="token keyword">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CreateCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>cacheCfg<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">WithKeepBinary</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">IBinaryObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IBinaryObject</span> binaryPerson <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_7-4-2-键和值类型"><a href="#_7-4-2-键和值类型" class="header-anchor">#</a> 7.4.2.键和值类型</h4> <p>在将Ignite缓存与<a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/value-types" target="_self" rel="noopener noreferrer">值类型</a>一起使用时，应相应地设置<code>PlatformCacheConfiguration.KeyTypeName</code>和<code>ValueTypeName</code>以获得最佳性能并减少GC压力：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cacheCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;people&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    PlatformCacheConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PlatformCacheConfiguration</span>
    <span class="token punctuation">{</span>
        KeyTypeName <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">.</span>FullName<span class="token punctuation">,</span>
        ValueTypeName <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span>Guid<span class="token punctuation">)</span><span class="token punctuation">.</span>FullName
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CreateCache</span><span class="token punctuation">&lt;</span><span class="token keyword">long</span><span class="token punctuation">,</span> <span class="token class-name">Guid</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>cacheCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Ignite默认使用<code>ConcurrentDictionary&lt;object, object&gt;</code>存储平台缓存数据，因为实际类型事先未知。这将导致对值类型进行<a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/types/boxing-and-unboxing" target="_self" rel="noopener noreferrer">装箱和拆箱</a>，从而降低性能并消耗更多的内存。当在<code>PlatformCacheConfiguration</code>中配置<code>KeyTypeName</code>和<code>ValueTypeName</code>时，Ignite会使用这些类型来创建一个内部的<code>ConcurrentDictionary</code>而不是默认的<code>object</code>。</p> <div class="custom-block warning"><p class="custom-block-title">警告</p> <p>错误的<code>KeyTypeName</code>和/或<code>ValueTypeName</code>设置可能导致运行时强制转换异常。</p></div> <h2 id="_8-插件"><a href="#_8-插件" class="header-anchor">#</a> 8.插件</h2> <h3 id="_8-1-概述"><a href="#_8-1-概述" class="header-anchor">#</a> 8.1.概述</h3> <p>Ignite.NET的插件系统使得第三方可以扩展Ignite.NET的核心功能。解释Ignite插件的工作方式的最好方法是查看插件的生命周期。</p> <h3 id="_8-2-igniteconfiguration-pluginconfigurations"><a href="#_8-2-igniteconfiguration-pluginconfigurations" class="header-anchor">#</a> 8.2.IgniteConfiguration.PluginConfigurations</h3> <p>作为一个Ignite插件，首先需要在<code>IgniteConfiguration.PluginConfigurations</code>属性上注册<code>IPluginConfiguration</code>接口的实现，从用户的角度来看，这是一个手动过程，即必须明确引用和配置插件的程序集。</p> <p><code>IPluginConfiguration</code>接口有两个与Ignite.NET的Java部分交互的方法，下面会有介绍。除此之外<code>IPluginConfiguration</code>实现还应包含所有其他和插件有关的配置属性。</p> <p><code>IPluginConfiguration</code>实现的另一部分是必要的<code>PluginProviderType</code>属性，其会将插件配置与插件的实现进行链接，例如：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token punctuation">[</span><span class="token class-name">PluginProviderType</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>MyPluginProvider<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyPluginConfiguration</span> <span class="token punctuation">:</span> <span class="token class-name">IPluginConfiguration</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> MyProperty <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// Plugin-specific property</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">?</span> PluginConfigurationClosureFactoryId
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// No Java part</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">WriteBinary</span><span class="token punctuation">(</span><span class="token class-name">IBinaryRawWriter</span> writer<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// No-op.</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre></div><p>总结：</p> <ul><li>开发者将<code>IPluginConfiguration</code>实现的实例添加到<code>IgniteConfiguration</code>中；</li> <li>使用准备好的配置启动Ignite节点；</li> <li>在Ignite节点初始化完成之前，插件引擎将检查<code>IPluginConfiguration</code>实现的<code>PluginProviderType</code>属性并实例化指定的类；</li></ul> <h3 id="_8-3-ipluginprovider"><a href="#_8-3-ipluginprovider" class="header-anchor">#</a> 8.3.IPluginProvider</h3> <p><code>IPluginProvider</code>实现是新添加的插件的主力，它通过处理<code>OnIgniteStart</code>和<code>OnIgniteStop</code>方法的调用来处理Ignite节点的生命周期，另外它还通过<code>GetPlugin&lt;T&gt;()</code>方法为开发者提供了一个可选的API。</p> <p>Ignite.NET引擎在<code>IPluginProvider</code>实现上要调用的第一个方法是<code>Start(IPluginContext&lt;TestIgnitePluginConfiguration&gt; context)</code>，<code>IPluginContext</code>中可以访问初始的插件配置以及与Ignite进行交互的所有方法。</p> <p>当停止Ignite时，会依次调用<code>Stop</code>和<code>OnIgniteStop</code>方法，以便插件实现可以完成所有的清理和关闭相关的任务。</p> <h3 id="_8-4-iignite-getplugin"><a href="#_8-4-iignite-getplugin" class="header-anchor">#</a> 8.4.IIgnite.GetPlugin</h3> <p>通过<code>IIgnite.GetPlugin(string name)</code>方法可以访问插件暴露给用户的API，Ignite引擎会使用传递的名字查找<code>IPluginProvider</code>并在其上调用<code>GetPlugin</code>。</p> <h3 id="_8-5-与java交互"><a href="#_8-5-与java交互" class="header-anchor">#</a> 8.5.与Java交互</h3> <p>Ignite.NET插件可以通过<code>PlatformTarget</code>和<code>IPlatformTarget</code>接口对与Ignite Java插件进行交互。</p> <h4 id="_8-5-1-java端"><a href="#_8-5-1-java端" class="header-anchor">#</a> 8.5.1.Java端</h4> <ul><li>实现<code>PlatformTarget</code>接口，它是与.NET的通信端点：</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">MyPluginTarget</span> <span class="token keyword">implements</span> <span class="token class-name">PlatformTarget</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">processInLongOutLong</span><span class="token punctuation">(</span><span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">long</span> val<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IgniteCheckedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    	<span class="token keyword">return</span> val <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
      <span class="token keyword">return</span> val <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token comment">// Other methods here.</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>实现<code>PlatformPluginExtension</code>接口：</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyPluginExtension</span> <span class="token keyword">implements</span> <span class="token class-name">PlatformPluginExtension</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">42</span><span class="token punctuation">;</span>  <span class="token comment">// Unique id to be used from .NET side.</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">PlatformTarget</span> <span class="token function">createTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPluginTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Return target from previous step.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>实现<code>PluginProvider.initExtensions</code>方法并注册<code>PlatformPluginExtension</code>类：</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initExtensions</span><span class="token punctuation">(</span><span class="token class-name">PluginContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">ExtensionRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  registry<span class="token punctuation">.</span><span class="token function">registerExtension</span><span class="token punctuation">(</span><span class="token class-name">PlatformPluginExtension</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MyPluginExtension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_8-5-2-net端"><a href="#_8-5-2-net端" class="header-anchor">#</a> 8.5.2..NET端</h4> <p>通过对应的ID调用<code>IPluginContext.GetExtension</code>，其会调用Java端的<code>createTarget</code>方法：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">IPlatformTarget</span> extension <span class="token operator">=</span> pluginContext<span class="token punctuation">.</span><span class="token function">GetExtension</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> result <span class="token operator">=</span> extension<span class="token punctuation">.</span><span class="token function">InLongOutLong</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// processInLongOutLong is called in Java</span>
</code></pre></div><p>其他的<code>IPlatformTarget</code>方法会以高效的方式在Java和.NET之间交换任意类型的数据。</p> <h4 id="_8-5-3-java端的回调"><a href="#_8-5-3-java端的回调" class="header-anchor">#</a> 8.5.3.Java端的回调</h4> <p>上面介绍了.NET -&gt; Java的调用机制，当然也可以进行Java -&gt; .NET的调用：</p> <ul><li>在.NET端通过<code>RegisterCallback</code>方法使用一些ID注册回调处理器；</li> <li>在Java端使用该ID调用<code>PlatformCallbackGateway.pluginCallback</code>。</li></ul> <div class="custom-block tip"><p class="custom-block-title">完整的示例</p> <p>完整的示例，可以参见这篇<a href="https://ptupitsyn.github.io/Ignite-Plugin/" target="_self" rel="noopener noreferrer">文章</a>。</p></div> <h2 id="_9-序列化"><a href="#_9-序列化" class="header-anchor">#</a> 9.序列化</h2> <p>大多数用户定义的类都会使用Ignite.NET API通过网络传递给其他节点，这些类包括：</p> <ul><li>缓存键和值；</li> <li>缓存处理器和过滤器（<code>ICacheEntryProcessor</code>、<code>ICacheEntryFilter</code>、<code>ICacheEntryEventFilter</code>、<code>ICacheEntryEventListener</code>）；</li> <li>计算函数（<code>IComputeFunc</code>）、操作（<code>IComputeAction</code>）和作业（<code>IComputeJob</code>）；</li> <li>服务（<code>IService</code>）；</li> <li>事件和消息处理器（<code>IEventListener</code>，<code>IEventFilter</code>，<code>IMessageListener</code>）。</li></ul> <p>通过网络传输的这些类对象需要序列化，Ignite.NET支持以下序列化用户数据的方式：</p> <ul><li><code>Apache.Ignite.Core.Binary.IBinarizable</code>接口；</li> <li><code>Apache.Ignite.Core.Binary.IBinarySerializer</code>接口；</li> <li><code>System.Runtime.Serialization.ISerializable</code>接口；</li> <li>Ignite反射式序列化（当以上都不适用时）。</li></ul> <h3 id="_9-1-ibinarizable"><a href="#_9-1-ibinarizable" class="header-anchor">#</a> 9.1.IBinarizable</h3> <p><code>IBinarizable</code>方式提供了对序列化的细粒度控制，这是高性能生产代码的首选方法。</p> <p>首先，在自己的类中实现<code>IBinarizable</code>接口：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">:</span> <span class="token class-name">IBinarizable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Street <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> Zip <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">WriteBinary</span><span class="token punctuation">(</span><span class="token class-name">IBinaryWriter</span> writer<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Alphabetic field order is required for SQL DML to work.</span>
        <span class="token comment">// Even if DML is not used, alphabetic order is recommended.</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">&quot;street&quot;</span><span class="token punctuation">,</span> Street<span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteInt</span><span class="token punctuation">(</span><span class="token string">&quot;zip&quot;</span><span class="token punctuation">,</span> Zip<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ReadBinary</span><span class="token punctuation">(</span><span class="token class-name">IBinaryReader</span> reader<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      	<span class="token comment">// Read order does not matter, however, reading in the same order</span>
        <span class="token comment">// as writing improves performance.</span>
        Street <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token string">&quot;street&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Zip <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadInt</span><span class="token punctuation">(</span><span class="token string">&quot;zip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>IBinarizable</code>也可以在没有字段名的原始模式下实现，这提供了最快和最紧凑的序列化，但是SQL查询不可用：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">:</span> <span class="token class-name">IBinarizable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Street <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> Zip <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">WriteBinary</span><span class="token punctuation">(</span><span class="token class-name">IBinaryWriter</span> writer<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> rawWriter <span class="token operator">=</span> writer<span class="token punctuation">.</span><span class="token function">GetRawWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        rawWriter<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>Street<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rawWriter<span class="token punctuation">.</span><span class="token function">WriteInt</span><span class="token punctuation">(</span>Zip<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ReadBinary</span><span class="token punctuation">(</span><span class="token class-name">IBinaryReader</span> reader<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Read order must be the same as write order</span>
        <span class="token keyword">var</span> rawReader <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">GetRawReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Street <span class="token operator">=</span> rawReader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Zip <span class="token operator">=</span> rawReader<span class="token punctuation">.</span><span class="token function">ReadInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">自动化GetHashCode和Equals实现</p> <p>如果对象可以序列化为二进制形式，则Ignite将在序列化时计算其哈希值，并将其写入二进制数组。此外，Ignite还提供了<code>equals</code>方法的自定义实现，用于二进制对象的比较。这意味着无需覆盖自定义键和值的<code>GetHashCode</code>和<code>Equals</code>方法即可在Ignite中使用它们。</p></div> <h3 id="_9-2-ibinaryserializer"><a href="#_9-2-ibinaryserializer" class="header-anchor">#</a> 9.2.IBinarySerializer</h3> <p><code>IBinarySerializer</code>与<code>IBinarizable</code>类似，但是将序列化逻辑与类实现分开。当无法修改类代码，并且在多个类之间共享序列化逻辑等场景时，这可能很有用。以下代码产生与上面的<code>Address</code>示例完全相同的序列化：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">:</span> <span class="token class-name">IBinarizable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Street <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> Zip <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddressSerializer</span> <span class="token punctuation">:</span> <span class="token class-name">IBinarySerializer</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">WriteBinary</span><span class="token punctuation">(</span><span class="token keyword">object</span> obj<span class="token punctuation">,</span> <span class="token class-name">IBinaryWriter</span> writer<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      	<span class="token keyword">var</span> addr <span class="token operator">=</span> <span class="token punctuation">(</span>Address<span class="token punctuation">)</span> obj<span class="token punctuation">;</span>

        writer<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">&quot;street&quot;</span><span class="token punctuation">,</span> addr<span class="token punctuation">.</span>Street<span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteInt</span><span class="token punctuation">(</span><span class="token string">&quot;zip&quot;</span><span class="token punctuation">,</span> addr<span class="token punctuation">.</span>Zip<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ReadBinary</span><span class="token punctuation">(</span><span class="token keyword">object</span> obj<span class="token punctuation">,</span> <span class="token class-name">IBinaryReader</span> reader<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      	<span class="token keyword">var</span> addr <span class="token operator">=</span> <span class="token punctuation">(</span>Address<span class="token punctuation">)</span> obj<span class="token punctuation">;</span>

        addr<span class="token punctuation">.</span>Street <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token string">&quot;street&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        addr<span class="token punctuation">.</span>Zip <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadInt</span><span class="token punctuation">(</span><span class="token string">&quot;zip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>序列化器应在配置中指定，如下：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    BinaryConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BinaryConfiguration</span>
    <span class="token punctuation">{</span>
        TypeConfigurations <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">BinaryTypeConfiguration</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span>Address<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Serializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AddressSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_9-3-iserializable"><a href="#_9-3-iserializable" class="header-anchor">#</a> 9.3.ISerializable</h3> <p>实现<code>System.Runtime.Serialization.ISerializable</code>接口的类型将相应地进行序列化（通过调用<code>GetObjectData</code>和序列化构造函数）。所有的系统功能都支持：包括<code>IObjectReference</code>、<code>IDeserializationCallback</code>、<code>OnSerializingAttribute</code>、<code>OnSerializedAttribute</code>、<code>OnDeserializingAttribute</code>、<code>OnDeserializedAttribute</code>。</p> <p><code>GetObjectData</code>的结果以Ignite二进制格式写入，以下三个类提供相同的序列化表示形式：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">Reflective</span>
<span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">string</span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Binarizable</span> <span class="token punctuation">:</span> <span class="token class-name">IBinarizable</span>
<span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">string</span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">WriteBinary</span><span class="token punctuation">(</span><span class="token class-name">IBinaryWriter</span> writer<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		writer<span class="token punctuation">.</span><span class="token function">WriteInt</span><span class="token punctuation">(</span><span class="token string">&quot;Id&quot;</span><span class="token punctuation">,</span> Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
		writer<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ReadBinary</span><span class="token punctuation">(</span><span class="token class-name">IBinaryReader</span> reader<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		Id <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadInt</span><span class="token punctuation">(</span><span class="token string">&quot;Id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Name <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Serializable</span> <span class="token punctuation">:</span> <span class="token class-name">ISerializable</span>
<span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">string</span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">Serializable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

	<span class="token keyword">protected</span> <span class="token function">Serializable</span><span class="token punctuation">(</span><span class="token class-name">SerializationInfo</span> info<span class="token punctuation">,</span> <span class="token class-name">StreamingContext</span> context<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		Id <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">GetInt32</span><span class="token punctuation">(</span><span class="token string">&quot;Id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Name <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">GetObjectData</span><span class="token punctuation">(</span><span class="token class-name">SerializationInfo</span> info<span class="token punctuation">,</span> <span class="token class-name">StreamingContext</span> context<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		info<span class="token punctuation">.</span><span class="token function">AddValue</span><span class="token punctuation">(</span><span class="token string">&quot;Id&quot;</span><span class="token punctuation">,</span> Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
		info<span class="token punctuation">.</span><span class="token function">AddValue</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_9-4-ignite反射式序列化"><a href="#_9-4-ignite反射式序列化" class="header-anchor">#</a> 9.4.Ignite反射式序列化</h3> <p>Ignite反射式序列化本质上是一种<code>IBinarizable</code>方式，其是通过反射所有字段并发出读/写调用自动实现的。</p> <p>该机制没有条件，任何类或结构都可以序列化（包括所有系统类型、委托、表达式树、匿名类型等）。</p> <p>可以使用<code>NonSerialized</code>属性排除不需要的字段。</p> <p>可以通过<code>BinaryReflectiveSerializer</code>显式启用原始模式：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="c#" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> binaryConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BinaryConfiguration</span>
<span class="token punctuation">{</span>
    TypeConfigurations <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">BinaryTypeConfiguration</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>MyClass<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Serializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BinaryReflectiveSerializer</span> <span class="token punctuation">{</span>RawMode <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="app.config" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>binaryConfiguration</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeConfigurations</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>binaryTypeConfiguration</span> <span class="token attr-name">typeName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Apache.Ignite.ExamplesDll.Binary.Address<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>serializer</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Apache.Ignite.Core.Binary.BinaryReflectiveSerializer, Apache.Ignite.Core<span class="token punctuation">'</span></span> <span class="token attr-name">rawMode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>true<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>binaryTypeConfiguration</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeConfigurations</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>binaryConfiguration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section></div></div> <p>如果没有这个配置，<code>BinaryConfiguration</code>是不需要的。</p> <p>性能与手工实现<code>IBinarizable</code>相同，反射只在启动阶段使用，用于遍历所有的字段并发出有效的IL代码。</p> <p>带有<code>Serializable</code>属性但没有<code>ISerializable</code>接口的类型使用Ignite反射式序列化器写入。</p> <h3 id="_9-5-使用entity-framework-pocos"><a href="#_9-5-使用entity-framework-pocos" class="header-anchor">#</a> 9.5.使用Entity Framework POCOs</h3> <p>Ignite中可以直接使用Entity Framework POCOs。</p> <p>但是，Ignite无法直接序列化或反序列化POCO代理<a href="https://msdn.microsoft.com/en-us/data/jj592886.aspx" target="_self" rel="noopener noreferrer">https://msdn.microsoft.com/zh-cn/data/jj592886.aspx</a>，因为代理类型是动态类型。</p> <p>将EF对象与Ignite结合使用时，要确认禁用创建代理：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="entity-framework-6" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code>ctx<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span>ProxyCreationEnabled <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="entity-framework-5" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code>ctx<span class="token punctuation">.</span>ContextOptions<span class="token punctuation">.</span>ProxyCreationEnabled <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h3 id="_9-6-更多信息"><a href="#_9-6-更多信息" class="header-anchor">#</a> 9.6.更多信息</h3> <p>有关本章节介绍的各种模式的序列化性能的更多信息，请参见<a href="https://ptupitsyn.github.io/Ignite-Serialization-Performance/" target="_self" rel="noopener noreferrer">Ignite的序列化性能</a>这篇文章。</p> <h2 id="_10-跨平台支持"><a href="#_10-跨平台支持" class="header-anchor">#</a> 10.跨平台支持</h2> <h3 id="_10-1-概述"><a href="#_10-1-概述" class="header-anchor">#</a> 10.1.概述</h3> <p>从2.4版本开始，同Windows平台一样，也可以在Linux和macOS平台上运行.NET节点以及开发Ignite.NET应用，.NET Core和Mono平台都是支持的。</p> <h3 id="_10-2-net-core"><a href="#_10-2-net-core" class="header-anchor">#</a> 10.2..NET Core</h3> <p><strong>环境要求</strong></p> <ul><li><a href="https://www.microsoft.com/net/download/" target="_self" rel="noopener noreferrer">.NET Core SDK 2.0+</a>；</li> <li><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_self" rel="noopener noreferrer">Java 8+</a>（macOS需要JDK，否则JRE也可以）。</li></ul> <p><strong>运行二进制包中的示例</strong></p> <ul><li>从<a href="https://ignite.apache.org/download.cgi#binaries" target="_self" rel="noopener noreferrer">这里</a>下载二进制包然后解压；</li> <li><code>cd platforms/dotnet/examples/dotnetcore</code>；</li> <li><code>dotnet run</code>。</li></ul> <h3 id="_10-3-java检测"><a href="#_10-3-java检测" class="header-anchor">#</a> 10.3.Java检测</h3> <p>Ignite.NET会在如下位置寻找Java安装目录：</p> <ul><li><code>HKLM\Software\JavaSoft\Java Runtime Environment</code>(Windows)；</li> <li><code>/usr/bin/java</code>(Linux)；</li> <li><code>/Library/Java/JavaVirtualMachines</code>(macOS)。</li></ul> <p>如果修改了Java的默认位置，那么需要使用下面的方法之一指定实际的位置：</p> <ul><li>配置<code>IgniteConfiguration.JvmDllPath</code>属性；</li> <li>配置<code>JAVA_HOME</code>环境变量。</li></ul> <h3 id="_10-4-已知问题"><a href="#_10-4-已知问题" class="header-anchor">#</a> 10.4.已知问题</h3> <p><strong>No Java runtime present, requesting install</strong></p> <p>在macOS上Java的<code>8u151</code>版本存在一个问题：<a href="https://bugs.openjdk.java.net/browse/JDK-7131356" target="_self" rel="noopener noreferrer">JDK-7131356</a>，一定要安装<code>8u152</code>及其以后的版本。</p> <p><strong>Serializing delegates is not supported on this platform</strong></p> <p>.NET Core不支持序列化委托，执行<code>System.MulticastDelegate.GetObjectData</code><a href="https://github.com/dotnet/coreclr/blob/master/src/mscorlib/src/System/MulticastDelegate.cs#L52" target="_self" rel="noopener noreferrer">会抛出异常</a>，因此Ignite.NET无法对委托或包含委托的对象进行序列化。</p> <p><strong>Could not load file or assembly 'System.Configuration.ConfigurationManager'</strong></p> <p>已知的<a href="https://github.com/dotnet/standard/issues/506" target="_self" rel="noopener noreferrer">.NET问题(506)</a>，有时需要额外的包引用：</p> <ul><li><code>dotnet add package System.Configuration.ConfigurationManager</code></li></ul> <h2 id="_11-平台互操作性"><a href="#_11-平台互操作性" class="header-anchor">#</a> 11.平台互操作性</h2> <p>Ignite允许不同的平台（例如.NET、Java和C++）彼此互操作，由一个平台定义和写入Ignite的类和对象可以由另一平台读取和使用。</p> <h3 id="_11-1-标识符"><a href="#_11-1-标识符" class="header-anchor">#</a> 11.1.标识符</h3> <p>为了实现互操作性，Ignite使用通用二进制格式写入对象，此格式使用整数标识符对对象类型和字段进行编码。</p> <p>Ignite通过两个阶段，将对象的类型和字段名转换为整数值：</p> <ul><li>名称转换：将完整的类型名和字段名传递给<code>IBinaryNameMapper</code>接口，并转换为某种通用形式；</li> <li>ID转换：将生成的字符串传递给<code>IBinaryIdMapper</code>以生成字段ID或者类型ID。</li></ul> <p>可以在<code>BinaryConfiguration</code>中配置全局映射器，也可以在<code>BinaryTypeConfiguration</code>中为具体类型配置映射器。</p> <p>Java有相同的接口<code>BinaryNameMapper</code>和<code>BinaryIdMapper</code>，它们也是配置在<code>BinaryConfiguration</code>或<code>BinaryTypeConfiguration</code>上。</p> <h3 id="_11-2-默认行为"><a href="#_11-2-默认行为" class="header-anchor">#</a> 11.2.默认行为</h3> <p>.NET和Java类型必须映射到相同的类型ID，并且相关字段必须映射到相同的字段ID。</p> <p>Ignite.NET的.NET部分默认会应用以下转换：</p> <ul><li>名称转换：<code>System.Type.FullName</code>面向非泛型类型的属性，字段或属性名称不变；</li> <li>ID转换：将名称转换为小写，然后以与Java中的<code>java.lang.String.hashCode()</code>方法相同的方式计算ID。</li></ul> <p>Ignite.NET的Java部分默认会应用以下转换：</p> <ul><li>名称转换：<code>Class.getName()</code>方法用于获取类名称，字段名称保持不变；</li> <li>ID转换：将名称转换为小写，然后用<code>java.lang.String.hashCode()</code>计算ID。</li></ul> <p>例如，如果以下两种类型在.NET命名空间和Java包外部，则它们将自动彼此映射：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="c#" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">Person</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Data <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Person</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <p>不过类型通常在某些命名空间或包中，包和命名空间的命名约定在Java和.NET中有所不同，.NET命名空间与Java包相同可能会出现问题。</p> <p>简单名称映射器（忽略命名空间）可以避免此问题，其应该在.NET端和Java端中同时配置：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java-spring-xml" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>grid.cfg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>binaryConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.BinaryConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>nameMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.binary.BinaryBasicNameMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>simpleName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="c#" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
  BinaryConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BinaryConfiguration</span>
  <span class="token punctuation">{</span>
    NameMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BinaryBasicNameMapper</span> <span class="token punctuation">{</span>IsSimpleName <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></section> <section aria-hidden="true" id="app.config" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>binaryConfiguration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nameMapper</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Apache.Ignite.Core.Binary.BinaryBasicNameMapper, Apache.Ignite.Core<span class="token punctuation">&quot;</span></span> <span class="token attr-name">isSimpleName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>binaryConfiguration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section></div></div> <h3 id="_11-3-类型兼容性"><a href="#_11-3-类型兼容性" class="header-anchor">#</a> 11.3.类型兼容性</h3> <table><thead><tr><th>C#</th> <th>Java</th></tr></thead> <tbody><tr><td><code>bool</code></td> <td><code>boolean</code></td></tr> <tr><td><code>byte</code>(*)，<code>sbyte</code></td> <td><code>byte</code></td></tr> <tr><td><code>short</code>，<code>ushort</code>(*)</td> <td><code>short</code></td></tr> <tr><td><code>int</code>, <code>uint</code>(*)</td> <td><code>int</code></td></tr> <tr><td><code>long</code>,<code>ulong</code>(*)</td> <td><code>long</code></td></tr> <tr><td><code>char</code></td> <td><code>char</code></td></tr> <tr><td><code>float</code></td> <td><code>float</code></td></tr> <tr><td><code>double</code></td> <td><code>double</code></td></tr> <tr><td><code>decimal</code></td> <td><code>java.math.BigDecimal</code>(**)</td></tr> <tr><td><code>decimal</code></td> <td><code>java.lang.String</code></td></tr> <tr><td><code>Guid</code></td> <td><code>java.util.UUID</code></td></tr> <tr><td><code>DateTime</code></td> <td><code>java.util.Date</code>,<code>java.sql.Timestamp</code></td></tr></tbody></table> <ul><li><code>byte</code>，<code>ushort</code>，<code>uint</code>，<code>ulong</code>没有对应的Java类型，将直接按字节映射（无范围检查），例如在C#中<code>byte</code>值为<code>200</code>，对应在Java中为有符号的<code>byte</code>值<code>-56</code>。</li></ul> <p>** Java中<code>BigDecimal</code>可以有任意的大小和精度，而C#中数值型固定为16个字节和28-29位精度，如果反序列化时一个<code>BigDecimal</code>无法匹配<code>decimal</code>，则Ignite.NET会抛出<code>BinaryObjectException</code>。</p> <p><strong>Enum</strong>：在Ignite中，Java的<code>writeEnum</code>只会写入序数值，但是在.NET中，可以为<code>enumValue</code>分配任何数字，因此要注意，不会考虑任何自定义的枚举到原始值的绑定。</p> <div class="custom-block warning"><p class="custom-block-title">DateTime序列化</p> <p>DateTime可以是Local和UTC，Java中Timestamp只能是UTC。因此Ignite.NET可以通过如下方式对DateTime进行序列化：</p> <ul><li>.NET风格（可以与非UTC值一起使用，在SQL中不可用）和作为Timestamp（对非UTC值抛出异常，可用在SQL中）；</li> <li>反射式序列化：使用<code>QuerySqlField</code>标记字段以强制执行时间戳序列化，或者配置<code>BinaryReflectiveSerializer.ForceTimestamp</code>为<code>true</code>，这个可以每类型单独配置，也可以全局配置，比如：<code>IgniteConfiguration.BinaryConfiguration = new BinaryConfiguration { Serializer = new BinaryReflectiveSerializer { ForceTimestamp = true } }</code>；</li> <li><code>IBinarizable</code>：使用<code>IBinaryWriter.WriteTimestamp</code>方法。</li></ul> <p>如果无法通过<code>QuerySqlField</code>修改类来标记字段或无法实现<code>IBinarizable</code>，可以使用<code>IBinarySerializer</code>方式。具体请参见<a href="#_9-%E5%BA%8F%E5%88%97%E5%8C%96">序列化</a>。</p></div> <h3 id="_11-4-集合兼容性"><a href="#_11-4-集合兼容性" class="header-anchor">#</a> 11.4.集合兼容性</h3> <p>简单类型数组（上表所示）和对象数组都是可互操作的，所有其他集合和数组的默认行为（使用反射式序列化或<code>IBinaryWriter.WriteObject</code>）将使用<code>BinaryFormatter</code>，Java代码是无法读取的（为了正确支持泛型）。如果要将集合写为可互操作的格式，需要实现<code>IBinarizable</code>接口，并使用<code>IBinaryWriter.WriteCollection</code>或<code>IBinaryWriter.WriteDictionary</code>或<code>IBinaryReader.ReadCollection</code>或<code>IBinaryReader.ReadDictionary</code>方法。</p> <h3 id="_11-5-混合平台集群"><a href="#_11-5-混合平台集群" class="header-anchor">#</a> 11.5.混合平台集群</h3> <p>Ignite、Ignite.NET和Ignite.C++节点可以加入同一个集群。</p> <p>所有平台都是基于Java构建的，因此任何节点都可以执行Java计算。但是.NET和C++计算只能由相对应的节点执行。</p> <p>如果集群中至少有一个非.NET节点，则不支持以下Ignite.NET功能：</p> <ul><li>带过滤器的扫描查询；</li> <li>带过滤器的持续查询；</li> <li><code>ICache.Invoke</code>方法；</li> <li>带过滤器的<code>ICache.LoadCache</code>；</li> <li>服务；</li> <li><code>IMessaging.RemoteListen</code>；</li> <li><code>IEvents.RemoteQuery</code>；</li></ul> <p>有关多平台搭建的实战文章：<a href="https://my.oschina.net/liyuj/blog/793938" target="_self" rel="noopener noreferrer">构建多平台的Ignite集群：Java+.NET</a>。</p> <h3 id="_11-6-混合平台集群中的计算"><a href="#_11-6-混合平台集群中的计算" class="header-anchor">#</a> 11.6.混合平台集群中的计算</h3> <p><code>ICompute.ExecuteJavaTask</code>方法在任何集群上的执行都没有限制。其他<code>ICompute</code>方法将仅在.NET节点上执行闭包。</p> <h2 id="_12-远程程序集加载"><a href="#_12-远程程序集加载" class="header-anchor">#</a> 12.远程程序集加载</h2> <h3 id="_12-1-概述"><a href="#_12-1-概述" class="header-anchor">#</a> 12.1.概述</h3> <p>许多Ignite API都涉及远程代码执行，例如将计算任务和函数序列化，然后发送到远程节点并执行。但是远程节点必须加载具有这些功能的.NET程序集（dll文件），以便实例化和反序列化任务实例。</p> <p>在Ignite的2.1版之前，必须手动加载程序集（使用Apache.Ignite.exe的<code>-assembly</code>开关或其他方式）。从2.1版开始引入了自动远程程序集加载，由<code>IgniteConfiguration.PeerAssemblyLoadingMode</code>控制。其默认值为<code>Disabled</code>，这意味着和之前的行为一致。在集群中的所有节点上，该属性值必须全部相同。还有另一种可用的模式是<code>CurrentAppDomain</code>。</p> <h3 id="_12-2-currentappdomain模式"><a href="#_12-2-currentappdomain模式" class="header-anchor">#</a> 12.2.CurrentAppDomain模式</h3> <p>开启<code>PeerAssemblyLoadingMode.CurrentAppDomain</code>可以实现集群中其他节点的自动按需程序集请求，将程序集加载到运行Ignite节点的<a href="https://msdn.microsoft.com/en-us/library/system.appdomain.aspx" target="_self" rel="noopener noreferrer">AppDomain</a>中。</p> <p>考虑以下代码：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// Print Hello World on all cluster nodes.</span>
ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Broadcast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HelloAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HelloAction</span> <span class="token punctuation">:</span> <span class="token class-name">IComputeAction</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Ignite序列化<code>HelloAction</code>实例并发送到集群中的每个节点；</li> <li>远程节点尝试反序列化<code>HelloAction</code>，如果当前已加载或引用的程序集中没有此类，则将请求发送到<code>Broadcast</code>被调用的节点，然后发送到其他节点（如有必要）；</li> <li>程序集文件从其他节点作为字节数组发送，并通过<code>Assembly.Load(byte[])</code>方法加载。</li></ul> <h4 id="_12-2-1-版本控制"><a href="#_12-2-1-版本控制" class="header-anchor">#</a> 12.2.1.版本控制</h4> <p><a href="https://msdn.microsoft.com/en-us/library/system.type.assemblyqualifiedname.aspx" target="_self" rel="noopener noreferrer">程序集限定类型名</a>（包括程序集版本）用于解析类型。</p> <p>如果集群处于运行态，需要在逻辑上做出如下的修改，然后查看程序集如何自动加载：</p> <ul><li>修改<code>HelloAction</code>实例以输出一些内容；</li> <li>修改<a href="https://msdn.microsoft.com/en-us/library/system.reflection.assemblyversionattribute.aspx" target="_self" rel="noopener noreferrer">AssemblyVersion</a>；</li> <li>重新编译然后运行应用代码；</li> <li>新版本的程序集会在其他节点上部署并运行。</li></ul> <p>但是如果不修改<code>AssemblyVersion</code>，则Ignite将使用以前加载的现有程序集，因为类型名没有变化。</p> <p>不同版本的程序集可以共存，老节点可以继续运行旧代码，而新节点可以使用同一类的较新版本执行计算。</p> <p><code>AssemblyVersion</code>属性可以包含星号（<code>*</code>），以在构建时可以自动增量处理：<code>[assembly: AssemblyVersion(&quot;1.0.*&quot;)]</code>。这样就可以保持集群运行，重复修改和运行计算，并且每次都将部署新的程序集版本。</p> <h4 id="_12-2-2-依赖"><a href="#_12-2-2-依赖" class="header-anchor">#</a> 12.2.2.依赖</h4> <p>依赖程序集也会自动加载（例如<code>ComputeAction</code>从其他程序集调用某些代码时），因此使用很重的框架和库时，要注意单个计算调用可能导致大量程序集的网络传输。</p> <h4 id="_12-2-3-卸载"><a href="#_12-2-3-卸载" class="header-anchor">#</a> 12.2.3.卸载</h4> <p>.NET不允许卸载程序集，只能是<code>AppDomain</code>作为整体卸载所有的程序集。</p> <p>当前可用的<code>CurrentAppDomain</code>模式使用现有的AppDomain，这意味着在当前AppDomain存在时，所有对等部署的程序集将保持加载状态，这可能会导致内存使用增加。</p> <h3 id="_12-3-示例"><a href="#_12-3-示例" class="header-anchor">#</a> 12.3.示例</h3> <p>实践中，可以使用<a href="https://github.com/apache/ignite/blob/56975c266e7019f307bb9da42333a6db4e47365e/modules/platforms/dotnet/examples/Apache.Ignite.Examples/Compute/PeerAssemblyLoadingExample.cs" target="_self" rel="noopener noreferrer">PeerAssemblyLoadingExample</a>尝试远程程序集加载。</p> <ul><li>在Visual Studio中创建一个新的控制台应用；</li> <li>安装Ignite.NET NuGet软件包<code>Install-Package Apache.Ignite</code>；</li> <li>打开<code>packages\Apache.Ignite.2.1\lib\net40</code>文件夹；</li> <li>向<code>&lt;igniteConfiguration&gt;</code>元素添加<code>peerAssemblyLoadingMode='CurrentAppDomain'</code>属性；</li> <li>运行<code>Apache.Ignite.exe</code>（一次或多次），保持进程运行；</li> <li>将<code>AssemblyInfo.cs</code>中的<code>AssemblyVersion</code>值改为<code>1.0.*</code>；</li> <li>在Visual Studio中修改<code>Program.cs</code>，如下所示：</li></ul> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="program.cs" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> Apache<span class="token punctuation">.</span>Ignite<span class="token punctuation">.</span>Core<span class="token punctuation">;</span>
<span class="token keyword">using</span> Apache<span class="token punctuation">.</span>Ignite<span class="token punctuation">.</span>Core<span class="token punctuation">.</span>Compute<span class="token punctuation">;</span>
<span class="token keyword">using</span> Apache<span class="token punctuation">.</span>Ignite<span class="token punctuation">.</span>Core<span class="token punctuation">.</span>Deployment<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> ConsoleApp
<span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
            <span class="token punctuation">{</span>
                PeerAssemblyLoadingMode <span class="token operator">=</span> PeerAssemblyLoadingMode<span class="token punctuation">.</span>CurrentAppDomain
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Broadcast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HelloAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">class</span> <span class="token class-name">HelloAction</span> <span class="token punctuation">:</span> <span class="token class-name">IComputeAction</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="apache.ignite.exe.config" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span> <span class="token attr-name">peerAssemblyLoadingMode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>CurrentAppDomain<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="assemblyinfo.cs" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language- extra-class"><pre class="language-text"><code>...
[assembly: AssemblyVersion(&quot;1.0.*&quot;)]
...
</code></pre></div></section></div></div> <ul><li>运行该项目并观察&quot;Hello，World！&quot;在所有<code>Apache.Ignite.exe</code>窗口的控制台输出；</li> <li>将&quot;Hello，World！&quot;改为其他的值，然后再次运行该程序；</li> <li>观察之前使用<code>Apache.Ignite.exe</code>启动的节点的输出有何不同。</li></ul> <h2 id="_13-问题解决"><a href="#_13-问题解决" class="header-anchor">#</a> 13.问题解决</h2> <h3 id="_13-1-概述"><a href="#_13-1-概述" class="header-anchor">#</a> 13.1.概述</h3> <p>本章节介绍了几种故障排除技术和在生产中构建和使用Ignite.NET应用时可能遇到的常见问题。</p> <h3 id="_13-2-使用控制台排除故障"><a href="#_13-2-使用控制台排除故障" class="header-anchor">#</a> 13.2.使用控制台排除故障</h3> <p>Ignite会产生控制台输出（stdout）：信息、指标、警告、错误详细信息等，如果应用未打开控制台，则可以将控制台输出重定向到字符串或文件：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> sw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">SetOut</span><span class="token punctuation">(</span>sw<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Examine output:</span>
sw<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_13-3-获取有关异常的更多信息"><a href="#_13-3-获取有关异常的更多信息" class="header-anchor">#</a> 13.3.获取有关异常的更多信息</h3> <p>当拿到<code>IgniteException</code>时，一定要检查其中的<code>InnerException</code>属性，该属性通常包含有关错误的更多详细信息，具体可以在Visual Studio的调试器中或通过在异常对象上调用<code>ToString()</code>方法看到：</p> <p><img src="https://ignite.apache.org/docs/2.9.0/images/net-view-details.png" alt=""></p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    IQueryCursor<span class="token operator">&lt;</span>List<span class="token operator">&gt;</span> cursor <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">QueryFields</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IgniteException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Printing out the whole exception meesage.</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_13-4-常见问题"><a href="#_13-4-常见问题" class="header-anchor">#</a> 13.4.常见问题</h3> <p>下面将介绍设计Ignite.NET应用时可能遇到的几个问题。</p> <h4 id="_13-4-1-无法加载jvm-dll"><a href="#_13-4-1-无法加载jvm-dll" class="header-anchor">#</a> 13.4.1.无法加载jvm.dll</h4> <p>确认已安装JDK，配置好了<code>JAVA_HOME</code>环境变量并指向JDK安装目录。最新的JDK可以在这里找到：<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_self" rel="noopener noreferrer">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a>。</p> <p><code>errorCode=193</code>是<code>ERROR_BAD_EXE_FORMAT</code>，通常是由x64/x86不匹配引起的。确认已安装的JDK和应用具有相同的x64/x86平台架构。当未设置<code>JAVA_HOME</code>时，Ignite会自动检测到合适的JDK，因此即使同时安装了x86和x64的JDK，也没有问题。</p> <p>丢失依赖时会发生<code>126 ERROR_MOD_NOT_FOUND</code>。</p> <ul><li>JDK8需要<a href="https://www.microsoft.com/en-us/download/details.aspx?id=14632" target="_self" rel="noopener noreferrer">Microsoft Visual C++ 2010 Redistributable</a>包；</li> <li>之后版本的JDK需要<a href="https://www.microsoft.com/en-us/download/details.aspx?id=48145" target="_self" rel="noopener noreferrer">Microsoft Visual C++ 2015 Redistributable</a>包或者更新的版本。</li></ul> <h4 id="_13-4-2-无法找到java类"><a href="#_13-4-2-无法找到java类" class="header-anchor">#</a> 13.4.2.无法找到Java类</h4> <p>检查<code>IGNITE_HOME</code>环境变量、<code>IgniteConfiguration.IgniteHome</code>和<code>IgniteConfiguration.JvmClasspath</code>属性，具体请参见<a href="#_14-%E9%83%A8%E7%BD%B2">部署</a>章节，ASP.NET/IIS场景还需要其他的步骤。</p> <h4 id="_13-4-3-ignition-start阻塞"><a href="#_13-4-3-ignition-start阻塞" class="header-anchor">#</a> 13.4.3.Ignition.Start阻塞</h4> <p>检查控制台输出。</p> <p>最常见的原因是拓扑连接失败：</p> <ul><li>发现部分的配置不正确（请参见<a href="/doc/2.8.0/net/Clustering.html#_4-集群配置">集群配置</a>）；</li> <li><code>ClientMode</code>是<code>true</code>的，但是没有服务端节点（请参见<a href="#_9-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF">客户端和服务端</a>）。</li></ul> <h4 id="_13-4-4-启动管理器失败-gridmanageradapter"><a href="#_13-4-4-启动管理器失败-gridmanageradapter" class="header-anchor">#</a> 13.4.4.启动管理器失败: GridManagerAdapter</h4> <p>检查控制台输出，通常这是由无效或不兼容的配置引起的：</p> <ul><li>某些配置属性值无效（超出范围等）；</li> <li>某些配置属性与其他集群节点中的值不兼容。尤其是<code>BinaryConfiguration</code>中的属性，例如<code>CompactFooter</code>、<code>IdMapper</code>和<code>NameMapper</code>应在所有节点上是相同的。</li></ul> <p>当搭建混合集群（Java + .NET节点）时，通常会出现后一个问题，因为这些平台上的默认配置是不同的。.NET仅支持<code>BinaryBasicIdMapper</code>和<code>BinaryBasicNameMapper</code>，因此必须通过以下方式调整Java配置以启用.NET节点的接入：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>binaryConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.BinaryConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>compactFooter<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>idMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.binary.BinaryBasicIdMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>nameMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.binary.BinaryBasicNameMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_13-4-5-无法加载文件或程序集-myassembly-或其依赖-系统无法找到指定文件"><a href="#_13-4-5-无法加载文件或程序集-myassembly-或其依赖-系统无法找到指定文件" class="header-anchor">#</a> 13.4.5.无法加载文件或程序集'MyAssembly'或其依赖，系统无法找到指定文件</h4> <p>远程节点缺失某程序集时会抛出该异常，具体请参见<a href="#_3-4-%E5%8A%A0%E8%BD%BD%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E9%9B%86">加载用户程序集</a>。</p> <h4 id="_13-4-6-堆栈溢出错误-net终止"><a href="#_13-4-6-堆栈溢出错误-net终止" class="header-anchor">#</a> 13.4.6.堆栈溢出错误，.NET终止</h4> <p>在Linux平台的.NET Core环境下，当用户代码抛出<code>NullReferenceException</code>异常时，就会发生这种情况。其原因是，.NET和Java都使用SIGSEGV来处理某些异常，包括<code>NullPointerException</code>和<code>NullReferenceException</code>，当JVM与.NET运行在同一进程中时，它将覆盖该处理器，破坏.NET异常处理（具体参见<a href="https://github.com/dotnet/coreclr/issues/25945" target="_self" rel="noopener noreferrer">1</a>，<a href="https://github.com/dotnet/coreclr/issues/25166" target="_self" rel="noopener noreferrer">2</a>）。</p> <p>.NET Core 3.0解决了该问题（<a href="https://github.com/dotnet/coreclr/pull/25972" target="_self" rel="noopener noreferrer">#25972</a>：将<code>COMPlus_EnableAlternateStackCheck</code>环境变量设置为<code>1</code>）。</p> <h4 id="_13-4-7-linux中的僵尸进程"><a href="#_13-4-7-linux中的僵尸进程" class="header-anchor">#</a> 13.4.7.Linux中的僵尸进程</h4> <p>在Linux中，.NET和Java都会安装<code>SIGCHLD</code>处理器来处理子进程终止。</p> <ul><li>处理器会延迟安装（当一个<code>Process</code>第一次启动时）；</li> <li>同时只能存在一个处理器。</li></ul> <p>因此，Java可能会覆盖.NET的处理器，反之亦然，从而导致无法清理某个平台上的子进程，进而导致<a href="https://en.wikipedia.org/wiki/Parent_process" target="_self" rel="noopener noreferrer">僵尸进程</a>。</p> <p><strong>在一个特殊的场景中，Ignite在Java端会使用子进程：即当启用持久化并使用<code>direct-io</code>模块时</strong>。这时就不应该使用.NET的<code>System.Diagnostics.Process</code>API。</p> <p><strong>解决方法</strong></p> <p>要解决此问题，需确保仅在Java端或.NET端创建子进程。</p> <p>例如，当使用<code>direct-io</code>并且.NET代码需要启动子进程时，需要将进程处理逻辑移至Java端并使用计算引擎的<code>ExecuteJavaTask</code>API对其进行调用，或者，使用服务API从.NET调用Java服务。</p> <h2 id="_14-集成"><a href="#_14-集成" class="header-anchor">#</a> 14.集成</h2> <h3 id="_14-1-asp-net输出缓存"><a href="#_14-1-asp-net输出缓存" class="header-anchor">#</a> 14.1.ASP.NET输出缓存</h3> <h4 id="_14-1-1-概述"><a href="#_14-1-1-概述" class="header-anchor">#</a> 14.1.1.概述</h4> <p>Ignite缓存可用作ASP.NET的输出缓存，这对于在Web服务器之间共享输出缓存尤其有效。</p> <h4 id="_14-1-2-安装"><a href="#_14-1-2-安装" class="header-anchor">#</a> 14.1.2.安装</h4> <ul><li><strong>二进制包</strong>：添加对<code>Apache.Ignite.AspNet.dll</code>的引用；</li> <li><strong>NuGet</strong>：<code>Install-Package Apache.Ignite.AspNet</code>。</li></ul> <h4 id="_14-1-3-自动启动ignite"><a href="#_14-1-3-自动启动ignite" class="header-anchor">#</a> 14.1.3.自动启动Ignite</h4> <p>如果要自动启动Ignite用于输出缓存，可以<a href="#_1-3-%E9%80%9A%E8%BF%87%E5%BA%94%E7%94%A8%E6%88%96web%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%96%B9%E5%BC%8F%E9%85%8D%E7%BD%AE">在web.config中配置IgniteConfigurationSection</a>：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configSections</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>igniteConfiguration<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Apache.Ignite.Core.IgniteConfigurationSection, Apache.Ignite.Core<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configSections</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span> <span class="token attr-name">autoGenerateIgniteInstanceName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>myWebCache<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在<code>web.config</code>中配置输出缓存：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.web</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>caching</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputCache</span> <span class="token attr-name">defaultProvider</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>apacheIgnite<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>providers</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>apacheIgnite<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Apache.Ignite.AspNet.IgniteOutputCacheProvider, Apache.Ignite.AspNet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">igniteConfigurationSectionName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>igniteConfiguration<span class="token punctuation">&quot;</span></span> <span class="token attr-name">cacheName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myWebCache<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>providers</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputCache</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>caching</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.web</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_14-1-4-手动启动ignite"><a href="#_14-1-4-手动启动ignite" class="header-anchor">#</a> 14.1.4.手动启动Ignite</h4> <p>也可以手动启动Ignite的实例，然后在提供者配置中指定它的名字：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.web</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>caching</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>outputCache</span> <span class="token attr-name">defaultProvider</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>apacheIgnite<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>providers</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>apacheIgnite<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Apache.Ignite.AspNet.IgniteOutputCacheProvider, Apache.Ignite.AspNet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">cacheName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myWebCache<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>providers</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>outputCache</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>caching</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.web</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在接收任何请求之前，应该先启动Ignite的实例，通常这是在<code>Global.asax</code>的<code>Application_Start</code>方法中实现的。</p> <p>对于和Web环境尤其是和<code>IGNITE_HOME</code>有关的内容，请参见<a href="#_2-5-asp-net%E9%83%A8%E7%BD%B2">ASP.NET部署</a>。</p> <h3 id="_14-2-asp-net会话状态缓存"><a href="#_14-2-asp-net会话状态缓存" class="header-anchor">#</a> 14.2.ASP.NET会话状态缓存</h3> <h4 id="_14-2-1-概述"><a href="#_14-2-1-概述" class="header-anchor">#</a> 14.2.1.概述</h4> <p>会话状态的值和信息默认存储在ASP.NET进程的内存中，而会话状态缓存旨在将用户会话数据存储在不同的源中。</p> <p>Ignite.NET实现了一个会话状态存储，其会将会话数据存储在Ignite缓存中，该缓存将会话状态分布在多个服务器上，以实现更高的可用性和容错能力。</p> <div class="custom-block warning"><p class="custom-block-title">开发调试</p> <p>在开发和调试过程中，IIS将在构建和运行Web应用时动态检测代码更新，不过不会重启嵌入式Ignite实例，这可能导致异常和不确定的行为，因此使用Ignite会话状态缓存时，<strong>要确认手动重启IIS</strong>。</p></div> <h4 id="_14-2-2-安装"><a href="#_14-2-2-安装" class="header-anchor">#</a> 14.2.2.安装</h4> <ul><li><strong>二进制包</strong>：添加对<code>Apache.Ignite.AspNet.dll</code>的引用；</li> <li><strong>NuGet</strong>：<code>Install-Package Apache.Ignite.AspNet</code>。</li></ul> <h4 id="_14-2-3-配置"><a href="#_14-2-3-配置" class="header-anchor">#</a> 14.2.3.配置</h4> <p>要启用基于Ignite的会话状态缓存，需要像下面这样修改<code>web.config</code>：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.web</span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sessionState</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Custom<span class="token punctuation">&quot;</span></span> <span class="token attr-name">customProvider</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>IgniteSessionStateProvider<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>providers</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>IgniteSessionStateProvider<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Apache.Ignite.AspNet.IgniteSessionStateStoreProvider, Apache.Ignite.AspNet<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name">igniteConfigurationSectionName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>igniteConfiguration<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name">applicationId</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myApp<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name">gridName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myGrid<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name">cacheName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>aspNetSessionCache<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>providers</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sessionState</span><span class="token punctuation">&gt;</span></span>
  ...
&lt;/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.web</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>name</code>和<code>type</code>属性是必须的，其他都是可选的。</p> <table><thead><tr><th>属性</th> <th>描述</th></tr></thead> <tbody><tr><td><code>igniteConfigurationSectionName</code></td> <td><code>configSections</code>中定义的<code>web.config</code>段名，具体请参见<a href="/doc/2.8.0/net/#_5-配置">配置</a>章节的内容，该配置会在未启动Ignite时启动Ignite。</td></tr> <tr><td><code>applicationId</code></td> <td>仅当多个Web应用共享同一Ignite会话状态缓存时才应使用。会分配不同的ID字符串，以避免应用之间的会话数据冲突。建议通过<code>cacheName</code>属性每个应用都使用单独的缓存。</td></tr> <tr><td><code>gridName</code></td> <td>会话状态缓存实现通过该网格名调用<code>Ignition.TryGetIgnite</code>来检查Ignite是否已启动。</td></tr> <tr><td><code>cacheName</code></td> <td>会话状态缓存名，默认为<code>ASPNET_SESSION_STATE</code>。</td></tr></tbody></table> <p>关于在ASP.NET应用中启用Ignite的更多信息，请参见<a href="#_14-1-asp-net%E8%BE%93%E5%87%BA%E7%BC%93%E5%AD%98">ASP.NET输出缓存</a>。</p> <p>对于和Web环境尤其是和<code>IGNITE_HOME</code>有关的内容，请参见<a href="#_2-5-asp-net%E9%83%A8%E7%BD%B2">ASP.NET部署</a>。</p> <h3 id="_14-3-entity-framework二级缓存"><a href="#_14-3-entity-framework二级缓存" class="header-anchor">#</a> 14.3.Entity Framework二级缓存</h3> <h4 id="_14-3-1-概述"><a href="#_14-3-1-概述" class="header-anchor">#</a> 14.3.1.概述</h4> <p>Entity Framework像大多数其他ORM一样，可以在多个层级上使用缓存。</p> <ul><li>一级缓存是<code>DbContext</code>在实体级别控制的（实体缓存在对应的<code>DbSet</code>中）；</li> <li>二级缓存位于<code>DataReader</code>层级，并保存原始查询数据（不过Entity Framework6中没有现成的二级缓存机制）。</li></ul> <p>Ignite.NET提供了EF6的二级缓存解决方案。该方案将数据存储在分布式Ignite缓存中，尤其适用于多个应用服务器通过Entity Framework访问单个SQL数据库的场景，缓存的数据在集群的所有主机之间共享。</p> <h4 id="_14-3-2-安装"><a href="#_14-3-2-安装" class="header-anchor">#</a> 14.3.2.安装</h4> <ul><li><strong>二进制包</strong>：添加对<code>Apache.Ignite.EntityFramework.dll</code>的引用；</li> <li><strong>NuGet</strong>：<code>Install-Package Apache.Ignite.EntityFramework</code>。</li></ul> <h4 id="_14-3-3-配置"><a href="#_14-3-3-配置" class="header-anchor">#</a> 14.3.3.配置</h4> <p>Ignite.NET提供了一个支持二级缓存的自定义<code>DbConfiguration</code>实现<code>Apache.Ignite.EntityFramework.IgniteDbConfiguration</code>。将<code>DbConfiguration</code>应用于EntityFramework<code>DbContext</code>的方法有很多，具体请参见以下MSDN文档：<a href="https://msdn.microsoft.com/en-us/library/jj680699" target="_self" rel="noopener noreferrer">msdn.microsoft.com/zh-cn/library/jj680699</a>。</p> <p>不过最简单方法是使用<code>DbConfigurationType</code>属性：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token class-name">DbConfigurationType</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>IgniteDbConfiguration<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">class</span> <span class="token class-name">MyContext</span> <span class="token punctuation">:</span> <span class="token class-name">DbContext</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">virtual</span> DbSet<span class="token operator">&lt;</span>Foo<span class="token operator">&gt;</span> Foos <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">virtual</span> DbSet<span class="token operator">&lt;</span>Bar<span class="token operator">&gt;</span> Bars <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>要自定义缓存行为，可以创建一个继承<code>IgniteDbConfiguration</code>的类并调用其某个基类构造函数，下面是一个示例：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">MyDbConfiguration</span> <span class="token punctuation">:</span> <span class="token class-name">IgniteDbConfiguration</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token function">MyDbConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>
      <span class="token comment">// IIgnite instance to use</span>
      Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// Metadata cache configuration (small cache, does not tolerate data loss)</span>
      <span class="token comment">// Should be replicated or partitioned with backups</span>
      <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;metaCache&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        CacheMode <span class="token operator">=</span> CacheMode<span class="token punctuation">.</span>Replicated
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// Data cache configuration (large cache, holds actual query results,</span>
      <span class="token comment">// tolerates data loss). Can have no backups.</span>
      <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;dataCache&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        CacheMode <span class="token operator">=</span> CacheMode<span class="token punctuation">.</span>Partitioned<span class="token punctuation">,</span>
        Backups <span class="token operator">=</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// Custom caching policy.</span>
      <span class="token keyword">new</span> <span class="token class-name">MyCachingPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// No-op.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Apply custom configuration to the DbContext</span>
<span class="token punctuation">[</span><span class="token class-name">DbConfigurationType</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>MyDbConfiguration<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">class</span> <span class="token class-name">MyContext</span> <span class="token punctuation">:</span> <span class="token class-name">DbContext</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>缓存策略</strong></p> <p>缓存策略控制缓存模式、过期时间以及应缓存的实体集。该策略默认为空，所有实体集都缓存为<code>ReadWrite</code>模式并且没有过期时间。可以通过实现<code>IDbCachingPolicy</code>接口或继承<code>DbCachingPolicy</code>类来配置缓存策略，下面是一个简单的示例：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DbCachingPolicy</span> <span class="token punctuation">:</span> <span class="token class-name">IDbCachingPolicy</span>
<span class="token punctuation">{</span>
  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Determines whether the specified query can be cached.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">CanBeCached</span><span class="token punctuation">(</span><span class="token class-name">DbQueryInfo</span> queryInfo<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// This method is called before database call.</span>
    <span class="token comment">// Cache only Persons.</span>
    <span class="token keyword">return</span> queryInfo<span class="token punctuation">.</span>AffectedEntitySets<span class="token punctuation">.</span><span class="token function">All</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">&quot;Person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Determines whether specified number of rows should be cached.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">CanBeCached</span><span class="token punctuation">(</span><span class="token class-name">DbQueryInfo</span> queryInfo<span class="token punctuation">,</span> <span class="token keyword">int</span> rowCount<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// This method is called after database call.</span>
    <span class="token comment">// Cache only queries that return less than 1000 rows.</span>
    <span class="token keyword">return</span> rowCount <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Gets the absolute expiration timeout for a given query.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token class-name">TimeSpan</span> <span class="token function">GetExpirationTimeout</span><span class="token punctuation">(</span><span class="token class-name">DbQueryInfo</span> queryInfo<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Cache for 5 minutes.</span>
    <span class="token keyword">return</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromMinutes</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// &lt;summary&gt;</span>
  <span class="token comment">/// Gets the caching strategy for a given query.</span>
  <span class="token comment">/// &lt;/summary&gt;</span>
  <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token class-name">DbCachingMode</span> <span class="token function">GetCachingMode</span><span class="token punctuation">(</span><span class="token class-name">DbQueryInfo</span> queryInfo<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Cache with invalidation.</span>
    <span class="token keyword">return</span> DbCachingMode<span class="token punctuation">.</span>ReadWrite<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>缓存模式</strong></p> <table><thead><tr><th>DbCachingMode</th> <th>含义</th></tr></thead> <tbody><tr><td><code>ReadOnly</code></td> <td>只读模式。永不失效，该模式中数据库更新将被忽略。查询结果被缓存后会一直保留在缓存中直到过期（不指定则永不过期）。该模式适用于预计不会更改的数据（例如国家/地区列表和其他字典数据）。</td></tr> <tr><td><code>ReadWrite</code></td> <td>读写模式。当底层实体集更改时，缓存的数据将失效。这是<code>常规</code>的缓存模式，始终提供正确的查询结果。注意只有由配置了Ignite缓存的<code>DbContext</code>执行所有数据库更新，该模式才能正常工作，而其他的数据库更新则被无视。</td></tr></tbody></table> <h4 id="_14-3-4-app-config和web-config"><a href="#_14-3-4-app-config和web-config" class="header-anchor">#</a> 14.3.4.app.config和web.config</h4> <p>通过提供<code>IgniteDbConfiguration</code>（或其子类）的程序集限定类型名，可以在配置文件中启用Ignite缓存：</p> <p>app.config：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entityFramework</span> <span class="token attr-name">codeConfigurationType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Apache.Ignite.EntityFramework.IgniteDbConfiguration, Apache.Ignite.EntityFramework<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...Your EF config...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entityFramework</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_14-3-5-高级配置"><a href="#_14-3-5-高级配置" class="header-anchor">#</a> 14.3.5.高级配置</h4> <p>如果无法继承<code>IgniteDbConfiguration</code>（已经继承了其他类），还可以在构造函数中调用<code>IgniteDbConfiguration.InitializeIgniteCaching</code>静态方法，然后将<code>this</code>作为第一个参数：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">MyDbConfiguration</span> <span class="token punctuation">:</span> <span class="token class-name">OtherDbConfiguration</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token function">MyDbConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    IgniteDbConfiguration<span class="token punctuation">.</span><span class="token function">InitializeIgniteCaching</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> Ignition<span class="token punctuation">.</span><span class="token function">GetIgnite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="right-pale"><div class="right-content"><div class="bbox tell-box"><button class="btn btn-circle btn-success right-tell"><i class="fa fa-lg fa-phone"></i></button> <p class="tell-hide">
            18624049226
        </p></div> <div class="bbox weixin-box"><button class="btn btn-circle btn-success right-weixin"><i class="fa fa-weixin"></i></button> <p class="tell-hide" style="padding:5px;"><img src="/img/weixin.jpg"></p></div></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间：:</span> <span class="time">10/26/2020, 11:28:53 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/doc/java/RESTAPI.html" class="prev">
        REST API
      </a></span> <span class="next"><a href="/doc/java/CppSpecific.html">
        Ignite C++
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.c0c83703.js" defer></script><script src="/assets/js/3.b95bc49f.js" defer></script><script src="/assets/js/1.5c509afc.js" defer></script><script src="/assets/js/272.bbeb18e9.js" defer></script><script src="/assets/js/11.2830eec0.js" defer></script><script src="/assets/js/10.41a5f603.js" defer></script><script src="/assets/js/8.85f43835.js" defer></script>
  </body>
</html>
