<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>瘦客户端 | Apache Ignite技术服务</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="/css/plugin.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <script src="https://hm.baidu.com/hm.js?76e2d8c51e8068e025053bc59d51045b"></script>
    <meta name="description" content="apache ignite,ignite中文,ignite官网,内存数据库,分布式数据库">
    <meta name="keywords" content="apache ignite,ignite中文,ignite官网,内存数据库,分布式数据库">
    <meta http-equiv="cache-control" content="no-store,no-cache,must-revalidate">
    <meta http-equiv="expires" content="0">
    
    <link rel="preload" href="/assets/css/0.styles.cb5acd6d.css" as="style"><link rel="preload" href="/assets/js/app.264f4941.js" as="script"><link rel="preload" href="/assets/js/3.b95bc49f.js" as="script"><link rel="preload" href="/assets/js/1.5c509afc.js" as="script"><link rel="preload" href="/assets/js/290.5e5af2e6.js" as="script"><link rel="preload" href="/assets/js/11.2830eec0.js" as="script"><link rel="preload" href="/assets/js/10.41a5f603.js" as="script"><link rel="preload" href="/assets/js/8.6b57c8fe.js" as="script"><link rel="prefetch" href="/assets/js/100.a171744a.js"><link rel="prefetch" href="/assets/js/101.ff9dca2e.js"><link rel="prefetch" href="/assets/js/102.d184e2e5.js"><link rel="prefetch" href="/assets/js/103.517248cd.js"><link rel="prefetch" href="/assets/js/104.2d8722e2.js"><link rel="prefetch" href="/assets/js/105.ed393f31.js"><link rel="prefetch" href="/assets/js/106.c83204cd.js"><link rel="prefetch" href="/assets/js/107.f50929d2.js"><link rel="prefetch" href="/assets/js/108.af945b99.js"><link rel="prefetch" href="/assets/js/109.342d16a9.js"><link rel="prefetch" href="/assets/js/110.d9ad9f20.js"><link rel="prefetch" href="/assets/js/111.95a1c8a9.js"><link rel="prefetch" href="/assets/js/112.53cd9060.js"><link rel="prefetch" href="/assets/js/113.1af74e4f.js"><link rel="prefetch" href="/assets/js/114.39aeb19c.js"><link rel="prefetch" href="/assets/js/115.79f0dcf4.js"><link rel="prefetch" href="/assets/js/116.9bdfa957.js"><link rel="prefetch" href="/assets/js/117.198334b5.js"><link rel="prefetch" href="/assets/js/118.fde5922b.js"><link rel="prefetch" href="/assets/js/119.ec5f8340.js"><link rel="prefetch" href="/assets/js/12.3d2f4947.js"><link rel="prefetch" href="/assets/js/120.7800adfb.js"><link rel="prefetch" href="/assets/js/121.dd2873f5.js"><link rel="prefetch" href="/assets/js/122.4c8bca61.js"><link rel="prefetch" href="/assets/js/123.a44f5c84.js"><link rel="prefetch" href="/assets/js/124.dd7f9103.js"><link rel="prefetch" href="/assets/js/125.51220de0.js"><link rel="prefetch" href="/assets/js/126.4097380b.js"><link rel="prefetch" href="/assets/js/127.52ec7689.js"><link rel="prefetch" href="/assets/js/128.16b91a56.js"><link rel="prefetch" href="/assets/js/129.b6d9c72f.js"><link rel="prefetch" href="/assets/js/13.1af33d82.js"><link rel="prefetch" href="/assets/js/130.59d0e920.js"><link rel="prefetch" href="/assets/js/131.54318a09.js"><link rel="prefetch" href="/assets/js/132.a8453dbd.js"><link rel="prefetch" href="/assets/js/133.fe3fe717.js"><link rel="prefetch" href="/assets/js/134.2cfde59a.js"><link rel="prefetch" href="/assets/js/135.33086b21.js"><link rel="prefetch" href="/assets/js/136.9008469e.js"><link rel="prefetch" href="/assets/js/137.9634ebea.js"><link rel="prefetch" href="/assets/js/138.037626e6.js"><link rel="prefetch" href="/assets/js/139.a9cfc5d7.js"><link rel="prefetch" href="/assets/js/14.1dc71b94.js"><link rel="prefetch" href="/assets/js/140.7db27260.js"><link rel="prefetch" href="/assets/js/141.4273f161.js"><link rel="prefetch" href="/assets/js/142.7941ca41.js"><link rel="prefetch" href="/assets/js/143.0665f716.js"><link rel="prefetch" href="/assets/js/144.f4f5e178.js"><link rel="prefetch" href="/assets/js/145.1ae0ceb8.js"><link rel="prefetch" href="/assets/js/146.0f695b3a.js"><link rel="prefetch" href="/assets/js/147.3a5a0c1e.js"><link rel="prefetch" href="/assets/js/148.7b50379e.js"><link rel="prefetch" href="/assets/js/149.4b47b1d8.js"><link rel="prefetch" href="/assets/js/15.7df0b63f.js"><link rel="prefetch" href="/assets/js/150.c2c820b2.js"><link rel="prefetch" href="/assets/js/151.a4decbf6.js"><link rel="prefetch" href="/assets/js/152.d13d95e5.js"><link rel="prefetch" href="/assets/js/153.7efd6f73.js"><link rel="prefetch" href="/assets/js/154.f604aeb3.js"><link rel="prefetch" href="/assets/js/155.18ef925f.js"><link rel="prefetch" href="/assets/js/156.da0af49c.js"><link rel="prefetch" href="/assets/js/157.b6d5dc0f.js"><link rel="prefetch" href="/assets/js/158.25948f55.js"><link rel="prefetch" href="/assets/js/159.b035a6e3.js"><link rel="prefetch" href="/assets/js/16.14c9b590.js"><link rel="prefetch" href="/assets/js/160.b34057f7.js"><link rel="prefetch" href="/assets/js/161.b441753a.js"><link rel="prefetch" href="/assets/js/162.a2d6ddb5.js"><link rel="prefetch" href="/assets/js/163.417d5be2.js"><link rel="prefetch" href="/assets/js/164.36ade9de.js"><link rel="prefetch" href="/assets/js/165.7633b3a4.js"><link rel="prefetch" href="/assets/js/166.89c13b2d.js"><link rel="prefetch" href="/assets/js/167.31d3e0db.js"><link rel="prefetch" href="/assets/js/168.6fec639a.js"><link rel="prefetch" href="/assets/js/169.11d38c5f.js"><link rel="prefetch" href="/assets/js/17.25a2bd2e.js"><link rel="prefetch" href="/assets/js/170.5cfb4727.js"><link rel="prefetch" href="/assets/js/171.ce2f29b3.js"><link rel="prefetch" href="/assets/js/172.073a5096.js"><link rel="prefetch" href="/assets/js/173.ee7a0176.js"><link rel="prefetch" href="/assets/js/174.c90cc69c.js"><link rel="prefetch" href="/assets/js/175.2a4281a5.js"><link rel="prefetch" href="/assets/js/176.a330d4b7.js"><link rel="prefetch" href="/assets/js/177.57fef2c6.js"><link rel="prefetch" href="/assets/js/178.34762b99.js"><link rel="prefetch" href="/assets/js/179.16a96ace.js"><link rel="prefetch" href="/assets/js/18.c43a3e2d.js"><link rel="prefetch" href="/assets/js/180.17e02e51.js"><link rel="prefetch" href="/assets/js/181.63a9440e.js"><link rel="prefetch" href="/assets/js/182.202bdcd9.js"><link rel="prefetch" href="/assets/js/183.a75100c7.js"><link rel="prefetch" href="/assets/js/184.60d1db45.js"><link rel="prefetch" href="/assets/js/185.b5190968.js"><link rel="prefetch" href="/assets/js/186.39273304.js"><link rel="prefetch" href="/assets/js/187.896ee339.js"><link rel="prefetch" href="/assets/js/188.829cedd7.js"><link rel="prefetch" href="/assets/js/189.905542fd.js"><link rel="prefetch" href="/assets/js/19.439b7581.js"><link rel="prefetch" href="/assets/js/190.ee776c74.js"><link rel="prefetch" href="/assets/js/191.3085204f.js"><link rel="prefetch" href="/assets/js/192.2964246c.js"><link rel="prefetch" href="/assets/js/193.2b671ac5.js"><link rel="prefetch" href="/assets/js/194.bcb4b2ca.js"><link rel="prefetch" href="/assets/js/195.b7701933.js"><link rel="prefetch" href="/assets/js/196.c46576e8.js"><link rel="prefetch" href="/assets/js/197.5f557681.js"><link rel="prefetch" href="/assets/js/198.1e89f134.js"><link rel="prefetch" href="/assets/js/199.fc3a3c6c.js"><link rel="prefetch" href="/assets/js/20.1d900c8d.js"><link rel="prefetch" href="/assets/js/200.edc5937c.js"><link rel="prefetch" href="/assets/js/201.3598772b.js"><link rel="prefetch" href="/assets/js/202.2af299e0.js"><link rel="prefetch" href="/assets/js/203.ff8e8eb7.js"><link rel="prefetch" href="/assets/js/204.05ae9f6f.js"><link rel="prefetch" href="/assets/js/205.c444b35f.js"><link rel="prefetch" href="/assets/js/206.49174d6a.js"><link rel="prefetch" href="/assets/js/207.60662bbf.js"><link rel="prefetch" href="/assets/js/208.33cd493d.js"><link rel="prefetch" href="/assets/js/209.1c61726e.js"><link rel="prefetch" href="/assets/js/21.e545d595.js"><link rel="prefetch" href="/assets/js/210.7c4ac60e.js"><link rel="prefetch" href="/assets/js/211.9cd992bc.js"><link rel="prefetch" href="/assets/js/212.a93805d6.js"><link rel="prefetch" href="/assets/js/213.c14ad741.js"><link rel="prefetch" href="/assets/js/214.a410b70d.js"><link rel="prefetch" href="/assets/js/215.688a1937.js"><link rel="prefetch" href="/assets/js/216.6d0b3d44.js"><link rel="prefetch" href="/assets/js/217.55cf55da.js"><link rel="prefetch" href="/assets/js/218.2d4304b5.js"><link rel="prefetch" href="/assets/js/219.f06321dc.js"><link rel="prefetch" href="/assets/js/22.e1ae2ebc.js"><link rel="prefetch" href="/assets/js/220.81da06b9.js"><link rel="prefetch" href="/assets/js/221.73424581.js"><link rel="prefetch" href="/assets/js/222.00b432e8.js"><link rel="prefetch" href="/assets/js/223.be11916c.js"><link rel="prefetch" href="/assets/js/224.87898b28.js"><link rel="prefetch" href="/assets/js/225.89cce153.js"><link rel="prefetch" href="/assets/js/226.084af005.js"><link rel="prefetch" href="/assets/js/227.89a8090e.js"><link rel="prefetch" href="/assets/js/228.7ab726e0.js"><link rel="prefetch" href="/assets/js/229.dab9a950.js"><link rel="prefetch" href="/assets/js/23.208f00a1.js"><link rel="prefetch" href="/assets/js/230.16703feb.js"><link rel="prefetch" href="/assets/js/231.8c4f9061.js"><link rel="prefetch" href="/assets/js/232.3abb8973.js"><link rel="prefetch" href="/assets/js/233.7541de87.js"><link rel="prefetch" href="/assets/js/234.0ac56c13.js"><link rel="prefetch" href="/assets/js/235.3046b7a1.js"><link rel="prefetch" href="/assets/js/236.972eeb66.js"><link rel="prefetch" href="/assets/js/237.db67551c.js"><link rel="prefetch" href="/assets/js/238.c63261e7.js"><link rel="prefetch" href="/assets/js/239.16f7d9b5.js"><link rel="prefetch" href="/assets/js/24.b06822a9.js"><link rel="prefetch" href="/assets/js/240.26e6dbf7.js"><link rel="prefetch" href="/assets/js/241.d389295c.js"><link rel="prefetch" href="/assets/js/242.0393fc9a.js"><link rel="prefetch" href="/assets/js/243.a899649a.js"><link rel="prefetch" href="/assets/js/244.ea9614d4.js"><link rel="prefetch" href="/assets/js/245.86f6a9df.js"><link rel="prefetch" href="/assets/js/246.976be3a8.js"><link rel="prefetch" href="/assets/js/247.ff939a6f.js"><link rel="prefetch" href="/assets/js/248.8c30a5c0.js"><link rel="prefetch" href="/assets/js/249.0be32375.js"><link rel="prefetch" href="/assets/js/25.5d32942a.js"><link rel="prefetch" href="/assets/js/250.43176ce7.js"><link rel="prefetch" href="/assets/js/251.9b0b29d5.js"><link rel="prefetch" href="/assets/js/252.d63e7357.js"><link rel="prefetch" href="/assets/js/253.8277f2f3.js"><link rel="prefetch" href="/assets/js/254.4007d9bf.js"><link rel="prefetch" href="/assets/js/255.72c5640c.js"><link rel="prefetch" href="/assets/js/256.1e162c0e.js"><link rel="prefetch" href="/assets/js/257.8d8179ba.js"><link rel="prefetch" href="/assets/js/258.58823ab5.js"><link rel="prefetch" href="/assets/js/259.6e544184.js"><link rel="prefetch" href="/assets/js/26.863f7e60.js"><link rel="prefetch" href="/assets/js/260.0bccb717.js"><link rel="prefetch" href="/assets/js/261.fe834fea.js"><link rel="prefetch" href="/assets/js/262.bfc961d7.js"><link rel="prefetch" href="/assets/js/263.3c585b44.js"><link rel="prefetch" href="/assets/js/264.3be55fee.js"><link rel="prefetch" href="/assets/js/265.88eac1d6.js"><link rel="prefetch" href="/assets/js/266.a4007560.js"><link rel="prefetch" href="/assets/js/267.4632ce34.js"><link rel="prefetch" href="/assets/js/268.74cc2201.js"><link rel="prefetch" href="/assets/js/269.475d8378.js"><link rel="prefetch" href="/assets/js/27.a023f451.js"><link rel="prefetch" href="/assets/js/270.8a6f7abc.js"><link rel="prefetch" href="/assets/js/271.07d4c1fd.js"><link rel="prefetch" href="/assets/js/272.bbeb18e9.js"><link rel="prefetch" href="/assets/js/273.74980d47.js"><link rel="prefetch" href="/assets/js/274.792c9dc0.js"><link rel="prefetch" href="/assets/js/275.36db08e6.js"><link rel="prefetch" href="/assets/js/276.f8ec4114.js"><link rel="prefetch" href="/assets/js/277.ca966325.js"><link rel="prefetch" href="/assets/js/278.914a70c5.js"><link rel="prefetch" href="/assets/js/279.b398be35.js"><link rel="prefetch" href="/assets/js/28.61eabbbb.js"><link rel="prefetch" href="/assets/js/280.2e35164b.js"><link rel="prefetch" href="/assets/js/281.0b0fafa2.js"><link rel="prefetch" href="/assets/js/282.ca60cf6b.js"><link rel="prefetch" href="/assets/js/283.8e33df1e.js"><link rel="prefetch" href="/assets/js/284.b2c33b92.js"><link rel="prefetch" href="/assets/js/285.ec7d2c52.js"><link rel="prefetch" href="/assets/js/286.54e246c6.js"><link rel="prefetch" href="/assets/js/287.615d01c0.js"><link rel="prefetch" href="/assets/js/288.944c2ab4.js"><link rel="prefetch" href="/assets/js/289.db4f077f.js"><link rel="prefetch" href="/assets/js/29.f0f4d791.js"><link rel="prefetch" href="/assets/js/291.b4053cdc.js"><link rel="prefetch" href="/assets/js/292.986c668a.js"><link rel="prefetch" href="/assets/js/293.a659e882.js"><link rel="prefetch" href="/assets/js/294.3598da41.js"><link rel="prefetch" href="/assets/js/295.939f6d0d.js"><link rel="prefetch" href="/assets/js/30.ed97af1f.js"><link rel="prefetch" href="/assets/js/31.f464b981.js"><link rel="prefetch" href="/assets/js/32.81d53af7.js"><link rel="prefetch" href="/assets/js/33.1abe3576.js"><link rel="prefetch" href="/assets/js/34.e3c43a9e.js"><link rel="prefetch" href="/assets/js/35.3bd76755.js"><link rel="prefetch" href="/assets/js/36.0f0aeea1.js"><link rel="prefetch" href="/assets/js/37.c246691f.js"><link rel="prefetch" href="/assets/js/38.89242a75.js"><link rel="prefetch" href="/assets/js/39.129ba990.js"><link rel="prefetch" href="/assets/js/4.03c84a3c.js"><link rel="prefetch" href="/assets/js/40.52d4257b.js"><link rel="prefetch" href="/assets/js/41.c45513c7.js"><link rel="prefetch" href="/assets/js/42.b42542e4.js"><link rel="prefetch" href="/assets/js/43.5fcfe760.js"><link rel="prefetch" href="/assets/js/44.2165b121.js"><link rel="prefetch" href="/assets/js/45.f011e76a.js"><link rel="prefetch" href="/assets/js/46.b190d321.js"><link rel="prefetch" href="/assets/js/47.66e391b9.js"><link rel="prefetch" href="/assets/js/48.6668dba4.js"><link rel="prefetch" href="/assets/js/49.8dca8b6e.js"><link rel="prefetch" href="/assets/js/5.dc64067c.js"><link rel="prefetch" href="/assets/js/50.05a55da7.js"><link rel="prefetch" href="/assets/js/51.18753c7f.js"><link rel="prefetch" href="/assets/js/52.d6e778fa.js"><link rel="prefetch" href="/assets/js/53.4bd5b1e2.js"><link rel="prefetch" href="/assets/js/54.a78aaa0b.js"><link rel="prefetch" href="/assets/js/55.e42ca7af.js"><link rel="prefetch" href="/assets/js/56.a4a50c46.js"><link rel="prefetch" href="/assets/js/57.6eec316c.js"><link rel="prefetch" href="/assets/js/58.7cfb4255.js"><link rel="prefetch" href="/assets/js/59.dbc333cc.js"><link rel="prefetch" href="/assets/js/6.a365e315.js"><link rel="prefetch" href="/assets/js/60.2fa2afd7.js"><link rel="prefetch" href="/assets/js/61.a12986d6.js"><link rel="prefetch" href="/assets/js/62.968f58b9.js"><link rel="prefetch" href="/assets/js/63.bee6b498.js"><link rel="prefetch" href="/assets/js/64.8c0607a1.js"><link rel="prefetch" href="/assets/js/65.63c58056.js"><link rel="prefetch" href="/assets/js/66.e7a6a465.js"><link rel="prefetch" href="/assets/js/67.82e8c6f5.js"><link rel="prefetch" href="/assets/js/68.e62e6234.js"><link rel="prefetch" href="/assets/js/69.250ca4fe.js"><link rel="prefetch" href="/assets/js/7.bdfa8241.js"><link rel="prefetch" href="/assets/js/70.08dacaaf.js"><link rel="prefetch" href="/assets/js/71.2ad91bd3.js"><link rel="prefetch" href="/assets/js/72.d81dcb2e.js"><link rel="prefetch" href="/assets/js/73.db7b4053.js"><link rel="prefetch" href="/assets/js/74.ed28d1ce.js"><link rel="prefetch" href="/assets/js/75.6daa5ea4.js"><link rel="prefetch" href="/assets/js/76.3f083d88.js"><link rel="prefetch" href="/assets/js/77.50cf9b57.js"><link rel="prefetch" href="/assets/js/78.cfc14aca.js"><link rel="prefetch" href="/assets/js/79.fa535173.js"><link rel="prefetch" href="/assets/js/80.04b4372a.js"><link rel="prefetch" href="/assets/js/81.442378a1.js"><link rel="prefetch" href="/assets/js/82.28992137.js"><link rel="prefetch" href="/assets/js/83.b1733d5b.js"><link rel="prefetch" href="/assets/js/84.c84fe8b2.js"><link rel="prefetch" href="/assets/js/85.3df73729.js"><link rel="prefetch" href="/assets/js/86.28abe836.js"><link rel="prefetch" href="/assets/js/87.adc38596.js"><link rel="prefetch" href="/assets/js/88.f57d467f.js"><link rel="prefetch" href="/assets/js/89.1bdf828f.js"><link rel="prefetch" href="/assets/js/9.ac032f9d.js"><link rel="prefetch" href="/assets/js/90.1007c7a2.js"><link rel="prefetch" href="/assets/js/91.be7512e6.js"><link rel="prefetch" href="/assets/js/92.dc3df5c8.js"><link rel="prefetch" href="/assets/js/93.0b63c74e.js"><link rel="prefetch" href="/assets/js/94.31d25b70.js"><link rel="prefetch" href="/assets/js/95.c0389214.js"><link rel="prefetch" href="/assets/js/96.70c50255.js"><link rel="prefetch" href="/assets/js/97.8f8e0dcb.js"><link rel="prefetch" href="/assets/js/98.390f8d37.js"><link rel="prefetch" href="/assets/js/99.1d8aaf36.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cb5acd6d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Apache Ignite技术服务</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/Service.html" class="nav-link">
  服务&amp;报价
</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link router-link-active">
  文档
</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/confluent/" class="nav-link">
  Confluent平台
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">最新版本</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">最新版本</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/java/ThinClients.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  2.10.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.9.1/" class="nav-link">
  2.9.1
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.8.0/" class="nav-link">
  2.8.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.7.0/" class="nav-link">
  2.7.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/" class="nav-link">
  2.6.0
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/Service.html" class="nav-link">
  服务&amp;报价
</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link router-link-active">
  文档
</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/confluent/" class="nav-link">
  Confluent平台
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">最新版本</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">最新版本</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/java/ThinClients.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  2.10.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.9.1/" class="nav-link">
  2.9.1
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.8.0/" class="nav-link">
  2.8.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.7.0/" class="nav-link">
  2.7.0
</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/" class="nav-link">
  2.6.0
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/doc/java/" aria-current="page" class="sidebar-link">前言</a></li><li><a href="/doc/java/QuickStartGuide.html" class="sidebar-link">快速入门</a></li><li><a href="/doc/java/Installation.html" class="sidebar-link">安装</a></li><li><a href="/doc/java/SettingUp.html" class="sidebar-link">Ignite配置入门</a></li><li><a href="/doc/java/StartingNodes.html" class="sidebar-link">启动和停止节点</a></li><li><a href="/doc/java/Clustering.html" class="sidebar-link">集群化</a></li><li><a href="/doc/java/ThinClients.html" aria-current="page" class="active sidebar-link">瘦客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_1-瘦客户端介绍" class="sidebar-link">1.瘦客户端介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_1-1-概述" class="sidebar-link">1.1.概述</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_1-2-瘦客户端特性" class="sidebar-link">1.2.瘦客户端特性</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_1-3-集群配置" class="sidebar-link">1.3.集群配置</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_1-3-2-为瘦客户端启用ssl-tls" class="sidebar-link">1.3.2.为瘦客户端启用SSL/TLS</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_2-java瘦客户端" class="sidebar-link">2.Java瘦客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_2-1-概述" class="sidebar-link">2.1.概述</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_2-2-配置" class="sidebar-link">2.2.配置</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_2-3-接入集群" class="sidebar-link">2.3.接入集群</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_2-4-分区感知" class="sidebar-link">2.4.分区感知</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_2-5-使用键-值api" class="sidebar-link">2.5.使用键-值API</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_2-6-执行sql语句" class="sidebar-link">2.6.执行SQL语句</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_2-7-使用集群api" class="sidebar-link">2.7.使用集群API</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_2-8-执行计算任务" class="sidebar-link">2.8.执行计算任务</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_2-9-执行ignite服务" class="sidebar-link">2.9.执行Ignite服务</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_2-10-处理异常" class="sidebar-link">2.10.处理异常</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_2-11-安全" class="sidebar-link">2.11.安全</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_2-12-异步api" class="sidebar-link">2.12.异步API</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_3-net瘦客户端" class="sidebar-link">3..NET瘦客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_3-1-环境要求" class="sidebar-link">3.1.环境要求</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_3-2-安装" class="sidebar-link">3.2.安装</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_3-3-接入集群" class="sidebar-link">3.3.接入集群</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_3-4-分区感知" class="sidebar-link">3.4.分区感知</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_3-5-使用键-值api" class="sidebar-link">3.5.使用键-值API</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_3-6-执行扫描查询" class="sidebar-link">3.6.执行扫描查询</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_3-7-执行sql语句" class="sidebar-link">3.7.执行SQL语句</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_3-8-使用集群api" class="sidebar-link">3.8.使用集群API</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_3-9-执行计算任务" class="sidebar-link">3.9.执行计算任务</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_3-10-执行ignite服务" class="sidebar-link">3.10.执行Ignite服务</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_3-11-安全" class="sidebar-link">3.11.安全</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_4-c-瘦客户端" class="sidebar-link">4.C++瘦客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_4-1-环境要求" class="sidebar-link">4.1.环境要求</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_4-2-安装" class="sidebar-link">4.2.安装</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_4-3-创建客户端实例" class="sidebar-link">4.3.创建客户端实例</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_4-4-使用键-值api" class="sidebar-link">4.4.使用键-值API</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_4-5-安全" class="sidebar-link">4.5.安全</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_4-6-事务" class="sidebar-link">4.6.事务</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_5-python瘦客户端" class="sidebar-link">5.Python瘦客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_5-1-环境要求" class="sidebar-link">5.1.环境要求</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_5-2-安装" class="sidebar-link">5.2.安装</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_5-3-接入集群" class="sidebar-link">5.3.接入集群</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_5-4-客户端故障转移" class="sidebar-link">5.4.客户端故障转移</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_5-5-分区感知" class="sidebar-link">5.5.分区感知</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_5-6-创建缓存" class="sidebar-link">5.6.创建缓存</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_5-7-使用键-值api" class="sidebar-link">5.7.使用键-值API</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_5-8-扫描查询" class="sidebar-link">5.8.扫描查询</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_5-9-执行sql语句" class="sidebar-link">5.9.执行SQL语句</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_5-10-安全" class="sidebar-link">5.10.安全</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_6-php瘦客户端" class="sidebar-link">6.PHP瘦客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_6-1-环境要求" class="sidebar-link">6.1.环境要求</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_6-2-安装" class="sidebar-link">6.2.安装</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_6-3-创建客户端实例" class="sidebar-link">6.3.创建客户端实例</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_6-4-接入集群" class="sidebar-link">6.4.接入集群</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_6-5-使用键-值api" class="sidebar-link">6.5.使用键-值API</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_6-6-扫描查询" class="sidebar-link">6.6.扫描查询</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_6-7-执行sql语句" class="sidebar-link">6.7.执行SQL语句</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_6-8-安全" class="sidebar-link">6.8.安全</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_7-node-js瘦客户端" class="sidebar-link">7.Node.js瘦客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_7-1-环境要求" class="sidebar-link">7.1.环境要求</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_7-2-安装" class="sidebar-link">7.2.安装</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_7-3-创建客户端实例" class="sidebar-link">7.3.创建客户端实例</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_7-4-接入集群" class="sidebar-link">7.4.接入集群</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_7-5-分区感知" class="sidebar-link">7.5.分区感知</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_7-6-启用调试" class="sidebar-link">7.6.启用调试</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_7-7-启用键-值api" class="sidebar-link">7.7.启用键-值API</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_7-8-扫描查询" class="sidebar-link">7.8.扫描查询</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_7-9-执行sql查询" class="sidebar-link">7.9.执行SQL查询</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_7-10-安全" class="sidebar-link">7.10.安全</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_8-二进制客户端协议" class="sidebar-link">8.二进制客户端协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_8-1-二进制客户端协议" class="sidebar-link">8.1.二进制客户端协议</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_8-2-数据格式" class="sidebar-link">8.2.数据格式</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_8-3-键-值查询" class="sidebar-link">8.3.键-值查询</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_8-4-sql和扫描查询" class="sidebar-link">8.4.SQL和扫描查询</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_8-5-二进制类型元数据" class="sidebar-link">8.5.二进制类型元数据</a></li><li class="sidebar-sub-header"><a href="/doc/java/ThinClients.html#_8-6-缓存配置" class="sidebar-link">8.6.缓存配置</a></li></ul></li></ul></li><li><a href="/doc/java/DataModeling.html" class="sidebar-link">数据建模</a></li><li><a href="/doc/java/ConfiguringMemory.html" class="sidebar-link">配置内存</a></li><li><a href="/doc/java/Persistence.html" class="sidebar-link">配置持久化</a></li><li><a href="/doc/java/ConfiguringCaches.html" class="sidebar-link">配置缓存</a></li><li><a href="/doc/java/DataRebalancing.html" class="sidebar-link">数据再平衡</a></li><li><a href="/doc/java/DataStreaming.html" class="sidebar-link">数据流处理</a></li><li><a href="/doc/java/UsingKeyValueApi.html" class="sidebar-link">键-值API</a></li><li><a href="/doc/java/Transactions.html" class="sidebar-link">Ignite事务</a></li><li><a href="/doc/java/WorkingwithSQL.html" class="sidebar-link">处理SQL</a></li><li><a href="/doc/java/SQLReference.html" class="sidebar-link">SQL参考</a></li><li><a href="/doc/java/DistributedComputing.html" class="sidebar-link">分布式计算</a></li><li><a href="/doc/java/CodeDeployment.html" class="sidebar-link">代码部署</a></li><li><a href="/doc/java/MachineLearning.html" class="sidebar-link">机器学习</a></li><li><a href="/doc/java/ContinuousQueries.html" class="sidebar-link">Ignite持续查询</a></li><li><a href="/doc/java/Service.html" class="sidebar-link">Ignite服务</a></li><li><a href="/doc/java/Messaging.html" class="sidebar-link">Ignite消息</a></li><li><a href="/doc/java/DataStructures.html" class="sidebar-link">Ignite分布式数据结构</a></li><li><a href="/doc/java/DistributedLocks.html" class="sidebar-link">Ignite分布式锁</a></li><li><a href="/doc/java/RESTAPI.html" class="sidebar-link">REST API</a></li><li><a href="/doc/java/DotnetSpecific.html" class="sidebar-link">Ignite.NET</a></li><li><a href="/doc/java/CppSpecific.html" class="sidebar-link">Ignite C++</a></li><li><a href="/doc/java/Monitoring.html" class="sidebar-link">监控</a></li><li><a href="/doc/java/WorkingwithEvents.html" class="sidebar-link">处理事件</a></li><li><a href="/doc/java/Tools.html" class="sidebar-link">工具</a></li><li><a href="/doc/java/Security.html" class="sidebar-link">安全</a></li><li><a href="/doc/java/ExtensionsIntegrations.html" class="sidebar-link">扩展和集成</a></li><li><a href="/doc/java/Plugins.html" class="sidebar-link">插件</a></li><li><a href="/doc/java/PerformanceTroubleshooting.html" class="sidebar-link">性能和故障排除</a></li><li><a href="/doc/java/Legal.html" class="sidebar-link">法律条款</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="瘦客户端"><a href="#瘦客户端" class="header-anchor">#</a> 瘦客户端</h1> <h2 id="_1-瘦客户端介绍"><a href="#_1-瘦客户端介绍" class="header-anchor">#</a> 1.瘦客户端介绍</h2> <h3 id="_1-1-概述"><a href="#_1-1-概述" class="header-anchor">#</a> 1.1.概述</h3> <p>瘦客户端是一个使用标准套接字连接接入集群的轻量级的Ignite客户端，它不会成为集群拓扑的一部分，也不持有任何数据，也不会参与计算。它所做的只是简单地建立一个与标准Ignite节点的套接字连接，并通过该节点执行所有操作。</p> <p>瘦客户端基于<a href="#_8-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8D%8F%E8%AE%AE">二进制客户端协议</a>，这样任何语言都可以接入Ignite集群，目前如下的客户端可用：</p> <ul><li>Java瘦客户端</li> <li>.NET/C#瘦客户端</li> <li>C++瘦客户端</li> <li>Node.js瘦客户端</li> <li>Python瘦客户端</li> <li>PHP瘦客户端</li></ul> <h3 id="_1-2-瘦客户端特性"><a href="#_1-2-瘦客户端特性" class="header-anchor">#</a> 1.2.瘦客户端特性</h3> <p>下表列出了每个客户端支持的特性：</p> <table><thead><tr><th>瘦客户端特性</th> <th>Java</th> <th>.NET</th> <th>C++</th> <th>Python</th> <th>Node.js</th> <th>PHP</th></tr></thead> <tbody><tr><td><code>扫描查询</code></td> <td>是</td> <td>是</td> <td>否</td> <td>是</td> <td>是</td> <td>是</td></tr> <tr><td><code>支持过滤器的扫描查询</code></td> <td>是</td> <td>是</td> <td>否</td> <td>否</td> <td>否</td> <td>否</td></tr> <tr><td><code>SqlFieldsQuery</code></td> <td>是</td> <td>是</td> <td>否</td> <td>是</td> <td>是</td> <td>是</td></tr> <tr><td><code>二进制对象API</code></td> <td>是</td> <td>是</td> <td>否</td> <td>否</td> <td>是</td> <td>是</td></tr> <tr><td><code>异步操作</code></td> <td>否</td> <td>是</td> <td>否</td> <td>是</td> <td>是</td> <td>是</td></tr> <tr><td><code>SSL/TLS</code></td> <td>是</td> <td>是</td> <td>是</td> <td>是</td> <td>是</td> <td>是</td></tr> <tr><td><code>认证</code></td> <td>是</td> <td>是</td> <td>是</td> <td>是</td> <td>是</td> <td>是</td></tr> <tr><td><code>分区感知</code></td> <td>是</td> <td>是</td> <td>是</td> <td>是</td> <td>是</td> <td>否</td></tr> <tr><td><code>故障转移</code></td> <td>是</td> <td>是</td> <td>是</td> <td>是</td> <td>是</td> <td>是</td></tr> <tr><td><code>事务</code></td> <td>是</td> <td>是</td> <td>否</td> <td>否</td> <td>否</td> <td>否</td></tr> <tr><td><code>集群API</code></td> <td>是</td> <td>是</td> <td>否</td> <td>否</td> <td>否</td> <td>否</td></tr> <tr><td><code>集群发现</code></td> <td>否</td> <td>是</td> <td>否</td> <td>否</td> <td>否</td> <td>否</td></tr> <tr><td><code>计算</code></td> <td>是</td> <td>是</td> <td>否</td> <td>否</td> <td>否</td> <td>否</td></tr> <tr><td><code>服务调用</code></td> <td>是</td> <td>是</td> <td>否</td> <td>否</td> <td>否</td> <td>否</td></tr> <tr><td><code>服务端发现</code></td> <td>否</td> <td>是</td> <td>否</td> <td>否</td> <td>否</td> <td>否</td></tr> <tr><td><code>Kubernetes中的服务端发现</code></td> <td>是</td> <td>否</td> <td>否</td> <td>否</td> <td>否</td> <td>否</td></tr></tbody></table> <h4 id="_1-2-1-客户端连接故障转移"><a href="#_1-2-1-客户端连接故障转移" class="header-anchor">#</a> 1.2.1.客户端连接故障转移</h4> <p>所有瘦客户端均支持连接故障转移机制，在当前节点或连接失败时，客户端可自动切换到可用节点。为了使该机制生效，需要在客户端配置中提供用于故障转移节点的地址列表，具体请参见相关的客户端文档。</p> <h4 id="_1-2-2-分区感知"><a href="#_1-2-2-分区感知" class="header-anchor">#</a> 1.2.2.分区感知</h4> <p>如<a href="/doc/java/DataModeling.html#_2-数据分区">数据分区</a>章节所述，出于可伸缩性和性能方面的考虑，集群中的数据会在节点间平均分布。每个集群节点都维护数据和分区分布图的子集，用于确定持有所请求条目的主/备份副本的节点。</p> <p>分区感知使得瘦客户端可以将查询请求直接发送到持有待查询数据的节点。</p> <div class="custom-block warning"><p class="custom-block-title">警告</p> <p>分区感知是一项实验性功能，正式发布之前，其API或设计架构可能会更改。</p></div> <p>在没有分区感知时，通过瘦客户端接入集群的应用，实际是通过某个作为代理的服务端节点执行所有查询和操作，然后将这些操作重新路由到数据所在的节点，这会导致瓶颈，可能会限制应用的线性扩展能力。</p> <p><img src="https://ignite.apache.org/docs/2.9.0/images/partitionawareness01.png" alt=""></p> <p>注意查询必须通过代理服务端节点，然后路由到正确的节点。</p> <p>有了分区感知之后，瘦客户端可以将查询和操作直接路由到持有待处理数据的主节点，这消除了瓶颈，使应用更易于扩展。</p> <p><img src="https://ignite.apache.org/docs/2.9.0/images/partitionawareness02.png" alt=""></p> <div class="custom-block danger"><p class="custom-block-title">警告</p> <p>注意目前需要在连接属性中提供所有服务端节点的地址。这意味着如果新的服务端节点加入集群，则应将新服务端的地址添加到连接属性中，然后重新连接。否则，瘦客户端将无法向该服务端发送直接请求，正式发布之后将解决此限制。</p></div> <h4 id="_1-2-3-认证"><a href="#_1-2-3-认证" class="header-anchor">#</a> 1.2.3.认证</h4> <p>所有瘦客户端都支持集群的身份验证。身份验证是在<a href="/doc/java/Security.html#_1-认证">集群配置</a>中配置的，客户端仅提供用户凭据。更多的信息请参考特定客户端的文档。</p> <h3 id="_1-3-集群配置"><a href="#_1-3-集群配置" class="header-anchor">#</a> 1.3.集群配置</h3> <p>瘦客户端连接参数是由客户端连接器配置控制的。Ignite默认在端口10800上接受客户端连接。端口、连接缓冲区大小和超时、启用SSL/TLS等都是可以修改的。</p> <h4 id="_1-3-1-配置瘦客户端连接器"><a href="#_1-3-1-配置瘦客户端连接器" class="header-anchor">#</a> 1.3.1.配置瘦客户端连接器</h4> <p>以下示例显示了如何配置瘦客户端连接参数：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="xml" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ignite.cfg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>clientConnectorConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.ClientConnectorConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>port<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10000<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientConnectorConfiguration</span> clientConnectorCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConnectorConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Set a port range from 10000 to 10005</span>
clientConnectorCfg<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
clientConnectorCfg<span class="token punctuation">.</span><span class="token function">setPortRange</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setClientConnectorConfiguration</span><span class="token punctuation">(</span>clientConnectorCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start a node</span>
<span class="token class-name">Ignite</span> ignite <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="c#/.net" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    ClientConnectorConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConnectorConfiguration</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Set a port range from 10000 to 10005</span>
        Port <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">,</span>
        PortRange <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <p>下表中列出了可能需要修改的一些参数：</p> <table><thead><tr><th>参数</th> <th>描述</th> <th>默认值</th></tr></thead> <tbody><tr><td><code>thinClientEnabled</code></td> <td>启用/禁用客户端接入</td> <td><code>true</code></td></tr> <tr><td><code>port</code></td> <td>瘦客户端连接端口</td> <td><code>10800</code></td></tr> <tr><td><code>portRange</code></td> <td>此参数设置瘦客户端连接的端口范围。例如，如果<code>portRange</code>=10，则瘦客户端可以连接到10800–18010范围内的任何端口。节点会尝试绑定从<code>port</code>开始的范围内的每个端口，直到找到可用端口为止。如果所有端口都不可用，则该节点将无法启动。</td> <td><code>100</code></td></tr> <tr><td><code>sslEnabled</code></td> <td>将此属性配置为<code>true</code>，可以为瘦客户端连接启用SSL。</td> <td><code>false</code></td></tr></tbody></table> <p>完整的参数列表，请参见<a href="https://ignite.apache.org/releases/2.9.0/javadoc/org/apache/ignite/configuration/ClientConnectorConfiguration.html" target="_self" rel="noopener noreferrer">ClientConnectorConfiguration</a>的javadoc。</p> <h3 id="_1-3-2-为瘦客户端启用ssl-tls"><a href="#_1-3-2-为瘦客户端启用ssl-tls" class="header-anchor">#</a> 1.3.2.为瘦客户端启用SSL/TLS</h3> <p>参见<a href="/doc/java/Security.html#_2-3-瘦客户端和jdbc-odbc的ssl-tls">瘦客户端和JDBC/ODBC的SSL/TLS</a>章节的内容。</p> <h2 id="_2-java瘦客户端"><a href="#_2-java瘦客户端" class="header-anchor">#</a> 2.Java瘦客户端</h2> <h3 id="_2-1-概述"><a href="#_2-1-概述" class="header-anchor">#</a> 2.1.概述</h3> <p>Java瘦客户端是一个使用标准套接字连接接入集群的轻量级的Ignite客户端，它不会成为集群拓扑的一部分，也不持有任何数据，也不会参与计算。它所做的只是简单地建立一个与标准Ignite节点的套接字连接，并通过该节点执行所有操作。</p> <h3 id="_2-2-配置"><a href="#_2-2-配置" class="header-anchor">#</a> 2.2.配置</h3> <p>如果使用Maven或者Gradle，需要向应用中添加<code>ignite-core</code>依赖：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="maven" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ignite.version</span><span class="token punctuation">&gt;</span></span>2.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ignite.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="gradle" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token keyword">def</span> igniteVersion <span class="token operator">=</span> <span class="token string">'2.9.0'</span>

dependencies <span class="token punctuation">{</span>
    compile group<span class="token punctuation">:</span> <span class="token string">'org.apache.ignite'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'ignite-core'</span><span class="token punctuation">,</span> version<span class="token punctuation">:</span> igniteVersion
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <p>或者，也可以直接使用二进制包中的<code>ignite-core-2.9.0.jar</code>。</p> <h3 id="_2-3-接入集群"><a href="#_2-3-接入集群" class="header-anchor">#</a> 2.3.接入集群</h3> <p>可以使用<code>Ignition.startClient(ClientConfiguration)</code>方法初始化瘦客户端，该方法接受一个定义了客户端连接参数的<code>ClientConfiguration</code>对象。</p> <p>该方法返回<code>IgniteClient</code>接口，提供了访问数据的各种方法。<code>IgniteClient</code>是一个自动关闭的资源，因此可以使用<code>try-with-resources</code>语句来关闭瘦客户端并且释放连接相关的资源。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddresses</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:10800&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ClientCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Get data from the cache</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以提供多个节点的地址，这时瘦客户端会随机接入列表中的服务端，如果都不可达，则抛出<code>ClientConnectionException</code>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddresses</span><span class="token punctuation">(</span><span class="token string">&quot;node1_address:10800&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;node2_address:10800&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node3_address:10800&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClientConnectionException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// All the servers are unavailable</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意，如果服务端故障，上述代码提供了一个故障转移的机制，具体请参见下面的处理节点故障相关章节的内容。</p> <h3 id="_2-4-分区感知"><a href="#_2-4-分区感知" class="header-anchor">#</a> 2.4.分区感知</h3> <p>分区感知使得瘦客户端可以将请求直接发给待处理数据所在的节点。</p> <div class="custom-block warning"><p class="custom-block-title">警告</p> <p>分区感知是一个试验性特性，在正式发布之前，API和设计架构可能会修改。</p></div> <p>在没有分区感知时，通过瘦客户端接入集群的应用，实际是通过某个作为代理的服务端节点执行所有查询和操作，然后将这些操作重新路由到数据所在的节点，这会导致瓶颈，可能会限制应用的线性扩展能力。</p> <p><img src="https://ignite.apache.org/docs/2.9.0/images/partitionawareness01.png" alt=""></p> <p>注意查询必须通过代理服务端节点，然后路由到正确的节点。</p> <p>有了分区感知之后，瘦客户端可以将查询和操作直接路由到持有待处理数据的主节点，这消除了瓶颈，使应用更易于扩展。</p> <p><img src="https://ignite.apache.org/docs/2.9.0/images/partitionawareness02.png" alt=""></p> <div class="custom-block danger"><p class="custom-block-title">警告</p> <p>注意目前对于非Java客户端需要在连接属性中提供所有服务端节点的地址。这意味着如果新的服务端节点加入集群，则应将新服务端的地址添加到连接属性中，然后重新连接。否则，瘦客户端将无法向该服务端发送直接请求，正式发布之后将解决此限制。</p></div> <p>下面的示例介绍了Java瘦客户端中分区感知功能的使用方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setAddresses</span><span class="token punctuation">(</span><span class="token string">&quot;node1_address:10800&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node2_address:10800&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node3_address:10800&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setPartitionAwarenessEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ClientCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Put, get or remove data from the cache...</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClientException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果服务端节点列表动态地变化或者扩展，则可以使用<code>ClientAddressFinder</code>的自定义实现配置连接。当客户端发送连接请求时，应提供一组当前的服务器地址。下面的代码示例说明了使用方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientAddressFinder</span> finder <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dynamicServerAddresses <span class="token operator">=</span> <span class="token function">fetchServerAddresses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> dynamicServerAddresses<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">ClientConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setAddressFinder</span><span class="token punctuation">(</span>finder<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setPartitionAwarenessEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ClientCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Put, get, or remove data from the cache...</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClientException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>该代码段显示了如果希望客户端动态探测服务端地址，应如何实现的示例。</p> <ul><li><code>ClientAddressFinder</code>是一个函数式接口，提供了唯一的方法<code>getAddresses()</code>；</li> <li>该<code>fetchServerAddress()</code>是一个自定义函数，动态地提供服务端地址；</li> <li>使用<code>ClientConfiguration.setAddressFinder(finder)</code>配置客户端。</li></ul> <p>另外，还可以查看接口实现的真实示例，现成的<code>ThinClientKubernetesAddressFinder</code>可用于可扩展的Kubernetes环境。</p> <h3 id="_2-5-使用键-值api"><a href="#_2-5-使用键-值api" class="header-anchor">#</a> 2.5.使用键-值API</h3> <p>Java瘦客户端支持胖客户端可以用的大多数键-值操作，要在某个缓存上执行键-值操作，需要先拿到该缓存的实例，然后调用他的方法。</p> <h4 id="_2-5-1-获取缓存的实例"><a href="#_2-5-1-获取缓存的实例" class="header-anchor">#</a> 2.5.1.获取缓存的实例</h4> <p><code>ClientCache</code>API提供了键-值操作API，通过如下的方法可以获得<code>ClientCache</code>的实例：</p> <ul><li><code>IgniteClient.cache(String)</code>：假定给定名字的缓存已存在，该方法不会与集群通信确认缓存是否真实存在，如果缓存不存在之后的缓存操作会报错；</li> <li><code>IgniteClient.getOrCreateCache(String)</code>，<code>IgniteClient.getOrCreateCache(ClientCacheConfiguration)</code>：获取指定名字的缓存，如果不存在则会创建该缓存，创建时会使用默认的配置；</li> <li><code>IgniteClient.createCache(String)</code>，<code>IgniteClient.createCache(ClientCacheConfiguration)</code>：创建指定名字的缓存，如果已经存在则会报错；</li></ul> <p>使用<code>IgniteClient.cacheNames()</code>可以列出所有已有的缓存。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientCacheConfiguration</span> cacheCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientCacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;References&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setCacheMode</span><span class="token punctuation">(</span><span class="token class-name">CacheMode</span><span class="token punctuation">.</span>REPLICATED<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setWriteSynchronizationMode</span><span class="token punctuation">(</span><span class="token class-name">CacheWriteSynchronizationMode</span><span class="token punctuation">.</span>FULL_SYNC<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ClientCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span>cacheCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-5-2-基本缓存操作"><a href="#_2-5-2-基本缓存操作" class="header-anchor">#</a> 2.5.2.基本缓存操作</h4> <p>下面的代码片段演示了如何从瘦客户端执行基本的缓存操作：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> data <span class="token operator">=</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> i<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token operator">::</span><span class="token function">toString</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">assert</span> <span class="token operator">!</span>cache<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">assert</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">assert</span> cache<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">assert</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">&quot;101&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">assert</span> cache<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">assert</span> <span class="token string">&quot;101&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">assert</span> <span class="token number">0</span> <span class="token operator">==</span> cache<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-5-3-执行扫描查询"><a href="#_2-5-3-执行扫描查询" class="header-anchor">#</a> 2.5.3.执行扫描查询</h4> <p>使用<code>ScanQuery&lt;K, V&gt;</code>类可获得一组满足给定条件的条目，瘦客户端将查询发送到集群节点，在集群节点上将其作为普通<a href="/doc/java/UsingKeyValueApi.html#_3-使用扫描查询">扫描查询</a>执行。</p> <p>查询条件由一个<code>IgniteBiPredicate&lt;K, V&gt;</code>对象指定，该对象作为参数传递给查询构造函数。谓词应用于服务器端,如果未提供任何谓词，查询将返回所有缓存条目。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>谓词的类必须在集群的服务端节点上可用。</p></div> <p>查询结果是按页传输到客户端的，每个页面包含特定数量的条目，仅在请求该页面的条目时才将其提取到客户端。要更改页面中的条目数，需要使用<code>ScanQuery.setPageSize(int pageSize)</code>方法（默认值为1024）。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> personCache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">&quot;personCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Query</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> qry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScanQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>i<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> p<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;Smith&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">QueryCursor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> cur <span class="token operator">=</span> personCache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>qry<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cache</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> cur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Process the entry ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>IgniteClient.query(…​)</code>方法会返回<code>FieldsQueryCursor</code>的实例，要确保对结果集进行遍历后将其关闭。</p> <h4 id="_2-5-4-事务"><a href="#_2-5-4-事务" class="header-anchor">#</a> 2.5.4.事务</h4> <p>如果缓存为<code>AtomicityMode.TRANSACTIONAL</code>模式，则客户端支持事务。</p> <h5 id="_2-5-4-1-执行事务"><a href="#_2-5-4-1-执行事务" class="header-anchor">#</a> 2.5.4.1.执行事务</h5> <p>要开始事务，需要从<code>IgniteClient</code>中拿到<code>ClientTransactions</code>对象。<code>ClientTransactions</code>中有一组<code>txStart(…​)</code>方法，每个都会开启一个新的事务然后返回一个表示事务的<code>ClientTransaction</code>对象，使用该对象可以对事务进行提交或者回滚。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;my_transactional_cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ClientTransactions</span> tx <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">transactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ClientTransaction</span> t <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">txStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;new value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    t<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="_2-5-4-2-事务配置"><a href="#_2-5-4-2-事务配置" class="header-anchor">#</a> 2.5.4.2.事务配置</h5> <p>客户端事务可以有不同的<a href="/doc/java/Transactions.html#_3-并发模型和隔离级别">并发模型和隔离级别</a>，以及执行超时，这些都可以在所有事务上进行配置，也可以针对单个事务进行配置。</p> <p><code>ClientConfiguration</code>可以配置该客户端接口启动的所有事务默认的并发模型、隔离级别和超时时间：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cfg<span class="token punctuation">.</span><span class="token function">setAddresses</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:10800&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cfg<span class="token punctuation">.</span><span class="token function">setTransactionConfiguration</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClientTransactionConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDefaultTxTimeout</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setDefaultTxConcurrency</span><span class="token punctuation">(</span><span class="token class-name">TransactionConcurrency</span><span class="token punctuation">.</span>OPTIMISTIC<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setDefaultTxIsolation</span><span class="token punctuation">(</span><span class="token class-name">TransactionIsolation</span><span class="token punctuation">.</span>REPEATABLE_READ<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>开启某个事务时，也可以单独指定并发模型、隔离级别和超时时间，这时提供的值就会覆盖默认的值：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientTransactions</span> tx <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">transactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ClientTransaction</span> t <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">txStart</span><span class="token punctuation">(</span><span class="token class-name">TransactionConcurrency</span><span class="token punctuation">.</span>OPTIMISTIC<span class="token punctuation">,</span>
        <span class="token class-name">TransactionIsolation</span><span class="token punctuation">.</span>REPEATABLE_READ<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;new value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-5-5-处理二进制对象"><a href="#_2-5-5-处理二进制对象" class="header-anchor">#</a> 2.5.5.处理二进制对象</h4> <p>瘦客户端完全支持<a href="/doc/java/UsingKeyValueApi.html#_2-使用二进制对象">处理二进制对象</a>章节中介绍的二进制对象API，使用<code>CacheClient.withKeepBinary()</code>可以将缓存切换到二进制模式，然后就可以直接处理二进制对象而避免序列化/反序列化。使用<code>IgniteClient.binary()</code>可以获取一个<code>IgniteBinary</code>的实例，然后就可以从头开始构建一个对象。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IgniteBinary</span> binary <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">binary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">BinaryObject</span> val <span class="token operator">=</span> binary<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token string">&quot;Person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setField</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setField</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Joe&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ClientCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">BinaryObject</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;persons&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withKeepBinary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">BinaryObject</span> value <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-6-执行sql语句"><a href="#_2-6-执行sql语句" class="header-anchor">#</a> 2.6.执行SQL语句</h3> <p>Java瘦客户端提供了一个SQL API来执行SQL语句，SQL语句通过<code>SqlFieldsQuery</code>对象来声明，然后通过<code>IgniteClient.query(SqlFieldsQuery)</code>来执行。</p> <div class="language-java extra-class"><pre class="language-java"><code>client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>
        <span class="token string">&quot;CREATE TABLE IF NOT EXISTS Person (id INT PRIMARY KEY, name VARCHAR) WITH \&quot;VALUE_TYPE=%s\&quot;&quot;</span><span class="token punctuation">,</span>
        <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSchema</span><span class="token punctuation">(</span><span class="token string">&quot;PUBLIC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token class-name">Person</span> val <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">&quot;Person 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO Person(id, name) VALUES(?, ?)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> val<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setSchema</span><span class="token punctuation">(</span><span class="token string">&quot;PUBLIC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">FieldsQueryCursor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> cursor <span class="token operator">=</span> client
        <span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT name from Person WHERE id=?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSchema</span><span class="token punctuation">(</span><span class="token string">&quot;PUBLIC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the results; the `getAll()` methods closes the cursor; you do not have to</span>
<span class="token comment">// call cursor.close();</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> results <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

results<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>columns <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;name = &quot;</span> <span class="token operator">+</span> columns<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>query(SqlFieldsQuery)</code>方法会返回一个<code>FieldsQueryCursor</code>的实例，可以用于对结果集进行迭代，使用完毕后，一定要关闭以释放相关的资源。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p><code>getAll()</code>方法会从游标中拿到所有的结果集，然后将其关闭。</p></div> <p><code>SqlFieldsQuery</code>的使用以及SQL API方面的更多信息，请参见<a href="/doc/java/WorkingwithSQL.html#_4-使用sql-api">使用SQL API</a>章节的内容。</p> <h3 id="_2-7-使用集群api"><a href="#_2-7-使用集群api" class="header-anchor">#</a> 2.7.使用集群API</h3> <p>集群API可以用于创建集群组然后在这个组中执行各种操作。<code>ClientCluster</code>接口是该API的入口，用处如下：</p> <ul><li>获取或者修改集群的状态；</li> <li>获取集群所有节点的列表；</li> <li>创建集群节点的逻辑组，然后使用其他的Ignite API在组中执行特定的操作。</li></ul> <p>使用<code>IgniteClient</code>实例可以获得<code>ClientCluster</code>接口的引用。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>clientCfg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ClientCluster</span> clientCluster <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    clientCluster<span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token class-name">ClusterState</span><span class="token punctuation">.</span>ACTIVE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-7-1-节点逻辑分组"><a href="#_2-7-1-节点逻辑分组" class="header-anchor">#</a> 2.7.1.节点逻辑分组</h4> <p>可以使用集群API的<code>ClientClusterGroup</code>接口来创建集群节点的各种组合。比如，一个组可以包含所有的服务端节点，而另一组可以仅包含与特定TCP/IP地址格式匹配的那些节点，下面的示例显示如何创建位于<code>dc1</code>数据中心的一组服务端节点：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>clientCfg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ClientClusterGroup</span> serversInDc1 <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forServers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;dc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dc1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    serversInDc1<span class="token punctuation">.</span><span class="token function">nodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>n <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Node ID: &quot;</span> <span class="token operator">+</span> n<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>关于这个功能的更多信息，请参见<a href="/doc/java/DistributedComputing.html#_2-集群组">集群组</a>的相关文档。</p> <h3 id="_2-8-执行计算任务"><a href="#_2-8-执行计算任务" class="header-anchor">#</a> 2.8.执行计算任务</h3> <p>当前，Java瘦客户端通过执行集群中<strong>已经部署</strong>的计算任务来支持基本的<a href="/doc/java/DistributedComputing.html#_1-分布式计算api">计算功能</a>。可以跨所有集群节点或特定<a href="#_2-7-1-%E8%8A%82%E7%82%B9%E9%80%BB%E8%BE%91%E5%88%86%E7%BB%84">集群组</a>运行任务。这个环境要求将计算任务打包成一个JAR文件，并将其添加到集群节点的类路径中。</p> <p>由瘦客户端触发的任务执行默认在集群侧被禁用。需要在服务端节点和胖客户端节点将<code>ThinClientConfiguration.maxActiveComputeTasksPerConnection</code>参数设置为非零值：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="xml" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ignite.cfg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>clientConnectorConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.ClientConnectorConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>thinClientConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.ThinClientConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>maxActiveComputeTasksPerConnection<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ThinClientConfiguration</span> thinClientCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThinClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setMaxActiveComputeTasksPerConnection</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ClientConnectorConfiguration</span> clientConnectorCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConnectorConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setThinClientConfiguration</span><span class="token punctuation">(</span>thinClientCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteConfiguration</span> igniteCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setClientConnectorConfiguration</span><span class="token punctuation">(</span>clientConnectorCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Ignite</span> ignite <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>igniteCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <p>下面的示例显示如果通过<code>ClientCompute</code>接口访问计算API，然后执行名为<code>MyTask</code>的计算任务：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>clientCfg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Suppose that the MyTask class is already deployed in the cluster</span>
    client<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>
        <span class="token class-name">MyTask</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;argument&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-9-执行ignite服务"><a href="#_2-9-执行ignite服务" class="header-anchor">#</a> 2.9.执行Ignite服务</h3> <p>可以使用Java瘦客户端的<code>ClientServices</code>接口调用一个集群中<strong>已经部署</strong>的<a href="/doc/java/UsingServices.html">Ignite服务</a>。</p> <p>下面的示例显示如何调用名为<code>MyService</code>的服务：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>clientCfg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Executing the service named MyService</span>
    <span class="token comment">// that is already deployed in the cluster.</span>
    client<span class="token punctuation">.</span><span class="token function">services</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serviceProxy</span><span class="token punctuation">(</span>
        <span class="token string">&quot;MyService&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MyService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">myServiceMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>部署的服务可以通过Java或者.NET实现。</p> <h3 id="_2-10-处理异常"><a href="#_2-10-处理异常" class="header-anchor">#</a> 2.10.处理异常</h3> <h4 id="_2-10-1-处理节点故障"><a href="#_2-10-1-处理节点故障" class="header-anchor">#</a> 2.10.1.处理节点故障</h4> <p>当在客户端配置中提供多个节点的地址时，如果当前连接失败，客户端将自动切换到下一个节点，然后重试任何正在进行的操作。</p> <p>对于原子操作，故障转移到另一个节点对用户是透明的。但是如果执行的是扫描查询或SELECT查询，则查询游标上的迭代可能会抛出<code>ClientConnectionException</code>。之所以会发生这种情况，是因为查询是按页返回数据，并且如果在客户端检索页面时客户端连接到的节点故障，则会抛出异常以保持查询结果的一致性。</p> <p>如果启动了显式事务，则在服务端节点故障时，绑定到该事务的缓存操作也会抛出<code>ClientException</code>异常。</p> <p>用户代码应处理这些异常并相应地实现重试逻辑。</p> <h3 id="_2-11-安全"><a href="#_2-11-安全" class="header-anchor">#</a> 2.11.安全</h3> <h4 id="_2-11-1-ssl-tls"><a href="#_2-11-1-ssl-tls" class="header-anchor">#</a> 2.11.1.SSL/TLS</h4> <p>要在瘦客户端和集群之间使用加密的通信，必须在集群配置和客户端配置中都启用SSL/TLS。有关集群配置的说明，请参见<a href="#_1-3-2-%E4%B8%BA%E7%98%A6%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%90%AF%E7%94%A8ssl-tls">瘦客户端启用SSL/TLS</a>章节的介绍。</p> <p>要在瘦客户端中启用加密的通信，请在瘦客户端配置中提供一个包含加密密钥的密钥库和一个具有受信任证书的信任库：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientConfiguration</span> clientCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddresses</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:10800&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

clientCfg<span class="token punctuation">.</span><span class="token function">setSslMode</span><span class="token punctuation">(</span><span class="token class-name">SslMode</span><span class="token punctuation">.</span>REQUIRED<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSslClientCertificateKeyStorePath</span><span class="token punctuation">(</span>KEYSTORE<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setSslClientCertificateKeyStoreType</span><span class="token punctuation">(</span><span class="token string">&quot;JKS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSslClientCertificateKeyStorePassword</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setSslTrustCertificateKeyStorePath</span><span class="token punctuation">(</span>TRUSTSTORE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSslTrustCertificateKeyStorePassword</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setSslTrustCertificateKeyStoreType</span><span class="token punctuation">(</span><span class="token string">&quot;JKS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSslKeyAlgorithm</span><span class="token punctuation">(</span><span class="token string">&quot;SunX509&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSslTrustAll</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setSslProtocol</span><span class="token punctuation">(</span><span class="token class-name">SslProtocol</span><span class="token punctuation">.</span>TLS<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>clientCfg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>下表介绍了客户端连接的加密参数：</p> <table><thead><tr><th>属性</th> <th>描述</th> <th>默认值</th></tr></thead> <tbody><tr><td><code>sslMode</code></td> <td><code>REQURED</code>或者<code>DISABLED</code></td> <td><code>DISABLED</code></td></tr> <tr><td><code>sslClientCertificateKeyStorePath</code></td> <td>私钥密钥库文件的路径</td> <td></td></tr> <tr><td><code>sslClientCertificateKeyStoreType</code></td> <td>密钥库的类型</td> <td><code>JKS</code></td></tr> <tr><td><code>sslClientCertificateKeyStorePassword</code></td> <td>密钥库的密码</td> <td></td></tr> <tr><td><code>sslTrustCertificateKeyStorePath</code></td> <td>信任库文件的路径</td> <td></td></tr> <tr><td><code>sslTrustCertificateKeyStoreType</code></td> <td>信任库的类型</td> <td><code>JKS</code></td></tr> <tr><td><code>sslTrustCertificateKeyStorePassword</code></td> <td>信任库的密码</td> <td></td></tr> <tr><td><code>sslKeyAlgorithm</code></td> <td>用于创建密钥管理器的密钥管理器算法</td> <td><code>SunX509</code></td></tr> <tr><td><code>sslTrustAll</code></td> <td>如果配置为<code>true</code>，则不验证证书</td> <td></td></tr> <tr><td><code>sslProtocol</code></td> <td>用于数据加密的协议名</td> <td><code>TLS</code></td></tr></tbody></table> <h4 id="_2-11-2-认证"><a href="#_2-11-2-认证" class="header-anchor">#</a> 2.11.2.认证</h4> <p>配置<a href="/doc/java/Security.html#_1-认证">集群侧的认证</a>，然后在客户端配置中提供用户名和密码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ClientConfiguration</span> clientCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddresses</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:10800&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">&quot;joe&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setUserPassword</span><span class="token punctuation">(</span><span class="token string">&quot;passw0rd!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>clientCfg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClientAuthenticationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Handle authentication failure</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-12-异步api"><a href="#_2-12-异步api" class="header-anchor">#</a> 2.12.异步API</h3> <p>大多数绑定到网络的瘦客户端API都有一个对应的异步API，比如<code>ClientCache.get</code>和<code>ClientCache.getAsync</code>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">IgniteClient</span> client <span class="token operator">=</span> <span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">startClient</span><span class="token punctuation">(</span>clientCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ClientCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">&quot;cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IgniteClientFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> putFut <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">putAsync</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
putFut<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Blocking wait.</span>

<span class="token class-name">IgniteClientFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> getFut <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">getAsync</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
getFut<span class="token punctuation">.</span><span class="token function">thenAccept</span><span class="token punctuation">(</span>val <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Non-blocking continuation.</span>
</code></pre></div><ul><li>异步方法不会阻塞调用线程；</li> <li>异步方法返回<code>IgniteClientFuture&lt;T&gt;</code>，其实现了<code>Future&lt;T&gt;</code>和<code>CompletionStage&lt;T&gt;</code>接</li> <li>异步操作通过<code>ClientConfiguration.asyncContinuationExecutor</code>继续执行，默认值为<code>ForkJoinPool#commonPool()</code>，例如，<code>cache.getAsync(1).thenAccept(val → System.out.println(val))</code>会使用<code>commonPool</code>中的一个线程来执行<code>println</code>调用。</li></ul> <h2 id="_3-net瘦客户端"><a href="#_3-net瘦客户端" class="header-anchor">#</a> 3..NET瘦客户端</h2> <h3 id="_3-1-环境要求"><a href="#_3-1-环境要求" class="header-anchor">#</a> 3.1.环境要求</h3> <ul><li>支持的运行时：.NET 4.0+，.NET Core 2.0+；</li> <li>支持的操作系统：Windows，Linux，macOS (.NET Core 2.0+支持的任何操作系统)。</li></ul> <h3 id="_3-2-安装"><a href="#_3-2-安装" class="header-anchor">#</a> 3.2.安装</h3> <p>.NET瘦客户端API由Ignite.NET API库提供，位于二进制包的<code>{IGNITE_HOME}/platforms/dotnet</code>目录下，API位于<code>Apache.Ignite.Core</code>程序集中。</p> <h3 id="_3-3-接入集群"><a href="#_3-3-接入集群" class="header-anchor">#</a> 3.3.接入集群</h3> <p>瘦客户端的API入口是<code>Ignition.StartClient(IgniteClientConfiguration)</code>方法，其中<code>IgniteClientConfiguration.Endpoints</code>是必需的，它指向了运行服务端节点的主机。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span>
<span class="token punctuation">{</span>
    Endpoints <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;127.0.0.1:10800&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> client <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">StartClient</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetOrCreateCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-3-1-故障转移"><a href="#_3-3-1-故障转移" class="header-anchor">#</a> 3.3.1.故障转移</h4> <p>可以提供多个节点的地址，这时瘦客户端会随机接入列表中的服务端，这时<strong>故障转移机制</strong>就会启用，即如果一个服务端故障，客户端会尝试其他的地址然后自动重连。注意如果服务端节点故障时客户端操作正在执行中，有可能抛出<code>IgniteClientException</code>异常，开发者需要处理这个异常并实现相应的重试逻辑。</p> <h4 id="_3-3-2-服务端节点自动发现"><a href="#_3-3-2-服务端节点自动发现" class="header-anchor">#</a> 3.3.2.服务端节点自动发现</h4> <p>瘦客户端可以自动发现集群中的服务端节点，如果开启了分区感知，这个功能就会启用。</p> <p>服务端的发现是一个异步的过程，是在后台进行的。另外，瘦客户端只在执行部分操作时才会接收拓扑更新（以最大程度地减少来自空闲连接的服务器负载和网络流量）。</p> <p>可以通过启用日志记录和/或调用<code>IIgniteClient.GetConnections</code>来观察发现过程：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span>
<span class="token punctuation">{</span>
    Endpoints <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;127.0.0.1:10800&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    EnablePartitionAwareness <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">,</span>

    <span class="token comment">// Enable trace logging to observe discovery process.</span>
    Logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConsoleLogger</span> <span class="token punctuation">{</span> MinLevel <span class="token operator">=</span> LogLevel<span class="token punctuation">.</span>Trace <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> client <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">StartClient</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Perform any operation and sleep to let the client discover</span>
<span class="token comment">// server nodes asynchronously.</span>
client<span class="token punctuation">.</span><span class="token function">GetCacheNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">IClientConnection</span> connection <span class="token keyword">in</span> client<span class="token punctuation">.</span><span class="token function">GetConnections</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span>RemoteEndPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">警告</p> <p>当服务端位于NAT服务器或代理之后时，服务端发现可能不起作用。服务端节点将其地址和端口提供给客户端，但是当客户端位于其他子网中时，这些地址将不起作用。</p></div> <h3 id="_3-4-分区感知"><a href="#_3-4-分区感知" class="header-anchor">#</a> 3.4.分区感知</h3> <p>分区感知使得瘦客户端可以将请求直接发给待处理数据所在的节点。</p> <div class="custom-block warning"><p class="custom-block-title">警告</p> <p>分区感知是一个试验性特性，在正式发布之前，API和设计架构可能会修改。</p></div> <p>在没有分区感知时，通过瘦客户端接入集群的应用，实际是通过某个作为代理的服务端节点执行所有查询和操作，然后将这些操作重新路由到数据所在的节点，这会导致瓶颈，可能会限制应用的线性扩展能力。</p> <p><img src="https://ignite.apache.org/docs/2.9.0/images/partitionawareness01.png" alt=""></p> <p>注意查询必须通过代理服务端节点，然后路由到正确的节点。</p> <p>有了分区感知之后，瘦客户端可以将查询和操作直接路由到持有待处理数据的主节点，这消除了瓶颈，使应用更易于扩展。</p> <p><img src="https://ignite.apache.org/docs/2.9.0/images/partitionawareness02.png" alt=""></p> <p>将<code>IgniteClientConfiguration.EnablePartitionAwareness</code>属性配置为<code>true</code>可以开启分区感知，这同时也开启了服务端发现。如果客户端位于NAT或者代理之后，服务端自动发现可能不起作用，这时需要在客户端的连接配置中提供所有的服务端地址。</p> <h3 id="_3-5-使用键-值api"><a href="#_3-5-使用键-值api" class="header-anchor">#</a> 3.5.使用键-值API</h3> <h4 id="_3-5-1-获取缓存的实例"><a href="#_3-5-1-获取缓存的实例" class="header-anchor">#</a> 3.5.1.获取缓存的实例</h4> <p><code>ICacheClient</code>API提供了键-值操作API，通过如下的方法可以获得<code>ICacheClient</code>的实例：</p> <ul><li><code>GetCache(cacheName)</code>：返回已有缓存的实例；</li> <li><code>CreateCache(cacheName)</code>：用指定名字创建一个缓存；</li> <li><code>GetOrCreateCache(CacheClientConfiguration)</code>：通过指定的配置获取和创建一个缓存；</li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cacheCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheClientConfiguration</span>
<span class="token punctuation">{</span>
    Name <span class="token operator">=</span> <span class="token string">&quot;References&quot;</span><span class="token punctuation">,</span>
    CacheMode <span class="token operator">=</span> CacheMode<span class="token punctuation">.</span>Replicated<span class="token punctuation">,</span>
    WriteSynchronizationMode <span class="token operator">=</span> CacheWriteSynchronizationMode<span class="token punctuation">.</span>FullSync
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetOrCreateCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>cacheCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用<code>IIgniteClient.GetCacheNames()</code>可以获得所有已有缓存的列表。</p> <h4 id="_3-5-2-基本缓存操作"><a href="#_3-5-2-基本缓存操作" class="header-anchor">#</a> 3.5.2.基本缓存操作</h4> <p>下面的代码片段演示了如何从瘦客户端执行基本的缓存操作：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> data <span class="token operator">=</span> Enumerable<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToDictionary</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">,</span> e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">PutAll</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> replace <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>replace<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//false</span>

<span class="token keyword">var</span> <span class="token keyword">value</span> <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>

replace <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>replace<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>

<span class="token keyword">value</span> <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//3</span>

cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">&quot;101&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">RemoveAll</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> sizeIsOne <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">GetSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>sizeIsOne<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>

<span class="token keyword">value</span> <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//101</span>

cache<span class="token punctuation">.</span><span class="token function">RemoveAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> sizeIsZero <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">GetSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>sizeIsZero<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>
</code></pre></div><h4 id="_3-5-3-处理二进制对象"><a href="#_3-5-3-处理二进制对象" class="header-anchor">#</a> 3.5.3.处理二进制对象</h4> <p>瘦客户端完全支持<a href="/doc/java/UsingKeyValueApi.html#_2-使用二进制对象">处理二进制对象</a>章节中介绍的二进制对象API，使用<code>ICacheClient.WithKeepBinary()</code>可以将缓存切换到二进制模式，然后就可以直接处理二进制对象而避免序列化/反序列化。使用<code>IIgniteClient.GetBinary()</code>可以获取一个<code>IBinary</code>的实例，然后就可以从头开始构建一个对象。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> binary <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">GetBinary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> val <span class="token operator">=</span> binary<span class="token punctuation">.</span><span class="token function">GetBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;Person&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">SetField</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">SetField</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Joe&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetOrCreateCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;persons&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">WithKeepBinary</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">IBinaryObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token keyword">value</span> <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-6-执行扫描查询"><a href="#_3-6-执行扫描查询" class="header-anchor">#</a> 3.6.执行扫描查询</h3> <p>使用扫描查询可获得一组满足给定条件的条目，瘦客户端将查询发送到集群节点，在集群节点上将其作为普通扫描查询执行。</p> <p>查询条件由一个<code>ICacheEntryFilter</code>对象指定，该对象作为参数传递给查询构造函数。</p> <p>查询过滤器定义方式如下：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">NameFilter</span> <span class="token punctuation">:</span> <span class="token class-name">ICacheEntryFilter</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> Person<span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">bool</span> <span class="token function">Invoke</span><span class="token punctuation">(</span>ICacheEntry<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> Person<span class="token operator">&gt;</span> entry<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> entry<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;Smith&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后执行扫描查询：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetOrCreateCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;personCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>Name <span class="token operator">=</span> <span class="token string">&quot;John Smith&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>Name <span class="token operator">=</span> <span class="token string">&quot;John Johnson&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> cursor <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token generic-method"><span class="token function">ScanQuery</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NameFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">var</span> entry <span class="token keyword">in</span> cursor<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Key = &quot;</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span>Key <span class="token operator">+</span> <span class="token string">&quot;, Name = &quot;</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-7-执行sql语句"><a href="#_3-7-执行sql语句" class="header-anchor">#</a> 3.7.执行SQL语句</h3> <p>瘦客户端提供了一个SQL API来执行SQL语句，SQL语句通过<code>SqlFieldsQuery</code>对象来声明，然后通过<code>ICacheClient.Query(SqlFieldsQuery)</code>来执行。另外，SQL查询也可以通过Ignite LINQ提供者来执行。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetOrCreateCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;Person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cache<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span>
        $<span class="token string">&quot;CREATE TABLE IF NOT EXISTS Person (id INT PRIMARY KEY, name VARCHAR) WITH \&quot;VALUE_TYPE={typeof(Person)}\&quot;&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>Schema <span class="token operator">=</span> <span class="token string">&quot;PUBLIC&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> val <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>Id <span class="token operator">=</span> key<span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">&quot;Person 1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO Person(id, name) VALUES(?, ?)&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Arguments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>val<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> val<span class="token punctuation">.</span>Name<span class="token punctuation">}</span><span class="token punctuation">,</span>
        Schema <span class="token operator">=</span> <span class="token string">&quot;PUBLIC&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> cursor <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT name FROM Person WHERE id = ?&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Arguments <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>key<span class="token punctuation">}</span><span class="token punctuation">,</span>
        Schema <span class="token operator">=</span> <span class="token string">&quot;PUBLIC&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> results <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">GetAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> first <span class="token operator">=</span> results<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>first <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;name = &quot;</span> <span class="token operator">+</span> first<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-8-使用集群api"><a href="#_3-8-使用集群api" class="header-anchor">#</a> 3.8.使用集群API</h3> <p>集群API可以用于创建集群组然后在这个组中执行各种操作。<code>IClientCluster</code>接口是该API的入口，用处如下：</p> <ul><li>获取或者修改集群的状态；</li> <li>获取集群所有节点的列表；</li> <li>创建集群节点的逻辑组，然后使用其他的Ignite API在组中执行特定的操作。</li></ul> <p>使用<code>IClientCluster</code>实例可以获得包含所有节点的<code>IClientCluster</code>的引用。并激活整个集群以及<code>my-cache</code>缓存的预写日志。</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">IIgniteClient</span> client <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">StartClient</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IClientCluster</span> cluster <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">GetCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cluster<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cluster<span class="token punctuation">.</span><span class="token function">EnableWal</span><span class="token punctuation">(</span><span class="token string">&quot;my-cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-8-1-节点逻辑分组"><a href="#_3-8-1-节点逻辑分组" class="header-anchor">#</a> 3.8.1.节点逻辑分组</h4> <p>可以使用集群API的<code>IClientClusterGroup</code>接口来创建集群节点的各种组合。比如，一个组可以包含所有的服务端节点，而另一组可以仅包含与特定TCP/IP地址格式匹配的那些节点，下面的示例显示如何创建位于<code>dc1</code>数据中心的一组服务端节点：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">IIgniteClient</span> client <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">StartClient</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IClientClusterGroup</span> serversInDc1 <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">GetCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ForServers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ForAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;dc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dc1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">IClientClusterNode</span> node <span class="token keyword">in</span> serversInDc1<span class="token punctuation">.</span><span class="token function">GetNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>$<span class="token string">&quot;Node ID: {node.Id}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意，<code>IClientCluster</code>实例实现了<code>IClientClusterGroup</code>，这个是集群组根，包括了集群的所有节点。</p> <p>关于这个功能的更多信息，请参见<a href="/doc/java/DistributedComputing.html#_2-集群组">集群组</a>的相关文档。</p> <h3 id="_3-9-执行计算任务"><a href="#_3-9-执行计算任务" class="header-anchor">#</a> 3.9.执行计算任务</h3> <p>当前，.NET瘦客户端通过执行集群中<strong>已经部署</strong>的计算任务来支持基本的<a href="/doc/java/DistributedComputing.html#_1-分布式计算api">计算功能</a>。可以跨所有集群节点或特定<a href="#_3-8-1-%E8%8A%82%E7%82%B9%E9%80%BB%E8%BE%91%E5%88%86%E7%BB%84">集群组</a>运行任务。</p> <p>由瘦客户端触发的任务执行默认在集群侧被禁用。需要在服务端节点和胖客户端节点将<code>ThinClientConfiguration.MaxActiveComputeTasksPerConnection</code>参数设置为非零值：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="xml" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ignite.cfg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>clientConnectorConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.ClientConnectorConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>thinClientConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.ThinClientConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>maxActiveComputeTasksPerConnection<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="c#" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> igniteCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    ClientConnectorConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConnectorConfiguration</span>
    <span class="token punctuation">{</span>
        ThinClientConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThinClientConfiguration</span>
        <span class="token punctuation">{</span>
            MaxActiveComputeTasksPerConnection <span class="token operator">=</span> <span class="token number">10</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">IIgnite</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>igniteCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <p>下面的示例显示如果通过<code>IComputeClient</code>接口访问计算API，然后执行名为<code>org.foo.bar.AddOneTask</code>、传入参数为<code>1</code>的计算任务：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">IIgniteClient</span> client <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">StartClient</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IComputeClient</span> compute <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> result <span class="token operator">=</span> compute<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ExecuteJavaTask</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;org.foo.bar.AddOneTask&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-10-执行ignite服务"><a href="#_3-10-执行ignite服务" class="header-anchor">#</a> 3.10.执行Ignite服务</h3> <p>可以使用<code>IServicesClient</code>API调用已在集群中部署的Ignite服务，关于服务的部署，请参见<a href="/doc/java/Service.html">使用Ignite服务</a>章节的内容。</p> <p>下面的示例显示如何调用名为<code>MyService</code>的服务：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">IIgniteClient</span> client <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">StartClient</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IServicesClient</span> services <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">GetServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IMyService</span> serviceProxy <span class="token operator">=</span> services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetServiceProxy</span><span class="token punctuation">&lt;</span><span class="token class-name">IMyService</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;MyService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
serviceProxy<span class="token punctuation">.</span><span class="token function">MyServiceMethod</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>本客户端可以执行由Java或者.NET实现的服务。</p> <h3 id="_3-11-安全"><a href="#_3-11-安全" class="header-anchor">#</a> 3.11.安全</h3> <h4 id="_3-11-1-ssl-tls"><a href="#_3-11-1-ssl-tls" class="header-anchor">#</a> 3.11.1.SSL/TLS</h4> <p>要在瘦客户端和集群之间使用加密的通信，必须在集群配置和客户端配置中都启用SSL/TLS。有关集群配置的说明，请参见<a href="#_1-3-2-%E4%B8%BA%E7%98%A6%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%90%AF%E7%94%A8ssl-tls">瘦客户端启用SSL/TLS</a>章节的介绍。</p> <p>下面的代码示例演示了如何在瘦客户端中配置SSL参数：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span>
<span class="token punctuation">{</span>
    Endpoints <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;127.0.0.1:10800&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    SslStreamFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SslStreamFactory</span>
    <span class="token punctuation">{</span>
        CertificatePath <span class="token operator">=</span> <span class="token string">&quot;.../certs/client.pfx&quot;</span><span class="token punctuation">,</span>
        CertificatePassword <span class="token operator">=</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> client <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">StartClient</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-11-2-认证"><a href="#_3-11-2-认证" class="header-anchor">#</a> 3.11.2.认证</h4> <p>配置<a href="/doc/java/Security.html#_1-认证">集群侧的认证</a>，然后在客户端配置中提供用户名和密码：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span>
<span class="token punctuation">{</span>
    Endpoints <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;127.0.0.1:10800&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    UserName <span class="token operator">=</span> <span class="token string">&quot;ignite&quot;</span><span class="token punctuation">,</span>
    Password <span class="token operator">=</span> <span class="token string">&quot;ignite&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> client <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">StartClient</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_4-c-瘦客户端"><a href="#_4-c-瘦客户端" class="header-anchor">#</a> 4.C++瘦客户端</h2> <h3 id="_4-1-环境要求"><a href="#_4-1-环境要求" class="header-anchor">#</a> 4.1.环境要求</h3> <ul><li>C编译器：MS Visual C（10.0及以后），g++（4.4.0及以后）；</li> <li>Visual Studio 2010及以后。</li></ul> <h3 id="_4-2-安装"><a href="#_4-2-安装" class="header-anchor">#</a> 4.2.安装</h3> <p>Ignite二进制包的<code>${IGNITE_HOME}/platforms/cpp</code>目录中包含了C++瘦客户端的源代码。</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="windows" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-batch extra-class"><pre class="language-batch"><code><span class="token command"><span class="token keyword">cd</span> <span class="token variable">%IGNITE_HOME%</span>\platforms\cpp\project\vs</span>

<span class="token command"><span class="token keyword">msbuild</span> ignite.sln <span class="token parameter attr-name">/p<span class="token punctuation">:</span></span>Configuration=Release <span class="token parameter attr-name">/p<span class="token punctuation">:</span></span>Platform=x64</span>
</code></pre></div></section> <section aria-hidden="true" id="ubuntu" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> <span class="token variable">${CPP_BUILD_DIR}</span>
cmake -DCMAKE_BUILD_TYPE<span class="token operator">=</span>Release -DWITH_THIN_CLIENT<span class="token operator">=</span>ON <span class="token variable">${IGNITE_HOME}</span>/platforms/cpp
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre></div></section> <section aria-hidden="true" id="centos/rhel" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> <span class="token variable">${CPP_BUILD_DIR}</span>
cmake3 -DCMAKE_BUILD_TYPE<span class="token operator">=</span>Release -DWITH_THIN_CLIENT<span class="token operator">=</span>ON <span class="token variable">${IGNITE_HOME}</span>/platforms/cpp
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre></div></section></div></div> <h3 id="_4-3-创建客户端实例"><a href="#_4-3-创建客户端实例" class="header-anchor">#</a> 4.3.创建客户端实例</h3> <p>瘦客户端提供的API位于<code>ignite::thin</code>命名空间，API的主要入口是<code>IgniteClient::Start(IgniteClientConfiguration)</code>方法，会返回一个客户端的实例：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ignite/thin/ignite_client.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ignite/thin/ignite_client_configuration.h&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> ignite<span class="token operator">::</span>thin<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">TestClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    IgniteClientConfiguration cfg<span class="token punctuation">;</span>

    <span class="token comment">//Endpoints list format is &quot;&lt;host&gt;[port[..range]][,...]&quot;</span>
    cfg<span class="token punctuation">.</span><span class="token function">SetEndPoints</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:11110,example.com:1234..1240&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    IgniteClient client <span class="token operator">=</span> IgniteClient<span class="token operator">::</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cache<span class="token operator">::</span>CacheClient<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">&gt;</span> cacheClient <span class="token operator">=</span>
        client<span class="token punctuation">.</span>GetOrCreateCache<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;TestCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cacheClient<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello Ignite Thin Client!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_4-3-1-分区感知"><a href="#_4-3-1-分区感知" class="header-anchor">#</a> 4.3.1.分区感知</h4> <p>分区感知使得瘦客户端可以将请求直接发给待处理数据所在的节点。</p> <div class="custom-block warning"><p class="custom-block-title">警告</p> <p>分区感知是一个试验性特性，在正式发布之前，API和设计架构可能会修改。</p></div> <p>在没有分区感知时，通过瘦客户端接入集群的应用，实际是通过某个作为代理的服务端节点执行所有查询和操作，然后将这些操作重新路由到数据所在的节点，这会导致瓶颈，可能会限制应用的线性扩展能力。</p> <p><img src="https://ignite.apache.org/docs/2.9.0/images/partitionawareness01.png" alt=""></p> <p>注意查询必须通过代理服务端节点，然后路由到正确的节点。</p> <p>有了分区感知之后，瘦客户端可以将查询和操作直接路由到持有待处理数据的主节点，这消除了瓶颈，使应用更易于扩展。</p> <p><img src="https://ignite.apache.org/docs/2.9.0/images/partitionawareness02.png" alt=""></p> <div class="custom-block danger"><p class="custom-block-title">警告</p> <p>注意目前对于非Java客户端需要在连接属性中提供所有服务端节点的地址。这意味着如果新的服务端节点加入集群，则应将新服务端的地址添加到连接属性中，然后重新连接。否则，瘦客户端将无法向该服务端发送直接请求，正式发布之后将解决此限制。</p></div> <p>下面的代码演示了C++瘦客户端中的分区感知功能如何使用：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ignite/thin/ignite_client.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ignite/thin/ignite_client_configuration.h&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> ignite<span class="token operator">::</span>thin<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">TestClientPartitionAwareness</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    IgniteClientConfiguration cfg<span class="token punctuation">;</span>
    cfg<span class="token punctuation">.</span><span class="token function">SetEndPoints</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:10800,217.29.2.1:10800,200.10.33.1:10800&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cfg<span class="token punctuation">.</span><span class="token function">SetPartitionAwareness</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    IgniteClient client <span class="token operator">=</span> IgniteClient<span class="token operator">::</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cache<span class="token operator">::</span>CacheClient<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">&gt;</span> cacheClient <span class="token operator">=</span>
        client<span class="token punctuation">.</span>GetOrCreateCache<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;TestCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cacheClient<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello Ignite Partition Awareness!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cacheClient<span class="token punctuation">.</span><span class="token function">RefreshAffinityMapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Getting a value</span>
    std<span class="token operator">::</span>string val <span class="token operator">=</span> cacheClient<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-4-使用键-值api"><a href="#_4-4-使用键-值api" class="header-anchor">#</a> 4.4.使用键-值API</h3> <h4 id="_4-4-1-获取缓存实例"><a href="#_4-4-1-获取缓存实例" class="header-anchor">#</a> 4.4.1.获取缓存实例</h4> <p>要在缓存上执行基本的键-值操作，需要先获取缓存的实例：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>cache<span class="token operator">::</span>CacheClient<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">&gt;</span> cache <span class="token operator">=</span>
    client<span class="token punctuation">.</span>GetOrCreateCache<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;TestCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>GetOrCreateCache(cacheName)</code>会返回一个缓存的实例，如果不存在，会创建一个新的缓存。</p> <h4 id="_4-4-2-基本缓存操作"><a href="#_4-4-2-基本缓存操作" class="header-anchor">#</a> 4.4.2.基本缓存操作</h4> <p>下面的代码片段演示了如何在一个缓存上执行基本的缓存操作：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>std<span class="token operator">::</span>map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">&gt;</span> vals<span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    vals<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

cache<span class="token punctuation">.</span><span class="token function">PutAll</span><span class="token punctuation">(</span>vals<span class="token punctuation">)</span><span class="token punctuation">;</span>
cache<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">&quot;101&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cache<span class="token punctuation">.</span><span class="token function">RemoveAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-5-安全"><a href="#_4-5-安全" class="header-anchor">#</a> 4.5.安全</h3> <h4 id="_4-5-1-ssl-tls"><a href="#_4-5-1-ssl-tls" class="header-anchor">#</a> 4.5.1.SSL/TLS</h4> <p>要在瘦客户端和集群之间使用加密的通信，必须在集群配置和客户端配置中都启用SSL/TLS。有关集群配置的说明，请参见<a href="#_1-3-2-%E4%B8%BA%E7%98%A6%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%90%AF%E7%94%A8ssl-tls">瘦客户端启用SSL/TLS</a>章节的介绍。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>IgniteClientConfiguration cfg<span class="token punctuation">;</span>

<span class="token comment">// Sets SSL mode.</span>
cfg<span class="token punctuation">.</span><span class="token function">SetSslMode</span><span class="token punctuation">(</span>SslMode<span class="token operator">::</span>Type<span class="token operator">::</span>REQUIRE<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Sets file path to SSL certificate authority to authenticate server certificate during connection establishment.</span>
cfg<span class="token punctuation">.</span><span class="token function">SetSslCaFile</span><span class="token punctuation">(</span><span class="token string">&quot;path/to/SSL/certificate/authority&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Sets file path to SSL certificate to use during connection establishment.</span>
cfg<span class="token punctuation">.</span><span class="token function">SetSslCertFile</span><span class="token punctuation">(</span><span class="token string">&quot;path/to/SSL/certificate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Sets file path to SSL private key to use during connection establishment.</span>
cfg<span class="token punctuation">.</span><span class="token function">SetSslKeyFile</span><span class="token punctuation">(</span><span class="token string">&quot;path/to/SSL/private/key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_4-5-2-认证"><a href="#_4-5-2-认证" class="header-anchor">#</a> 4.5.2.认证</h4> <p>配置<a href="/doc/java/Security.html#_1-认证">集群侧的认证</a>，然后在客户端配置中提供用户名和密码：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ignite/thin/ignite_client.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ignite/thin/ignite_client_configuration.h&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> ignite<span class="token operator">::</span>thin<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">TestClientWithAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    IgniteClientConfiguration cfg<span class="token punctuation">;</span>
    cfg<span class="token punctuation">.</span><span class="token function">SetEndPoints</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:10800&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Use your own credentials here.</span>
    cfg<span class="token punctuation">.</span><span class="token function">SetUser</span><span class="token punctuation">(</span><span class="token string">&quot;ignite&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cfg<span class="token punctuation">.</span><span class="token function">SetPassword</span><span class="token punctuation">(</span><span class="token string">&quot;ignite&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    IgniteClient client <span class="token operator">=</span> IgniteClient<span class="token operator">::</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cache<span class="token operator">::</span>CacheClient<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">&gt;</span> cacheClient <span class="token operator">=</span>
        client<span class="token punctuation">.</span>GetOrCreateCache<span class="token operator">&lt;</span><span class="token keyword">int32_t</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;TestCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cacheClient<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello Ignite Thin Client with auth!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-6-事务"><a href="#_4-6-事务" class="header-anchor">#</a> 4.6.事务</h3> <p>带<code>AtomicityMode.TRANSACTIONAL</code>模式的缓存支持客户端事务。</p> <h4 id="_4-6-1-执行事务"><a href="#_4-6-1-执行事务" class="header-anchor">#</a> 4.6.1.执行事务</h4> <p>从<code>IgniteClient</code>中拿到<code>ClientTransactions</code>对象后，就可以开启事务。<code>ClientTransactions</code>有一组<code>txStart(…​)</code>方法，每个方法都会开启一个新的事务然后返回一个表示事务的<code>ClientTransaction</code>对象，使用该对象可以对事务进行提交或回滚。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>cache<span class="token operator">::</span>CacheClient<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span> cache <span class="token operator">=</span> client<span class="token punctuation">.</span>GetCache<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;my_transactional_cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

transactions<span class="token operator">::</span>ClientTransactions transactions <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">ClientTransactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

transactions<span class="token operator">::</span>ClientTransaction tx <span class="token operator">=</span> transactions<span class="token punctuation">.</span><span class="token function">TxStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_4-6-2-事务配置"><a href="#_4-6-2-事务配置" class="header-anchor">#</a> 4.6.2.事务配置</h4> <p>客户端事务可以有不同的并发模型、隔离级别和执行超时，这些参数可以进行全局的配置，也可以进行事务级的配置。</p> <p>可以在启动某个事务时指定这些参数，这时这些参数会覆盖全局的默认参数。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>transactions<span class="token operator">::</span>ClientTransactions transactions <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">ClientTransactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">uint32_t</span> TX_TIMEOUT <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>

transactions<span class="token operator">::</span>ClientTransaction tx <span class="token operator">=</span> transactions<span class="token punctuation">.</span><span class="token function">TxStart</span><span class="token punctuation">(</span>TransactionConcurrency<span class="token operator">::</span>OPTIMISTIC<span class="token punctuation">,</span> TransactionIsolation<span class="token operator">::</span>SERIALIZABLE<span class="token punctuation">,</span> TX_TIMEOUT<span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>还可以执行带标签的事务：</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>transactions<span class="token operator">::</span>ClientTransaction tx <span class="token operator">=</span> transactions<span class="token punctuation">.</span><span class="token function">withLabel</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">TxStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

transactions<span class="token operator">::</span>ClientTransaction tx <span class="token operator">=</span> transactions<span class="token punctuation">.</span><span class="token function">withLabel</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">TxStart</span><span class="token punctuation">(</span>TransactionConcurrency<span class="token operator">::</span>OPTIMISTIC<span class="token punctuation">,</span> TransactionIsolation<span class="token operator">::</span>SERIALIZABLE<span class="token punctuation">,</span> TX_TIMEOUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_5-python瘦客户端"><a href="#_5-python瘦客户端" class="header-anchor">#</a> 5.Python瘦客户端</h2> <h3 id="_5-1-环境要求"><a href="#_5-1-环境要求" class="header-anchor">#</a> 5.1.环境要求</h3> <p>Python 3.4版本及以上</p> <h3 id="_5-2-安装"><a href="#_5-2-安装" class="header-anchor">#</a> 5.2.安装</h3> <p>可以使用<code>pip</code>或者zip压缩包来安装Python瘦客户端。</p> <h4 id="_5-2-1-使用pip"><a href="#_5-2-1-使用pip" class="header-anchor">#</a> 5.2.1.使用PIP</h4> <p>Python的瘦客户端包名为<code>pyignite</code>，可以使用下面的命令安装它：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="pip3" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-shell extra-class"><pre class="language-shell"><code>pip3 <span class="token function">install</span> pyignite
</code></pre></div></section> <section aria-hidden="true" id="pip" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> pyignite
</code></pre></div></section></div></div> <h4 id="_5-2-2-使用zip压缩包"><a href="#_5-2-2-使用zip压缩包" class="header-anchor">#</a> 5.2.2.使用ZIP压缩包</h4> <p>瘦客户端可以从zip压缩包安装：</p> <ul><li>下载Ignite的<a href="https://ignite.apache.org/download.cgi#binaries" target="_self" rel="noopener noreferrer">二进制包</a>；</li> <li>解压压缩包然后转到其根目录；</li> <li>使用如下的命令安装瘦客户端：</li></ul> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="pip3" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-shell extra-class"><pre class="language-shell"><code>pip3 <span class="token function">install</span> <span class="token builtin class-name">.</span>
</code></pre></div></section> <section aria-hidden="true" id="pip" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> <span class="token builtin class-name">.</span>
</code></pre></div></section></div></div> <p>这将以所谓的<code>develop</code>或者<code>editable</code>模式安装<code>pyignite</code>，关于该模式的更多信息，请参见<a href="https://pip.pypa.io/en/stable/reference/pip_install/#editable-installs" target="_self" rel="noopener noreferrer">官方文档</a>。</p> <p>检查<code>requirements</code>文件夹，然后根据需要安装，安装时可使用下面的命令：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="pip3" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-shell extra-class"><pre class="language-shell"><code>pip3 <span class="token function">install</span> -r requirements/<span class="token operator">&lt;</span>your task<span class="token operator">&gt;</span>.txt
</code></pre></div></section> <section aria-hidden="true" id="pip" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> -r requirements/<span class="token operator">&lt;</span>your task<span class="token operator">&gt;</span>.txt
</code></pre></div></section></div></div> <p>关于<code>setup.py</code>使用方面的细节，请参见<a href="https://setuptools.readthedocs.io/en/latest/" target="_self" rel="noopener noreferrer">配置工具手册</a>。</p> <h3 id="_5-3-接入集群"><a href="#_5-3-接入集群" class="header-anchor">#</a> 5.3.接入集群</h3> <p>二进制包中包含了可运行的示例，演示了Python瘦客户端的基本使用场景，这些示例位于<code>{ROOT_FOLDER}/examples</code>文件夹。</p> <p>下面的代码片段显示了如何从Python瘦客户端接入集群：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client

<span class="token comment">## Open a connection</span>
client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-4-客户端故障转移"><a href="#_5-4-客户端故障转移" class="header-anchor">#</a> 5.4.客户端故障转移</h3> <p>如果到当前节点的连接故障或者超时，可以配置客户端自动故障转移到另一个节点。</p> <p>当连接故障时，客户端会传播初始异常（<code>OSError</code>或<code>SocketError</code>），但是会保持构造参数不变，然后尝试透明地重建连接。如果重连失败，会抛出<code>ReconnectError</code>异常。</p> <p>在下面的示例中，为客户端提供了3个节点的地址：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client
<span class="token keyword">from</span> pyignite<span class="token punctuation">.</span>datatypes<span class="token punctuation">.</span>cache_config <span class="token keyword">import</span> CacheMode
<span class="token keyword">from</span> pyignite<span class="token punctuation">.</span>datatypes<span class="token punctuation">.</span>prop_codes <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pyignite<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> SocketError

nodes <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'217.29.2.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'200.10.33.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

client <span class="token operator">=</span> Client<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">40.0</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>nodes<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Connected to {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">)</span>

my_cache <span class="token operator">=</span> client<span class="token punctuation">.</span>get_or_create_cache<span class="token punctuation">(</span><span class="token punctuation">{</span>
    PROP_NAME<span class="token punctuation">:</span> <span class="token string">'my_cache'</span><span class="token punctuation">,</span>
    PROP_CACHE_MODE<span class="token punctuation">:</span> CacheMode<span class="token punctuation">.</span>REPLICATED<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'test_key'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># Abstract main loop</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># Do the work</span>
        test_value <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'test_key'</span><span class="token punctuation">)</span>
        my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'test_key'</span><span class="token punctuation">,</span> test_value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> <span class="token punctuation">(</span>OSError<span class="token punctuation">,</span> SocketError<span class="token punctuation">)</span> <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token comment"># Recover from error (repeat last command, check data</span>
        <span class="token comment"># consistency or just continue − depends on the task)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Error: {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Last value: {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>my_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'test_key'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Reconnected to {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-5-分区感知"><a href="#_5-5-分区感知" class="header-anchor">#</a> 5.5.分区感知</h3> <p>分区感知使得瘦客户端可以将请求直接发给待处理数据所在的节点。</p> <p>在没有分区感知时，通过瘦客户端接入集群的应用，实际是通过某个作为代理的服务端节点执行所有查询和操作，然后将这些操作重新路由到数据所在的节点，这会导致瓶颈，可能会限制应用的线性扩展能力。</p> <p><img src="https://ignite.apache.org/docs/2.9.0/images/partitionawareness01.png" alt=""></p> <p>注意查询必须通过代理服务端节点，然后路由到正确的节点。</p> <p>有了分区感知之后，瘦客户端可以将查询和操作直接路由到持有待处理数据的主节点，这消除了瓶颈，使应用更易于扩展。</p> <p><img src="https://ignite.apache.org/docs/2.9.0/images/partitionawareness02.png" alt=""></p> <div class="custom-block danger"><p class="custom-block-title">警告</p> <p>注意目前对于非Java客户端需要在连接属性中提供所有服务端节点的地址。这意味着如果新的服务端节点加入集群，则应将新服务端的地址添加到连接属性中，然后重新连接。否则，瘦客户端将无法向该服务端发送直接请求，正式发布之后将解决此限制。</p></div> <p>要启用分区感知，需要在连接的构造函数中将<code>partition_aware</code>配置为<code>true</code>，然后在连接串中提供所有服务端节点的地址：</p> <div class="language-python extra-class"><pre class="language-python"><code>client <span class="token operator">=</span> Client<span class="token punctuation">(</span>partition_aware<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
nodes <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'217.29.2.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'200.10.33.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>nodes<span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-6-创建缓存"><a href="#_5-6-创建缓存" class="header-anchor">#</a> 5.6.创建缓存</h3> <p>可以使用下面的方法之一获取一个缓存的实例：</p> <ul><li><code>get_cache(settings)</code>：通过给定的名字或者参数配置创建一个本地缓存对象，该缓存必须在集群中存在，否则当在该缓存上执行操作时会抛出异常；</li> <li><code>create_cache(settings)</code>：通过给定的名字或者参数配置创建一个缓存；</li> <li><code>get_or_create_cache(settings)</code>：返回一个已有的缓存，或者在其不存在时创建它。</li></ul> <p>每个方法接收一个缓存名，或者表示缓存配置的参数列表。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client

<span class="token comment"># Open a connection</span>
client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>

<span class="token comment"># Create a cache</span>
my_cache <span class="token operator">=</span> client<span class="token punctuation">.</span>create_cache<span class="token punctuation">(</span><span class="token string">'myCache'</span><span class="token punctuation">)</span>
</code></pre></div><p>下面是通过一组参数创建缓存的示例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> collections <span class="token keyword">import</span> OrderedDict

<span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client<span class="token punctuation">,</span> GenericObjectMeta
<span class="token keyword">from</span> pyignite<span class="token punctuation">.</span>datatypes <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pyignite<span class="token punctuation">.</span>datatypes<span class="token punctuation">.</span>prop_codes <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># Open a connection</span>
client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>

cache_config <span class="token operator">=</span> <span class="token punctuation">{</span>
    PROP_NAME<span class="token punctuation">:</span> <span class="token string">'my_cache'</span><span class="token punctuation">,</span>
    PROP_BACKUPS_NUMBER<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    PROP_CACHE_KEY_CONFIGURATION<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">'type_name'</span><span class="token punctuation">:</span> <span class="token string">'PersonKey'</span><span class="token punctuation">,</span>
            <span class="token string">'affinity_key_field_name'</span><span class="token punctuation">:</span> <span class="token string">'companyId'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

my_cache <span class="token operator">=</span> client<span class="token punctuation">.</span>create_cache<span class="token punctuation">(</span>cache_config<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">PersonKey</span><span class="token punctuation">(</span>metaclass<span class="token operator">=</span>GenericObjectMeta<span class="token punctuation">,</span> type_name<span class="token operator">=</span><span class="token string">'PersonKey'</span><span class="token punctuation">,</span> schema<span class="token operator">=</span>OrderedDict<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">'personId'</span><span class="token punctuation">,</span> IntObject<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'companyId'</span><span class="token punctuation">,</span> IntObject<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


personKey <span class="token operator">=</span> PersonKey<span class="token punctuation">(</span>personId<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> companyId<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span>personKey<span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>my_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span>personKey<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_5-6-1-缓存配置"><a href="#_5-6-1-缓存配置" class="header-anchor">#</a> 5.6.1.缓存配置</h4> <p>可以配置的属性列表已在<code>prop_codes</code>模块中提供。</p> <table><thead><tr><th>属性名</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>PROP_NAME</code></td> <td>str</td> <td>缓存名，这是唯一必需的参数</td></tr> <tr><td><code>PROP_CACHE_MODE</code></td> <td>int</td> <td>缓存模式</td></tr> <tr><td><code>PROP_CACHE_ATOMICITY_MODE</code></td> <td>int</td> <td>缓存原子化模式</td></tr> <tr><td><code>PROP_BACKUPS_NUMBER</code></td> <td>int</td> <td>备份分区数量</td></tr> <tr><td><code>PROP_WRITE_SYNCHRONIZATION_MODE</code></td> <td>int</td> <td>写同步模式</td></tr> <tr><td><code>PROP_COPY_ON_READ</code></td> <td>bool</td> <td>读拷贝标志，默认值为<code>true</code></td></tr> <tr><td><code>PROP_READ_FROM_BACKUP</code></td> <td>bool</td> <td>是否尽可能从本地备份分区读取条目的标志，或者总是从主分区请求数据，默认值为<code>true</code></td></tr> <tr><td><code>PROP_DATA_REGION_NAME</code></td> <td>str</td> <td>数据区名</td></tr> <tr><td><code>PROP_IS_ONHEAP_CACHE_ENABLED</code></td> <td>bool</td> <td>是否开启缓存的堆内缓存</td></tr> <tr><td><code>PROP_QUERY_ENTITIES</code></td> <td>list</td> <td>查询实体列表</td></tr> <tr><td><code>PROP_QUERY_PARALLELISM</code></td> <td>int</td> <td>查询并行度</td></tr> <tr><td><code>PROP_QUERY_DETAIL_METRIC_SIZE</code></td> <td>int</td> <td>查询详细指标列表</td></tr> <tr><td><code>PROP_SQL_SCHEMA</code></td> <td>str</td> <td>SQL模式名</td></tr> <tr><td><code>PROP_SQL_INDEX_INLINE_MAX_SIZE</code></td> <td>int</td> <td>SQL索引内联最大值</td></tr> <tr><td><code>PROP_SQL_ESCAPE_ALL</code></td> <td>bool</td> <td>是否打开SQL转义</td></tr> <tr><td><code>PROP_MAX_QUERY_ITERATORS</code></td> <td>int</td> <td>查询迭代器的最大数量</td></tr> <tr><td><code>PROP_REBALANCE_MODE</code></td> <td>int</td> <td>再平衡模式</td></tr> <tr><td><code>PROP_REBALANCE_DELAY</code></td> <td>int</td> <td>再平衡延迟（毫秒）</td></tr> <tr><td><code>PROP_REBALANCE_TIMEOUT</code></td> <td>int</td> <td>再平衡超时（毫秒）</td></tr> <tr><td><code>PROP_REBALANCE_BATCH_SIZE</code></td> <td>int</td> <td>再平衡批次大小</td></tr> <tr><td><code>PROP_REBALANCE_BATCHES_PREFETCH_COUNT</code></td> <td>int</td> <td>再平衡预取计数</td></tr> <tr><td><code>PROP_REBALANCE_ORDER</code></td> <td>int</td> <td>再平衡顺序</td></tr> <tr><td><code>PROP_REBALANCE_THROTTLE</code></td> <td>int</td> <td>再平衡限流（毫秒）</td></tr> <tr><td><code>PROP_GROUP_NAME</code></td> <td>str</td> <td>缓存组名</td></tr> <tr><td><code>PROP_CACHE_KEY_CONFIGURATION</code></td> <td>list</td> <td>缓存键配置</td></tr> <tr><td><code>PROP_DEFAULT_LOCK_TIMEOUT</code></td> <td>int</td> <td>默认锁超时</td></tr> <tr><td><code>PROP_MAX_CONCURRENT_ASYNC_OPERATIONS</code></td> <td>int</td> <td>最大并发异步操作数</td></tr> <tr><td><code>PROP_PARTITION_LOSS_POLICY</code></td> <td>int</td> <td>分区丢失策略</td></tr> <tr><td><code>PROP_EAGER_TTL</code></td> <td>bool</td> <td>是否开启热生存时间</td></tr> <tr><td><code>PROP_STATISTICS_ENABLED</code></td> <td>bool</td> <td>是否开启统计</td></tr></tbody></table> <h5 id="_5-6-1-1-查询实体"><a href="#_5-6-1-1-查询实体" class="header-anchor">#</a> 5.6.1.1.查询实体</h5> <p>查询实体是描述<a href="/doc/java/WorkingwithSQL.html#_4-1-配置可查询字段">可查询字段</a>的对象，可查询字段是指缓存中可以使用SQL进行查询的字段。</p> <ul><li><code>table_name</code>：SQL表名；</li> <li><code>key_field_name</code>：键字段名；</li> <li><code>key_type_name</code>：键类型名（Java类型或者复杂对象）；</li> <li><code>value_field_name</code>：值字段名；</li> <li><code>value_type_name</code>：值类型名；</li> <li><code>field_name_aliases</code>：字段别名列表；</li> <li><code>query_fields</code>：可查询字段名列表；</li> <li><code>query_indexes</code>：查询索引列表。</li></ul> <p><strong>字段名别名</strong></p> <p>字段名别名用于给完整的属性名定义一个简称（<code>object.name</code> → <code>objectName</code>）。</p> <ul><li><code>field_name</code>：字段名；</li> <li><code>alias</code>：别名。</li></ul> <p><strong>可查询字段</strong></p> <p>定义可查询的字段：</p> <ul><li><code>name</code>：字段名；</li> <li><code>type_name</code>：Java类型名或者复杂对象名；</li> <li><code>is_key_field</code>：（可选）布尔值，默认为<code>False</code>；</li> <li><code>is_notnull_constraint_field</code>：布尔值；</li> <li><code>default_value</code>：（可选）可以转换为<code>type_name</code>类型的任何内容，默认为空（Null）；</li> <li><code>precision</code>：（可选）数值精度。数值中的位数总数，默认为-1（使用集群默认值），非数值SQL类型会被忽略（<code>java.math.BigDecimal</code>除外）；</li> <li><code>scale</code>：（可选）数值标度。小数点后的位数，默认为-1（使用集群默认值），非数值SQL类型会被忽略。</li></ul> <p><strong>查询索引</strong></p> <p>定义创建索引的字段。</p> <ul><li><code>index_name</code>：索引名；</li> <li><code>index_type</code>：索引类型代码，为无符号字节范围内的整数值；</li> <li><code>inline_size</code>：索引内联值，整数；</li> <li><code>fields</code>：索引字段列表。</li></ul> <p><strong>字段</strong></p> <ul><li><code>name</code>：字段名；</li> <li><code>is_descending</code>：（可选）布尔值，默认为<code>False</code>。</li></ul> <p><strong>缓存键</strong></p> <ul><li><code>type_name</code>：复杂类型名；</li> <li><code>affinity_key_field_name</code>：关联键字段名。</li></ul> <h3 id="_5-7-使用键-值api"><a href="#_5-7-使用键-值api" class="header-anchor">#</a> 5.7.使用键-值API</h3> <p><code>pyignite.cache.Cache</code>类提供了通过键-值操作处理缓存条目的方法，比如<code>put</code>、<code>put_all</code>、<code>get</code>、<code>get_all</code>、<code>replace</code>等，下面是一个示例：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client

client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>

<span class="token comment"># Create cache</span>
my_cache <span class="token operator">=</span> client<span class="token punctuation">.</span>create_cache<span class="token punctuation">(</span><span class="token string">'my cache'</span><span class="token punctuation">)</span>

<span class="token comment"># Put value in cache</span>
my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'my key'</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span>

<span class="token comment"># Get value from cache</span>
result <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'my key'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment"># 42</span>

result <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'non-existent key'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment"># None</span>

<span class="token comment"># Get multiple values from cache</span>
result <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>get_all<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string">'my key'</span><span class="token punctuation">,</span>
    <span class="token string">'non-existent key'</span><span class="token punctuation">,</span>
    <span class="token string">'other-key'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment"># {'my key': 42}</span>
</code></pre></div><h4 id="_5-7-1-使用类型提示"><a href="#_5-7-1-使用类型提示" class="header-anchor">#</a> 5.7.1.使用类型提示</h4> <p>处理单个值或键的<code>pyignite</code>方法具有一个附加的可选参数<code>value_hint</code>或<code>key_hint</code>，该参数接受一个解析器/构造器类。几乎任何结构化元素（在<code>dict</code>或<code>list</code>内部）都可以替换为2元组(元素，类型提示)。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client
<span class="token keyword">from</span> pyignite<span class="token punctuation">.</span>datatypes <span class="token keyword">import</span> CharObject<span class="token punctuation">,</span> ShortObject

client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>

my_cache <span class="token operator">=</span> client<span class="token punctuation">.</span>get_or_create_cache<span class="token punctuation">(</span><span class="token string">'my cache'</span><span class="token punctuation">)</span>

my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'my key'</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span>
<span class="token comment"># Value ‘42’ takes 9 bytes of memory as a LongObject</span>

my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'my key'</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> value_hint<span class="token operator">=</span>ShortObject<span class="token punctuation">)</span>
<span class="token comment"># Value ‘42’ takes only 3 bytes as a ShortObject</span>

my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># ‘a’ is a key of type String</span>

my_cache<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> key_hint<span class="token operator">=</span>CharObject<span class="token punctuation">)</span>
<span class="token comment"># Another key ‘a’ of type CharObject is created</span>

value <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>  <span class="token comment"># 1</span>

value <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> key_hint<span class="token operator">=</span>CharObject<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>  <span class="token comment"># 2</span>

<span class="token comment"># Now let us delete both keys at once</span>
my_cache<span class="token punctuation">.</span>remove_keys<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string">'a'</span><span class="token punctuation">,</span>  <span class="token comment"># a default type key</span>
    <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> CharObject<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># a key of type CharObject</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-8-扫描查询"><a href="#_5-8-扫描查询" class="header-anchor">#</a> 5.8.扫描查询</h3> <p>缓存对象的<code>scan()</code>方法可以用于获取缓存的所有对象。它返回一个生成<code>(key,value)</code>元组的生成器，可以按以下步骤遍历生成的键-值对：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client

client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>

my_cache <span class="token operator">=</span> client<span class="token punctuation">.</span>create_cache<span class="token punctuation">(</span><span class="token string">'myCache'</span><span class="token punctuation">)</span>

my_cache<span class="token punctuation">.</span>put_all<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'key_{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span> v <span class="token keyword">for</span> v <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># {</span>
<span class="token comment">#     'key_0': 0,</span>
<span class="token comment">#     'key_1': 1,</span>
<span class="token comment">#     'key_2': 2,</span>
<span class="token comment">#     ... 20 elements in total...</span>
<span class="token comment">#     'key_18': 18,</span>
<span class="token comment">#     'key_19': 19</span>
<span class="token comment"># }</span>

result <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> result<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token comment"># 'key_17' 17</span>
<span class="token comment"># 'key_10' 10</span>
<span class="token comment"># 'key_6' 6,</span>
<span class="token comment"># ... 20 elements in total...</span>
<span class="token comment"># 'key_16' 16</span>
<span class="token comment"># 'key_12' 12</span>


result <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># {</span>
<span class="token comment">#     'key_17': 17,</span>
<span class="token comment">#     'key_10': 10,</span>
<span class="token comment">#     'key_6': 6,</span>
<span class="token comment">#     ... 20 elements in total...</span>
<span class="token comment">#     'key_16': 16,</span>
<span class="token comment">#     'key_12': 12</span>
<span class="token comment"># }</span>

</code></pre></div><p>或者，可以一次性将生成器转换为字典：</p> <div class="language-python extra-class"><pre class="language-python"><code>result <span class="token operator">=</span> my_cache<span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># {</span>
<span class="token comment">#     'key_17': 17,</span>
<span class="token comment">#     'key_10': 10,</span>
<span class="token comment">#     'key_6': 6,</span>
<span class="token comment">#     ... 20 elements in total...</span>
<span class="token comment">#     'key_16': 16,</span>
<span class="token comment">#     'key_12': 12</span>
<span class="token comment"># }</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>注意：如果缓存中包含大量数据，则字典可能会消耗过多的内存。</p></div> <h3 id="_5-9-执行sql语句"><a href="#_5-9-执行sql语句" class="header-anchor">#</a> 5.9.执行SQL语句</h3> <p>Python瘦客户端支持所有Ignite支持的<a href="/doc/java/SQLReference.html">SQL命令</a>，该命令通过缓存对象的<code>sql()</code>方法执行，<code>sql()</code>方法会返回一个可以生产结果行的生成器：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span>
<span class="token comment"># contributor license agreements.  See the NOTICE file distributed with</span>
<span class="token comment"># this work for additional information regarding copyright ownership.</span>
<span class="token comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span>
<span class="token comment"># (the &quot;License&quot;); you may not use this file except in compliance with</span>
<span class="token comment"># the License.  You may obtain a copy of the License at</span>
<span class="token comment">#</span>
<span class="token comment">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">#</span>
<span class="token comment"># Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="token comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment"># See the License for the specific language governing permissions and</span>
<span class="token comment"># limitations under the License.</span>

<span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client

client <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>

CITY_CREATE_TABLE_QUERY <span class="token operator">=</span> <span class="token triple-quoted-string string">'''CREATE TABLE City (
    ID INT(11),
    Name CHAR(35),
    CountryCode CHAR(3),
    District CHAR(20),
    Population INT(11),
    PRIMARY KEY (ID, CountryCode)
) WITH &quot;affinityKey=CountryCode&quot;'''</span>

client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>CITY_CREATE_TABLE_QUERY<span class="token punctuation">)</span>

CITY_CREATE_INDEX <span class="token operator">=</span> <span class="token triple-quoted-string string">'''CREATE INDEX idx_country_code ON city (CountryCode)'''</span>

client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>CITY_CREATE_INDEX<span class="token punctuation">)</span>

CITY_INSERT_QUERY <span class="token operator">=</span> <span class="token triple-quoted-string string">'''INSERT INTO City(
    ID, Name, CountryCode, District, Population
) VALUES (?, ?, ?, ?, ?)'''</span>

CITY_DATA <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">3793</span><span class="token punctuation">,</span> <span class="token string">'New York'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">,</span> <span class="token string">'New York'</span><span class="token punctuation">,</span> <span class="token number">8008278</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">3794</span><span class="token punctuation">,</span> <span class="token string">'Los Angeles'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">,</span> <span class="token string">'California'</span><span class="token punctuation">,</span> <span class="token number">3694820</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">3795</span><span class="token punctuation">,</span> <span class="token string">'Chicago'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">,</span> <span class="token string">'Illinois'</span><span class="token punctuation">,</span> <span class="token number">2896016</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">3796</span><span class="token punctuation">,</span> <span class="token string">'Houston'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">,</span> <span class="token string">'Texas'</span><span class="token punctuation">,</span> <span class="token number">1953631</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">3797</span><span class="token punctuation">,</span> <span class="token string">'Philadelphia'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">,</span> <span class="token string">'Pennsylvania'</span><span class="token punctuation">,</span> <span class="token number">1517550</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">3798</span><span class="token punctuation">,</span> <span class="token string">'Phoenix'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">,</span> <span class="token string">'Arizona'</span><span class="token punctuation">,</span> <span class="token number">1321045</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">3799</span><span class="token punctuation">,</span> <span class="token string">'San Diego'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">,</span> <span class="token string">'California'</span><span class="token punctuation">,</span> <span class="token number">1223400</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">3800</span><span class="token punctuation">,</span> <span class="token string">'Dallas'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">,</span> <span class="token string">'Texas'</span><span class="token punctuation">,</span> <span class="token number">1188580</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token keyword">for</span> row <span class="token keyword">in</span> CITY_DATA<span class="token punctuation">:</span>
    client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>CITY_INSERT_QUERY<span class="token punctuation">,</span> query_args<span class="token operator">=</span>row<span class="token punctuation">)</span>

CITY_SELECT_QUERY <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM City&quot;</span>

cities <span class="token operator">=</span> client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>CITY_SELECT_QUERY<span class="token punctuation">)</span>
<span class="token keyword">for</span> city <span class="token keyword">in</span> cities<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token operator">*</span>city<span class="token punctuation">)</span>
</code></pre></div><p>注意如果将<code>include_field_names</code>参数配置为<code>True</code>，则该<code>sql()</code>方法将在第一个<code>yield</code>中生成一个列名列表。可以使用Python的<code>next</code>函数访问该字段名称：</p> <div class="language-python extra-class"><pre class="language-python"><code>field_names <span class="token operator">=</span> client<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>CITY_SELECT_QUERY<span class="token punctuation">,</span> include_field_names<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__next__<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>field_names<span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-10-安全"><a href="#_5-10-安全" class="header-anchor">#</a> 5.10.安全</h3> <h4 id="_5-10-1-ssl-tls"><a href="#_5-10-1-ssl-tls" class="header-anchor">#</a> 5.10.1.SSL/TLS</h4> <p>要在瘦客户端和集群之间使用加密的通信，必须在集群配置和客户端配置中都启用SSL/TLS。有关集群配置的说明，请参见<a href="/doc/java/Security.html#_2-3-瘦客户端和jdbc-odbc的ssl-tls">为瘦客户端启用SSL/TLS</a>章节的介绍。</p> <p>下面是在瘦客户端中启用SSL的示例配置：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client
<span class="token keyword">import</span> ssl

client <span class="token operator">=</span> Client<span class="token punctuation">(</span>
                use_ssl<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                ssl_cert_reqs<span class="token operator">=</span>ssl<span class="token punctuation">.</span>CERT_REQUIRED<span class="token punctuation">,</span>
                ssl_keyfile<span class="token operator">=</span><span class="token string">'/path/to/key/file'</span><span class="token punctuation">,</span>
                ssl_certfile<span class="token operator">=</span><span class="token string">'/path/to/client/cert'</span><span class="token punctuation">,</span>
                ssl_ca_certfile<span class="token operator">=</span><span class="token string">'/path/to/trusted/cert/or/chain'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>
</code></pre></div><p>支持的参数：</p> <table><thead><tr><th>参数</th> <th>描述</th></tr></thead> <tbody><tr><td><code>use_ssl</code></td> <td>在客户端启用SSL/TLS可以配置为<code>True</code></td></tr> <tr><td><code>ssl_keyfile</code></td> <td>密钥库文件路径</td></tr> <tr><td><code>ssl_certfile</code></td> <td>包含SSL证书的文件路径</td></tr> <tr><td><code>ssl_ca_certfile</code></td> <td>受信证书文件路径</td></tr> <tr><td><code>ssl_cert_reqs</code></td> <td><code>ssl.CERT_NONE</code>：远程证书被忽略（默认）；<br><code>ssl.CERT_OPTIONAL</code>：如果提供，将验证远程证书；<br><code>ssl.CERT_REQUIRED</code>：需要有效的远程证书</td></tr> <tr><td><code>ssl_version</code></td> <td></td></tr> <tr><td><code>ssl_ciphers</code></td> <td></td></tr></tbody></table> <h4 id="_5-10-2-认证"><a href="#_5-10-2-认证" class="header-anchor">#</a> 5.10.2.认证</h4> <p>配置<a href="/doc/java/Security.html#_1-认证">集群端的认证</a>后，需要在客户端的配置中提供有效的用户名和密码：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span>
<span class="token comment"># contributor license agreements.  See the NOTICE file distributed with</span>
<span class="token comment"># this work for additional information regarding copyright ownership.</span>
<span class="token comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span>
<span class="token comment"># (the &quot;License&quot;); you may not use this file except in compliance with</span>
<span class="token comment"># the License.  You may obtain a copy of the License at</span>
<span class="token comment">#</span>
<span class="token comment">#      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">#</span>
<span class="token comment"># Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="token comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment"># See the License for the specific language governing permissions and</span>
<span class="token comment"># limitations under the License.</span>

<span class="token keyword">from</span> pyignite <span class="token keyword">import</span> Client
<span class="token keyword">import</span> ssl


client <span class="token operator">=</span> Client<span class="token punctuation">(</span>
                ssl_cert_reqs<span class="token operator">=</span>ssl<span class="token punctuation">.</span>CERT_REQUIRED<span class="token punctuation">,</span>
                ssl_keyfile<span class="token operator">=</span><span class="token string">'/path/to/key/file'</span><span class="token punctuation">,</span>
                ssl_certfile<span class="token operator">=</span><span class="token string">'/path/to/client/cert'</span><span class="token punctuation">,</span>
                ssl_ca_certfile<span class="token operator">=</span><span class="token string">'/path/to/trusted/cert/or/chain'</span><span class="token punctuation">,</span>
                username<span class="token operator">=</span><span class="token string">'ignite'</span><span class="token punctuation">,</span>
                password<span class="token operator">=</span><span class="token string">'ignite'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span>
</code></pre></div><p>注意提供凭据会自动打开SSL，这是因为通过不安全的通道发送凭据不是最佳实践，因此强烈建议不要这样做。如果仍要使用认证而不保护连接，只需在创建客户端对象时禁用SSL：</p> <div class="language-python extra-class"><pre class="language-python"><code>client <span class="token operator">=</span> Client<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'ignite'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">'ignite'</span><span class="token punctuation">,</span> use_ssl<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_6-php瘦客户端"><a href="#_6-php瘦客户端" class="header-anchor">#</a> 6.PHP瘦客户端</h2> <h3 id="_6-1-环境要求"><a href="#_6-1-环境要求" class="header-anchor">#</a> 6.1.环境要求</h3> <ul><li><a href="http://php.net/manual/en/install.php" target="_self" rel="noopener noreferrer">PHP版本7.2及以上</a>以及<a href="https://getcomposer.org/download" target="_self" rel="noopener noreferrer">Composer依赖管理器</a>；</li> <li><code>php-xml</code>模块；</li> <li><a href="http://php.net/manual/en/mbstring.installation.php" target="_self" rel="noopener noreferrer">PHP Multibyte String扩展</a>，根据PHP的配置，可能需要对其进行额外的安装/配置。</li></ul> <h3 id="_6-2-安装"><a href="#_6-2-安装" class="header-anchor">#</a> 6.2.安装</h3> <p>瘦客户端可通过zip压缩包进行安装：</p> <ul><li>下载Ignite的<a href="https://ignite.apache.org/download.cgi#binaries" target="_self" rel="noopener noreferrer">二进制包</a>；</li> <li>解压该压缩包然后转到<code>{IGNITE_HOME}/platforms/php</code>文件夹；</li> <li>使用如下命令进行安装：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>composer <span class="token function">install</span> --no-dev
</code></pre></div><p>要在应用中使用该客户端，需要在源代码中引入由<code>Composer</code>生成的<code>vendor/autoload.php</code>文件：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">require_once</span> <span class="token double-quoted-string string">&quot;&lt;php_client_root_dir&gt;/vendor/autoload.php&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-3-创建客户端实例"><a href="#_6-3-创建客户端实例" class="header-anchor">#</a> 6.3.创建客户端实例</h3> <p>PHP瘦客户端的所有操作都是通过<code>Client</code>实例执行的，可以根据需要创建任意数量的<code>Client</code>实例，他们之间相互独立：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>

<span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-4-接入集群"><a href="#_6-4-接入集群" class="header-anchor">#</a> 6.4.接入集群</h3> <p>要接入集群，需使用必要的连接参数定义<code>ClientConfiguration</code>对象，然后使用<code>Client.connect(…​)</code>方法。</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>ClientConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Apache<span class="token punctuation">\</span>Ignite<span class="token punctuation">\</span>Exception<span class="token punctuation">\</span>ClientException</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">connectClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token variable">$clientConfiguration</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span>
            <span class="token single-quoted-string string">'127.0.0.1:10800'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'127.0.0.1:10801'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'127.0.0.1:10802'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Connect to Ignite node</span>
        <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token variable">$clientConfiguration</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ClientException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">connectClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>ClientConfiguration</code>的构造函数接收节点端点的列表。必须至少指定一个端点，如果指定了多个，瘦客户端将在端点之间<a href="#_1-2-1-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB">故障转移</a>。</p> <p>如果客户端无法接入集群， 则在尝试执行任何远程操作时会抛出<code>NoConnectionException</code>异常。</p> <p>如果客户端在操作之前/操作期间意外断开连接，则会抛出<code>OperationStatusUnknownException</code>异常，这时不知道该操作是否已在集群中实际执行。当应用调用下一个操作时，客户端将尝试重连配置中指定的下一个节点。</p> <p>调用<code>disconnect()</code>方法可以关闭连接。</p> <h3 id="_6-5-使用键-值api"><a href="#_6-5-使用键-值api" class="header-anchor">#</a> 6.5.使用键-值API</h3> <h4 id="_6-5-1-获取-创建缓存实例"><a href="#_6-5-1-获取-创建缓存实例" class="header-anchor">#</a> 6.5.1.获取/创建缓存实例</h4> <p>客户端实例提供3个方法用于获取缓存的实例：</p> <ul><li><code>getCache(name)</code>：通过名字获取一个已有的缓存，该方法不会验证缓存在集群中是否存在，而是尝试在缓存上执行任意操作时会抛出异常；</li> <li><code>getOrCreateCache(name, config)</code>：通过名字获取一个已有的缓存，或者使用提供的配置创建一个新的缓存；</li> <li><code>createCache(name, config)</code>：通过提供的名字和参数创建一个新的缓存。</li></ul> <p>下面是创建缓存的方法：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$cacheCfg</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$cacheCfg</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setCacheMode</span><span class="token punctuation">(</span>CacheConfiguration<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">CACHE_MODE_REPLICATED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$cacheCfg</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setWriteSynchronizationMode</span><span class="token punctuation">(</span>CacheConfiguration<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">WRITE_SYNC_MODE_FULL_SYNC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'References'</span><span class="token punctuation">,</span> <span class="token variable">$cacheCfg</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-5-2-基本键-值操作"><a href="#_6-5-2-基本键-值操作" class="header-anchor">#</a> 6.5.2.基本键-值操作</h4> <p>下面的代码片段演示了如何通过缓存实例进行基本的键-值操作：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$val</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$keys</span> <span class="token operator">=</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$keys</span> <span class="token keyword">as</span> <span class="token variable">$number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$val</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">,</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$number</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$replace</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">replaceIfEquals</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'2'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$replace</span> <span class="token operator">?</span> <span class="token single-quoted-string string">'true'</span> <span class="token punctuation">:</span> <span class="token single-quoted-string string">'false'</span><span class="token punctuation">;</span> <span class="token comment">//false</span>
<span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>

<span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$value</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
<span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>

<span class="token variable">$replace</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">replaceIfEquals</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$replace</span> <span class="token operator">?</span> <span class="token single-quoted-string string">'true'</span> <span class="token punctuation">:</span> <span class="token single-quoted-string string">'false'</span><span class="token punctuation">;</span> <span class="token comment">//true</span>
<span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>

<span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$value</span><span class="token punctuation">;</span> <span class="token comment">//3</span>
<span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>

<span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'101'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">removeKeys</span><span class="token punctuation">(</span><span class="token variable">$keys</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$sizeIsOne</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$sizeIsOne</span> <span class="token operator">?</span> <span class="token single-quoted-string string">'true'</span> <span class="token punctuation">:</span> <span class="token single-quoted-string string">'false'</span><span class="token punctuation">;</span> <span class="token comment">//true</span>
<span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>

<span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$value</span><span class="token punctuation">;</span> <span class="token comment">//101</span>
<span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>

<span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$sizeIsZero</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$sizeIsZero</span> <span class="token operator">?</span> <span class="token single-quoted-string string">'true'</span> <span class="token punctuation">:</span> <span class="token single-quoted-string string">'false'</span><span class="token punctuation">;</span> <span class="token comment">//true</span>
<span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-6-扫描查询"><a href="#_6-6-扫描查询" class="header-anchor">#</a> 6.6.扫描查询</h3> <p><code>Cache.query(ScanQuery)</code>方法可用于从缓存中获取所有的条目，它会使用标准的PHP迭代器接口返回一个游标对象，使用此游标可以以延迟加载模式一个一个在结果集中迭代，另外，游标也有方法可以一次性获得全部结果集。</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$cache</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'personCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John Smith'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John Johnson'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$qry</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScanQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ScanQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-7-执行sql语句"><a href="#_6-7-执行sql语句" class="header-anchor">#</a> 6.7.执行SQL语句</h3> <p>PHP瘦客户端支持所有Ignite支持的<a href="/doc/java/SQLReference.html">SQL命令</a>，SQL语句是通过缓存对象的<code>query(SqlFieldQuery)</code>方法执行的。该方法接受一个表示SQL语句的<code>SqlFieldsQuery</code>，<code>query()</code>方法会使用标准的PHP迭代器接口返回一个游标对象，使用此游标可以以延迟加载模式一个一个在结果集中迭代，另外，游标也有方法可以一次性获得全部结果集。</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$create_table</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span>
    <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'CREATE TABLE IF NOT EXISTS Person (id INT PRIMARY KEY, name VARCHAR) WITH &quot;VALUE_TYPE=%s&quot;'</span><span class="token punctuation">,</span> Person<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$create_table</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setSchema</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUBLIC'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$create_table</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$key</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token variable">$val</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Person 1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$insert</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'INSERT INTO Person(id, name) VALUES(?, ?)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$insert</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">,</span> <span class="token variable">$val</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$insert</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setSchema</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUBLIC'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$insert</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$select</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'SELECT name FROM Person WHERE id = ?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$select</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$select</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setSchema</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'PUBLIC'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$cursor</span> <span class="token operator">=</span> <span class="token variable">$cache</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$select</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Get the results; the `getAll()` methods closes the cursor; you do not have to call cursor.close();</span>
<span class="token variable">$results</span> <span class="token operator">=</span> <span class="token variable">$cursor</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$results</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token single-quoted-string string">'name = '</span> <span class="token punctuation">.</span> <span class="token variable">$results</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token double-quoted-string string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-8-安全"><a href="#_6-8-安全" class="header-anchor">#</a> 6.8.安全</h3> <h4 id="_6-8-1-ssl-tls"><a href="#_6-8-1-ssl-tls" class="header-anchor">#</a> 6.8.1.SSL/TLS</h4> <p>要在瘦客户端和集群之间使用加密通信，需要在双方的配置中开启它，具体请参见集群配置中<a href="/doc/java/Security.html#_2-3-瘦客户端和jdbc-odbc的ssl-tls">为瘦客户端启用SSL/TLS</a>章节的介绍。</p> <p>下面是在瘦客户端中开启SSL的示例配置：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$tlsOptions</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'local_cert'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'/path/to/client/cert'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'cafile'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'/path/to/ca/file'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'local_pk'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'/path/to/key/file'</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token variable">$config</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'localhost:10800'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$config</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setTLSOptions</span><span class="token punctuation">(</span><span class="token variable">$tlsOptions</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-8-2-认证"><a href="#_6-8-2-认证" class="header-anchor">#</a> 6.8.2.认证</h4> <p>配置<a href="/doc/java/Security.html#_1-认证">集群端的认证</a>后，需要在瘦客户端的配置中提供有效的用户名和密码：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$config</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConfiguration</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'localhost:10800'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$config</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'ignite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$config</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'ignite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//$config-&gt;setTLSOptions($tlsOptions);</span>

<span class="token variable">$client</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_7-node-js瘦客户端"><a href="#_7-node-js瘦客户端" class="header-anchor">#</a> 7.Node.js瘦客户端</h2> <h3 id="_7-1-环境要求"><a href="#_7-1-环境要求" class="header-anchor">#</a> 7.1.环境要求</h3> <ul><li>Node.js 版本8.0及以上，可以下载Node.js对应平台的<a href="https://nodejs.org/en/download/" target="_self" rel="noopener noreferrer">二进制包</a>，或者通过<a href="https://nodejs.org/en/download/package-manager" target="_self" rel="noopener noreferrer">包管理器</a>安装Node.js。</li></ul> <p><code>node</code>和<code>npm</code>安装之后，就可以进行下面的安装了。</p> <h3 id="_7-2-安装"><a href="#_7-2-安装" class="header-anchor">#</a> 7.2.安装</h3> <p>Node.js瘦客户端以<code>npm</code>软件包和zip压缩包的形式提供，在自己的环境中可以使用任意方法安装该客户端。</p> <h4 id="_7-2-1-使用npm"><a href="#_7-2-1-使用npm" class="header-anchor">#</a> 7.2.1.使用NPM</h4> <p>使用下面的命令可以从NPM仓库中安装该客户端：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> -g apache-ignite-client
</code></pre></div><h4 id="_7-2-2-使用zip压缩包"><a href="#_7-2-2-使用zip压缩包" class="header-anchor">#</a> 7.2.2.使用ZIP压缩包</h4> <p>该瘦客户端也可以通过从Ignite网站上下载的压缩包进行安装：</p> <ul><li>下载Ignite的<a href="https://ignite.apache.org/download.cgi#binaries" target="_self" rel="noopener noreferrer">二进制包</a>；</li> <li>解压该压缩包，然后转到<code>{IGNITE_HOME}/platforms/nodejs</code>文件夹；</li> <li>执行下面的命令完成安装：</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">link</span> apache-ignite-client
</code></pre></div><h3 id="_7-3-创建客户端实例"><a href="#_7-3-创建客户端实例" class="header-anchor">#</a> 7.3.创建客户端实例</h3> <p><code>IgniteClient</code>类提供了瘦客户端的API，可以通过如下方式获取该客户端的实例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span>onStateChanged<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">onStateChanged</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> IgniteClient<span class="token punctuation">.</span><span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">CONNECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Client is started'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> IgniteClient<span class="token punctuation">.</span><span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">DISCONNECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Client is stopped'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>构造器会接收一个表示回调函数的可选参数，每次连接状态发生变更时，都会调用该函数。</p> <p>可以根据需要创建任意数量的<code>IgniteClient</code>实例，他们之间相互独立。</p> <h3 id="_7-4-接入集群"><a href="#_7-4-接入集群" class="header-anchor">#</a> 7.4.接入集群</h3> <p>使用<code>IgniteClient.connect()</code>方法，可以将客户端接入集群。该方法会接收一个表示连接参数的<code>IgniteClientConfiguration</code>类对象，该连接参数必须包含一组用于<a href="#_1-2-1-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB">故障转移</a>目的的节点列表（<code>host:port</code>格式）。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">connectClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span>onStateChanged<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> igniteClientConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span>
            <span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">,</span> <span class="token string">'127.0.0.1:10801'</span><span class="token punctuation">,</span> <span class="token string">'127.0.0.1:10802'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Connect to Ignite node</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>igniteClientConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">onStateChanged</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> IgniteClient<span class="token punctuation">.</span><span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">CONNECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Client is started'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> IgniteClient<span class="token punctuation">.</span><span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">CONNECTING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Client is connecting'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> IgniteClient<span class="token punctuation">.</span><span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">DISCONNECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Client is stopped'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">connectClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>该客户端有3个连接状态：<code>CONNECTING</code>、<code>CONNECTED</code>、<code>DISCONNECTED</code>。可以在客户端配置对象上指定一个回调函数，每次连接状态发生变更时都会调用该函数。</p> <p>只有在<code>CONNECTED</code>状态时才可以与集群进行交互。如果客户端断开了连接，它会自动切换到<code>CONNECTING</code>状态，然后尝试通过<a href="#_1-2-1-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB">故障转移机制</a>进行重连。如果无法连接列表中提供的所有端点，客户端会切换到<code>DISCONNECTED</code>状态。</p> <p>可以调用<code>disconnect()</code>方法关闭连接，他会将客户端切换至<code>DISCONNECTED</code>状态。</p> <h3 id="_7-5-分区感知"><a href="#_7-5-分区感知" class="header-anchor">#</a> 7.5.分区感知</h3> <p>分区感知使得瘦客户端可以将请求直接发给待处理数据所在的节点。</p> <p>在没有分区感知时，通过瘦客户端接入集群的应用，实际是通过某个作为代理的服务端节点执行所有查询和操作，然后将这些操作重新路由到数据所在的节点，这会导致瓶颈，可能会限制应用的线性扩展能力。</p> <p><img src="https://ignite.apache.org/docs/2.9.0/images/partitionawareness01.png" alt=""></p> <p>注意查询必须通过代理服务端节点，然后路由到正确的节点。</p> <p>有了分区感知之后，瘦客户端可以将查询和操作直接路由到持有待处理数据的主节点，这消除了瓶颈，使应用更易于扩展。</p> <p><img src="https://ignite.apache.org/docs/2.9.0/images/partitionawareness02.png" alt=""></p> <div class="custom-block danger"><p class="custom-block-title">警告</p> <p>注意目前对于非Java客户端需要在连接属性中提供所有服务端节点的地址。这意味着如果新的服务端节点加入集群，则应将新服务端的地址添加到连接属性中，然后重新连接。否则，瘦客户端将无法向该服务端发送直接请求，正式发布之后将解决此限制。</p></div> <p>要启用分区感知，需要将<code>partitionAwareness</code>参数配置为<code>true</code>，如下所示：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">ENDPOINTS</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">,</span> <span class="token string">'127.0.0.1:10801'</span><span class="token punctuation">,</span> <span class="token string">'127.0.0.1:10802'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token constant">ENDPOINTS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> useTls <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> partitionAwareness <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

cfg<span class="token punctuation">.</span><span class="token function">setConnectionOptions</span><span class="token punctuation">(</span>useTls<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> partitionAwareness<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-6-启用调试"><a href="#_7-6-启用调试" class="header-anchor">#</a> 7.6.启用调试</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
igniteClient<span class="token punctuation">.</span><span class="token function">setDebug</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-7-启用键-值api"><a href="#_7-7-启用键-值api" class="header-anchor">#</a> 7.7.启用键-值API</h3> <h4 id="_7-7-1-获取缓存实例"><a href="#_7-7-1-获取缓存实例" class="header-anchor">#</a> 7.7.1.获取缓存实例</h4> <p>键-值API通过缓存的实例提供，瘦客户端提供了若干方法用于获取缓存的实例：</p> <ul><li>通过名字获取缓存；</li> <li>通过指定的名字以及可选的缓存配置创建缓存；</li> <li>获取或创建缓存，销毁缓存等。</li></ul> <p>可以按需获取任意数量的缓存实例（相同的缓存和不同的缓存都可以），都可以并行地处理。</p> <p>下面的示例显示如何通过名字获取缓存，之后又销毁它：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getOrCreateCacheByName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Get or create cache by name</span>
        <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Perform cache key-value operations</span>
        <span class="token comment">// ...</span>

        <span class="token comment">// Destroy cache</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">destroyCache</span><span class="token punctuation">(</span><span class="token string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        igniteClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">getOrCreateCacheByName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_7-7-2-缓存配置"><a href="#_7-7-2-缓存配置" class="header-anchor">#</a> 7.7.2.缓存配置</h4> <p>创建一个新缓存时，可以提供一个缓存配置的实例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>
<span class="token keyword">const</span> CacheConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>CacheConfiguration<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createCacheByConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Create cache by name and configuration</span>
        <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">createCache</span><span class="token punctuation">(</span>
            <span class="token string">'myCache'</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSqlSchema</span><span class="token punctuation">(</span><span class="token string">'PUBLIC'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        igniteClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">createCacheByConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_7-7-3-类型映射配置"><a href="#_7-7-3-类型映射配置" class="header-anchor">#</a> 7.7.3.类型映射配置</h4> <p>Node.js类型并不总是唯一地映射到Java类型，有时可能需要在缓存配置中显式指定键和值类型。在执行读/写缓存操作时，客户端将使用这些类型在Java/JavaScript数据类型之间转换键和值对象。</p> <p>如果未指定类型，则客户端将使用<a href="#_7-7-4-2-%E9%BB%98%E8%AE%A4%E6%98%A0%E5%B0%84">默认的映射</a>，这是类型映射的示例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Set cache key/value types</span>
cache<span class="token punctuation">.</span><span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setValueType</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MapObjectType</span><span class="token punctuation">(</span>
        MapObjectType<span class="token punctuation">.</span><span class="token constant">MAP_SUBTYPE</span><span class="token punctuation">.</span><span class="token constant">LINKED_HASH_MAP</span><span class="token punctuation">,</span>
        ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">SHORT</span><span class="token punctuation">,</span>
        ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">BYTE_ARRAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_7-7-4-数据类型"><a href="#_7-7-4-数据类型" class="header-anchor">#</a> 7.7.4.数据类型</h4> <p>客户端以2种方式支持Ignite类型和JavaScript类型之间的映射：</p> <ul><li>显式映射；</li> <li>默认映射。</li></ul> <h5 id="_7-7-4-1-显式映射"><a href="#_7-7-4-1-显式映射" class="header-anchor">#</a> 7.7.4.1.显式映射</h5> <p>每当应用通过客户端的API进行字段的读写时，就会发生映射。这里的字段是存储在Ignite中的任何数据：Ignite数据条目的整个键或值、数组或集合的元素、复杂对象的字段等。</p> <p>通过使用客户端的API方法，应用可以为特定字段显式指定Ignite类型。客户端在读/写操作期间使用此信息将字段从JavaScript转换为Java类型（或反之）。对于读操作，该字段将转换为JavaScript类型，而在写入时则会验证相应的JavaScript类型。</p> <p>如果应用未为字段明确指定Ignite类型，则客户端将在字段读/写操作期间使用默认映射。</p> <h5 id="_7-7-4-2-默认映射"><a href="#_7-7-4-2-默认映射" class="header-anchor">#</a> 7.7.4.2.默认映射</h5> <p>默认映射的说明在<a href="https://www.gridgain.com/sdk/nodejs-thin-client/latest/ObjectType.html" target="_self" rel="noopener noreferrer">这里</a>。</p> <h4 id="_7-7-5-基本键-值操作"><a href="#_7-7-5-基本键-值操作" class="header-anchor">#</a> 7.7.5.基本键-值操作</h4> <p><code>CacheClient</code>类提供了通过键-值操作处理缓存条目的方法，<code>put</code>、<code>get</code>、<code>getAll</code>、<code>putAll</code>等，如下所示：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apache-ignite-client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>
<span class="token keyword">const</span> ObjectType <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>ObjectType<span class="token punctuation">;</span>
<span class="token keyword">const</span> CacheEntry <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>CacheEntry<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">performCacheKeyValueOperations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1:10800'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Put and get value</span>
        <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Put and get multiple values using putAll()/getAll() methods</span>
        <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'value2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'value3'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> values <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>values<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token parameter">val</span> <span class="token operator">=&gt;</span> val<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Removes all entries from the cache</span>
        <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        igniteClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">performCacheKeyValueOperations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-8-扫描查询"><a href="#_7-8-扫描查询" class="header-anchor">#</a> 7.8.扫描查询</h3> <p><code>IgniteClient.query(scanquery)</code>方法可用于获取缓存的所有数据，它会返回一个游标对象，可以以延迟加载的方式迭代结果集，也可以一次性获取所有的结果集。</p> <p>要执行扫描查询，需要创建一个<code>ScanQuery</code>对象，然后调用<code>IgniteClient.query(scanquery)</code>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">'myCache'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Put multiple values using putAll()</span>
<span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'value1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'value2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'value3'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create and configure scan query</span>
<span class="token keyword">const</span> scanQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScanQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">setPageSize</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Obtain scan query cursor</span>
<span class="token keyword">const</span> cursor <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>scanQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Get all cache entries returned by the scan query</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> cacheEntry <span class="token keyword">of</span> <span class="token keyword">await</span> cursor<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cacheEntry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-9-执行sql查询"><a href="#_7-9-执行sql查询" class="header-anchor">#</a> 7.9.执行SQL查询</h3> <p>Node.js瘦客户端支持Ignite支持的所有<a href="/doc/java/SQLReference.html">SQL命令</a>，该命令通过缓存对象的<code>query(SqlFieldQuery)</code>方法执行，该方法会接收一个表示SQL语句的<code>SqlFieldsQuery</code>实例，然后返回一个<code>SqlFieldsCursor</code>类的实例，通过该游标可以迭代结果集或者一次性获得所有的结果集。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Cache configuration required for sql query execution</span>
<span class="token keyword">const</span> cacheConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">setQueryEntities</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">QueryEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setValueTypeName</span><span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setFields</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                <span class="token keyword">new</span> <span class="token class-name">QueryField</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'java.lang.String'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">QueryField</span><span class="token punctuation">(</span><span class="token string">'salary'</span><span class="token punctuation">,</span> <span class="token string">'java.lang.Double'</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">'sqlQueryPersonCache'</span><span class="token punctuation">,</span> cacheConfiguration<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">setValueType</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ComplexObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'name'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'salary'</span> <span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'Person'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Put multiple values using putAll()</span>
<span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'name'</span> <span class="token operator">:</span> <span class="token string">'John Doe'</span><span class="token punctuation">,</span> <span class="token string">'salary'</span> <span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'name'</span> <span class="token operator">:</span> <span class="token string">'Jane Roe'</span><span class="token punctuation">,</span> <span class="token string">'salary'</span> <span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CacheEntry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'name'</span> <span class="token operator">:</span> <span class="token string">'Mary Major'</span><span class="token punctuation">,</span> <span class="token string">'salary'</span> <span class="token operator">:</span> <span class="token number">1500</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create and configure sql query</span>
<span class="token keyword">const</span> sqlQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlQuery</span><span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> <span class="token string">'salary &gt; ? and salary &lt;= ?'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">900</span><span class="token punctuation">,</span> <span class="token number">1600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Obtain sql query cursor</span>
<span class="token keyword">const</span> cursor <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sqlQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Get all cache entries returned by the sql query</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> cacheEntry <span class="token keyword">of</span> <span class="token keyword">await</span> cursor<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cacheEntry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-10-安全"><a href="#_7-10-安全" class="header-anchor">#</a> 7.10.安全</h3> <h4 id="_7-10-1-ssl-tls"><a href="#_7-10-1-ssl-tls" class="header-anchor">#</a> 7.10.1.SSL/TLS</h4> <p>要在瘦客户端和集群之间使用加密通信，需要在双方的配置中开启它，具体请参见集群配置中<a href="/doc/java/Security.html#_2-3-瘦客户端和jdbc-odbc的ssl-tls">为瘦客户端启用SSL/TLS</a>章节的介绍。</p> <p>下面是在瘦客户端中开启SSL的示例配置：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> tls <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">FS</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;apache-ignite-client&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ObjectType <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>ObjectType<span class="token punctuation">;</span>
<span class="token keyword">const</span> IgniteClientConfiguration <span class="token operator">=</span> IgniteClient<span class="token punctuation">.</span>IgniteClientConfiguration<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">ENDPOINT</span> <span class="token operator">=</span> <span class="token string">'localhost:10800'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">USER_NAME</span> <span class="token operator">=</span> <span class="token string">'ignite'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">PASSWORD</span> <span class="token operator">=</span> <span class="token string">'ignite'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">TLS_KEY_FILE_NAME</span> <span class="token operator">=</span> __dirname <span class="token operator">+</span> <span class="token string">'/certs/client.key'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">TLS_CERT_FILE_NAME</span> <span class="token operator">=</span> __dirname <span class="token operator">+</span> <span class="token string">'/certs/client.crt'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">TLS_CA_FILE_NAME</span> <span class="token operator">=</span> __dirname <span class="token operator">+</span> <span class="token string">'/certs/ca.crt'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">CACHE_NAME</span> <span class="token operator">=</span> <span class="token string">'AuthTlsExample_cache'</span><span class="token punctuation">;</span>

<span class="token comment">// This example demonstrates how to establish a secure connection to an Ignite node and use username/password authentication,</span>
<span class="token comment">// as well as basic Key-Value Queries operations for primitive types:</span>
<span class="token comment">// - connects to a node using TLS and providing username/password</span>
<span class="token comment">// - creates a cache, if it doesn't exist</span>
<span class="token comment">//   - specifies key and value type of the cache</span>
<span class="token comment">// - put data of primitive types into the cache</span>
<span class="token comment">// - get data from the cache</span>
<span class="token comment">// - destroys the cache</span>
<span class="token keyword">class</span> <span class="token class-name">AuthTlsExample</span> <span class="token punctuation">{</span>

    <span class="token keyword">async</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> igniteClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClient</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onStateChanged</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        igniteClient<span class="token punctuation">.</span><span class="token function">setDebug</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> connectionOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'key'</span> <span class="token operator">:</span> <span class="token constant">FS</span><span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token constant">TLS_KEY_FILE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'cert'</span> <span class="token operator">:</span> <span class="token constant">FS</span><span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token constant">TLS_CERT_FILE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'ca'</span> <span class="token operator">:</span> <span class="token constant">FS</span><span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token constant">TLS_CA_FILE_NAME</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span><span class="token constant">ENDPOINT</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token constant">USER_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token constant">PASSWORD</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setConnectionOptions</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> connectionOptions<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setKeyType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
            <span class="token function">setValueType</span><span class="token punctuation">(</span>ObjectType<span class="token punctuation">.</span><span class="token constant">PRIMITIVE_TYPE</span><span class="token punctuation">.</span><span class="token constant">SHORT_ARRAY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">putGetData</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">await</span> igniteClient<span class="token punctuation">.</span><span class="token function">destroyCache</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ERROR: '</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            igniteClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">putGetData</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> values <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateValue</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Put multiple values in parallel</span>
        <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>keys<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> values<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>keys<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> values<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Cache values put successfully'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Get values sequentially</span>
        <span class="token keyword">let</span> value<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            value <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compareValues</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Unexpected cache value!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Cache values get successfully'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">compareValues</span><span class="token punctuation">(</span><span class="token parameter">array1<span class="token punctuation">,</span> array2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> array1<span class="token punctuation">.</span>length <span class="token operator">===</span> array2<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span>
            array1<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value1<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> value1 <span class="token operator">===</span> array2<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">generateValue</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> length <span class="token operator">=</span> key <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> key <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">onStateChanged</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> IgniteClient<span class="token punctuation">.</span><span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">CONNECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Client is started'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> IgniteClient<span class="token punctuation">.</span><span class="token constant">STATE</span><span class="token punctuation">.</span><span class="token constant">DISCONNECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Client is stopped'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> authTlsExample <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AuthTlsExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authTlsExample<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_7-10-2-认证"><a href="#_7-10-2-认证" class="header-anchor">#</a> 7.10.2.认证</h4> <p>配置<a href="/doc/java/Security.html#_1-认证">集群端的认证</a>后，需要在瘦客户端的配置中提供有效的用户名和密码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">ENDPOINT</span> <span class="token operator">=</span> <span class="token string">'localhost:10800'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">USER_NAME</span> <span class="token operator">=</span> <span class="token string">'ignite'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">PASSWORD</span> <span class="token operator">=</span> <span class="token string">'ignite'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> igniteClientConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteClientConfiguration</span><span class="token punctuation">(</span>
    <span class="token constant">ENDPOINT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token constant">USER_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token constant">PASSWORD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_8-二进制客户端协议"><a href="#_8-二进制客户端协议" class="header-anchor">#</a> 8.二进制客户端协议</h2> <h3 id="_8-1-二进制客户端协议"><a href="#_8-1-二进制客户端协议" class="header-anchor">#</a> 8.1.二进制客户端协议</h3> <h4 id="_8-1-1-概述"><a href="#_8-1-1-概述" class="header-anchor">#</a> 8.1.1.概述</h4> <p>Ignite的二进制客户端协议使得应用不用启动一个全功能的节点，就可以与已有的集群进行通信。应用使用原始的TCP套接字，就可以接入集群。连接建立之后，就可以使用定义好的格式执行缓存操作。</p> <p>与集群通信，客户端必须遵守下述的数据格式和通信细节。</p> <h4 id="_8-1-2-数据格式"><a href="#_8-1-2-数据格式" class="header-anchor">#</a> 8.1.2.数据格式</h4> <p><strong>字节序</strong></p> <p>Ignite的二进制客户端协议使用小端字节顺序。</p> <p><strong>数据对象</strong></p> <p>业务数据，比如缓存的键和值，是以Ignite的<a href="/doc/java/DataModeling.html#_4-二进制编组器">二进制对象</a>表示的，一个数据对象可以是标准类型（预定义），也可以是复杂对象，具体可以看<a href="#_2-2-%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F">数据格式</a>的相关章节。</p> <h4 id="_8-1-3-消息格式"><a href="#_8-1-3-消息格式" class="header-anchor">#</a> 8.1.3.消息格式</h4> <p>所有消息的请求和响应，包括握手，都以<code>int</code>类型消息长度开始（不包括开始的4个字节），后面是消息体。</p> <p><strong>握手</strong></p> <p>二进制客户端协议需要一个连接握手，来确保客户端和服务端版本的兼容性。下表会显示请求和响应握手消息的结构，下面的示例章节中还会显示如何发送和接收握手请求及其对应的响应。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>int</code></td> <td>握手有效消息长度</td></tr> <tr><td><code>byte</code></td> <td>握手码，值为1</td></tr> <tr><td><code>short</code></td> <td>主版本号</td></tr> <tr><td><code>short</code></td> <td>次版本号</td></tr> <tr><td><code>short</code></td> <td>修订版本号</td></tr> <tr><td><code>byte</code></td> <td>客户端码，值为2</td></tr> <tr><td><code>string</code></td> <td>用户名</td></tr> <tr><td><code>string</code></td> <td>密码</td></tr></tbody></table> <table><thead><tr><th>响应类型（成功）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>int</code></td> <td>成功消息长度，1</td></tr> <tr><td><code>byte</code></td> <td>成功标志，1</td></tr></tbody></table> <table><thead><tr><th>响应类型（失败）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>int</code></td> <td>错误消息长度</td></tr> <tr><td><code>byte</code></td> <td>成功标志，0</td></tr> <tr><td><code>short</code></td> <td>服务端主版本号</td></tr> <tr><td><code>short</code></td> <td>服务端次版本号</td></tr> <tr><td><code>short</code></td> <td>服务端修订版本号</td></tr> <tr><td><code>string</code></td> <td>错误消息</td></tr></tbody></table> <p><strong>标准消息头</strong></p> <p>客户端操作消息由消息头和与操作有关的数据的消息体组成，每个操作都有自己的数据请求和响应格式，以及一个通用头。
下面的表格和示例显示了客户端操作消息头的请求和响应结构。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>int</code></td> <td>有效信息长度</td></tr> <tr><td><code>short</code></td> <td>操作码</td></tr> <tr><td><code>long</code></td> <td>请求Id，客户端生成，响应中也会返回</td></tr></tbody></table> <p>请求头：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token keyword">int</span> reqLength<span class="token punctuation">,</span> <span class="token keyword">short</span> opCode<span class="token punctuation">,</span> <span class="token keyword">long</span> reqId<span class="token punctuation">,</span> <span class="token class-name">DataOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token comment">// Message length</span>
  <span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">+</span> reqLength<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Op code</span>
  <span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span>opCode<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Request id</span>
  <span class="token function">writeLongLittleEndian</span><span class="token punctuation">(</span>reqId<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>int</code></td> <td>响应消息长度</td></tr> <tr><td><code>long</code></td> <td>请求Id</td></tr> <tr><td><code>int</code></td> <td>状态码，（0为成功，其它为错误码）</td></tr> <tr><td><code>string</code></td> <td>错误消息（只有状态码非0时才会有）</td></tr></tbody></table> <p>响应头：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">readResponseHeader</span><span class="token punctuation">(</span><span class="token class-name">DataInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token comment">// Response length</span>
  <span class="token keyword">final</span> <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Request id</span>
  <span class="token keyword">long</span> resReqId <span class="token operator">=</span> <span class="token function">readLongLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Success code</span>
  <span class="token keyword">int</span> statusCode <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_8-1-4-接入"><a href="#_8-1-4-接入" class="header-anchor">#</a> 8.1.4.接入</h4> <p><strong>TCP套接字</strong></p> <p>客户端应用接入服务端节点需要通过TCP套接字，连接器默认使用<code>10800</code>端口。可以在集群的<code>IgniteConfiguration</code>中的<code>clientConnectorConfiguration</code>属性中，配置端口号及其它的服务端连接参数，如下所示：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="xml" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ignite.cfg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Thin client connection configuration. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>clientConnectorConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.ClientConnectorConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>host<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>127.0.0.1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>port<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10900<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>portRange<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>30<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Other Ignite Configurations. --&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></section> <section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code>	<span class="token class-name">IgniteConfiguration</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ClientConnectorConfiguration</span> ccfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientConnectorConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ccfg<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ccfg<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">10900</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ccfg<span class="token punctuation">.</span><span class="token function">setPortRange</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set client connection configuration in IgniteConfiguration</span>
cfg<span class="token punctuation">.</span><span class="token function">setClientConnectorConfiguration</span><span class="token punctuation">(</span>ccfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start Ignite node</span>
<span class="token class-name">Ignition</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <p><strong>连接握手</strong></p> <p>除了套接字连接之外，瘦客户端协议还需要连接握手，以确保客户端和服务端版本兼容。注意握手必须是连接建立后的<strong>第一条消息</strong>。</p> <p>对于握手消息的请求和响应数据结构，可以看上面的握手章节。</p> <p><strong>示例</strong></p> <p>套接字和握手连接：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">10800</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">&quot;yourUsername&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">&quot;yourPassword&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Message length</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">18</span> <span class="token operator">+</span> username<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> password<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Handshake operation</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Protocol version 1.0.0</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Client code: thin client</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// username</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// password</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// send request</span>
out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Receive handshake response</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> successFlag <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Since Ignite binary protocol uses little-endian byte order,</span>
<span class="token comment">// we need to implement big-endian to little-endian</span>
<span class="token comment">// conversion methods for write and read.</span>

<span class="token comment">// Write int in little-endian byte order</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">,</span> <span class="token class-name">DataOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Write short in little-endian byte order</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">,</span> <span class="token class-name">DataOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Write byte in little-endian byte order</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">,</span> <span class="token class-name">DataOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  out<span class="token punctuation">.</span><span class="token function">writeByte</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Read int in little-endian byte order</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span><span class="token class-name">DataInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> ch1 <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> ch2 <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> ch3 <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> ch4 <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ch1 <span class="token operator">|</span> ch2 <span class="token operator">|</span> ch3 <span class="token operator">|</span> ch4<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">EOFException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ch4 <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>ch3 <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>ch2 <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>ch1 <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// Read byte in little-endian byte order</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">byte</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span><span class="token class-name">DataInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Other write and read methods</span>
</code></pre></div><h4 id="_8-1-5-客户端操作"><a href="#_8-1-5-客户端操作" class="header-anchor">#</a> 8.1.5.客户端操作</h4> <p>握手成功之后，客户端就可以执行各种缓存操作了。</p> <ul><li>键-值查询；</li> <li>SQL和扫描查询；</li> <li>二进制类型操作；</li> <li>缓存配置操作。</li></ul> <h3 id="_8-2-数据格式"><a href="#_8-2-数据格式" class="header-anchor">#</a> 8.2.数据格式</h3> <p>标准数据类型表示为类型代码和值的组合。</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>type_code</code></td> <td>1</td> <td>有符号的单字节整数代码，表示值的类型。</td></tr> <tr><td><code>value</code></td> <td>可变长度</td> <td>值本身，类型和大小取决于<code>type_code</code></td></tr></tbody></table> <p>下面会详细描述支持的类型及其格式。</p> <h4 id="_8-2-1-基础类型"><a href="#_8-2-1-基础类型" class="header-anchor">#</a> 8.2.1.基础类型</h4> <p>基础类型都是非常基本的类型，比如数值类型。</p> <p><strong>Byte</strong></p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Type</code></td> <td>1</td> <td>1</td></tr> <tr><td><code>Value</code></td> <td>1</td> <td>单字节值</td></tr></tbody></table> <p><strong>Short</strong></p> <p>类型代码：2</p> <p>2字节有符号长整形数值，小端字节顺序。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Value</code></td> <td>2</td> <td>值</td></tr></tbody></table> <p><strong>Int</strong></p> <p>类型代码：3</p> <p>4字节有符号长整形数值，小端字节顺序。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Value</code></td> <td>4</td> <td>值</td></tr></tbody></table> <p><strong>Long</strong></p> <p>类型代码：4</p> <p>8字节有符号长整形数值，小端字节顺序。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Value</code></td> <td>8</td> <td>值</td></tr></tbody></table> <p><strong>Float</strong></p> <p>类型代码：5</p> <p>4字节IEEE 754长浮点数值，小端字节顺序。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Value</code></td> <td>4</td> <td>值</td></tr></tbody></table> <p><strong>Double</strong></p> <p>类型代码：6</p> <p>8字节IEEE 754长浮点数值，小端字节顺序。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Value</code></td> <td>8</td> <td>值</td></tr></tbody></table> <p><strong>Char</strong></p> <p>类型代码：7</p> <p>单UTF-16代码单元，小端字节顺序。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Value</code></td> <td>2</td> <td>UTF-16代码单元，小端字节顺序</td></tr></tbody></table> <p><strong>Bool</strong></p> <p>类型代码：8</p> <p>布尔值，0为<code>false</code>，非零为<code>true</code>。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>Value</code></td> <td>1</td> <td>0为<code>false</code>，非零为<code>true</code></td></tr></tbody></table> <p><strong>NULL</strong></p> <p>类型代码：101</p> <p>这不是一个确切的类型，只是一个空值，可以分配给任何类型的对象。</p> <p>没有实际内容，只有类型代码。</p> <h4 id="_8-2-2-标准对象"><a href="#_8-2-2-标准对象" class="header-anchor">#</a> 8.2.2.标准对象</h4> <p><strong>String</strong></p> <p>类型代码：9</p> <p>UTF-8编码的字符串，必须是有效的UTF-8编码的字符串。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>低位优先的有符号整数，字符串的长度，以UTF-8代码单位表示，即字节</td></tr> <tr><td><code>data</code></td> <td><code>length</code></td> <td>无BOM的UTF-8编码的字符串数据</td></tr></tbody></table> <p><strong>UUID（Guid）</strong></p> <p>类型代码：10</p> <p>一个统一唯一标识符（UUID）是一个128为的数值，用于在计算机系统中标识信息。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>most_significant_bits</code></td> <td>8</td> <td>低位优先的64位字节数值，表示UUID的64个最高有效位。</td></tr> <tr><td><code>least_significant_bits</code></td> <td>8</td> <td>低位优先的64位字节数值，表示UUID的64个最低有效位。</td></tr></tbody></table> <p><strong>Timestamp</strong></p> <p>类型代码：33</p> <p>比<code>Date</code>数据类型更精确。除了从epoch开始的毫秒外，包含最后一毫秒的纳秒部分，该值范围在0到999999之间。这意味着，可以通过以下表达式获得以纳秒为单位的完整时间戳：<code>msecs_since_epoch \* 1000000 + msec_fraction_in_nsecs</code>。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>纳秒时间戳计算表达式仅供评估之用。在生产中不应该使用该表达式，因为在某些语言中，表达式可能导致整数溢出。</p></div> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>msecs_since_epoch</code></td> <td>8</td> <td>低位优先的有符号整形值，该值为从<code>00:00:00 1 Jan 1970 UTC</code>开始过去的毫秒数，这个格式通常称为Unix或者POSIX时间。</td></tr> <tr><td><code>msec_fraction_in_nsecs</code></td> <td>4</td> <td>低位优先的有符号整形值，一个毫秒的纳秒部分。</td></tr></tbody></table> <p><strong>Date</strong></p> <p>类型代码：11</p> <p>日期，该值为从<code>00:00:00 1 Jan 1970 UTC</code>开始过去的毫秒数，这个格式通常称为Unix或者POSIX时间。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>msecs_since_epoch</code></td> <td>8</td> <td>低位优先的有符号整形值。</td></tr></tbody></table> <p><strong>Time</strong></p> <p>类型代码：36</p> <p>时间，表示为从午夜（即00:00:00 UTC）起经过的毫秒数。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>value</code></td> <td>8</td> <td>低位优先的有符号整形值，表示为从<code>00:00:00 UTC</code>起经过的毫秒数。</td></tr></tbody></table> <p><strong>Decimal</strong></p> <p>类型代码：30</p> <p>任何所需精度和比例的数值。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>scale</code></td> <td>4</td> <td>低位优先的有符号整形值，实际为十的幂，在此基础上原值要做除法，比如，比例为3的42为0.042，比例为-3的42为42000，比例为1的42为42。</td></tr> <tr><td><code>length</code></td> <td>4</td> <td>低位优先的有符号整形值，数字的长度（字节）。</td></tr> <tr><td><code>data</code></td> <td><code>length</code></td> <td>第一位是负数标志。如果为1，则值为负数。其它位以高位优先格式的有符号的变长整数。</td></tr></tbody></table> <p><strong>Enum</strong></p> <p>类型代码：28</p> <p>枚举类型值，这些类型只定义了有限数量的命名值。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>type_id</code></td> <td>4</td> <td>低位优先的有符号整形值，具体可以看下面的<code>Type ID</code>。</td></tr> <tr><td><code>ordinal</code></td> <td>4</td> <td>低位优先的有符号整形值，枚举值序号。它在枚举声明中的位置，初始常数为0。</td></tr></tbody></table> <h4 id="_8-2-3-基础类型数组"><a href="#_8-2-3-基础类型数组" class="header-anchor">#</a> 8.2.3.基础类型数组</h4> <p>这种数组只包含值（元素）的内容，它们类型类似，具体可以看下表的格式描述。注意数组只包含内容，没有类型代码。</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组中元素的个数。</td></tr> <tr><td><code>element_0_payload</code></td> <td>依赖于类型</td> <td>元素0的内容。</td></tr> <tr><td><code>element_1_payload</code></td> <td>依赖于类型</td> <td>元素1的内容。</td></tr> <tr><td><code>element_N_payload</code></td> <td>依赖于类型</td> <td>元素N的内容。</td></tr></tbody></table> <p><strong>Byte数组</strong></p> <p>类型代码：12</p> <p>字节数组。可以是一段原始数据，也可以是一组小的有符号整数。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code></td> <td>元素序列。每个元素都是<code>byte</code>类型。</td></tr></tbody></table> <p><strong>Short数组</strong></p> <p>类型代码：13</p> <p>有符号短整形数值数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code> × 2</td> <td>元素序列。每个元素都是<code>short</code>类型。</td></tr></tbody></table> <p><strong>Int数组</strong></p> <p>类型代码：14</p> <p>有符号整形数值数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code> × 4</td> <td>元素序列。每个元素都是<code>int</code>类型。</td></tr></tbody></table> <p><strong>Long数组</strong></p> <p>类型代码：15</p> <p>有符号长整形数值数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code> × 8</td> <td>元素序列。每个元素都是<code>long</code>类型。</td></tr></tbody></table> <p><strong>Float数组</strong></p> <p>类型代码：16</p> <p>浮点型数值数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code> × 4</td> <td>元素序列。每个元素都是<code>float</code>类型。</td></tr></tbody></table> <p><strong>Double数组</strong></p> <p>类型代码：17</p> <p>双精度浮点型数值数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code> × 8</td> <td>元素序列。每个元素都是<code>double</code>类型。</td></tr></tbody></table> <p><strong>Char数组</strong></p> <p>类型代码：18</p> <p>UTF-16编码单元数组。和<code>String</code>不同，此类型不是必须包含有效的UTF-16文本。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code> × 2</td> <td>元素序列。每个元素都是<code>char</code>类型。</td></tr></tbody></table> <p><strong>Bool数组</strong></p> <p>类型代码：19</p> <p>布尔值数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td><code>length</code></td> <td>元素序列。每个元素都是<code>bool</code>类型。</td></tr></tbody></table> <h4 id="_8-2-4-标准对象数组"><a href="#_8-2-4-标准对象数组" class="header-anchor">#</a> 8.2.4.标准对象数组</h4> <p>这种数组包含完整值（元素）的内容，这意味着，数组的元素包含类型代码和内容。此格式允许元素为<code>NULL</code>值。这就是它们被称为“对象”的原因。它们都有相似的格式，具体可以看下表的格式描述。</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组中元素的个数。</td></tr> <tr><td><code>element_0_full_value</code></td> <td>依赖于值类型</td> <td>元素0的完整值，包含类型代码和内容，可以为<code>NULL</code>。</td></tr> <tr><td><code>element_1_full_value</code></td> <td>依赖于值类型</td> <td>元素1的完整值或<code>NULL</code>。</td></tr> <tr><td><code>element_N_full_value</code></td> <td>依赖于值类型</td> <td>元素N的完整值或<code>NULL</code>。</td></tr></tbody></table> <p><strong>String数组</strong></p> <p>类型代码：20</p> <p>UTF-8字符串数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，取决于每个字符串的长度，对于每个元素，字符串为<code>5 + 值长度</code>，<code>NULL</code>为<code>1</code></td> <td>元素序列。每个元素都是<code>string</code>类型的完整值，包括类型代码，或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>UUID（Guid）数组</strong></p> <p>类型代码：21</p> <p>UUID（Guid）数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，对于每个元素，UUID为<code>17</code>，<code>NULL</code>为<code>1</code></td> <td>元素序列。每个元素都是<code>uuid</code>类型的完整值，包括类型代码，或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>Timestamp数组</strong></p> <p>类型代码：34</p> <p>时间戳数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，对于每个元素，Timestamp为<code>13</code>，<code>NULL</code>为<code>1</code></td> <td>元素序列。每个元素都是<code>timestamp</code>类型的完整值，包括类型代码，或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>Date数组</strong></p> <p>类型代码：22</p> <p>日期数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，对于每个元素，Date为<code>9</code>，<code>NULL</code>为<code>1</code></td> <td>元素序列。每个元素都是<code>date</code>类型的完整值，包括类型代码，或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>Time数组</strong></p> <p>类型代码：37</p> <p>时间数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，对于每个元素，Time为<code>9</code>，<code>NULL</code>为<code>1</code></td> <td>元素序列。每个元素都是<code>time</code>类型的完整值，包括类型代码，或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>Decimal数组</strong></p> <p>类型代码：31</p> <p>数值数组。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，对于每个元素，数值为<code>9 + 值长度</code>，<code>NULL</code>为<code>1</code></td> <td>元素序列。每个元素都是<code>decimal</code>类型的完整值，包括类型代码，或者<code>NULL</code>。</td></tr></tbody></table> <h4 id="_8-2-5-对象集合"><a href="#_8-2-5-对象集合" class="header-anchor">#</a> 8.2.5.对象集合</h4> <p><strong>对象数组</strong></p> <p>类型代码：23</p> <p>任意类型对象数组。包括任意类型的标准对象、以及各种类型的复杂对象、<code>NULL</code>值及其它们的任意组合，这也意味着，集合可以包含其它的集合。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>type_id</code></td> <td>4</td> <td>包含对象的类型描述符，比如，Java中这个类型会用于反序列化为<code>Type[]</code>，显然，数组中的所有对象都应该有个<code>Type</code>作为父类型，这是任意对象类型的父类型。比如，在Java中是<code>java.lang.Object</code>，这样的<code>根</code>对象类型的Type ID为<code>-1</code>，具体下面会详述。</td></tr> <tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，取决于对象的长度</td> <td>元素序列。每个元素都是任意类型的完整值，或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>集合</strong></p> <p>类型代码：24</p> <p>通用集合类型，和对象数组一样，包含对象，但是和数组不同，它有一个针对特定类型反序列化到平台特定集合的提示，不仅仅是个数组，它支持下面的集合类型：</p> <ul><li><code>USER_SET</code>：-1，这是常规集合类型，无法映射到更具体的集合类型。不过，众所周知，它是固定的。将这样的集合反序列化为平台上基本和更广泛使用的集合类型是有意义的，例如哈希集合；</li> <li><code>USER_COL</code>：0，这是常规集合类型，无法映射到更具体的集合类型。将这样的集合反序列化为平台上基本和更广泛使用的集合类型是有意义的，例如可变大小数组；</li> <li><code>ARR_LIST</code>：1，这实际上是一种可变大小的数组类型；</li> <li><code>LINKED_LIST</code>：2，这是链表类型；</li> <li><code>HASH_SET</code>：3，这是基本的哈希集合类型；</li> <li><code>LINKED_HASH_SET</code>：4，这是一个哈希集合类型，会维护元素的顺序；</li> <li><code>SINGLETON_LIST</code>：5，这是一个只有一个元素的集合，可供平台用于优化目的。如果不适用，则可以使用任何集合类型。</li></ul> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p>集合类型字节用作将集合反序列化为特定平台最合适类型的提示。例如在Java中，<code>HASH_SET</code>会反序列化为<code>java.util.HashSet</code>，而<code>LINKED_HASH_SET</code>会反序列化为<code>java.util.LinkedHashSet</code>。建议瘦客户端实现在序列化和反序列化时尝试使用最合适的集合类型。但是，这只是一个提示，如果它与平台无关或不适用，可以忽略它。</p></div> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>type</code></td> <td>1</td> <td>集合的类型</td></tr> <tr><td><code>elements</code></td> <td>可变长度，取决于对象的大小</td> <td>元素序列。每个元素都是任意类型的完整值，或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>映射</strong></p> <p>类型代码：25</p> <p>类似Map的集合类型，包含成对的键和值对象，键和值可以为任意类型的对象，包括各种类型的标准对象、复杂对象以及组合对象。包含一个反序列化到具体Map类型的提示，支持下面的Map类型：</p> <ul><li><code>HASH_MAP</code>：1，这是基本的哈希映射；</li> <li><code>LINKED_HASH_MAP</code>：2，这也是一个哈希映射，但是会维护元素的顺序。</li></ul> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p>映射类型字节用作将集合反序列化为特定平台最合适类型的提示。建议瘦客户端实现在序列化和反序列化时尝试使用最合适的集合类型。但是，这只是一个提示，如果它与平台无关或不适用，可以忽略它。</p></div> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>type</code></td> <td>1</td> <td>集合的类型</td></tr> <tr><td><code>elements</code></td> <td>可变长度，取决于对象的大小</td> <td>元素序列。这里的元素都有键和值，成对出现，每个元素都是任意类型的完整值或者<code>NULL</code>。</td></tr></tbody></table> <p><strong>枚举数组</strong></p> <p>类型代码：29</p> <p>枚举类型值数组，元素要么是枚举类型值，要么是NULL，所以，任意元素要么占用9字节，要么1字节。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>type_id</code></td> <td>4</td> <td>包含对象的类型描述符，比如，Java中这个类型会用于反序列化为<code>EnumType[]</code>，显然，数组中的所有对象都应该有个<code>EnumType</code>作为父类型，这是任意枚举对象类型的父类型，具体下面会详述。</td></tr> <tr><td><code>length</code></td> <td>4</td> <td>有符号整数，数组里的元素个数</td></tr> <tr><td><code>elements</code></td> <td>可变长度，取决于对象的长度</td> <td>元素序列。每个元素都是枚举类型的完整值，或者<code>NULL</code>。</td></tr></tbody></table> <h4 id="_8-2-6-复杂对象"><a href="#_8-2-6-复杂对象" class="header-anchor">#</a> 8.2.6.复杂对象</h4> <p>类型代码：103</p> <p>复杂对象由一个24位的头、一组字段（数据对象）以及一个模式（字段ID和位置）组成。根据操作和数据模型，一个数据对象可以为一个基础类型或者复杂类型（一组字段）。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>是否必须</th></tr></thead> <tbody><tr><td><code>version</code></td> <td>1</td> <td>是</td></tr> <tr><td><code>flags</code></td> <td>2</td> <td>是</td></tr> <tr><td><code>type_id</code></td> <td>4</td> <td>是</td></tr> <tr><td><code>hash_code</code></td> <td>4</td> <td>是</td></tr> <tr><td><code>length</code></td> <td>4</td> <td>是</td></tr> <tr><td><code>schema_id</code></td> <td>4</td> <td>是</td></tr> <tr><td><code>object_fields</code></td> <td>可变长度</td> <td>否</td></tr> <tr><td><code>schema</code></td> <td>可变长度</td> <td>否</td></tr> <tr><td><code>raw_data_offset</code></td> <td>4</td> <td>否</td></tr></tbody></table> <p><strong>version</strong></p> <p>这是一个字段，指示复杂对象布局的版本。它是必须向后兼容的。客户端应该检查这个字段并向用户指出错误（如果不知道对象布局版本），以防止数据损坏和不可预知的反序列化结果。</p> <p><strong>flags</strong></p> <p>这个字段是16位的低位优先的掩码。包含对象标志，该标志指示读取器应如何处理对象实例。有以下标志：</p> <ul><li><code>USER_TYPE = 0x0001</code>：表示类型是用户类型，应始终为任何客户端类型设置，在反序列化时可以忽略；</li> <li><code>HAS_SCHEMA = 0x0002</code>：表示对象布局在尾部是否包含模式；</li> <li><code>HAS_RAW_DATA = 0x0004</code>：表示对象是否包含原始数据；</li> <li><code>OFFSET_ONE_BYTE = 0x0008</code>：表示模式字段偏移量为一个字节长度；</li> <li><code>OFFSET_TWO_BYTES = 0x0010</code>：表示模式字段偏移量为二个字节长度；</li> <li><code>COMPACT_FOOTER = 0x0020</code>：表示尾部不包含字段ID，只有偏移量。</li></ul> <p><strong>type_id</strong></p> <p>此字段包含唯一的类型标识符。它是低位优先的4个字节长度。默认情况下，<code>Type ID</code>是通过类型名称的Java风格的哈希值获得的。<code>Type ID</code>评估算法应该在集群中的所有平台上都相同，以便所有平台都能够使用此类型的对象进行操作。下面是所有瘦客户端推荐使用的默认<code>Type ID</code>计算算法：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> len <span class="token operator">=</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

  <span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

    c <span class="token operator">=</span> <span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>

    h <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">*</span> h <span class="token operator">+</span> c<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> h<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int32_t</span> <span class="token function">HashCode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> val<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>val <span class="token operator">&amp;&amp;</span> size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">int32_t</span> hash <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">char</span> c <span class="token operator">=</span> val<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'A'</span> <span class="token operator">&lt;=</span> c <span class="token operator">&amp;&amp;</span> c <span class="token operator">&lt;=</span> <span class="token string">'Z'</span><span class="token punctuation">)</span>
      c <span class="token operator">|=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>

    hash <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">*</span> hash <span class="token operator">+</span> c<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> hash<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <p><strong>hash_code</strong></p> <p>值的哈希编码，它是低位优先的4字节长度，它由不包含头部的内容部分的Java风格的哈希编码计算得来，Ignite引擎用来作比较用，比如用作键的比较。下面是哈希值的计算算法：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">dataHashCode</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> len <span class="token operator">=</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

  <span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    h <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">*</span> h <span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> h<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int32_t</span> <span class="token function">GetDataHashCode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> data<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">int32_t</span> hash <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token keyword">int8_t</span><span class="token operator">*</span> bytes <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">int8_t</span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    hash <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">*</span> hash <span class="token operator">+</span> bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> hash<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <p><strong>length</strong></p> <p>这个字段为对象（包括头部）的整体长度，它为低位优先的4字节整型值，通过在当前数据流的位置上简单地增加本字段值的偏移量，可以轻易地忽略整个对象。</p> <p><strong>schema_id</strong></p> <p>对象模式标识符。它为低位优先4字节值，并由所有对象字段ID的哈希值计算得出。它用于复杂的对象大小优化。Ignite使用<code>schema_id</code>来避免将整个模式写入到每个复杂对象值的末尾。相反，它将所有模式存储在二进制元数据存储中，并且只向对象写入字段偏移量。这种优化有助于显著减少包含许多短字段（如整型值）的复杂对象的大小。</p> <p>如果模式缺失（例如，以原始模式写入整个对象，或者没有任何字段），则<code>schema_id</code>字段为0。</p> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p>无法使用<code>type_id</code>确定<code>schema_id</code>，因为具有相同<code>type_id</code>的对象可以具有多个模式，即字段序列。</p></div> <p><code>schema_id</code>的计算算法如下：</p> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="java" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/** FNV1 hash offset basis. */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> FNV1_OFFSET_BASIS <span class="token operator">=</span> <span class="token number">0x811C9DC5</span><span class="token punctuation">;</span>

<span class="token comment">/** FNV1 hash prime. */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> FNV1_PRIME <span class="token operator">=</span> <span class="token number">0x01000193</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">calculateSchemaId</span><span class="token punctuation">(</span><span class="token keyword">int</span> fieldIds<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fieldIds <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> fieldIds<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">int</span> len <span class="token operator">=</span> fieldIds<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

  <span class="token keyword">int</span> schemaId <span class="token operator">=</span> FNV1_OFFSET_BASIS<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    fieldId <span class="token operator">=</span> fieldIds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

    schemaId <span class="token operator">=</span> schemaId <span class="token operator">^</span> <span class="token punctuation">(</span>fieldId <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">=</span> schemaId <span class="token operator">*</span> FNV1_PRIME<span class="token punctuation">;</span>
    schemaId <span class="token operator">=</span> schemaId <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fieldId <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">=</span> schemaId <span class="token operator">*</span> FNV1_PRIME<span class="token punctuation">;</span>
    schemaId <span class="token operator">=</span> schemaId <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fieldId <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">=</span> schemaId <span class="token operator">*</span> FNV1_PRIME<span class="token punctuation">;</span>
    schemaId <span class="token operator">=</span> schemaId <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fieldId <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">=</span> schemaId <span class="token operator">*</span> FNV1_PRIME<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="c" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">/** FNV1 hash offset basis. */</span>
<span class="token keyword">enum</span> <span class="token punctuation">{</span> FNV1_OFFSET_BASIS <span class="token operator">=</span> <span class="token number">0x811C9DC5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/** FNV1 hash prime. */</span>
<span class="token keyword">enum</span> <span class="token punctuation">{</span> FNV1_PRIME <span class="token operator">=</span> <span class="token number">0x01000193</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int32_t</span> <span class="token function">CalculateSchemaId</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int32_t</span><span class="token operator">*</span> fieldIds<span class="token punctuation">,</span> size_t num<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fieldIds <span class="token operator">||</span> num <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">int32_t</span> schemaId <span class="token operator">=</span> FNV1_OFFSET_BASIS<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    fieldId <span class="token operator">=</span> fieldIds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

    schemaId <span class="token operator">^=</span> fieldId <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">*=</span> FNV1_PRIME<span class="token punctuation">;</span>
    schemaId <span class="token operator">^=</span> <span class="token punctuation">(</span>fieldId <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">*=</span> FNV1_PRIME<span class="token punctuation">;</span>
    schemaId <span class="token operator">^=</span> <span class="token punctuation">(</span>fieldId <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">*=</span> FNV1_PRIME<span class="token punctuation">;</span>
    schemaId <span class="token operator">^=</span> <span class="token punctuation">(</span>fieldId <span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
    schemaId <span class="token operator">*=</span> FNV1_PRIME<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <p><strong>object_fields</strong></p> <p>对象字段。每个字段都是二进制对象，可以是复杂类型，也可以是标准类型。注意，一个没有任何字段的复杂对象也是有效的，可能会遇到。每个字段的名字可有可无。对于命名字段，在对象模式中会写入一个偏移量，通过该偏移量，可以在对象中将其定位，而无需对整个对象进行反序列化。没有名字的字段总是存储在命名字段之后，并以所谓的<code>原始模式</code>写入。</p> <p>因此，以原始模式写入的字段只能按与写入相同的顺序通过顺序读取进行访问，而命名字段则可以按随机顺序读取。</p> <p><strong>schema</strong></p> <p>对象模式。复杂对象的模式可有可无，因此此字段是可选的。如果对象中没有命名字段，则对象中不存在模式。它还包括当对象根本没有字段时的情况。可以检查<code>HAS_SCHEMA</code>对象标志，以确定该对象是否具有模式。</p> <p>模式的主要目的是可以对对象字段进行快速搜索。为此，模式在对象内容中包含对象字段的偏移序列。字段偏移本身的大小可能不同。这些字段的大小由最大偏移值在写入时确定。如果它在[24..255]字节范围内，则使用1字节偏移量；如果它在[256..65535]字节范围内，则使用2字节偏移量。其它情况使用4字节偏移量。要确定读取时偏移量的大小，客户端应该检查<code>OFFSET_ONE_BYTE</code>和<code>OFFSET_TWO_BYTES</code>标志。如果设置了<code>OFFSET_ONE_BYTE</code>标志，则偏移量为1字节长，否则如果设置了<code>OFFSET_TWO_BYTES</code>标志，则偏移量为2字节长，否则偏移量为4字节长。</p> <p>支持的模式有两种：</p> <ul><li><code>完整模式方式</code>：实现更简单，但使用更多资源；</li> <li><code>压缩尾部方式</code>：更难实现，但提供更好的性能并减少内存消耗，因此建议新客户端用此方式实现。</li></ul> <p>具体下面会介绍。</p> <p>注意，客户端应该校验<code>COMPACT_FOOTER</code>标志，来确定每个对象应该使用哪个方式。</p> <p><em>完整模式方式</em></p> <p>如果使用这个方式，<code>COMPACT_FOOTER</code>标志未配置，然后整个对象模式会被写入对象的尾部，这时只有复杂对象自身需要反序列化（<code>schema_id</code>字段会被忽略，并且不需要其它的数据），这时复杂对象的<code>schema</code>字段的结构如下：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>field_id_0</code></td> <td>4</td> <td>索引值为0的字段的ID，低位优先4字节，这个ID是通过字段名字用和<code>type_id</code>一样的方式计算得来的。</td></tr> <tr><td><code>field_offset_0</code></td> <td>可变长度，依赖于对象的大小：1,2或4</td> <td>低位优先无符号整数，对象中字段的偏移量，从完整对象值的第一个字节开始（即<code>type_code</code>的位置）。</td></tr> <tr><td><code>field_id_1</code></td> <td>4</td> <td>索引值为1的字段的ID，低位优先4字节。</td></tr> <tr><td><code>field_offset_1</code></td> <td>可变长度，依赖于对象的大小：1,2或4</td> <td>低位优先无符号整数，对象中字段的偏移量。</td></tr> <tr><td><code>field_id_N</code></td> <td>4</td> <td>索引值为N的字段的ID，低位优先4字节。</td></tr> <tr><td><code>field_offset_N</code></td> <td>可变长度，依赖于对象的大小：1,2或4</td> <td>低位优先无符号整数，对象中字段的偏移量。</td></tr></tbody></table> <p><em>压缩尾部方式</em></p> <p>这个模式中，配置了<code>COMPACT_FOOTER</code>标志然后只有字段偏移量的序列会被写入对象的尾部。这时，客户端使用<code>schema_id</code>字段搜索以前存储的元数据中的对象模式，以查找字段顺序并将字段与其偏移量关联。</p> <p>如果使用了这个方式，客户端需要在一个特定的元数据中持有模式，然后将其发送/接收给/自Ignite服务端，具体可以看<a href="#_8-5-%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%B1%BB%E5%9E%8B%E5%85%83%E6%95%B0%E6%8D%AE">二进制类型元数据</a>的相关章节。</p> <p>这个场景中<code>schema</code>的结构如下：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>field_offset_0</code></td> <td>可变长度，依赖于对象的大小：1,2或4</td> <td>低位优先无符号整数，对象中字段0的偏移量，从完整对象值的第一个字节开始（即<code>type_code</code>的位置）。</td></tr> <tr><td><code>field_offset_1</code></td> <td>可变长度，依赖于对象的大小：1,2或4</td> <td>低位优先无符号整数，对象中字段1的偏移量。</td></tr> <tr><td><code>field_offset_N</code></td> <td>可变长度，依赖于对象的大小：1,2或4</td> <td>低位优先无符号整数，对象中字段N的偏移量。</td></tr></tbody></table> <p><strong>raw_data_offset</strong></p> <p>可选字段。仅存在于对象中，如果有任何字段，则以原始模式写入。这时，设置了<code>HAS_RAW_DATA</code>标志并且存在原始数据偏移量字段，存储为低位优先4字节。该值指向复杂对象中的原始数据偏移量，从头部的第一个字节开始（即，此字段始终大于头部的长度）。</p> <p>此字段用于用户以原始模式开始读取时对流进行定位。</p> <h4 id="_8-2-7-特殊类型"><a href="#_8-2-7-特殊类型" class="header-anchor">#</a> 8.2.7.特殊类型</h4> <p><strong>包装数据</strong></p> <p>类型代码：27</p> <p>一个或多个二进制对象可以包装成一个数组，这样可以高效地读取、存储、传输和写入对象，而不需要理解它的内容，只进行简单的字节复制即可。</p> <p>所有缓存操作都返回包装器内的复杂对象（不是基础类型）。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>length</code></td> <td>4</td> <td>低位优先的4字节有符号整数，以字节计算的包装后的数据的大小。</td></tr> <tr><td><code>payload</code></td> <td><code>length</code></td> <td>内容</td></tr> <tr><td><code>offset</code></td> <td>4</td> <td>低位优先的4字节有符号整数，数组内对象的偏移量，数组内可以包含一个对象图，这个偏移量指向根对象。</td></tr></tbody></table> <p><strong>二进制枚举</strong></p> <p>类型代码：38</p> <p>包装枚举类型，引擎可以返回此类型以替代普通枚举类型。当使用二进制API时，枚举应该以这种形式写入。</p> <p>结构：</p> <table><thead><tr><th>字段</th> <th>长度（字节）</th> <th>描述</th></tr></thead> <tbody><tr><td><code>type_id</code></td> <td>4</td> <td>低位优先的4字节有符号整数，具体可以看<code>type_id</code>相关章节的内容。</td></tr> <tr><td><code>ordinal</code></td> <td>4</td> <td>低位优先的4字节有符号整数，枚举值序号，即在枚举声明中的位置，这个序号的初始值为0</td></tr></tbody></table> <h4 id="_8-2-8-序列化和反序列化示例"><a href="#_8-2-8-序列化和反序列化示例" class="header-anchor">#</a> 8.2.8.序列化和反序列化示例</h4> <p><strong>常规对象读</strong></p> <p>下面的代码模板，显示了如何从输入的字节流中读取各种类型的数据：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span><span class="token class-name">DataInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token keyword">byte</span> code <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
      <span class="token keyword">return</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token function">readShortLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token function">readLongLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">27</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Assume 0 offset for simplicity</span>
      <span class="token class-name">Object</span> res <span class="token operator">=</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token number">103</span><span class="token operator">:</span>
      <span class="token keyword">byte</span> ver <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">assert</span> ver <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// version</span>
      <span class="token keyword">short</span> flags <span class="token operator">=</span> <span class="token function">readShortLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> typeId <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> schemaId <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> schemaOffset <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Binary Object: &quot;</span> <span class="token operator">+</span> typeId<span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Unsupported type: &quot;</span> <span class="token operator">+</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Int</strong></p> <p>下面的代码片段显示了如何进行<code>int</code>类型的数据对象的读写，使用的是基于套接字的输出/输入流：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Write int data object</span>
<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read int data object</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> typeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>String</strong></p> <p>下面的代码片段显示了如何进行<code>String</code>类型的读写，格式如下：</p> <table><thead><tr><th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>byte</td> <td>字符串类型代码，0</td></tr> <tr><td>int</td> <td>UTF-8字节模式的字符串长度</td></tr> <tr><td>bytes</td> <td>实际字符串</td></tr></tbody></table> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> writeString <span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span> <span class="token class-name">DataOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// type code for String</span>

  <span class="token keyword">int</span> strLen <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">// length of the string</span>
  <span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>strLen<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

  out<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">readString</span><span class="token punctuation">(</span><span class="token class-name">DataInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> type <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// type code</span>

  <span class="token keyword">int</span> strLen <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// length of the string</span>

  <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>strLen<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">readFully</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> strLen<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_8-3-键-值查询"><a href="#_8-3-键-值查询" class="header-anchor">#</a> 8.3.键-值查询</h3> <p>本章节会描述可以对缓存进行的键值操作，该键值操作等同于Ignite原生的缓存操作，具体可以看<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html" target="_self" rel="noopener noreferrer">IgniteCache</a>的文档，每个操作都会有一个<a href="#_2-1-3-%E6%B6%88%E6%81%AF%E6%A0%BC%E5%BC%8F">头信息</a>及与该操作对应的数据。</p> <p>关于可用的数据类型和数据格式规范的清单，可以参见<a href="#_2-2-%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F">数据格式</a>章节的介绍。</p> <h4 id="_8-3-1-操作代码"><a href="#_8-3-1-操作代码" class="header-anchor">#</a> 8.3.1.操作代码</h4> <p>与Ignite服务端节点成功握手后，客户端可以通过发送带有特定操作代码的请求（参见下面的请求/响应结构）来开始执行各种键值操作：</p> <table><thead><tr><th>操作</th> <th>操作代码</th></tr></thead> <tbody><tr><td><code>OP_CACHE_GET</code></td> <td>1000</td></tr> <tr><td><code>OP_CACHE_PUT</code></td> <td>1001</td></tr> <tr><td><code>OP_CACHE_PUT_IF_ABSENT</code></td> <td>1002</td></tr> <tr><td><code>OP_CACHE_GET_ALL</code></td> <td>1003</td></tr> <tr><td><code>OP_CACHE_PUT_ALL</code></td> <td>1004</td></tr> <tr><td><code>OP_CACHE_GET_AND_PUT</code></td> <td>1005</td></tr> <tr><td><code>OP_CACHE_GET_AND_REPLACE</code></td> <td>1006</td></tr> <tr><td><code>OP_CACHE_GET_AND_REMOVE</code></td> <td>1007</td></tr> <tr><td><code>OP_CACHE_GET_AND_PUT_IF_ABSENT</code></td> <td>1008</td></tr> <tr><td><code>OP_CACHE_REPLACE</code></td> <td>1009</td></tr> <tr><td><code>OP_CACHE_REPLACE_IF_EQUALS</code></td> <td>1010</td></tr> <tr><td><code>OP_CACHE_CONTAINS_KEY</code></td> <td>1011</td></tr> <tr><td><code>OP_CACHE_CONTAINS_KEYS</code></td> <td>1012</td></tr> <tr><td><code>OP_CACHE_CLEAR</code></td> <td>1013</td></tr> <tr><td><code>OP_CACHE_CLEAR_KEY</code></td> <td>1014</td></tr> <tr><td><code>OP_CACHE_CLEAR_KEYS</code></td> <td>1015</td></tr> <tr><td><code>OP_CACHE_REMOVE_KEY</code></td> <td>1016</td></tr> <tr><td><code>OP_CACHE_REMOVE_IF_EQUALS</code></td> <td>1017</td></tr> <tr><td><code>OP_CACHE_REMOVE_KEYS</code></td> <td>1018</td></tr> <tr><td><code>OP_CACHE_REMOVE_ALL</code></td> <td>1019</td></tr> <tr><td><code>OP_CACHE_GET_SIZE</code></td> <td>1020</td></tr></tbody></table> <p>注意上面提到的操作代码，是请求头的一部分，具体可以看<a href="#_2-1-3-%E6%B6%88%E6%81%AF%E6%A0%BC%E5%BC%8F">头信息</a>的相关内容。</p> <h4 id="_8-3-2-op-cache-get"><a href="#_8-3-2-op-cache-get" class="header-anchor">#</a> 8.3.2.OP_CACHE_GET</h4> <p>通过键从缓存获得值，如果不存在则返回<code>null</code>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>要返回的缓存条目的主键</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>数据对象</td> <td>给定主键对应的值，如果不存在则为<code>null</code></td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> OP_CACHE_GET<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting cache value (Data Object)</span>
<span class="token keyword">int</span> resTypeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-3-op-cache-get-all"><a href="#_8-3-3-op-cache-get-all" class="header-anchor">#</a> 8.3.3.OP_CACHE_GET_ALL</h4> <p>从一个缓存中获得多个键-值对。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>int</td> <td>键数量</td></tr> <tr><td>数据对象</td> <td>缓存条目的主键，重复多次，次数为前一个参数传递的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>int</td> <td>结果数量</td></tr> <tr><td>键对象+值对象</td> <td>返回的键-值对，不包含缓存中没有的条目，重复多次，次数为前一个参数返回的值</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> OP_CACHE_GET_ALL<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Key count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Data object 1</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key1<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Data object 2</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key2<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Result count</span>
<span class="token keyword">int</span> resCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> resCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Resulting data object</span>
  <span class="token keyword">int</span> resKeyTypeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Integer type code</span>
  <span class="token keyword">int</span> resKey <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Cache key</span>

  <span class="token comment">// Resulting data object</span>
  <span class="token keyword">int</span> resValTypeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Integer type code</span>
  <span class="token keyword">int</span> resValue <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Cache value</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <h4 id="_8-3-4-op-cache-put"><a href="#_8-3-4-op-cache-put" class="header-anchor">#</a> 8.3.4.OP_CACHE_PUT</h4> <p>往缓存中写入给定的键-值对（会覆盖已有的值）。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>键</td></tr> <tr><td>数据对象</td> <td>值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_CACHE_PUT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-5-op-cache-put-all"><a href="#_8-3-5-op-cache-put-all" class="header-anchor">#</a> 8.3.5.OP_CACHE_PUT_ALL</h4> <p>往缓存中写入给定的多个键-值对（会覆盖已有的值）。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>int</td> <td>键-值对数量</td></tr> <tr><td>键对象+值对象</td> <td>键-值对，重复多次，次数为前一个参数传递的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">29</span><span class="token punctuation">,</span> OP_CACHE_PUT_ALL<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Entry Count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object 1</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key1<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object 1</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value1<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>

<span class="token comment">// Cache key data object 2</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key2<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object 2</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value2<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-6-op-cache-contains-key"><a href="#_8-3-6-op-cache-contains-key" class="header-anchor">#</a> 8.3.6.OP_CACHE_CONTAINS_KEY</h4> <p>判断缓存中是否存在给定的键。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>缓存条目的主键</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>主键存在则为true，否则为false</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> OP_CACHE_CONTAINS_KEY<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Result</span>
<span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-7-op-cache-contains-keys"><a href="#_8-3-7-op-cache-contains-keys" class="header-anchor">#</a> 8.3.7.OP_CACHE_CONTAINS_KEYS</h4> <p>判断缓存中是否存在给定的所有键。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>int</td> <td>键数量</td></tr> <tr><td>数据对象</td> <td>缓存条目的主键，重复多次，次数为前一个参数传递的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>主键存在则为true，否则为false</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> OP_CACHE_CONTAINS_KEYS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object 1</span>
<span class="token keyword">int</span> key1 <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key1<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache key data object 2</span>
<span class="token keyword">int</span> key2 <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key2<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code>
<span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting boolean value</span>
<span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-8-op-cache-get-and-put"><a href="#_8-3-8-op-cache-get-and-put" class="header-anchor">#</a> 8.3.8.OP_CACHE_GET_AND_PUT</h4> <p>往缓存中插入一个键-值对，并且返回与该键对应的原值，如果缓存中没有该键，则会创建一个新的条目并返回<code>null</code>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>要更新的键</td></tr> <tr><td>数据对象</td> <td>给定键对应的新值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>数据对象</td> <td>给定键的原有值，或者为<code>null</code></td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_CACHE_GET_AND_PUT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting cache value (Data Object)</span>
<span class="token keyword">int</span> resTypeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-9-op-cache-get-and-replace"><a href="#_8-3-9-op-cache-get-and-replace" class="header-anchor">#</a> 8.3.9.OP_CACHE_GET_AND_REPLACE</h4> <p>替换缓存中给定键的值，然后返回原值，如果缓存中该键不存在，该操作会返回<code>null</code>而缓存不会有改变。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>要更新的键</td></tr> <tr><td>数据对象</td> <td>给定键对应的新值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>数据对象</td> <td>给定键的原有值，如果该键不存在则为<code>null</code></td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_CACHE_GET_AND_REPLACE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting cache value (Data Object)</span>
<span class="token keyword">int</span> resTypeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-10-op-cache-get-and-remove"><a href="#_8-3-10-op-cache-get-and-remove" class="header-anchor">#</a> 8.3.10.OP_CACHE_GET_AND_REMOVE</h4> <p>删除缓存中给定键对应的数据，然后返回原值，如果缓存中该键不存在，该操作会返回<code>null</code>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>要删除的键</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>数据对象</td> <td>给定键的原有值，如果该键不存在则为<code>null</code></td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> OP_CACHE_GET_AND_REMOVE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting cache value (Data Object)</span>
<span class="token keyword">int</span> resTypeCode <span class="token operator">=</span> <span class="token function">readByte</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">readInt</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-11-op-cache-put-if-absent"><a href="#_8-3-11-op-cache-put-if-absent" class="header-anchor">#</a> 8.3.11.OP_CACHE_PUT_IF_ABSENT</h4> <p>在条目不存在时插入一个新的条目。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>要插入的键</td></tr> <tr><td>数据对象</td> <td>给定键对应的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>插入成功为<code>true</code>，条目已存在为<code>false</code></td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_CACHE_PUT_IF_ABSENT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache Value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code> <span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting boolean value</span>
<span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-12-op-cache-get-and-put-if-absent"><a href="#_8-3-12-op-cache-get-and-put-if-absent" class="header-anchor">#</a> 8.3.12.OP_CACHE_GET_AND_PUT_IF_ABSENT</h4> <p>在条目不存在时插入一个新的条目，否则返回已有的值。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>要插入的键</td></tr> <tr><td>数据对象</td> <td>给定键对应的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>数据对象</td> <td>如果缓存没有该条目则返回<code>null</code>（这时会创建一个新条目），或者返回给定键对应的已有值。</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_CACHE_GET_AND_PUT_IF_ABSENT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting cache value (Data Object)</span>
<span class="token keyword">int</span> resTypeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-13-op-cache-replace"><a href="#_8-3-13-op-cache-replace" class="header-anchor">#</a> 8.3.13.OP_CACHE_REPLACE</h4> <p>替换缓存中已有键的值。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>键</td></tr> <tr><td>数据对象</td> <td>给定键对应的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>表示是否替换成功</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_CACHE_REPLACE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-14-op-cache-replace-if-equals"><a href="#_8-3-14-op-cache-replace-if-equals" class="header-anchor">#</a> 8.3.14.OP_CACHE_REPLACE_IF_EQUALS</h4> <p>当在缓存中给定的键已存在且值等于给定的值时，才会用新值替换旧值。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>键</td></tr> <tr><td>数据对象</td> <td>用于和给定的键对应的值做比较的值</td></tr> <tr><td>数据对象</td> <td>给定键对应的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>表示是否替换成功</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> OP_CACHE_REPLACE_IF_EQUALS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value to compare</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// New cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-15-op-cache-clear"><a href="#_8-3-15-op-cache-clear" class="header-anchor">#</a> 8.3.15.OP_CACHE_CLEAR</h4> <p>清空缓存而不通知监听器或者缓存写入器，具体可以看对应方法的<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html#clear--" target="_self" rel="noopener noreferrer">文档</a>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> OP_CACHE_CLEAR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-16-op-cache-clear-key"><a href="#_8-3-16-op-cache-clear-key" class="header-anchor">#</a> 8.3.16.OP_CACHE_CLEAR_KEY</h4> <p>清空缓存键而不通知监听器或者缓存写入器，具体可以看对应方法的<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html#clear-K-" target="_self" rel="noopener noreferrer">文档</a>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>缓存条目的键</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> OP_CACHE_CLEAR_KEY<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-17-op-cache-clear-keys"><a href="#_8-3-17-op-cache-clear-keys" class="header-anchor">#</a> 8.3.17.OP_CACHE_CLEAR_KEYS</h4> <p>清空缓存的多个键而不通知监听器或者缓存写入器，具体可以看对应方法的<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html#clearAll-java.util.Set-" target="_self" rel="noopener noreferrer">文档</a>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>int</td> <td>键数量</td></tr> <tr><td>数据对象×键数量</td> <td>缓存条目的键</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> OP_CACHE_CLEAR_KEYS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// key count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object 1</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key1<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache key data object 2</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key2<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-18-op-cache-remove-key"><a href="#_8-3-18-op-cache-remove-key" class="header-anchor">#</a> 8.3.18.OP_CACHE_REMOVE_KEY</h4> <p>删除给定键对应的数据，通知监听器和缓存的写入器，具体可以看相关方法的<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html#remove-K-" target="_self" rel="noopener noreferrer">文档</a>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>键</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>表示是否删除成功</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> OP_CACHE_REMOVE_KEY<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key1<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting boolean value</span>
<span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-19-op-cache-remove-if-equals"><a href="#_8-3-19-op-cache-remove-if-equals" class="header-anchor">#</a> 8.3.19.OP_CACHE_REMOVE_IF_EQUALS</h4> <p>当给定的值等于当前值时，删除缓存中给定键对应的条目，然后通知监听器和缓存写入器。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>数据对象</td> <td>要删除条目的键</td></tr> <tr><td>数据对象</td> <td>用于和当前值比较的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>表示是否删除成功</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_CACHE_REMOVE_IF_EQUALS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache value</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting boolean value</span>
<span class="token keyword">boolean</span> res <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-20-op-cache-get-size"><a href="#_8-3-20-op-cache-get-size" class="header-anchor">#</a> 8.3.20.OP_CACHE_GET_SIZE</h4> <p>获取缓存条目的数量，该方法等同于<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html#size-org.apache.ignite.cache.CachePeekMode...-" target="_self" rel="noopener noreferrer">IgniteCache.size(CachePeekMode... peekModes)</a>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>int</td> <td>要请求的PEEK模式数值。当设置为0时，将使用<code>CachePeekMode.ALL</code>。当设置为正值时，需要在以下字段中指定应计数的条目类型：全部、备份、主或近缓存条目。</td></tr> <tr><td>byte</td> <td>表示要统计哪种类型的条目：0：所有，1：近缓存条目，2：主条目，3：备份条目，该字段的重复次数应等于上一个参数的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>long</td> <td>缓存大小</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> OP_CACHE_GET_SIZE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Peek mode count; '0' means All</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Peek mode</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Number of entries in cache</span>
<span class="token keyword">long</span> cacheSize <span class="token operator">=</span> <span class="token function">readLongLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-21-op-cache-remove-keys"><a href="#_8-3-21-op-cache-remove-keys" class="header-anchor">#</a> 8.3.21.OP_CACHE_REMOVE_KEYS</h4> <p>删除给定键对应的条目，通知监听器和缓存写入器，具体可以看相关方法的<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html#removeAll-java.util.Set-" target="_self" rel="noopener noreferrer">文档</a>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>int</td> <td>要删除的键数量</td></tr> <tr><td>数据对象</td> <td>要删除条目的键，如果该键不存在，则会被忽略，该字段必须提供，重复次数为前一个参数的值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> OP_CACHE_REMOVE_KEYS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// key count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache key data object 1</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key1<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>

<span class="token comment">// Cache value data object 2</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Integer type code</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>key2<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Cache key</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting cache value (Data Object)</span>
<span class="token keyword">int</span> resTypeCode <span class="token operator">=</span> <span class="token function">readByte</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token function">readInt</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-3-22-op-cache-remove-all"><a href="#_8-3-22-op-cache-remove-all" class="header-anchor">#</a> 8.3.22.OP_CACHE_REMOVE_ALL</h4> <p>从缓存中删除所有的条目，通知监听器和缓存写入器，具体可以看相关方法的<a href="https://ignite.apache.org/releases/latest/javadoc/org/apache/ignite/IgniteCache.html#removeAll--" target="_self" rel="noopener noreferrer">文档</a>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> OP_CACHE_REMOVE_ALL<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response length</span>
<span class="token keyword">final</span> <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request id</span>
<span class="token keyword">long</span> resReqId <span class="token operator">=</span> <span class="token function">readLongLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Success</span>
<span class="token keyword">int</span> statusCode <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h3 id="_8-4-sql和扫描查询"><a href="#_8-4-sql和扫描查询" class="header-anchor">#</a> 8.4.SQL和扫描查询</h3> <h4 id="_8-4-1-操作代码"><a href="#_8-4-1-操作代码" class="header-anchor">#</a> 8.4.1.操作代码</h4> <p>与Ignite服务端节点成功握手后，客户端就可以通过发送带有特定操作代码的请求（请参见下面的请求/响应结构）来执行各种SQL和扫描查询了：</p> <table><thead><tr><th>操作</th> <th>操作代码</th></tr></thead> <tbody><tr><td><code>OP_QUERY_SQL</code></td> <td>2002</td></tr> <tr><td><code>OP_QUERY_SQL_CURSOR_GET_PAGE</code></td> <td>2003</td></tr> <tr><td><code>OP_QUERY_SQL_FIELDS</code></td> <td>2004</td></tr> <tr><td><code>OP_QUERY_SQL_FIELDS_CURSOR_GET_PAGE</code></td> <td>2005</td></tr> <tr><td><code>OP_QUERY_SCAN</code></td> <td>2000</td></tr> <tr><td><code>OP_QUERY_SCAN_CURSOR_GET_PAGE</code></td> <td>2001</td></tr> <tr><td><code>OP_RESOURCE_CLOSE</code></td> <td>0</td></tr></tbody></table> <p>注意上面提到的操作代码，是请求头的一部分，具体可以看<a href="#_2-1-3-%E6%B6%88%E6%81%AF%E6%A0%BC%E5%BC%8F">头信息</a>的相关内容。</p> <h4 id="_8-4-2-op-query-sql"><a href="#_8-4-2-op-query-sql" class="header-anchor">#</a> 8.4.2.OP_QUERY_SQL</h4> <p>在集群存储的数据中执行SQL查询，查询会返回所有的结果集（键-值对）。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>string</td> <td>类型或者SQL表名</td></tr> <tr><td>string</td> <td>SQL查询字符串</td></tr> <tr><td>int</td> <td>查询参数个数</td></tr> <tr><td>数据对象</td> <td>查询参数，重复多次，次数为前一个参数传递的值</td></tr> <tr><td>bool</td> <td>分布式关联标志</td></tr> <tr><td>bool</td> <td>本地查询标志</td></tr> <tr><td>bool</td> <td>复制标志，查询是否只包含复制表</td></tr> <tr><td>int</td> <td>游标页面大小</td></tr> <tr><td>long</td> <td>超时时间（毫秒），应该为非负值，值为0会禁用超时功能</td></tr></tbody></table> <p>响应只包含第一页的结果。</p> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>long</td> <td>游标ID，可以被<code>OP_RESOURSE_CLOSE</code>关闭</td></tr> <tr><td>int</td> <td>第一页的行数</td></tr> <tr><td>键数据对象+值数据对象</td> <td>键-值对形式的记录，重复多次，次数为前一个参数返回的行数值</td></tr> <tr><td>bool</td> <td>指示是否有更多结果可通过<code>OP_QUERY_SQL_CURSOR_GET_PAGE</code>获取。如果为false，则查询游标将自动关闭。</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> entityName <span class="token operator">=</span> <span class="token string">&quot;Person&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> entityNameLength <span class="token operator">=</span> <span class="token function">getStrLen</span><span class="token punctuation">(</span>entityName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// UTF-8 bytes</span>

<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;Select * from Person&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> sqlLength <span class="token operator">=</span> <span class="token function">getStrLen</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">34</span> <span class="token operator">+</span> entityNameLength <span class="token operator">+</span> sqlLength<span class="token punctuation">,</span> OP_QUERY_SQL<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token class-name">String</span> queryCacheName <span class="token operator">=</span> <span class="token string">&quot;personCache&quot;</span><span class="token punctuation">;</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>queryCacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flag = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Query Entity</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>entityName<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// SQL query</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Argument count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Joins</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Local query</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Replicated</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// cursor page size</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Timeout</span>
<span class="token function">writeLongLittleEndian</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> cursorId <span class="token operator">=</span> <span class="token function">readLongLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> rowCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read entries (as user objects)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rowCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Object</span> key <span class="token operator">=</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Object</span> val <span class="token operator">=</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;CacheEntry: &quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">boolean</span> moreResults <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-4-3-op-query-sql-cursor-get-page"><a href="#_8-4-3-op-query-sql-cursor-get-page" class="header-anchor">#</a> 8.4.3.OP_QUERY_SQL_CURSOR_GET_PAGE</h4> <p>通过<code>OP_QUERY_SQL</code>的游标ID，查询下一个游标页。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>long</td> <td>游标ID</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>long</td> <td>游标ID</td></tr> <tr><td>int</td> <td>行数</td></tr> <tr><td>键数据对象+值数据对象</td> <td>键-值对形式的记录，重复多次，次数为前一个参数返回的行数值</td></tr> <tr><td>bool</td> <td>指示是否有更多结果可通过<code>OP_QUERY_SQL_CURSOR_GET_PAGE</code>获取。如果为false，则查询游标将自动关闭。</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> OP_QUERY_SQL_CURSOR_GET_PAGE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cursor Id (received from Sql query operation)</span>
<span class="token function">writeLongLittleEndian</span><span class="token punctuation">(</span>cursorId<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> rowCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read entries (as user objects)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rowCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">Object</span> key <span class="token operator">=</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Object</span> val <span class="token operator">=</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;CacheEntry: &quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">boolean</span> moreResults <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-4-4-op-query-sql-fields"><a href="#_8-4-4-op-query-sql-fields" class="header-anchor">#</a> 8.4.4.OP_QUERY_SQL_FIELDS</h4> <p>执行SQLFieldQuery。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>0，该字段被废弃，未来会删除</td></tr> <tr><td>string</td> <td>查询的模式，可以为空，默认为<code>PUBLIC</code>模式</td></tr> <tr><td>int</td> <td>查询游标页面大小</td></tr> <tr><td>int</td> <td>最大行数</td></tr> <tr><td>string</td> <td>SQL</td></tr> <tr><td>int</td> <td>参数个数</td></tr> <tr><td>数据对象</td> <td>重复多次，重复次数为前一个参数值</td></tr> <tr><td>byte</td> <td>语句类型。ANY：0，SELECT：1，UPDATE：2</td></tr> <tr><td>bool</td> <td>分布式关联标志</td></tr> <tr><td>bool</td> <td>本地查询标志</td></tr> <tr><td>bool</td> <td>复制标志，查询涉及的表是否都为复制表</td></tr> <tr><td>bool</td> <td>是否强制关联的顺序</td></tr> <tr><td>bool</td> <td>数据是否并置标志</td></tr> <tr><td>bool</td> <td>是否延迟查询的执行</td></tr> <tr><td>long</td> <td>超时（毫秒）</td></tr> <tr><td>bool</td> <td>是否包含字段名</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>long</td> <td>游标ID，可以被<code>OP_RESOURCE_CLOSE</code>关闭</td></tr> <tr><td>int</td> <td>字段（列）数量</td></tr> <tr><td>string（可选）</td> <td><em>只有请求中的<code>IncludeFieldNames</code>标志为true时才是必须的</em>，列名，重复多次，重复次数为前一个参数的值</td></tr> <tr><td>int</td> <td>第一页行数</td></tr> <tr><td>数据对象</td> <td>字段（列）值，字段个数重复次数为前述字段数量参数值，行数重复次数为前一个参数的值</td></tr> <tr><td>bool</td> <td>表示是否还可以通过<code>OP_QUERY_SQL_FIELDS_CURSOR_GET_PAGE</code>获得更多结果</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">&quot;Select id, salary from Person&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> sqlLength <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token class-name">String</span> sqlSchema <span class="token operator">=</span> <span class="token string">&quot;PUBLIC&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> sqlSchemaLength <span class="token operator">=</span> sqlSchema<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">43</span> <span class="token operator">+</span> sqlLength <span class="token operator">+</span> sqlSchemaLength<span class="token punctuation">,</span> OP_QUERY_SQL_FIELDS<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token class-name">String</span> queryCacheName <span class="token operator">=</span> <span class="token string">&quot;personCache&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> cacheId <span class="token operator">=</span> queryCacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheId<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flag = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Schema</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>sqlSchemaLength<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
out<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>sqlSchema<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//sqlSchemaLength</span>

<span class="token comment">// cursor page size</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Max Rows</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// SQL query</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>sqlLength<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
out<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//sqlLength</span>

<span class="token comment">// Argument count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Statement type</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Joins</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Local query</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Replicated</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Enforce join order</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// collocated</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Lazy</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Timeout</span>
<span class="token function">writeLongLittleEndian</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Replicated</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> cursorId <span class="token operator">=</span> <span class="token function">readLongLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> colCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> rowCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read entries</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rowCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">long</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> salary <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Person id: &quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;; Person Salary: &quot;</span> <span class="token operator">+</span> salary<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">boolean</span> moreResults <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-4-5-op-query-sql-fields-cursor-get-page"><a href="#_8-4-5-op-query-sql-fields-cursor-get-page" class="header-anchor">#</a> 8.4.5.OP_QUERY_SQL_FIELDS_CURSOR_GET_PAGE</h4> <p>通过<code>OP_QUERY_SQL_FIELDS</code>的游标ID，获取下一页的查询结果。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>long</td> <td>从<code>OP_QUERY_SQL_FIELDS</code>获取的游标ID</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>int</td> <td>行数</td></tr> <tr><td>数据对象</td> <td>字段（列）值，字段个数重复次数为前述字段数量参数值，行数重复次数为前一个参数的值</td></tr> <tr><td>bool</td> <td>指示是否有更多结果可通过<code>OP_QUERY_SQL_FIELDS_CURSOR_GET_PAGE</code>获取。</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> QUERY_SQL_FIELDS_CURSOR_GET_PAGE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cursor Id</span>
<span class="token function">writeLongLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code> <span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> rowCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read entries (as user objects)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rowCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">// read data objects * column count.</span>
<span class="token punctuation">}</span>

<span class="token keyword">boolean</span> moreResults <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-4-6-op-query-scan"><a href="#_8-4-6-op-query-scan" class="header-anchor">#</a> 8.4.6.OP_QUERY_SCAN</h4> <p>执行扫描查询。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>byte</td> <td>标志，<code>0</code>为默认值，或者<code>1</code>为保持值的二进制形式</td></tr> <tr><td>数据对象</td> <td>过滤器对象，如果不打算在集群中过滤数据可以为<code>null</code>，过滤器类应该加入服务端节点的类路径中</td></tr> <tr><td>byte</td> <td>过滤器平台。JAVA：1，DOTNET：2，CPP：3，过滤器对象非空时，需要这个参数</td></tr> <tr><td>int</td> <td>游标页面大小</td></tr> <tr><td>int</td> <td>要查询的分区数（对于查询整个缓存为负数）</td></tr> <tr><td>bool</td> <td>本地标志，查询是否只在本地节点执行</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>long</td> <td>游标ID</td></tr> <tr><td>int</td> <td>行数</td></tr> <tr><td>键数据对象+值数据对象</td> <td>键-值对形式的记录，重复多次，次数为前一个参数返回的行数值</td></tr> <tr><td>bool</td> <td>指示是否有更多结果可通过<code>OP_QUERY_SCAN_CURSOR_GET_PAGE</code>获取。如果为false，则查询游标将自动关闭。</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> OP_QUERY_SCAN<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token class-name">String</span> queryCacheName <span class="token operator">=</span> <span class="token string">&quot;personCache&quot;</span><span class="token punctuation">;</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>queryCacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// flags</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Filter Object</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// null</span>

<span class="token comment">// Cursor page size</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Partition to query</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// local flag</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cursor id</span>
<span class="token keyword">long</span> cursorId <span class="token operator">=</span> <span class="token function">readLongLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> rowCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read entries (as user objects)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rowCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Object</span> key <span class="token operator">=</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Object</span> val <span class="token operator">=</span> <span class="token function">readDataObject</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;CacheEntry: &quot;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">boolean</span> moreResults <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-4-7-op-query-scan-cursor-get-page"><a href="#_8-4-7-op-query-scan-cursor-get-page" class="header-anchor">#</a> 8.4.7.OP_QUERY_SCAN_CURSOR_GET_PAGE</h4> <p>通过<code>OP_QUERY_SCAN</code>获取的游标，查询下一页的数据。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>long</td> <td>游标ID</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>long</td> <td>游标ID</td></tr> <tr><td>int</td> <td>行数</td></tr> <tr><td>键数据对象+值数据对象</td> <td>键-值对形式的记录，重复多次，次数为前一个参数返回的行数值</td></tr> <tr><td>bool</td> <td>指示是否有更多结果可通过<code>OP_QUERY_SCAN_CURSOR_GET_PAGE</code>获取。如果为false，则查询游标将自动关闭。</td></tr></tbody></table> <h4 id="_8-4-8-op-resource-close"><a href="#_8-4-8-op-resource-close" class="header-anchor">#</a> 8.4.8.OP_RESOURCE_CLOSE</h4> <p>关闭一个资源，比如游标。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>long</td> <td>资源ID</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> OP_RESOURCE_CLOSE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resource id</span>
<span class="token keyword">long</span> cursorId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token function">writeLongLittleEndian</span><span class="token punctuation">(</span>cursorId<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h3 id="_8-5-二进制类型元数据"><a href="#_8-5-二进制类型元数据" class="header-anchor">#</a> 8.5.二进制类型元数据</h3> <h4 id="_8-5-1-操作代码"><a href="#_8-5-1-操作代码" class="header-anchor">#</a> 8.5.1.操作代码</h4> <p>与Ignite服务端节点成功握手后，客户端就可以通过发送带有特定操作代码的请求（请参见下面的请求/响应结构）来执行与二进制类型有关的各种操作了：</p> <table><thead><tr><th>操作</th> <th>操作代码</th></tr></thead> <tbody><tr><td><code>OP_GET_BINARY_TYPE_NAME</code></td> <td>3000</td></tr> <tr><td><code>OP_REGISTER_BINARY_TYPE_NAME</code></td> <td>3001</td></tr> <tr><td><code>OP_GET_BINARY_TYPE</code></td> <td>3002</td></tr> <tr><td><code>OP_PUT_BINARY_TYPE</code></td> <td>3003</td></tr></tbody></table> <p>注意上面提到的操作代码，是请求头的一部分，具体可以看<a href="#_2-1-3-%E6%B6%88%E6%81%AF%E6%A0%BC%E5%BC%8F">头信息</a>的相关内容。</p> <h4 id="_8-5-2-op-get-binary-type-name"><a href="#_8-5-2-op-get-binary-type-name" class="header-anchor">#</a> 8.5.2.OP_GET_BINARY_TYPE_NAME</h4> <p>通过ID取得和平台相关的完整二进制类型名，比如，.NET和Java都可以映射相同的类型<code>Foo</code>，但是在.NET中类型是<code>Apache.Ignite.Foo</code>，而在Java中是<code>org.apache.ignite.Foo</code>。</p> <p>名字是使用<code>OP_REGISTER_BINARY_TYPE_NAME</code>注册的。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>byte</td> <td>平台ID。Java：0，DOTNET：1</td></tr> <tr><td>int</td> <td>类型ID，Java风格类型名字的哈希值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>string</td> <td>二进制类型名</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token string">&quot;ignite.myexamples.model.Person&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> typeLen <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> OP_GET_BINARY_TYPE_NAME<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Platform id</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Type id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Resulting String</span>
<span class="token keyword">int</span> typeCode <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// type code</span>
<span class="token keyword">int</span> strLen <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// length</span>

<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>strLen<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">readFully</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> strLen<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-5-3-op-register-binary-type-name"><a href="#_8-5-3-op-register-binary-type-name" class="header-anchor">#</a> 8.5.3.OP_REGISTER_BINARY_TYPE_NAME</h4> <p>通过ID注册平台相关的完整二进制类型名，比如，.NET和Java都可以映射相同的类型<code>Foo</code>，但是在.NET中类型是<code>Apache.Ignite.Foo</code>，而在Java中是<code>org.apache.ignite.Foo</code>。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>byte</td> <td>平台ID。Java：0，DOTNET：1</td></tr> <tr><td>int</td> <td>类型ID，Java风格类型名字的哈希值</td></tr> <tr><td>string</td> <td>类型名</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token string">&quot;ignite.myexamples.model.Person&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> typeLen <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">20</span> <span class="token operator">+</span> typeLen<span class="token punctuation">,</span> OP_PUT_BINARY_TYPE_NAME<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Platform id</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Type id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Type name</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-5-4-op-get-binary-type"><a href="#_8-5-4-op-get-binary-type" class="header-anchor">#</a> 8.5.4.OP_GET_BINARY_TYPE</h4> <p>通过ID获取二进制类型信息。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>类型ID，Java风格类型名字的哈希值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>bool</td> <td>false:二进制类型不存在，响应结束，true：二进制类型存在，内容如下</td></tr> <tr><td>int</td> <td>类型ID，Java风格类型名字的哈希值</td></tr> <tr><td>string</td> <td>类型名</td></tr> <tr><td>string</td> <td>关联键字段名</td></tr> <tr><td>int</td> <td>BinaryField计数</td></tr> <tr><td>BinaryField*count</td> <td>BinaryField结构。String：字段名；int：类型ID，Java风格类型名哈希值；int：字段ID，Java风格字段名哈希值</td></tr> <tr><td>bool</td> <td>是否枚举值，如果为true，则需要传入下面两个参数，否则会被忽略</td></tr> <tr><td>int</td> <td><em>只有在<code>enum</code>参数为<code>true</code>时才是必须</em>，枚举字段数量</td></tr> <tr><td>string+int</td> <td><em>只有在<code>enum</code>参数为<code>true</code>时才是必须</em>，枚举值，枚举值是一对字面量值（字符串）和一个数值（整型）组成。重复多次，重复次数为前一个参数的值</td></tr> <tr><td>int</td> <td>BinarySchema计数</td></tr> <tr><td>BinarySchema</td> <td>BinarySchema结构。int：唯一模式ID；int：模式中字段数；int：字段ID，Java风格字段名哈希值，重复多次，重复次数为模式中字段数量，BinarySchema重复次数为前一个参数数值</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token string">&quot;ignite.myexamples.model.Person&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> OP_BINARY_TYPE_GET<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Type id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">boolean</span> typeExist <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> typeId <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> typeName <span class="token operator">=</span> <span class="token function">readString</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> affinityFieldName <span class="token operator">=</span> <span class="token function">readString</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> fieldCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> fieldCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token function">readBinaryTypeField</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">boolean</span> isEnum <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> schemaCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read binary schemas</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> schemaCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> schemaId <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Schema Id</span>

  <span class="token keyword">int</span> fieldCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// field count</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> fieldCount<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// field id</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> readBinaryTypeField <span class="token punctuation">(</span><span class="token class-name">DataInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>
  <span class="token class-name">String</span> fieldName <span class="token operator">=</span> <span class="token function">readString</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> fieldTypeId <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> fieldId <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <h4 id="_8-5-5-op-put-binary-type"><a href="#_8-5-5-op-put-binary-type" class="header-anchor">#</a> 8.5.5.OP_PUT_BINARY_TYPE</h4> <p>在集群中注册二进制类型信息。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>类型ID，Java风格类型名字的哈希值</td></tr> <tr><td>string</td> <td>类型名</td></tr> <tr><td>string</td> <td>关联键字段名</td></tr> <tr><td>int</td> <td>BinaryField计数</td></tr> <tr><td>BinaryField</td> <td>BinaryField结构。String：字段名；int：类型ID，Java风格类型名哈希值；int：字段ID，Java风格字段名哈希值；重复多次，重复次数为前一个参数传递的值</td></tr> <tr><td>bool</td> <td>是否枚举值，如果为true，则需要传入下面两个参数，否则会被忽略</td></tr> <tr><td>int</td> <td><em>只有在<code>enum</code>参数为<code>true</code>时才是必须</em>，枚举字段数量</td></tr> <tr><td>string+int</td> <td><em>只有在<code>enum</code>参数为<code>true</code>时才是必须</em>，枚举值，枚举值是一对字面量值（字符串）和一个数值（整型）组成。重复多次，重复次数为前一个参数的值</td></tr> <tr><td>int</td> <td>BinarySchema计数</td></tr> <tr><td>BinarySchema</td> <td>BinarySchema结构。int：唯一模式ID；int：模式中字段数；int：字段ID，Java风格字段名哈希值，重复多次，重复次数为模式中字段数量，BinarySchema重复次数为前一个参数数值</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token string">&quot;ignite.myexamples.model.Person&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> OP_BINARY_TYPE_PUT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Type id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Type name</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Affinity key field name</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Field count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Field 1</span>
<span class="token class-name">String</span> field1 <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">;</span>
<span class="token function">writeBinaryTypeField</span><span class="token punctuation">(</span>field1<span class="token punctuation">,</span> <span class="token string">&quot;long&quot;</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Field 2</span>
<span class="token class-name">String</span> field2 <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">;</span>
<span class="token function">writeBinaryTypeField</span><span class="token punctuation">(</span>field2<span class="token punctuation">,</span> <span class="token string">&quot;String&quot;</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Field 3</span>
<span class="token class-name">String</span> field3 <span class="token operator">=</span> <span class="token string">&quot;salary&quot;</span><span class="token punctuation">;</span>
<span class="token function">writeBinaryTypeField</span><span class="token punctuation">(</span>field3<span class="token punctuation">,</span> <span class="token string">&quot;int&quot;</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// isEnum</span>
out<span class="token punctuation">.</span><span class="token function">writeBoolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Schema count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Schema</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">657</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Schema id; can be any custom value</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// field count</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>field1<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>field2<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>field3<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> writeBinaryTypeField <span class="token punctuation">(</span><span class="token class-name">String</span> field<span class="token punctuation">,</span> <span class="token class-name">String</span> fieldType<span class="token punctuation">,</span> <span class="token class-name">DataOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>
  <span class="token function">writeString</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>fieldType<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h3 id="_8-6-缓存配置"><a href="#_8-6-缓存配置" class="header-anchor">#</a> 8.6.缓存配置</h3> <h4 id="_8-6-1-操作代码"><a href="#_8-6-1-操作代码" class="header-anchor">#</a> 8.6.1.操作代码</h4> <p>与Ignite服务端节点成功握手后，客户端就可以通过发送带有特定操作代码的请求（请参见下面的请求/响应结构）来执行各种缓存配置操作了：</p> <table><thead><tr><th>操作</th> <th>操作代码</th></tr></thead> <tbody><tr><td><code>OP_CACHE_GET_NAMES</code></td> <td>1050</td></tr> <tr><td><code>OP_CACHE_CREATE_WITH_NAME</code></td> <td>1051</td></tr> <tr><td><code>OP_CACHE_GET_OR_CREATE_WITH_NAME</code></td> <td>1052</td></tr> <tr><td><code>OP_CACHE_CREATE_WITH_CONFIGURATION</code></td> <td>1053</td></tr> <tr><td><code>OP_CACHE_GET_OR_CREATE_WITH_CONFIGURATION</code></td> <td>1054</td></tr> <tr><td><code>OP_CACHE_GET_CONFIGURATION</code></td> <td>1055</td></tr> <tr><td><code>OP_CACHE_DESTROY</code></td> <td>1056</td></tr></tbody></table> <p>注意上面提到的操作代码，是请求头的一部分，具体可以看<a href="#_2-1-3-%E6%B6%88%E6%81%AF%E6%A0%BC%E5%BC%8F">头信息</a>的相关内容。</p> <h4 id="_8-6-2-op-cache-create-with-name"><a href="#_8-6-2-op-cache-create-with-name" class="header-anchor">#</a> 8.6.2.OP_CACHE_CREATE_WITH_NAME</h4> <p>通过给定的名字创建缓存，如果缓存的名字中有<code>*</code>，则可以应用一个缓存模板，如果给定名字的缓存已经存在，则会抛出异常。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>string</td> <td>缓存名</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> cacheName <span class="token operator">=</span> <span class="token string">&quot;myNewCache&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> nameLength <span class="token operator">=</span> cacheName<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">+</span> nameLength<span class="token punctuation">,</span> OP_CACHE_CREATE_WITH_NAME<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache name</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send request</span>
out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-6-3-op-cache-get-or-create-with-name"><a href="#_8-6-3-op-cache-get-or-create-with-name" class="header-anchor">#</a> 8.6.3.OP_CACHE_GET_OR_CREATE_WITH_NAME</h4> <p>通过给定的名字创建缓存，如果缓存的名字中有<code>*</code>，则可以应用一个缓存模板，如果给定名字的缓存已经存在，则什么也不做。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>string</td> <td>缓存名</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> cacheName <span class="token operator">=</span> <span class="token string">&quot;myNewCache&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> nameLength <span class="token operator">=</span> cacheName<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">+</span> nameLength<span class="token punctuation">,</span> OP_CACHE_GET_OR_CREATE_WITH_NAME<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache name</span>
<span class="token function">writeString</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send request</span>
out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-6-4-op-cache-get-names"><a href="#_8-6-4-op-cache-get-names" class="header-anchor">#</a> 8.6.4.OP_CACHE_GET_NAMES</h4> <p>获取已有缓存的名字。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>int</td> <td>缓存数量</td></tr> <tr><td>string</td> <td>缓存名字，重复多次，重复次数为前一个参数的返回值</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> OP_CACHE_GET_NAMES<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache count</span>
<span class="token keyword">int</span> cacheCount <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache names</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cacheCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> type <span class="token operator">=</span> <span class="token function">readByteLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// type code</span>

  <span class="token keyword">int</span> strLen <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// length</span>

  <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>strLen<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">readFully</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> strLen<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cache name</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></section></div></div> <h4 id="_8-6-5-op-cache-get-configuration"><a href="#_8-6-5-op-cache-get-configuration" class="header-anchor">#</a> 8.6.5.OP_CACHE_GET_CONFIGURATION</h4> <p>获取指定缓存的配置信息。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>缓存ID，Java风格的缓存名的哈希值</td></tr> <tr><td>type</td> <td>标志</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr> <tr><td>int</td> <td>以字节计算的配置信息的长度（所有的配置参数）</td></tr> <tr><td>CacheConfiguration</td> <td>缓存配置的结构，具体见下表</td></tr></tbody></table> <p><strong>CacheConfiguration</strong></p> <table><thead><tr><th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>int</td> <td>备份数量</td></tr> <tr><td>int</td> <td>CacheMode。LOCAL：0；REPLICATED：1；PARTITIONED：2</td></tr> <tr><td>bool</td> <td>CopyOnRead标志</td></tr> <tr><td>string</td> <td>内存区名字</td></tr> <tr><td>bool</td> <td>EagerTTL标志</td></tr> <tr><td>bool</td> <td>指标统计标志</td></tr> <tr><td>string</td> <td>缓存组名</td></tr> <tr><td>bool</td> <td>无效标志</td></tr> <tr><td>long</td> <td>默认锁超时时间（毫秒）</td></tr> <tr><td>int</td> <td>最大查询迭代数</td></tr> <tr><td>string</td> <td>缓存名</td></tr> <tr><td>bool</td> <td>堆内缓存开启标志</td></tr> <tr><td>int</td> <td>分区丢失策略。READ_ONLY_SAFE：0；READ_ONLY_ALL：1；READ_WRITE_SAFE：2；READ_WRITE_ALL：3；IGNORE：4</td></tr> <tr><td>int</td> <td>QueryDetailMetricsSize</td></tr> <tr><td>int</td> <td>QueryParellelism</td></tr> <tr><td>bool</td> <td>是否从备份读取标志</td></tr> <tr><td>int</td> <td>再平衡缓存区大小</td></tr> <tr><td>long</td> <td>再平衡批处理预取计数</td></tr> <tr><td>long</td> <td>再平衡延迟时间（毫秒）</td></tr> <tr><td>int</td> <td>再平衡模式。SYNC：0；ASYNC：1；NONE：2</td></tr> <tr><td>int</td> <td>再平衡顺序</td></tr> <tr><td>long</td> <td>再平衡调节（毫秒）</td></tr> <tr><td>long</td> <td>再平衡超时（毫秒）</td></tr> <tr><td>bool</td> <td>SqlEscapeAll</td></tr> <tr><td>int</td> <td>SqlIndexInlineMaxSize</td></tr> <tr><td>string</td> <td>SQL模式</td></tr> <tr><td>int</td> <td>写同步模式。FULL_SYNC：0；FULL_ASYNC：1；PRIMARY_SYNC：2</td></tr> <tr><td>int</td> <td>CacheKeyConfiguration计数</td></tr> <tr><td>CacheKeyConfiguration</td> <td>CacheKeyConfiguration结构。String：类型名；String：关联键字段名。重复多次，重复次数为前一参数返回值</td></tr> <tr><td>int</td> <td>QueryEntity计数</td></tr> <tr><td>QueryEntity</td> <td>QueryEntity结构，具体见下表</td></tr></tbody></table> <p><strong>QueryEntity</strong></p> <table><thead><tr><th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>string</td> <td>键类型名</td></tr> <tr><td>string</td> <td>值类型名</td></tr> <tr><td>string</td> <td>表名</td></tr> <tr><td>string</td> <td>键字段名</td></tr> <tr><td>string</td> <td>值字段名</td></tr> <tr><td>int</td> <td>QueryField计数</td></tr> <tr><td>QueryField</td> <td>QueryField结构。String：名字；String：类型名；bool：是否键字段；bool：是否有非空约束。重复多次，重复次数为前一参数对应值</td></tr> <tr><td>int</td> <td>别名计数</td></tr> <tr><td>string+string</td> <td>字段名别名</td></tr> <tr><td>int</td> <td>QueryIndex计数</td></tr> <tr><td>QueryIndex</td> <td>QueryIndex结构。String：索引名；byte：索引类型，(SORTED：0；FULLTEXT：1；GEOSPATIAL：2)；int：内联大小；int：字段计数；(string + bool)：字段（名字+是否降序）</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> cacheName <span class="token operator">=</span> <span class="token string">&quot;myCache&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> OP_CACHE_GET_CONFIGURATION<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Flags = none</span>
<span class="token function">writeByteLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Config length</span>
<span class="token keyword">int</span> configLen <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// CacheAtomicityMode</span>
<span class="token keyword">int</span> cacheAtomicityMode <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Backups</span>
<span class="token keyword">int</span> backups <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// CacheMode</span>
<span class="token keyword">int</span> cacheMode <span class="token operator">=</span> <span class="token function">readIntLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// CopyOnRead</span>
<span class="token keyword">boolean</span> copyOnRead <span class="token operator">=</span> <span class="token function">readBooleanLittleEndian</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Other configurations</span>
</code></pre></div></section></div></div> <h4 id="_8-6-6-op-cache-create-with-configuration"><a href="#_8-6-6-op-cache-create-with-configuration" class="header-anchor">#</a> 8.6.6.OP_CACHE_CREATE_WITH_CONFIGURATION</h4> <p>用给定的配置创建缓存，如果该缓存已存在会抛出异常。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>int</td> <td>按字节计算的配置的长度（所有的配置参数）</td></tr> <tr><td>short</td> <td>配置参数计数</td></tr> <tr><td>short + 属性类型</td> <td>配置属性数据。重复多次，重复次数为前一参数对应值</td></tr></tbody></table> <p>配置参数的个数没有要求，但是<code>Name</code>必须提供。</p> <p>缓存的配置数据是以键-值对的形式提供的，这里键是<code>short</code>类型的属性ID，而值是与键对应的数据，下表描述了所有可用的参数：</p> <table><thead><tr><th>属性代码</th> <th>属性类型</th> <th>描述</th></tr></thead> <tbody><tr><td>2</td> <td>int</td> <td>CacheAtomicityMode。TRANSACTIONAL：0；ATOMIC：1</td></tr> <tr><td>3</td> <td>int</td> <td>备份数量</td></tr> <tr><td>1</td> <td>int</td> <td>CacheMode。LOCAL：0；REPLICATED：1；PARTITIONED：2</td></tr> <tr><td>5</td> <td>bool</td> <td>CopyOnRead</td></tr> <tr><td>100</td> <td>String</td> <td>内存区名</td></tr> <tr><td>405</td> <td>bool</td> <td>EagerTtl</td></tr> <tr><td>406</td> <td>bool</td> <td>StatisticsEnabled</td></tr> <tr><td>400</td> <td>String</td> <td>缓存组名</td></tr> <tr><td>402</td> <td>long</td> <td>默认锁超时时间（毫秒）</td></tr> <tr><td>403</td> <td>int</td> <td>MaxConcurrentAsyncOperations</td></tr> <tr><td>206</td> <td>int</td> <td>MaxQueryIterators</td></tr> <tr><td>0</td> <td>String</td> <td>缓存名</td></tr> <tr><td>101</td> <td>bool</td> <td>堆内缓存启用标志</td></tr> <tr><td>404</td> <td>int</td> <td>PartitionLossPolicy。READ_ONLY_SAFE：0；READ_ONLY_ALL：1；READ_WRITE_SAFE：2；READ_WRITE_ALL：3；IGNORE：4</td></tr> <tr><td>202</td> <td>int</td> <td>QueryDetailMetricsSize</td></tr> <tr><td>201</td> <td>int</td> <td>QueryParallelism</td></tr> <tr><td>6</td> <td>bool</td> <td>ReadFromBackup</td></tr> <tr><td>303</td> <td>int</td> <td>再平衡批处理大小</td></tr> <tr><td>304</td> <td>long</td> <td>再平衡批处理预读计数</td></tr> <tr><td>301</td> <td>long</td> <td>再平衡延迟时间（毫秒）</td></tr> <tr><td>300</td> <td>int</td> <td>RebalanceMode。SYNC：0；ASYNC：1；NONE：2</td></tr> <tr><td>305</td> <td>int</td> <td>再平衡顺序</td></tr> <tr><td>306</td> <td>long</td> <td>再平衡调节（毫秒）</td></tr> <tr><td>302</td> <td>long</td> <td>再平衡超时（毫秒）</td></tr> <tr><td>205</td> <td>bool</td> <td>SqlEscapeAll</td></tr> <tr><td>204</td> <td>int</td> <td>SqlIndexInlineMaxSize</td></tr> <tr><td>203</td> <td>String</td> <td>SQL模式</td></tr> <tr><td>4</td> <td>int</td> <td>WriteSynchronizationMode。FULL_SYNC：0；FULL_ASYNC：1；PRIMARY_SYNC：2</td></tr> <tr><td>401</td> <td>int+CacheKeyConfiguration</td> <td>CacheKeyConfiguration计数+CacheKeyConfiguration。CacheKeyConfiguration结构。String：类型名；String：关联键字段名</td></tr> <tr><td>200</td> <td>int+QueryEntity</td> <td>QueryEntity计数+QueryEntity。QueryEntity结构如下表</td></tr></tbody></table> <p><strong>QueryEntity</strong></p> <table><thead><tr><th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>string</td> <td>键类型名</td></tr> <tr><td>string</td> <td>值类型名</td></tr> <tr><td>string</td> <td>表名</td></tr> <tr><td>string</td> <td>键字段名</td></tr> <tr><td>string</td> <td>值字段名</td></tr> <tr><td>int</td> <td>QueryField计数</td></tr> <tr><td>QueryField</td> <td>QueryField结构。String：名字；String：类型名；bool：是否键字段；bool：是否有非空约束。重复多次，重复次数为前一参数对应值</td></tr> <tr><td>int</td> <td>别名计数</td></tr> <tr><td>string+string</td> <td>字段名别名</td></tr> <tr><td>int</td> <td>QueryIndex计数</td></tr> <tr><td>QueryIndex</td> <td>QueryIndex结构。String：索引名；byte：索引类型，(SORTED：0；FULLTEXT：1；GEOSPATIAL：2)；int：内联大小；int：字段计数；(string + bool)：字段（名字+是否降序）</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> OP_CACHE_CREATE_WITH_CONFIGURATION<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Config length in bytes</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Number of properties</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Backups opcode</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Backups: 2</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Name opcode</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Name</span>
<span class="token function">writeString</span><span class="token punctuation">(</span><span class="token string">&quot;myNewCache&quot;</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-6-7-op-cache-get-or-create-with-configuration"><a href="#_8-6-7-op-cache-get-or-create-with-configuration" class="header-anchor">#</a> 8.6.7.OP_CACHE_GET_OR_CREATE_WITH_CONFIGURATION</h4> <p>根据提供的配置创建缓存，如果该缓存已存在则什么都不做。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr> <tr><td>CacheConfiguration</td> <td>缓存配置的结构，具体见前述</td></tr></tbody></table> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> OP_CACHE_GET_OR_CREATE_WITH_CONFIGURATION<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Config length in bytes</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Number of properties</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Backups opcode</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Backups: 2</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Name opcode</span>
<span class="token function">writeShortLittleEndian</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Name</span>
<span class="token function">writeString</span><span class="token punctuation">(</span><span class="token string">&quot;myNewCache&quot;</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Response header</span>
<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <h4 id="_8-6-8-op-cache-destroy"><a href="#_8-6-8-op-cache-destroy" class="header-anchor">#</a> 8.6.8.OP_CACHE_DESTROY</h4> <p>销毁指定的缓存。</p> <table><thead><tr><th>请求类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>请求头</td></tr></tbody></table> <p>缓存ID，Java风格的缓存名的哈希值</p> <table><thead><tr><th>响应类型</th> <th>描述</th></tr></thead> <tbody><tr><td>头信息</td> <td>响应头</td></tr></tbody></table> <div class="tabs-component"><ul role="tablist" class="tabs-component-tabs"></ul> <div class="tabs-component-panels"><section aria-hidden="true" id="请求" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> cacheName <span class="token operator">=</span> <span class="token string">&quot;myCache&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">DataOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Request header</span>
<span class="token function">writeRequestHeader</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> OP_CACHE_DESTROY<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cache id</span>
<span class="token function">writeIntLittleEndian</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send request</span>
out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section> <section aria-hidden="true" id="响应" role="tabpanel" class="tabs-component-panel" style="display:none;"><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Read result</span>
<span class="token class-name">DataInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">readResponseHeader</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></section></div></div> <div class="right-pale"><div class="right-content"><div class="bbox tell-box"><button class="btn btn-circle btn-success right-tell"><i class="fa fa-lg fa-phone"></i></button> <p class="tell-hide">
            18624049226
        </p></div> <div class="bbox weixin-box"><button class="btn btn-circle btn-success right-weixin"><i class="fa fa-weixin"></i></button> <p class="tell-hide" style="padding:5px;"><img src="/img/weixin.jpg"></p></div></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间：:</span> <span class="time">3/12/2021, 9:13:30 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/doc/java/Clustering.html" class="prev">
        集群化
      </a></span> <span class="next"><a href="/doc/java/DataModeling.html">
        数据建模
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.264f4941.js" defer></script><script src="/assets/js/3.b95bc49f.js" defer></script><script src="/assets/js/1.5c509afc.js" defer></script><script src="/assets/js/290.5e5af2e6.js" defer></script><script src="/assets/js/11.2830eec0.js" defer></script><script src="/assets/js/10.41a5f603.js" defer></script><script src="/assets/js/8.6b57c8fe.js" defer></script>
  </body>
</html>
