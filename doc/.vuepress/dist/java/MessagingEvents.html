<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>9.消息和事件</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.b473d3ab.css" as="style"><link rel="preload" href="/assets/js/app.53dd0248.js" as="script"><link rel="preload" href="/assets/js/70.ce385281.js" as="script"><link rel="prefetch" href="/assets/js/10.629160f8.js"><link rel="prefetch" href="/assets/js/100.8dd41c82.js"><link rel="prefetch" href="/assets/js/11.3ae3899e.js"><link rel="prefetch" href="/assets/js/12.5eea5fa7.js"><link rel="prefetch" href="/assets/js/13.814cf144.js"><link rel="prefetch" href="/assets/js/14.27bf9273.js"><link rel="prefetch" href="/assets/js/15.eb64c1d5.js"><link rel="prefetch" href="/assets/js/16.b8fd3ac5.js"><link rel="prefetch" href="/assets/js/17.6d72ceaa.js"><link rel="prefetch" href="/assets/js/18.ded6af2d.js"><link rel="prefetch" href="/assets/js/19.7dc3ecdc.js"><link rel="prefetch" href="/assets/js/2.82c623fb.js"><link rel="prefetch" href="/assets/js/20.13a8ea33.js"><link rel="prefetch" href="/assets/js/21.2d8f264c.js"><link rel="prefetch" href="/assets/js/22.a3e293d9.js"><link rel="prefetch" href="/assets/js/23.bf9aba6e.js"><link rel="prefetch" href="/assets/js/24.26ebce5a.js"><link rel="prefetch" href="/assets/js/25.b41b81b0.js"><link rel="prefetch" href="/assets/js/26.45147931.js"><link rel="prefetch" href="/assets/js/27.e25bc550.js"><link rel="prefetch" href="/assets/js/28.29be7cc5.js"><link rel="prefetch" href="/assets/js/29.7db78037.js"><link rel="prefetch" href="/assets/js/3.16a62f01.js"><link rel="prefetch" href="/assets/js/30.3223c2eb.js"><link rel="prefetch" href="/assets/js/31.1d38e4bb.js"><link rel="prefetch" href="/assets/js/32.95bcb255.js"><link rel="prefetch" href="/assets/js/33.fe204e0d.js"><link rel="prefetch" href="/assets/js/34.6a081c8a.js"><link rel="prefetch" href="/assets/js/35.e3f2095e.js"><link rel="prefetch" href="/assets/js/36.b15e9b49.js"><link rel="prefetch" href="/assets/js/37.238f3eb8.js"><link rel="prefetch" href="/assets/js/38.0a5e78b8.js"><link rel="prefetch" href="/assets/js/39.0fcea5ab.js"><link rel="prefetch" href="/assets/js/4.09795317.js"><link rel="prefetch" href="/assets/js/40.9d3805de.js"><link rel="prefetch" href="/assets/js/41.241989d7.js"><link rel="prefetch" href="/assets/js/42.f81cd3e4.js"><link rel="prefetch" href="/assets/js/43.44b41407.js"><link rel="prefetch" href="/assets/js/44.d2b58ee5.js"><link rel="prefetch" href="/assets/js/45.84e6dc48.js"><link rel="prefetch" href="/assets/js/46.121b15a3.js"><link rel="prefetch" href="/assets/js/47.d26a7115.js"><link rel="prefetch" href="/assets/js/48.8e1168fc.js"><link rel="prefetch" href="/assets/js/49.99b7227e.js"><link rel="prefetch" href="/assets/js/5.83f9a4bc.js"><link rel="prefetch" href="/assets/js/50.3e4ea217.js"><link rel="prefetch" href="/assets/js/51.5b29294d.js"><link rel="prefetch" href="/assets/js/52.b88a3b5d.js"><link rel="prefetch" href="/assets/js/53.1b185c21.js"><link rel="prefetch" href="/assets/js/54.58426c6e.js"><link rel="prefetch" href="/assets/js/55.7ab1c65d.js"><link rel="prefetch" href="/assets/js/56.12afb1ea.js"><link rel="prefetch" href="/assets/js/57.c73d6313.js"><link rel="prefetch" href="/assets/js/58.60ff3bef.js"><link rel="prefetch" href="/assets/js/59.c0f33441.js"><link rel="prefetch" href="/assets/js/6.9557d6ac.js"><link rel="prefetch" href="/assets/js/60.c20ede71.js"><link rel="prefetch" href="/assets/js/61.87c33cdc.js"><link rel="prefetch" href="/assets/js/62.5bfe9f57.js"><link rel="prefetch" href="/assets/js/63.43ce1725.js"><link rel="prefetch" href="/assets/js/64.40e55d8a.js"><link rel="prefetch" href="/assets/js/65.0ef2261c.js"><link rel="prefetch" href="/assets/js/66.2d2385c6.js"><link rel="prefetch" href="/assets/js/67.ab14fb75.js"><link rel="prefetch" href="/assets/js/68.bfe208fb.js"><link rel="prefetch" href="/assets/js/69.84ea4b5c.js"><link rel="prefetch" href="/assets/js/7.f4c076d8.js"><link rel="prefetch" href="/assets/js/71.15058880.js"><link rel="prefetch" href="/assets/js/72.362628d3.js"><link rel="prefetch" href="/assets/js/73.5049f712.js"><link rel="prefetch" href="/assets/js/74.0b17fabc.js"><link rel="prefetch" href="/assets/js/75.e80e5cd9.js"><link rel="prefetch" href="/assets/js/76.e55635e8.js"><link rel="prefetch" href="/assets/js/77.74e0006a.js"><link rel="prefetch" href="/assets/js/78.c45b8b13.js"><link rel="prefetch" href="/assets/js/79.3bac2928.js"><link rel="prefetch" href="/assets/js/8.ce6bd56a.js"><link rel="prefetch" href="/assets/js/80.54dc2d57.js"><link rel="prefetch" href="/assets/js/81.ae36540a.js"><link rel="prefetch" href="/assets/js/82.82b6f620.js"><link rel="prefetch" href="/assets/js/83.a48b249e.js"><link rel="prefetch" href="/assets/js/84.0db96720.js"><link rel="prefetch" href="/assets/js/85.d6c6f40e.js"><link rel="prefetch" href="/assets/js/86.ed566c04.js"><link rel="prefetch" href="/assets/js/87.ea8bb864.js"><link rel="prefetch" href="/assets/js/88.0002226c.js"><link rel="prefetch" href="/assets/js/89.ed9dd008.js"><link rel="prefetch" href="/assets/js/9.cf32c538.js"><link rel="prefetch" href="/assets/js/90.da0276d6.js"><link rel="prefetch" href="/assets/js/91.18376f61.js"><link rel="prefetch" href="/assets/js/92.bf23c8b6.js"><link rel="prefetch" href="/assets/js/93.a4737653.js"><link rel="prefetch" href="/assets/js/94.7127c03e.js"><link rel="prefetch" href="/assets/js/95.7eef57a8.js"><link rel="prefetch" href="/assets/js/96.3fa99fdb.js"><link rel="prefetch" href="/assets/js/97.968f6f05.js"><link rel="prefetch" href="/assets/js/98.52358adc.js"><link rel="prefetch" href="/assets/js/99.4ad86e2e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b473d3ab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <!----> </div> <div class="page"> <div class="content"><h1 id="_9-消息和事件"><a href="#_9-消息和事件" aria-hidden="true" class="header-anchor">#</a> 9.消息和事件</h1> <h2 id="_9-1-基于主题的消息"><a href="#_9-1-基于主题的消息" aria-hidden="true" class="header-anchor">#</a> 9.1.基于主题的消息</h2> <h3 id="_9-1-1-摘要"><a href="#_9-1-1-摘要" aria-hidden="true" class="header-anchor">#</a> 9.1.1.摘要</h3> <p>Ignite分布式消息可以在集群内的所有节点间进行基于主题的通信，带有特定消息主题的消息可以分布到订阅了该主题的所有节点或者节点的子集。</p> <p>Ignite消息基于发布-订阅范式，发布者和订阅者通过一个通用的主题连接在一起。当一个节点针对主题T发布了一个消息A，他会被分布到所有订阅了主题T的节点。</p> <div class="tip custom-block"><p class="custom-block-title">注意</p> <p>任意加入集群的新节点会自动地订阅集群内（或者集群组内）其他节点订阅的所有的主题。</p></div> <h3 id="_9-1-2-ignitemessaging"><a href="#_9-1-2-ignitemessaging" aria-hidden="true" class="header-anchor">#</a> 9.1.2.IgniteMessaging</h3> <p>Ignite中的分布式消息功能是通过<code>IgniteMessaging</code>接口提供的，可以像下面这样获得一个<code>IgniteMessaging</code>的实例：</p> <div class="language-java extra-class"><pre class="language-java"><code>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">ignite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Messaging instance over this cluster.</span>
IgniteMessaging msg <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Messaging instance over given cluster group (in this case, remote nodes).</span>
IgniteMessaging rmtMsg <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span>ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forRemotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_9-1-3-发布消息"><a href="#_9-1-3-发布消息" aria-hidden="true" class="header-anchor">#</a> 9.1.3.发布消息</h3> <p>send方法可以将一个带有特定消息主题的消息发送/发布到所有的节点，消息可以以<em>有序</em>也可以以<em>无序</em>的方式发送。</p> <p><strong>有序消息</strong></p> <p>**sendOrdered(...)**可以用于希望按照发送消息的顺序接收消息的场合，可以传递一个timeout参数来指定一个消息可以在队列中保持多长时间来等待发送之前的消息。如果达到了超时时间，那么还没有到达该节点上指定主题的所有消息都会被忽略。</p> <p><strong>无序消息</strong></p> <p><code>send(...)</code>方法不保证消息的顺序，这意味着，当顺序地发送消息A和消息B，不能保证目标节点先收到A后收到B。</p> <h3 id="_9-1-4-订阅消息"><a href="#_9-1-4-订阅消息" aria-hidden="true" class="header-anchor">#</a> 9.1.4.订阅消息</h3> <p>listen方法可以监听/订阅消息。当这些方法被调用时，带有指定消息主题的监听器就会被注册到所有的（或者集群组）节点来监听新的消息。对于listen方法，可以传入一个返回boolean值的谓词，他会告诉监听器是继续还是停止监听新的消息。</p> <p><strong>本地监听</strong></p> <p><code>localListen(...)</code>方法只在本地节点注册了一个带有指定主题的消息监听器然后监听来自集群内任意节点的消息。</p> <p><strong>远程监听</strong></p> <p>**remoteListen(...)**方法在集群内的所有节点上注册了一个带有指定主题的监听器然后监听来自集群内任意节点的消息。</p> <h3 id="_9-1-5-示例"><a href="#_9-1-5-示例" aria-hidden="true" class="header-anchor">#</a> 9.1.5.示例</h3> <p>下面的示例显示了在远程节点间的消息交换：</p> <p>Java8：有序消息：</p> <div class="language-java extra-class"><pre class="language-java"><code>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">ignite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
IgniteMessaging rmtMsg <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span>ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forRemotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Add listener for unordered messages on all remote nodes.</span>
rmtMsg<span class="token punctuation">.</span><span class="token function">remoteListen</span><span class="token punctuation">(</span><span class="token string">&quot;MyOrderedTopic&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>nodeId<span class="token punctuation">,</span> msg<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Received ordered message [msg=&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;, from=&quot;</span> <span class="token operator">+</span> nodeId <span class="token operator">+</span> <span class="token string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// Return true to continue listening.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Send ordered messages to remote nodes.</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    rmtMsg<span class="token punctuation">.</span><span class="token function">sendOrdered</span><span class="token punctuation">(</span><span class="token string">&quot;MyOrderedTopic&quot;</span><span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Java8：无序消息：</p> <div class="language-java extra-class"><pre class="language-java"><code>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">ignite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
IgniteMessaging rmtMsg <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span>ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forRemotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Add listener for unordered messages on all remote nodes.</span>
rmtMsg<span class="token punctuation">.</span><span class="token function">remoteListen</span><span class="token punctuation">(</span><span class="token string">&quot;MyUnOrderedTopic&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>nodeId<span class="token punctuation">,</span> msg<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Received unordered message [msg=&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;, from=&quot;</span> <span class="token operator">+</span> nodeId <span class="token operator">+</span> <span class="token string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// Return true to continue listening.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Send unordered messages to remote nodes.</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    rmtMsg<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;MyUnOrderedTopic&quot;</span><span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Java7：有序消息：</p> <div class="language-java extra-class"><pre class="language-java"><code>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">ignite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get cluster group of remote nodes.</span>
ClusterGroup rmtPrj <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forRemotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get messaging instance over remote nodes.</span>
IgniteMessaging msg <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span>rmtPrj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add message listener for specified topic on all remote nodes.</span>
msg<span class="token punctuation">.</span><span class="token function">remoteListen</span><span class="token punctuation">(</span><span class="token string">&quot;myOrderedTopic&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IgniteBiPredicate</span><span class="token generics function"><span class="token punctuation">&lt;</span>UUID<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">apply</span><span class="token punctuation">(</span>UUID nodeId<span class="token punctuation">,</span> String msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Received ordered message [msg=&quot;</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">&quot;, from=&quot;</span> <span class="token operator">+</span> nodeId <span class="token operator">+</span> <span class="token string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// Return true to continue listening.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send ordered messages to all remote nodes.</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    msg<span class="token punctuation">.</span><span class="token function">sendOrdered</span><span class="token punctuation">(</span><span class="token string">&quot;myOrderedTopic&quot;</span><span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_9-2-本地和远程事件"><a href="#_9-2-本地和远程事件" aria-hidden="true" class="header-anchor">#</a> 9.2.本地和远程事件</h2> <h3 id="_9-2-1-摘要"><a href="#_9-2-1-摘要" aria-hidden="true" class="header-anchor">#</a> 9.2.1.摘要</h3> <p>Ignite分布式事件功能使得在分布式集群环境下发生各种各样事件时应用可以接收到通知。可以自动获得比如任务执行、发生在本地或者远程节点上的读写或者查询操作的通知。</p> <h3 id="_9-2-2-igniteevents-api"><a href="#_9-2-2-igniteevents-api" aria-hidden="true" class="header-anchor">#</a> 9.2.2.IgniteEvents API</h3> <p>分布式事件功能是通过<code>IgniteEvents</code>接口提供的，可以通过如下方式从Ignite中获得<code>IgniteEvents</code>的实例：</p> <div class="language-java extra-class"><pre class="language-java"><code>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">ignite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

IgniteEvents evts <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">events</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_9-2-3-订阅事件"><a href="#_9-2-3-订阅事件" aria-hidden="true" class="header-anchor">#</a> 9.2.3.订阅事件</h3> <p>监听方法可以接收集群内发生的指定事件的通知，这些方法在本地或者远程节点上注册了一个指定事件的监听器，当在该节点上发生该事件时，会通知该监听器。</p> <p><strong>本地事件</strong></p> <p><code>localListen(...)</code>方法只在本地节点上针对指定事件注册事件监听器。</p> <p><strong>远程事件</strong></p> <p><code>remoteListen(...)</code>方法会在集群或者集群组内的所有节点上针对指定事件注册监听器。
下面是每个方法的示例：</p> <p>本地监听：</p> <div class="language-java extra-class"><pre class="language-java"><code>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">ignite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Local listener that listenes to local events.</span>
IgnitePredicate<span class="token generics function"><span class="token punctuation">&lt;</span>CacheEvent<span class="token punctuation">&gt;</span></span> locLsnr <span class="token operator">=</span> evt <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Received event [evt=&quot;</span> <span class="token operator">+</span> evt<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, key=&quot;</span> <span class="token operator">+</span> evt<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> 
    <span class="token string">&quot;, oldVal=&quot;</span> <span class="token operator">+</span> evt<span class="token punctuation">.</span><span class="token function">oldValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, newVal=&quot;</span> <span class="token operator">+</span> evt<span class="token punctuation">.</span><span class="token function">newValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// Continue listening.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Subscribe to specified cache events occuring on local node.</span>
ignite<span class="token punctuation">.</span><span class="token function">events</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">localListen</span><span class="token punctuation">(</span>locLsnr<span class="token punctuation">,</span>
  EventType<span class="token punctuation">.</span>EVT_CACHE_OBJECT_PUT<span class="token punctuation">,</span>
  EventType<span class="token punctuation">.</span>EVT_CACHE_OBJECT_READ<span class="token punctuation">,</span>
  EventType<span class="token punctuation">.</span>EVT_CACHE_OBJECT_REMOVED<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get an instance of named cache.</span>
<span class="token keyword">final</span> IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;cacheName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Generate cache events.</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
  cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>远程监听：</p> <div class="language-java extra-class"><pre class="language-java"><code>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">ignite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get an instance of named cache.</span>
<span class="token keyword">final</span> IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">jcache</span><span class="token punctuation">(</span><span class="token string">&quot;cacheName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Sample remote filter which only accepts events for keys</span>
<span class="token comment">// that are greater than or equal to 10.</span>
IgnitePredicate<span class="token generics function"><span class="token punctuation">&lt;</span>CacheEvent<span class="token punctuation">&gt;</span></span> rmtLsnr <span class="token operator">=</span> evt <span class="token operator">-</span><span class="token operator">&gt;</span> evt<span class="token punctuation">.</span><span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">&gt;</span></span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">// Subscribe to specified cache events on all nodes that have cache running.</span>
ignite<span class="token punctuation">.</span><span class="token function">events</span><span class="token punctuation">(</span>ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forCacheNodes</span><span class="token punctuation">(</span><span class="token string">&quot;cacheName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remoteListen</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> rmtLsnr<span class="token punctuation">,</span>                                                                 EventType<span class="token punctuation">.</span>EVT_CACHE_OBJECT_PUT<span class="token punctuation">,</span>
  EventType<span class="token punctuation">.</span>EVT_CACHE_OBJECT_READ<span class="token punctuation">,</span>
  EventType<span class="token punctuation">.</span>EVT_CACHE_OBJECT_REMOVED<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Generate cache events.</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
  cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在上述示例中，<code>EVT_CACHE_OBJECT_PUT</code>,<code>EVT_CACHE_OBJECT_READ</code>,<code>EVT_CACHE_OBJECT_REMOVED</code>是在<code>EventType</code>接口中预定义的事件类型常量。</p> <div class="tip custom-block"><p class="custom-block-title">注意</p> <p><code>EventType</code>接口定义了监听方法可用的各种事件类型常量，可以在相关的<a href="https://ignite.apache.org/releases/latest/javadoc/" target="_blank" rel="noopener noreferrer">javadoc<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中看到这些事件类型的完整列表。</p></div> <div class="warning custom-block"><p class="custom-block-title">警告</p> <p>作为参数传入<code>localListen(...)</code>和<code>remoteListen(...)</code>方法的事件类型还必须在<code>IgniteConfiguration</code>中进行配置，可以参照下面的<a href="#_9-2-5-%E9%85%8D%E7%BD%AE">配置</a>章节。</p></div> <h3 id="_9-2-4-事件的查询"><a href="#_9-2-4-事件的查询" aria-hidden="true" class="header-anchor">#</a> 9.2.4.事件的查询</h3> <p>系统生成的所有事件都会保持在本地节点的本地，<code>IgniteEvents</code>API提供了查询这些事件的方法。</p> <p><strong>本地事件</strong></p> <p><code>localQuery(...)</code>方法通过传入的谓词过滤器在本地节点上进行事件的查询。如果满足了所有的条件，就会返回一个本地节点发生的所有事件的集合。</p> <p><strong>远程事件</strong></p> <p><code>remoteQuery(...)</code>方法通过传入的谓词过滤器在远程节点上进行事件的异步查询。这个操作是分布式的，因此可能在通信层发生故障而且通常也会比本地事件通知花费更多的时间，注意这个方法是非阻塞的，然后附带future立即返回。</p> <h3 id="_9-2-5-配置"><a href="#_9-2-5-配置" aria-hidden="true" class="header-anchor">#</a> 9.2.5.配置</h3> <p>要获得集群内发生的任意任务或者缓存事件的通知，<code>IgniteConfiguration</code>的<code>includeEventTypes</code>属性必须启用：</p> <p>XML：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ... 
    <span class="token comment">&lt;!-- Enable cache events. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>includeEventTypes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">util:</span>constant</span> <span class="token attr-name">static-field</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.events.EventType.EVTS_CACHE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Java：</p> <div class="language-java extra-class"><pre class="language-java"><code>IgniteConfiguration cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Enable cache events.</span>
cfg<span class="token punctuation">.</span><span class="token function">setIncludeEventTypes</span><span class="token punctuation">(</span>EVTS_CACHE<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start Ignite node.</span>
Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>默认的话，因为性能原因事件通知是关闭的。</p> <div class="tip custom-block"><p class="custom-block-title">注意</p> <p>因为每秒生成上千的事件，他会在系统中产生额外的负载，这会导致显著的性能下降。因此强烈建议只有在应用逻辑必需时才启用这些事件。</p></div> <h2 id="_9-3-自动化批处理"><a href="#_9-3-自动化批处理" aria-hidden="true" class="header-anchor">#</a> 9.3.自动化批处理</h2> <p>Ignite会自动地对集群内发生的，作为缓存事件的结果生成的事件通知进行分组或者分批处理。</p> <p>缓存内的每个事件都会导致一个事件通知被生成以及发送，对于缓存活动频繁的系统，获取每个事件的通知都将是网络密集的，可能导致集群内缓存操作的性能下降。</p> <p>Ignite中，事件通知可以被分组然后分批地或者定时地发送，下面是一个如何实现这一点的示例：</p> <div class="language-java extra-class"><pre class="language-java"><code>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">ignite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Get an instance of named cache.</span>
<span class="token keyword">final</span> IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">jcache</span><span class="token punctuation">(</span><span class="token string">&quot;cacheName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Sample remote filter which only accepts events for keys</span>
<span class="token comment">// that are greater than or equal to 10.</span>
IgnitePredicate<span class="token generics function"><span class="token punctuation">&lt;</span>CacheEvent<span class="token punctuation">&gt;</span></span> rmtLsnr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgnitePredicate</span><span class="token generics function"><span class="token punctuation">&lt;</span>CacheEvent<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">apply</span><span class="token punctuation">(</span>CacheEvent evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Cache event: &quot;</span> <span class="token operator">+</span> evt<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token keyword">int</span> key <span class="token operator">=</span> evt<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token keyword">return</span> key <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token comment">// Subscribe to cache events occuring on all nodes </span>
<span class="token comment">// that have the specified cache running. </span>
<span class="token comment">// Send notifications in batches of 10.</span>
ignite<span class="token punctuation">.</span><span class="token function">events</span><span class="token punctuation">(</span>ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forCacheNodes</span><span class="token punctuation">(</span><span class="token string">&quot;cacheName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remoteListen</span><span class="token punctuation">(</span>
    <span class="token number">10</span> <span class="token comment">/*batch size*/</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token comment">/*time intervals*/</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> null<span class="token punctuation">,</span> rmtLsnr<span class="token punctuation">,</span> EVTS_CACHE<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Generate cache events.</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.53dd0248.js" defer></script><script src="/assets/js/70.ce385281.js" defer></script>
  </body>
</html>
