<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2.内存文件系统 | Apache Ignite中文主站</title>
    <meta name="description" content="Ignite内存计算平台的中文文档及相关资料">
    <link rel="shortcut icon" type="image/x-icon" href="https://ignite.apache.org/favicon.ico">
  <script src="https://hm.baidu.com/hm.js?03f40be28ff9a31fd798fd6b9dac0946"></script>
    
    <link rel="preload" href="/assets/css/0.styles.e9b8c49e.css" as="style"><link rel="preload" href="/assets/js/app.81e98b9b.js" as="script"><link rel="preload" href="/assets/js/36.f5c48e7c.js" as="script"><link rel="prefetch" href="/assets/js/24.0a813053.js"><link rel="prefetch" href="/assets/js/2.fe21896a.js"><link rel="prefetch" href="/assets/js/3.8e750420.js"><link rel="prefetch" href="/assets/js/4.56202a99.js"><link rel="prefetch" href="/assets/js/5.7d8b3177.js"><link rel="prefetch" href="/assets/js/6.92c59329.js"><link rel="prefetch" href="/assets/js/7.675b3ab8.js"><link rel="prefetch" href="/assets/js/8.cac6dc28.js"><link rel="prefetch" href="/assets/js/9.f2546dba.js"><link rel="prefetch" href="/assets/js/10.06bde874.js"><link rel="prefetch" href="/assets/js/11.58a5c60a.js"><link rel="prefetch" href="/assets/js/12.5465e03f.js"><link rel="prefetch" href="/assets/js/13.99c718b1.js"><link rel="prefetch" href="/assets/js/14.e7a8c613.js"><link rel="prefetch" href="/assets/js/15.d2f263c8.js"><link rel="prefetch" href="/assets/js/16.cbaac24d.js"><link rel="prefetch" href="/assets/js/17.f0724bbe.js"><link rel="prefetch" href="/assets/js/18.5e0d9c16.js"><link rel="prefetch" href="/assets/js/19.9368197f.js"><link rel="prefetch" href="/assets/js/20.f7e8b0b6.js"><link rel="prefetch" href="/assets/js/21.5350344d.js"><link rel="prefetch" href="/assets/js/22.585e88b2.js"><link rel="prefetch" href="/assets/js/23.aa70c332.js"><link rel="prefetch" href="/assets/js/25.cdc4407b.js"><link rel="prefetch" href="/assets/js/26.e2c242b0.js"><link rel="prefetch" href="/assets/js/27.19654cd1.js"><link rel="prefetch" href="/assets/js/28.a1eea530.js"><link rel="prefetch" href="/assets/js/29.fa408773.js"><link rel="prefetch" href="/assets/js/30.474033e4.js"><link rel="prefetch" href="/assets/js/31.4f634b80.js"><link rel="prefetch" href="/assets/js/32.fa087e43.js"><link rel="prefetch" href="/assets/js/33.b893e4ad.js"><link rel="prefetch" href="/assets/js/34.b78634c6.js"><link rel="prefetch" href="/assets/js/35.41c65a3b.js"><link rel="prefetch" href="/assets/js/37.9bf1214a.js"><link rel="prefetch" href="/assets/js/38.4e128ab0.js"><link rel="prefetch" href="/assets/js/39.034221a6.js"><link rel="prefetch" href="/assets/js/40.a5ca399a.js"><link rel="prefetch" href="/assets/js/41.76abd8fe.js"><link rel="prefetch" href="/assets/js/42.777592fb.js"><link rel="prefetch" href="/assets/js/43.5869ca12.js"><link rel="prefetch" href="/assets/js/44.cb2cc123.js"><link rel="prefetch" href="/assets/js/45.b4dc9b08.js"><link rel="prefetch" href="/assets/js/46.ac03df6f.js"><link rel="prefetch" href="/assets/js/47.2f6511b7.js"><link rel="prefetch" href="/assets/js/48.10c44386.js"><link rel="prefetch" href="/assets/js/49.55b72f95.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e9b8c49e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Apache Ignite中文主站</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link">Java</a></div><div class="nav-item"><a href="/doc/sql/" class="nav-link">SQL</a></div><div class="nav-item"><a href="/doc/integration/" class="nav-link">集成</a></div><div class="nav-item"><a href="/doc/spark/" class="nav-link router-link-active">Ignite&amp;Spark</a></div><div class="nav-item"><a href="/doc/tools/" class="nav-link">工具</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://www.gridgainchina.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GridGain中国官网
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link">Java</a></div><div class="nav-item"><a href="/doc/sql/" class="nav-link">SQL</a></div><div class="nav-item"><a href="/doc/integration/" class="nav-link">集成</a></div><div class="nav-item"><a href="/doc/spark/" class="nav-link router-link-active">Ignite&amp;Spark</a></div><div class="nav-item"><a href="/doc/tools/" class="nav-link">工具</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://www.gridgainchina.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GridGain中国官网
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/doc/spark/" class="sidebar-link">1.介绍</a></li><li><a href="/doc/spark/In-MemoryFileSystem.html" class="active sidebar-link">2.内存文件系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-1-内存文件系统" class="sidebar-link">2.1.内存文件系统</a></li><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-2-igfs原生ignite-api" class="sidebar-link">2.2.IGFS原生Ignite API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-2-1-ignitefilesystem" class="sidebar-link">2.2.1.IgniteFileSystem</a></li><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-2-2-文件以及目录操作" class="sidebar-link">2.2.2.文件以及目录操作</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-3-igfs作为hadoop文件系统" class="sidebar-link">2.3.IGFS作为Hadoop文件系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-3-1-配置ignite" class="sidebar-link">2.3.1.配置Ignite</a></li><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-3-2-运行ignite" class="sidebar-link">2.3.2.运行Ignite</a></li><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-3-3-配置hadoop" class="sidebar-link">2.3.3.配置Hadoop</a></li><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-3-4-运行hadoop" class="sidebar-link">2.3.4.运行Hadoop</a></li><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-3-5-文件系统uri" class="sidebar-link">2.3.5.文件系统URI</a></li><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-3-6-高可用igfs客户端" class="sidebar-link">2.3.6.高可用IGFS客户端</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-4-hadoop文件系统缓存" class="sidebar-link">2.4.Hadoop文件系统缓存</a></li><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-5-igfs模式" class="sidebar-link">2.5.IGFS模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-5-1-primary模式" class="sidebar-link">2.5.1.PRIMARY模式</a></li><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-5-2-proxy模式" class="sidebar-link">2.5.2.PROXY模式</a></li><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-5-3-dual-sync模式" class="sidebar-link">2.5.3.DUAL_SYNC模式</a></li><li class="sidebar-sub-header"><a href="/doc/spark/In-MemoryFileSystem.html#_2-5-4-dual-async模式" class="sidebar-link">2.5.4.DUAL_ASYNC模式</a></li></ul></li></ul></li><li><a href="/doc/spark/HadoopAccelerator.html" class="sidebar-link">3.Hadoop加速器</a></li><li><a href="/doc/spark/IgniteForSpark.html" class="sidebar-link">4.Ignite与Spark</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="_2-内存文件系统"><a href="#_2-内存文件系统" aria-hidden="true" class="header-anchor">#</a> 2.内存文件系统</h1> <h2 id="_2-1-内存文件系统"><a href="#_2-1-内存文件系统" aria-hidden="true" class="header-anchor">#</a> 2.1.内存文件系统</h2> <p>Ignite有一个独特的功能，叫做Ignite文件系统（IGFS），就是一个分布式的内存文件系统，IGFS提供了和Hadoop HDFS类似的功能，但是只在内存中。事实上，除了他自己的API，IGFS还实现了Hadoop的文件系统API，可以透明地加入Hadoop或者Spark的运行环境。
IGFS将每个文件的数据拆分成独立的数据块然后将他们保存进一个分布式内存缓存中。然而，与Hadoop HDFS不同，IGFS不需要一个name节点，它通过一个哈希函数自动确定文件数据的位置。
IGFS可以独立部署，也可以部署在HDFS之上，这时他成为了一个存储于HDFS中的文件的透明缓存层。
<img src="https://files.readme.io/795c4d6-spark-igfs_1.png" alt></p> <h2 id="_2-2-igfs原生ignite-api"><a href="#_2-2-igfs原生ignite-api" aria-hidden="true" class="header-anchor">#</a> 2.2.IGFS原生Ignite API</h2> <p>Ignite文件系统（IGFS）是一个内存级的文件系统，他可以在现有的缓存基础设施基础上对文件以及文件夹进行操作。
IGFS既可以作为一个纯粹的内存文件系统，也可以委托给其他的文件系统（比如各种Hadoop文件系统实现）作为一个缓存层。
另外，IGFS提供了在文件系统数据上执行MapReduce任务的API。</p> <h3 id="_2-2-1-ignitefilesystem"><a href="#_2-2-1-ignitefilesystem" aria-hidden="true" class="header-anchor">#</a> 2.2.1.IgniteFileSystem</h3> <p><code>IgniteFileSystem</code>接口是一个进入Ignite文件系统实现的入口，他提供了正常的文件系统操作的方法，比如<code>create</code>,<code>delete</code>,<code>mkdirs</code>等等，以及执行MapReduce任务的方法。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">ignite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Obtain instance of IGFS named &quot;myFileSystem&quot;.</span>
IgniteFileSystem fs <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token string">&quot;myFileSystem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>IGFS可以通过Spring XML文件或者编程的方式进行配置。
XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fileSystemConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.FileSystemConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Distinguished file system name. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myFileSystem<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> 
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>    
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Java：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteConfiguration cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
FileSystemConfiguration fileSystemCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileSystemConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileSystemCfg<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;myFileSystem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileSystemCfg<span class="token punctuation">.</span><span class="token function">setMetaCacheName</span><span class="token punctuation">(</span><span class="token string">&quot;myMetaCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fileSystemCfg<span class="token punctuation">.</span><span class="token function">setDataCacheName</span><span class="token punctuation">(</span><span class="token string">&quot;myDataCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
cfg<span class="token punctuation">.</span><span class="token function">setFileSystemConfiguration</span><span class="token punctuation">(</span>fileSystemCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-2-2-文件以及目录操作"><a href="#_2-2-2-文件以及目录操作" aria-hidden="true" class="header-anchor">#</a> 2.2.2.文件以及目录操作</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteFileSystem fs <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">fileSystem</span><span class="token punctuation">(</span><span class="token string">&quot;myFileSystem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create directory.</span>
IgfsPath dir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgfsPath</span><span class="token punctuation">(</span><span class="token string">&quot;/myDir&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create file and write some data to it.</span>
IgfsPath file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgfsPath</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token string">&quot;myFile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">(</span>OutputStream out <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

<span class="token comment">// Read from file.</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span>InputStream in <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Delete directory.</span>
fs<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="_2-3-igfs作为hadoop文件系统"><a href="#_2-3-igfs作为hadoop文件系统" aria-hidden="true" class="header-anchor">#</a> 2.3.IGFS作为Hadoop文件系统</h2> <p>Ignite Hadoop加速器提供了一个叫做<code>IgniteHadoopFileSystem</code>的Hadoop兼容IGFS实现，Hadoop可以以即插即用的形式运行在这个文件系统上，然后显著地减少了I/O和改善了延迟和吞吐量。
<img src="https://files.readme.io/f1ac167-ignite_filesystem_1.png" alt></p> <h3 id="_2-3-1-配置ignite"><a href="#_2-3-1-配置ignite" aria-hidden="true" class="header-anchor">#</a> 2.3.1.配置Ignite</h3> <p>Ignite Hadoop加速器在Ignite集群内部执行文件系统操作，必须满足几个前置条件：
1）<code>IGNITE_HOME</code>环境变量必须设置以及指向Ignite的安装根目录。
2）每个节点都必须在类路径上包含Hadoop的jar文件。可以参照各个Hadoop发行版的Ignite安装向导来了解详细信息。
3）<code>IGFS</code>必须在集群节点上进行了配置。可以参照<code>13.2.IGFS原生Ignite API</code>章节来了解如何进行配置。
4）要让<code>IGFS</code>接收来自Hadoop的请求，需要配置一个端点（默认的配置文件是<code>${IGNITE_HOME}/config/default-config.xml</code>）。Ignite提供两种类型的端点：</p> <ul><li><code>shmem</code>：工作于共享内存（Windows不可用）</li> <li><code>tcp</code>：工作于标准Socket API</li></ul> <p>如果与Ignite节点是在同一台机器上执行文件系统操作那么共享内存端点是推荐的做法。注意如果在共享内存通信模式下<code>port</code>参数也可以用于执行客户端-服务端握手的初始化。
XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.FileSystemConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myIgfs<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ipcEndpointConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.igfs.IgfsIpcEndpointConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SHMEM<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>port<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>12345<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  ....
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Java：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>FileSystemConfiguration fileSystemCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileSystemConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
IgfsIpcEndpointConfiguration endpointCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgfsIpcEndpointConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
endpointCfg<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span>IgfsEndpointType<span class="token punctuation">.</span>SHMEM<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
fileSystemCfg<span class="token punctuation">.</span><span class="token function">setIpcEndpointConfiguration</span><span class="token punctuation">(</span>endpointCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>TCP端点可以用于或者Ignite节点位于其他机器或者共享内存不可用的场合。
XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.FileSystemConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myIgfs<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ipcEndpointConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.igfs.IgfsIpcEndpointConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>TCP<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>host<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myHost<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>port<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>12345<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  ....
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Java：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>FileSystemConfiguration fileSystemCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileSystemConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
IgfsIpcEndpointConfiguration endpointCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgfsIpcEndpointConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
endpointCfg<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span>IgfsEndpointType<span class="token punctuation">.</span>TCP<span class="token punctuation">)</span><span class="token punctuation">;</span>
endpointCfg<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;myHost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
fileSystemCfg<span class="token punctuation">.</span><span class="token function">setIpcEndpointConfiguration</span><span class="token punctuation">(</span>endpointCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果host参数未设置，默认值是<code>127.0.0.1</code>。
如果port参数未设置，默认值是<code>10500</code>。
如果ipcEndpointConfiguration未设置，那么对于Linux系统共享内存端点会使用默认的端口，对于WindowsTCP端口会使用默认的端口。</p> <h3 id="_2-3-2-运行ignite"><a href="#_2-3-2-运行ignite" aria-hidden="true" class="header-anchor">#</a> 2.3.2.运行Ignite</h3> <p>配置Ignite节点后，通过如下方式可以启动：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ bin/ignite.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-3-3-配置hadoop"><a href="#_2-3-3-配置hadoop" aria-hidden="true" class="header-anchor">#</a> 2.3.3.配置Hadoop</h3> <p>要使用Ignite作业跟踪器运行Hadoop作业，需要满足如下的前提条件：
1）<code>IGNITE_HOME</code>环境变量必须设置以及指向Ignite的安装根目录。
2）Hadoop必须在类路径上包含Ignite jar文件：<code>${IGNITE_HOME}\libs\ignite-core-[version].jar</code>和<code>${IGNITE_HOME}\libs\hadoop\ignite-hadoop-[version].jar</code>。
这个可以通过若干种方式实现：</p> <ul><li>将这几个jar文件加入<code>HADOOP_CLASSPATH</code>环境变量；</li> <li>将这些jar文件拷贝或者建立符号链接到Hadoop存放共享库的文件夹中，可以参照Ignite针对各个Hadoop发行版的安装向导来了解详细信息；</li></ul> <p>3）对于将要执行的活动必须配置Ignite的Hadoop加速器文件系统，至少要提供文件系统类的全限定名；
XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.igfs.impl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.ignite.hadoop.fs.v1.IgniteHadoopFileSystem<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如果要将Ignite文件系统设置为默认的文件系统，可以增加如下的属性：
XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.default.name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>igfs://myIgfs@/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这里的value是一个配有IGFS的Ignite节点的端点URL，本章节的末尾会提供这个URL的规则。
如何将配置传递给Hadoop作业有若干种方式：
<strong>第一</strong>，可以创建独立的带有这些配置属性的<code>core-site.xml</code>然后用于作业的运行；
<strong>第二</strong>，可以通过编程的方式为特定的作业设置这些属性。
Java：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>Configuration conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;fs.igfs.impl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.ignite.hadoop.fs.v1.IgniteHadoopFileSystem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
conf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;fs.default.name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;igfs://myIgfs@/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Job job <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Job</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token string">&quot;word count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>第三</strong>，在Hadoop环境中可以修改默认的<code>core-site.xml</code>中的<code>fs.igfs.impl</code>属性。</p> <blockquote><p><strong>警告</strong>
在默认的<code>core-site.xml</code>文件中不要修改<code>fs.default.name</code>属性，因为HDFS无法启动。可以使用全限定路径访问IGFS，比如这样，<code>igfs://myIgfs@/path/to/file</code>，而不是<code>/path/to/file</code>。</p></blockquote> <h3 id="_2-3-4-运行hadoop"><a href="#_2-3-4-运行hadoop" aria-hidden="true" class="header-anchor">#</a> 2.3.4.运行Hadoop</h3> <p>如何运行一个作业取决于对Hadoop如何进行配置。
如果创建了独立的<code>core-site.xml</code>:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>hadoop --config <span class="token punctuation">[</span>path_to_config<span class="token punctuation">]</span> <span class="token punctuation">[</span>arguments<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意使用定制的Hadoop启动器脚本可以轻易的引用一个单独的Hadoop配置目录和Ignite库，比如<code>hadoop-ignited</code>:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">export</span> IGNITE_HOME<span class="token operator">=</span><span class="token punctuation">[</span>path_to_ignite<span class="token punctuation">]</span>

<span class="token comment"># Add necessary Ignite libraries to the Hadoop client classpath:</span>
VERSION<span class="token operator">=</span><span class="token punctuation">[</span>ignite_version_identifier<span class="token punctuation">]</span>
<span class="token function">export</span> HADOOP_CLASSPATH<span class="token operator">=</span><span class="token variable">${IGNITE_HOME}</span>/libs/ignite-core-<span class="token variable">${VERSION}</span>.jar:<span class="token variable">${IGNITE_HOME}</span>/libs/ignite-hadoop/ignite-hadoop-<span class="token variable">${VERSION}</span>.jar:<span class="token variable">${IGNITE_HOME}</span>/libs/ignite-shmem-1.0.0.jar

hadoop --config <span class="token punctuation">[</span>path_to_config_directory<span class="token punctuation">]</span> <span class="token string">&quot;<span class="token variable">${@}</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>使用IGFS通过这种方式运行一个Hadoop作业，需要运行命令<code>hadoop-ignited ...</code>，如果要在默认的Hadoop上运行同样的作业，只需要使用同样的参数运行<code>hadoop ...</code>。
如果通过编程方式启动一个作业，那么提交它：
Java：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Job job <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Job</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token string">&quot;word count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
job<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_2-3-5-文件系统uri"><a href="#_2-3-5-文件系统uri" aria-hidden="true" class="header-anchor">#</a> 2.3.5.文件系统URI</h3> <p>访问<code>IGFS</code>的URI具有如下的结构：<code>igfs://[name]@[host]:[port]/</code>,这里：</p> <ul><li><code>name</code>:要连接的IGFS的名字（通过FileSystemConfiguration.setName(...))指定的）；</li> <li><code>host</code>:可选的Ignite端点主机（<code>IgfsIpcEndpointConfiguration.host</code>），默认为<code>127.0.0.1</code>；</li> <li><code>port</code>:可选的Ignite端点端口 (<code>IgfsIpcEndpointConfiguration.port</code>)，默认为<code>10500</code>；</li></ul> <p>URI示例：</p> <ul><li><code>igfs://myIgfs@myHost:12345/</code>：连接到运行在指定主机和端口上的名为<code>myIgfs</code>的IGFS；</li> <li><code>igfs://myIgfs@myHost/</code>：连接到运行在指定主机和默认端口上的名为<code>myIgfs</code>的IGFS；</li> <li><code>igfs://myIgfs@/</code>：连接到运行在localhost和默认端口上的名为<code>myIgfs</code>的IGFS；</li> <li><code>igfs://myIgfs@:12345/</code>:连接到运行在localhost和指定端口上的名为<code>myIgfs</code>的IGFS；</li></ul> <h3 id="_2-3-6-高可用igfs客户端"><a href="#_2-3-6-高可用igfs客户端" aria-hidden="true" class="header-anchor">#</a> 2.3.6.高可用IGFS客户端</h3> <p>高可用（HA）IGFS客户端是基于Ignite客户端节点的，Ignite客户端节点是在执行Hadoop作业的主机上启动的。常规的TCP客户端接入上述的集群后，在重连后是不支持已经打开的IGFS I/O流的，而Ignite的客户端节点是没有这个问题的。
要配置使用Ignite的客户端节点接入集群，需要为Hadoop作业配置属性<strong>fs.igfs.&lt;igfs_authority&gt;.config_path</strong>，值为Ignite节点配置的路径：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Configuration conf = new Configuration();
...
conf.set(&quot;fs.default.name&quot;, &quot;igfs://myIgfs@/&quot;);
conf.set(&quot;fs.igfs.myIgfs.config_path&quot;, &quot;ignite/config/client.xml&quot;);
...
Job job = new Job(conf, &quot;word count&quot;);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>服务端节点的XML配置文件这里也是可以使用的，强制使用客户端模式启动主要是为了IGFS连接。</p> <h2 id="_2-4-hadoop文件系统缓存"><a href="#_2-4-hadoop文件系统缓存" aria-hidden="true" class="header-anchor">#</a> 2.4.Hadoop文件系统缓存</h2> <p>Ignite Hadoop加速器包含了一个<code>IGFS</code>二级文件系统实现<code>IgniteHadoopIgfsSecondaryFileSystem</code>，它可以对任何Hadoop<code>文件系统</code>实现进行通读和通写。
要使用二级文件系统，可以在<code>IGFS</code>配置中指定或者通过编程的方式实现。
XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.FileSystemConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>secondaryFileSystem<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.hadoop.fs.IgniteHadoopIgfsSecondaryFileSystem<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hdfs://myHdfs:9000<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>                            
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Java：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>ileSystemConfiguration fileSystemCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileSystemConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
IgniteHadoopIgfsSecondaryFileSystem hadoopFileSystem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteHadoopIgfsSecondaryFileSystem</span><span class="token punctuation">(</span><span class="token string">&quot;hdfs://myHdfs:9000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
fileSystemCfg<span class="token punctuation">.</span><span class="token function">setSecondarFileSystem</span><span class="token punctuation">(</span>hadoopFileSystem<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在Ignite节点启动过程中，Ignite默认不会在类路径中包含Hadoop的库文件，如果决定使用<code>HDFS</code>作为一个二级文件系统，那么需要提前按照如下步骤进行操作：</p> <ol><li>使用Ignite发行版的<code>Apache Ignite Hadoop Accelerator</code>版本（如果自行构建发行版可以使用-Dignite.edition=hadoop）；</li> <li>如果使用Apache的Hadoop发行版，启动一个Ignite节点之前需要设置HADOOP_HOME环境变量。如果使用其他的Hadoop发行版（HDP, Cloudera, BigTop等），一定确保<code>/etc/default/hadoop</code>文件存在并且有适当的内容。</li></ol> <p>作为一个选择，可以在Ignite节点类路径中手工添加必要的Hadoop依赖，这些依赖的groupId是<code>org.apache.hadoop</code>，他们已经在<code>modules/hadoop/pom.xml</code>文件中列出，当前，他们是：</p> <ul><li>hadoop-annotations</li> <li>hadoop-auth</li> <li>hadoop-common</li> <li>hadoop-hdfs</li> <li>hadoop-mapreduce-client-common</li> <li>hadoop-mapreduce-client-core</li></ul> <h2 id="_2-5-igfs模式"><a href="#_2-5-igfs模式" aria-hidden="true" class="header-anchor">#</a> 2.5.IGFS模式</h2> <p>IGFS可以工作于四种操作模式：<code>PRIMARY</code>,<code>PROXY</code>,<code>DUAL_SYNC</code>和<code>DUAL_ASYNC</code>。这些模式既可以配置整个文件系统，也可以配置特定的路径。他们是在<code>IgfsMode</code>枚举中定义的，默认文件系统操作于<code>DUAL_ASYNC</code>模式。
如果未配置二级文件系统，配置成<code>DUAL_SYNC</code>或者<code>DUAL_ASYNC</code>模式的所有路径都会回退到<code>PRIMARY</code>模式。
XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.FileSystemConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token comment">&lt;!-- Set default mode. --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>defaultMode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>DUAL_SYNC<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>     
  <span class="token comment">&lt;!-- Configure '/tmp' and all child paths to work in PRIMARY mode. --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>pathModes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/tmp/.*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>PRIMARY<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>      
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Java：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>FileSystemConfiguration fileSystemCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileSystemConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
fileSystemCfg<span class="token punctuation">.</span><span class="token function">setDefaultMode</span><span class="token punctuation">(</span>IgfsMode<span class="token punctuation">.</span>DUAL_SYNC<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> IgfsMode<span class="token punctuation">&gt;</span></span> pathModes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pathModes<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;/tmp/.*&quot;</span><span class="token punctuation">,</span> IgfsMode<span class="token punctuation">.</span>PRIMARY<span class="token punctuation">)</span><span class="token punctuation">;</span>
fileSystemCfg<span class="token punctuation">.</span><span class="token function">setPathModes</span><span class="token punctuation">(</span>pathModes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_2-5-1-primary模式"><a href="#_2-5-1-primary模式" aria-hidden="true" class="header-anchor">#</a> 2.5.1.PRIMARY模式</h3> <p>该模式中，IGFS作为基本的独立分布式内存文件系统，不会使用二级文件系统。</p> <h3 id="_2-5-2-proxy模式"><a href="#_2-5-2-proxy模式" aria-hidden="true" class="header-anchor">#</a> 2.5.2.PROXY模式</h3> <p>IGFS对于工作于PROXY模式的路径的操作是受限的，在这些路径上的任何操作都会抛出异常。</p> <h3 id="_2-5-3-dual-sync模式"><a href="#_2-5-3-dual-sync模式" aria-hidden="true" class="header-anchor">#</a> 2.5.3.DUAL_SYNC模式</h3> <p>该模式中，当数据被请求并且还没有缓存在内存中时，IGFS会在二级文件系统中进行同步地通读，当数据在IGFS中被更新/创建时对其进行同步地通写。实际上，该模式下IGFS是在二级文件系统之上作为一个智能缓存层的。</p> <h3 id="_2-5-4-dual-async模式"><a href="#_2-5-4-dual-async模式" aria-hidden="true" class="header-anchor">#</a> 2.5.4.DUAL_ASYNC模式</h3> <p>与<code>DUAL_SYNC</code>相同，但是对于二级文件系统的读写是异步方式执行的。
在IGFS更新和二级文件系统更新之间存在一个滞后，但是这个模式下更新的性能显著好于<code>DUAL_SYNC</code>模式。</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间：: </span> <span class="time">9/20/2018, 10:45:26 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/doc/spark/" class="prev router-link-active">
          1.介绍
        </a></span> <span class="next"><a href="/doc/spark/HadoopAccelerator.html">
          3.Hadoop加速器
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/36.f5c48e7c.js" defer></script><script src="/assets/js/app.81e98b9b.js" defer></script>
  </body>
</html>
