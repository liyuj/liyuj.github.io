<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1.基本概念 | Apache Ignite中文站</title>
    <meta name="description" content="Ignite内存计算平台的中文文档及相关资料">
    <link rel="shortcut icon" type="image/x-icon" href="https://ignite.apache.org/favicon.ico">
  <script src="https://hm.baidu.com/hm.js?03f40be28ff9a31fd798fd6b9dac0946"></script>
    
    <link rel="preload" href="/assets/css/0.styles.f86987ee.css" as="style"><link rel="preload" href="/assets/js/app.e2badc4a.js" as="script"><link rel="preload" href="/assets/js/92.bae3e01d.js" as="script"><link rel="prefetch" href="/assets/js/10.b12cb8d8.js"><link rel="prefetch" href="/assets/js/100.225ae59e.js"><link rel="prefetch" href="/assets/js/101.3d1d9c0e.js"><link rel="prefetch" href="/assets/js/102.5db29170.js"><link rel="prefetch" href="/assets/js/103.3d1097d7.js"><link rel="prefetch" href="/assets/js/104.828d2fa8.js"><link rel="prefetch" href="/assets/js/105.e6354228.js"><link rel="prefetch" href="/assets/js/106.f2269f41.js"><link rel="prefetch" href="/assets/js/107.30861358.js"><link rel="prefetch" href="/assets/js/108.212983a4.js"><link rel="prefetch" href="/assets/js/109.91290dee.js"><link rel="prefetch" href="/assets/js/11.dabb21a0.js"><link rel="prefetch" href="/assets/js/110.5088898f.js"><link rel="prefetch" href="/assets/js/111.9e62e706.js"><link rel="prefetch" href="/assets/js/112.2da18e84.js"><link rel="prefetch" href="/assets/js/113.4687a1d0.js"><link rel="prefetch" href="/assets/js/114.0bb264f0.js"><link rel="prefetch" href="/assets/js/115.31caa61f.js"><link rel="prefetch" href="/assets/js/116.cc125451.js"><link rel="prefetch" href="/assets/js/12.52d96ec8.js"><link rel="prefetch" href="/assets/js/13.d47b94ec.js"><link rel="prefetch" href="/assets/js/14.0d866a30.js"><link rel="prefetch" href="/assets/js/15.5ceadf39.js"><link rel="prefetch" href="/assets/js/16.a8b4d947.js"><link rel="prefetch" href="/assets/js/17.9aab6fea.js"><link rel="prefetch" href="/assets/js/18.1da2a72f.js"><link rel="prefetch" href="/assets/js/19.6a50942b.js"><link rel="prefetch" href="/assets/js/2.a45df984.js"><link rel="prefetch" href="/assets/js/20.268dfc85.js"><link rel="prefetch" href="/assets/js/21.502ebf07.js"><link rel="prefetch" href="/assets/js/22.663ba60c.js"><link rel="prefetch" href="/assets/js/23.eb19fc0a.js"><link rel="prefetch" href="/assets/js/24.414d290c.js"><link rel="prefetch" href="/assets/js/25.8c0fdfbf.js"><link rel="prefetch" href="/assets/js/26.c1c830a4.js"><link rel="prefetch" href="/assets/js/27.a6620dde.js"><link rel="prefetch" href="/assets/js/28.7dbabcc3.js"><link rel="prefetch" href="/assets/js/29.9e7f749c.js"><link rel="prefetch" href="/assets/js/3.ec2e51de.js"><link rel="prefetch" href="/assets/js/30.5db678a2.js"><link rel="prefetch" href="/assets/js/31.22f99309.js"><link rel="prefetch" href="/assets/js/32.4ede0800.js"><link rel="prefetch" href="/assets/js/33.6853f16e.js"><link rel="prefetch" href="/assets/js/34.bb5ab306.js"><link rel="prefetch" href="/assets/js/35.6cad7042.js"><link rel="prefetch" href="/assets/js/36.56b12ea2.js"><link rel="prefetch" href="/assets/js/37.bf8dea85.js"><link rel="prefetch" href="/assets/js/38.29dd0ab1.js"><link rel="prefetch" href="/assets/js/39.0826d231.js"><link rel="prefetch" href="/assets/js/4.608085ac.js"><link rel="prefetch" href="/assets/js/40.27affca7.js"><link rel="prefetch" href="/assets/js/41.a8130cb0.js"><link rel="prefetch" href="/assets/js/42.39b0920b.js"><link rel="prefetch" href="/assets/js/43.d718a3ea.js"><link rel="prefetch" href="/assets/js/44.18472d27.js"><link rel="prefetch" href="/assets/js/45.1d5dbc8e.js"><link rel="prefetch" href="/assets/js/46.125cf4e5.js"><link rel="prefetch" href="/assets/js/47.06ff4bc3.js"><link rel="prefetch" href="/assets/js/48.59537184.js"><link rel="prefetch" href="/assets/js/49.87b0a697.js"><link rel="prefetch" href="/assets/js/5.5e39ab41.js"><link rel="prefetch" href="/assets/js/50.f94cf537.js"><link rel="prefetch" href="/assets/js/51.d791066f.js"><link rel="prefetch" href="/assets/js/52.a6ab9615.js"><link rel="prefetch" href="/assets/js/53.4625efd8.js"><link rel="prefetch" href="/assets/js/54.426662a1.js"><link rel="prefetch" href="/assets/js/55.5cd41f78.js"><link rel="prefetch" href="/assets/js/56.ca8c0f02.js"><link rel="prefetch" href="/assets/js/57.b79aa9c1.js"><link rel="prefetch" href="/assets/js/58.6ba555a4.js"><link rel="prefetch" href="/assets/js/59.ab2e9847.js"><link rel="prefetch" href="/assets/js/6.9baf9f46.js"><link rel="prefetch" href="/assets/js/60.1222f8b7.js"><link rel="prefetch" href="/assets/js/61.e82653a6.js"><link rel="prefetch" href="/assets/js/62.09e09e38.js"><link rel="prefetch" href="/assets/js/63.64de3785.js"><link rel="prefetch" href="/assets/js/64.deec8f36.js"><link rel="prefetch" href="/assets/js/65.87e3039b.js"><link rel="prefetch" href="/assets/js/66.35b3105d.js"><link rel="prefetch" href="/assets/js/67.3bf54193.js"><link rel="prefetch" href="/assets/js/68.bdf743ed.js"><link rel="prefetch" href="/assets/js/69.60f8a682.js"><link rel="prefetch" href="/assets/js/7.517fbc90.js"><link rel="prefetch" href="/assets/js/70.5c4dca9f.js"><link rel="prefetch" href="/assets/js/71.6049a210.js"><link rel="prefetch" href="/assets/js/72.c5da4db6.js"><link rel="prefetch" href="/assets/js/73.d335e9d0.js"><link rel="prefetch" href="/assets/js/74.d9071fb1.js"><link rel="prefetch" href="/assets/js/75.112bd8dd.js"><link rel="prefetch" href="/assets/js/76.40e98982.js"><link rel="prefetch" href="/assets/js/77.03ab8249.js"><link rel="prefetch" href="/assets/js/78.586cd1e2.js"><link rel="prefetch" href="/assets/js/79.97ad7d0d.js"><link rel="prefetch" href="/assets/js/8.dd9c12d8.js"><link rel="prefetch" href="/assets/js/80.3e20ad15.js"><link rel="prefetch" href="/assets/js/81.a2935052.js"><link rel="prefetch" href="/assets/js/82.5dc37cac.js"><link rel="prefetch" href="/assets/js/83.209878ad.js"><link rel="prefetch" href="/assets/js/84.62bfff95.js"><link rel="prefetch" href="/assets/js/85.96502956.js"><link rel="prefetch" href="/assets/js/86.82d41a74.js"><link rel="prefetch" href="/assets/js/87.68584255.js"><link rel="prefetch" href="/assets/js/88.9de05e12.js"><link rel="prefetch" href="/assets/js/89.df21a5fc.js"><link rel="prefetch" href="/assets/js/9.363964e7.js"><link rel="prefetch" href="/assets/js/90.81cc12a0.js"><link rel="prefetch" href="/assets/js/91.4769c1ad.js"><link rel="prefetch" href="/assets/js/93.4d0578dd.js"><link rel="prefetch" href="/assets/js/94.654ca043.js"><link rel="prefetch" href="/assets/js/95.4c6083dd.js"><link rel="prefetch" href="/assets/js/96.c4465b47.js"><link rel="prefetch" href="/assets/js/97.e0f53934.js"><link rel="prefetch" href="/assets/js/98.ca22f375.js"><link rel="prefetch" href="/assets/js/99.eda54b7e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f86987ee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Apache Ignite中文站</span></a> <div class="links" style="max-width:nullpx;"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link router-link-exact-active router-link-active">Java</a></div><div class="nav-item"><a href="/doc/cpp/" class="nav-link">C++</a></div><div class="nav-item"><a href="/doc/sql/" class="nav-link">SQL</a></div><div class="nav-item"><a href="/doc/integration/" class="nav-link">集成</a></div><div class="nav-item"><a href="/doc/spark/" class="nav-link">Ignite&amp;Spark</a></div><div class="nav-item"><a href="/doc/tools/" class="nav-link">工具</a></div><div class="nav-item"><a href="/doc/gridgain/" class="nav-link">商业版</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/confluent/" class="nav-link">Confluent平台</a></div><div class="nav-item"><a href="https://www.zybuluo.com/liyuj/note/230739" target="_blank" rel="noopener noreferrer" class="nav-link external">
  历史版本
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">最新版本</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/java/" class="nav-link router-link-exact-active router-link-active">2.7.0</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/" class="nav-link">2.6.0</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link router-link-exact-active router-link-active">Java</a></div><div class="nav-item"><a href="/doc/cpp/" class="nav-link">C++</a></div><div class="nav-item"><a href="/doc/sql/" class="nav-link">SQL</a></div><div class="nav-item"><a href="/doc/integration/" class="nav-link">集成</a></div><div class="nav-item"><a href="/doc/spark/" class="nav-link">Ignite&amp;Spark</a></div><div class="nav-item"><a href="/doc/tools/" class="nav-link">工具</a></div><div class="nav-item"><a href="/doc/gridgain/" class="nav-link">商业版</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/confluent/" class="nav-link">Confluent平台</a></div><div class="nav-item"><a href="https://www.zybuluo.com/liyuj/note/230739" target="_blank" rel="noopener noreferrer" class="nav-link external">
  历史版本
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">最新版本</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/java/" class="nav-link router-link-exact-active router-link-active">2.7.0</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/" class="nav-link">2.6.0</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/doc/java/" class="active sidebar-link">1.基本概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/#_1-1-ignite是什么？" class="sidebar-link">1.1.Ignite是什么？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/#_1-1-1-固化内存" class="sidebar-link">1.1.1.固化内存</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-1-2-ignite持久化" class="sidebar-link">1.1.2.Ignite持久化</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-1-3-acid兼容" class="sidebar-link">1.1.3.ACID兼容</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-1-4-完整的sql支持" class="sidebar-link">1.1.4.完整的SQL支持</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-1-5-键-值" class="sidebar-link">1.1.5.键-值</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-1-6-并置处理" class="sidebar-link">1.1.6.并置处理</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-1-7-可扩展性和持久性" class="sidebar-link">1.1.7.可扩展性和持久性</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-2-ignite定位" class="sidebar-link">1.2.Ignite定位</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-3-入门" class="sidebar-link">1.3.入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/#_1-3-1-要求" class="sidebar-link">1.3.1.要求</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-3-2-启动第一个ignite集群" class="sidebar-link">1.3.2.启动第一个Ignite集群</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-3-3-使用maven" class="sidebar-link">1.3.3.使用Maven</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-3-4-第一个sql应用" class="sidebar-link">1.3.4.第一个SQL应用</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-3-5-第一个计算应用" class="sidebar-link">1.3.5.第一个计算应用</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-3-6-第一个数据网格应用" class="sidebar-link">1.3.6.第一个数据网格应用</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-3-7-第一个服务网格应用" class="sidebar-link">1.3.7.第一个服务网格应用</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-3-8-集群管理和监控" class="sidebar-link">1.3.8.集群管理和监控</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-3-9-docker和云镜像安装" class="sidebar-link">1.3.9.Docker和云镜像安装</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-3-10-rpm-deb包安装" class="sidebar-link">1.3.10.RPM|DEB包安装</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-3-11-通过源代码构建" class="sidebar-link">1.3.11.通过源代码构建</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-3-12-在jdk9-10-11中运行ignite" class="sidebar-link">1.3.12.在JDK9/10/11中运行Ignite</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-4-maven配置" class="sidebar-link">1.4.Maven配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/#_1-4-1-摘要" class="sidebar-link">1.4.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-4-2-常规依赖" class="sidebar-link">1.4.2.常规依赖</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-4-3-导入独立模块" class="sidebar-link">1.4.3.导入独立模块</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-4-4-lgpl依赖" class="sidebar-link">1.4.4.LGPL依赖</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-5-ignite生命周期" class="sidebar-link">1.5.Ignite生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/#_1-5-1-摘要" class="sidebar-link">1.5.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-5-2-ignition类" class="sidebar-link">1.5.2.Ignition类</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-5-3-lifecyclebean" class="sidebar-link">1.5.3.LifecycleBean</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-5-4-生命周期事件类型" class="sidebar-link">1.5.4.生命周期事件类型</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-6-异步支持" class="sidebar-link">1.6.异步支持</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/#_1-6-1-摘要" class="sidebar-link">1.6.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-6-2-支持的接口" class="sidebar-link">1.6.2.支持的接口</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-6-3-监听器和future链" class="sidebar-link">1.6.3.监听器和Future链</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-7-客户端和服务端" class="sidebar-link">1.7.客户端和服务端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/#_1-7-1-摘要" class="sidebar-link">1.7.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-7-2-配置客户端和服务端" class="sidebar-link">1.7.2.配置客户端和服务端</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-7-3-创建分布式缓存" class="sidebar-link">1.7.3.创建分布式缓存</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-7-4-客户端或者服务端计算" class="sidebar-link">1.7.4.客户端或者服务端计算</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-7-5-管理慢客户端" class="sidebar-link">1.7.5.管理慢客户端</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-7-6-客户端重连" class="sidebar-link">1.7.6.客户端重连</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-7-7-客户端节点强制服务端模式" class="sidebar-link">1.7.7.客户端节点强制服务端模式</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-8-资源注入" class="sidebar-link">1.8.资源注入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/#_1-8-1-摘要" class="sidebar-link">1.8.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-8-2-基于属性和基于方法" class="sidebar-link">1.8.2.基于属性和基于方法</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-8-3-预定义的资源" class="sidebar-link">1.8.3.预定义的资源</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-9-线程池" class="sidebar-link">1.9.线程池</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/#_1-9-1-摘要" class="sidebar-link">1.9.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-9-2-系统线程池" class="sidebar-link">1.9.2.系统线程池</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-9-3-公共线程池" class="sidebar-link">1.9.3.公共线程池</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-9-4-查询线程池" class="sidebar-link">1.9.4.查询线程池</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-9-5-服务线程池" class="sidebar-link">1.9.5.服务线程池</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-9-6-平行线程池" class="sidebar-link">1.9.6.平行线程池</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-9-7-数据流处理器线程池" class="sidebar-link">1.9.7.数据流处理器线程池</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-9-8-自定义线程池" class="sidebar-link">1.9.8.自定义线程池</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-10-二进制编组器" class="sidebar-link">1.10.二进制编组器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/#_1-10-1-基本概念" class="sidebar-link">1.10.1.基本概念</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-10-2-配置二进制对象" class="sidebar-link">1.10.2.配置二进制对象</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-10-3-binaryobject缓存api" class="sidebar-link">1.10.3.BinaryObject缓存API</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-10-4-使用binaryobjectbuilder修改二进制对象" class="sidebar-link">1.10.4.使用BinaryObjectBuilder修改二进制对象</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-10-5-binaryobject类型元数据" class="sidebar-link">1.10.5.BinaryObject类型元数据</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-10-6-binaryobject和cachestore" class="sidebar-link">1.10.6.BinaryObject和CacheStore</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-10-7-二进制name映射器和二进制id映射器" class="sidebar-link">1.10.7.二进制Name映射器和二进制ID映射器</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-11-日志" class="sidebar-link">1.11.日志</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/#_1-11-1-log4j" class="sidebar-link">1.11.1.Log4j</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-11-2-log4j2" class="sidebar-link">1.11.2.Log4j2</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-11-3-jcl" class="sidebar-link">1.11.3.JCL</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-11-4-slf4j" class="sidebar-link">1.11.4.SLF4J</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-11-5-默认日志" class="sidebar-link">1.11.5.默认日志</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-12-rpm和deb包安装" class="sidebar-link">1.12.RPM和DEB包安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/java/#_1-12-1-摘要" class="sidebar-link">1.12.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-12-2-仓库的配置" class="sidebar-link">1.12.2.仓库的配置</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-12-3-ignite的安装" class="sidebar-link">1.12.3.Ignite的安装</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-12-4-将ignite作为服务" class="sidebar-link">1.12.4.将Ignite作为服务</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-12-5-将ignite作为独立进程" class="sidebar-link">1.12.5.将Ignite作为独立进程</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-12-6-在windows10-wsl中运行ignite" class="sidebar-link">1.12.6.在Windows10 WSL中运行Ignite</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-13-异常处理" class="sidebar-link">1.13.异常处理</a></li><li class="sidebar-sub-header"><a href="/doc/java/#_1-14-faq" class="sidebar-link">1.14.FAQ</a></li></ul></li><li><a href="/doc/java/Clustering.html" class="sidebar-link">2.集群化</a></li><li><a href="/doc/java/Key-ValueDataGrid.html" class="sidebar-link">3.键-值数据网格</a></li><li><a href="/doc/java/Security.html" class="sidebar-link">4.安全</a></li><li><a href="/doc/java/DataLoadingStreaming.html" class="sidebar-link">5.数据注入和流处理</a></li><li><a href="/doc/java/DistributedDataStructures.html" class="sidebar-link">6.分布式数据结构</a></li><li><a href="/doc/java/ComputeGrid.html" class="sidebar-link">7.计算网格</a></li><li><a href="/doc/java/ServiceGrid.html" class="sidebar-link">8.服务网格</a></li><li><a href="/doc/java/MessagingEvents.html" class="sidebar-link">9.消息和事件</a></li><li><a href="/doc/java/DurableMemory.html" class="sidebar-link">10.固化内存</a></li><li><a href="/doc/java/ProductionReadiness.html" class="sidebar-link">11.生产准备</a></li><li><a href="/doc/java/PlatformsProtocols.html" class="sidebar-link">12.平台和协议</a></li><li><a href="/doc/java/Plugins.html" class="sidebar-link">13.插件</a></li><li><a href="/doc/java/Deployment.html" class="sidebar-link">14.部署</a></li><li><a href="/doc/java/MachineLearning.html" class="sidebar-link">15.机器学习网格</a></li><li><a href="/doc/java/Persistence.html" class="sidebar-link">16.持久化</a></li><li><a href="/doc/java/TestsAndBenchmarking.html" class="sidebar-link">17.基准测试</a></li><li><a href="/doc/java/Metrics.html" class="sidebar-link">18.指标</a></li><li><a href="/doc/java/ThinClients.html" class="sidebar-link">19.瘦客户端</a></li><li><a href="/doc/java/KubernetesDeployment.html" class="sidebar-link">20.Kubernetes部署</a></li><li><a href="/doc/java/DeepLearning.html" class="sidebar-link">21.深度学习</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="_1-基本概念"><a href="#_1-基本概念" aria-hidden="true" class="header-anchor">#</a> 1.基本概念</h1> <h2 id="_1-1-ignite是什么？"><a href="#_1-1-ignite是什么？" aria-hidden="true" class="header-anchor">#</a> 1.1.Ignite是什么？</h2> <div class="tip custom-block"><p class="custom-block-title">Ignite是：</p> <p>一个以内存为中心的分布式数据库、缓存和处理平台，可以在PB级数据中，以内存级的速度进行事务性、分析性以及流式负载的处理。</p></div> <p><img src="https://files.readme.io/0bad3a9-ignite_architecture.png" alt></p> <h3 id="_1-1-1-固化内存"><a href="#_1-1-1-固化内存" aria-hidden="true" class="header-anchor">#</a> 1.1.1.固化内存</h3> <p>Ignite的固化内存组件不仅仅将内存作为一个缓存层，还视为一个全功能的存储层。这意味着可以按需将持久化打开或者关闭。如果持久化关闭，那么Ignite就可以作为一个分布式的<strong>内存数据库</strong>或者<strong>内存数据网格</strong>，这完全取决于使用SQL和键-值API的喜好。如果持久化打开，那么Ignite就成为一个分布式的，<strong>可水平扩展的数据库</strong>，它会保证完整的数据一致性以及集群故障的可恢复能力。</p> <h3 id="_1-1-2-ignite持久化"><a href="#_1-1-2-ignite持久化" aria-hidden="true" class="header-anchor">#</a> 1.1.2.Ignite持久化</h3> <p>Ignite的原生持久化是一个分布式的、支持ACID以及兼容SQL的磁盘存储，它可以作为一个可选的磁盘层与Ignite的固化内存透明地集成，然后将数据和索引存储在SSD、闪存、3D XPoint以及其它类型的非易失性存储中。</p> <p>打开Ignite的持久化之后，就不需要将所有的数据和索引保存在内存中，或者在节点或者集群重启后对数据进行预热，因为固化内存和持久化紧密耦合之后，会将其视为一个二级存储层，这意味着在内存中数据和索引的一个子集如果丢失了，固化内存会从磁盘上进行获取。</p> <h3 id="_1-1-3-acid兼容"><a href="#_1-1-3-acid兼容" aria-hidden="true" class="header-anchor">#</a> 1.1.3.ACID兼容</h3> <p>存储在Ignite中的数据，在内存和磁盘上是同时支持ACID的，使Ignite成为一个<strong>强一致</strong>的系统，Ignite可以在整个拓扑的多台服务器上保持事务。</p> <h3 id="_1-1-4-完整的sql支持"><a href="#_1-1-4-完整的sql支持" aria-hidden="true" class="header-anchor">#</a> 1.1.4.完整的SQL支持</h3> <p>Ignite提供了完整的SQL、DDL和DML的支持，可以使用纯SQL而不用写代码与Ignite进行交互，这意味着只使用SQL就可以创建表和索引，以及插入、更新和查询数据。有这个完整的SQL支持，Ignite就可以作为一种<strong>分布式SQL数据库</strong>。</p> <h3 id="_1-1-5-键-值"><a href="#_1-1-5-键-值" aria-hidden="true" class="header-anchor">#</a> 1.1.5.键-值</h3> <p>Ignite的内存数据网格组件是一个完整的事务型<strong>分布式键值存储</strong>，它可以在有几百台服务器的集群上进行水平扩展。在打开持久化时，Ignite可以存储比内存容量更大的数据，并且在整个集群重启之后仍然可用。</p> <h3 id="_1-1-6-并置处理"><a href="#_1-1-6-并置处理" aria-hidden="true" class="header-anchor">#</a> 1.1.6.并置处理</h3> <p>大多数传统数据库是以客户机-服务器的模式运行的，这意味着数据必须发给客户端进行处理，这个方式需要在客户端和服务端之间进行大量的数据移动，通常来说不可扩展。而Ignite使用了另外一种方式，可以将轻量级的计算发给数据，即数据的<strong>并置</strong>计算，从结果上来说，Ignite扩展性更好，并且使数据移动最小化。</p> <h3 id="_1-1-7-可扩展性和持久性"><a href="#_1-1-7-可扩展性和持久性" aria-hidden="true" class="header-anchor">#</a> 1.1.7.可扩展性和持久性</h3> <p>Ignite是一个弹性的、可水平扩展的分布式系统，它支持按需地添加和删除节点，Ignite还可以存储数据的多个副本，这样可以使集群从部分故障中恢复。如果打开了持久化，那么Ignite中存储的数据可以在集群的完全故障中恢复。Ignite集群重启会非常快，因为数据从磁盘上获取，瞬间就具有了可操作性。从结果上来说，数据不需要在处理之前预加载到内存中，而Ignite会缓慢地恢复内存级的性能。</p> <h2 id="_1-2-ignite定位"><a href="#_1-2-ignite定位" aria-hidden="true" class="header-anchor">#</a> 1.2.Ignite定位</h2> <p><strong>Ignite是不是持久化或者纯内存存储？</strong></p> <p><strong>都是</strong>，Ignite的原生持久化可以打开，也可以关闭。这使得Ignite可以存储比可用内存容量更大的数据集。也就是说，可以只在内存中存储较少的操作性数据集，然后将不适合存储在内存中的较大数据集存储在磁盘上，即为了提高性能将内存作为一个缓存层。</p> <p><strong>Ignite是不是内存数据库（IMDB）？</strong></p> <p><strong>是</strong>，虽然Ignite的<em>固化内存</em>在内存和磁盘中都工作得很好，但是磁盘持久化是可以关闭的，使Ignite成为一个支持SQL以及分布式关联的<em>内存数据库</em>。</p> <p><strong>Ignite是不是内存数据网格（IMDG）？</strong></p> <p><strong>是</strong>，Ignite是一个全功能的数据网格，它既可以用于纯内存模式，也可以带有Ignite的原生持久化，它也可以与任何第三方数据库集成，包括RDBMS和NoSQL。</p> <p><strong>Ignite是不是一个分布式缓存？</strong></p> <p><strong>是</strong>，如果关闭原生持久化，Ignite就会成为一个分布式缓存，Ignite实现了JCache规范（JSR107），并且提供了比规范要求更多的功能，包括分区和复制模式、分布式ACID事务、SQL查询以及原生持久化等。</p> <p><strong>Ignite是不是分布式数据库？</strong></p> <p><strong>是</strong>，在整个集群的多个节点中，Ignite中的数据要么是<em>分区模式</em>的，要么是<em>复制模式</em>的，这给系统带来了伸缩性，增加了系统的弹性。Ignite可以自动控制数据如何分区，同时，开发者也可以插入自定义的分布（关系）函数，以及为了提高效率将部分数据并置在一起。</p> <p><strong>Ignite是不是SQL数据库？</strong></p> <p><strong>不完整</strong>，尽管Ignite的目标是和其它的关系型SQL数据库具有类似的行为，但是在处理约束和索引方面还是有不同的。Ignite支持<em>一级</em>和<em>二级</em>索引，但是只有一级索引支持<em>唯一性</em>，Ignite还不支持<em>外键</em>约束。</p> <p>总体来说，Ignite作为约束不支持任何会导致集群广播消息的更新以及显著降低系统性能和可伸缩性的操作。</p> <p><strong>Ignite是不是一个NoSQL数据库?</strong></p> <p><strong>不完全</strong>，和其它NoSQL数据库一样，Ignite支持高可用和水平扩展，但是，和其它的NoSQL数据库不同，Ignite支持SQL和ACID。</p> <p><strong>Ignite是不是事务型数据库？</strong></p> <p><strong>不完整</strong>，ACID事务是支持的，但是仅仅在键-值API级别，Ignite还支持<em>跨分区的事务</em>，这意味着事务可以跨越不同服务器不同分区中的键。</p> <p>Ignite在2.7版本中，通过MVCC技术，实现了包括SQL事务在内的全事务支持，不过目前还处于测试阶段。</p> <p><strong>Ignite是不是一个多模式数据库？</strong></p> <p><strong>是</strong>，Ignite的数据建模和访问，同时支持键值和SQL，另外，Ignite还为在分布式数据上的计算处理，提供了强大的API。</p> <p><strong>Ignite是不是键-值存储？</strong></p> <p><strong>是</strong>，Ignite提供了丰富的键-值API，兼容于JCache (JSR-107)，并且支持Java，C++和.NET。</p> <p><strong>固化内存是什么？</strong></p> <p>Ignite的<em>固化内存</em>架构使得Ignite可以将内存计算延伸至磁盘，它基于一个页面化的堆外内存分配器，它通过预写日志（WAL）的持久化来对数据进行固化，当持久化禁用之后，固化内存就会变成一个纯粹的内存存储。</p> <p><strong>并置处理是什么？</strong></p> <p>Ignite是一个分布式系统，因此，有能力将数据和数据以及数据和计算进行并置就变得非常重要，这会避免分布式数据噪声。当执行分布式SQL关联时数据的并置就变得非常的重要。Ignite还支持将用户的逻辑（函数，lambda等）直接发到数据所在的节点然后在本地进行数据的运算。</p> <h2 id="_1-3-入门"><a href="#_1-3-入门" aria-hidden="true" class="header-anchor">#</a> 1.3.入门</h2> <h3 id="_1-3-1-要求"><a href="#_1-3-1-要求" aria-hidden="true" class="header-anchor">#</a> 1.3.1.要求</h3> <p>Apache Ignite官方在如下环境中进行了测试：</p> <ul><li>JDK：Oracle JDK8及以上，Open JDK8及以上，IBM JDK8及以上，如果使用了JDK9或之后的版本，具体可以看下面的<a href="#_1-3-12-%E5%9C%A8jdk9-10-11%E4%B8%AD%E8%BF%90%E8%A1%8Cignite">在JDK9及以后版本中运行Ignite</a>章节；</li> <li>OS：Linux（任何版本），Mac OS X（10.6及以上），Windows(XP及以上)，Windows Server（2008及以上），Oracle Solaris；</li> <li>网络：没有限制（建议10G）；</li> <li>架构：x86，x64，SPARC，PowerPC</li></ul> <h3 id="_1-3-2-启动第一个ignite集群"><a href="#_1-3-2-启动第一个ignite集群" aria-hidden="true" class="header-anchor">#</a> 1.3.2.启动第一个Ignite集群</h3> <p><strong>二进制发行版</strong></p> <p>可以从下面的步骤开始：</p> <ul><li>从<a href="https://ignite.apache.org/" target="_self" rel="noopener noreferrer">官网</a>下载zip格式压缩包；</li> <li>解压到系统中的一个安装文件夹；</li> <li>（可选）配置<code>IGNITE_HOME</code>环境变量，指向安装文件夹，确保路径不以<code>/</code>结尾。</li></ul> <div class="tip custom-block"><p class="custom-block-title">其它的安装选项</p> <p>除了二进制发行版，Ignite还支持源代码安装、docker、云镜像以及RPM格式，具体可以看下面的说明。
在应用中，建议使用maven，后面会介绍。</p></div> <p>下一步，使用命令行接口可以启动第一个Ignite集群，如下所示，可以使用默认的或者也可以加上自定义的配置文件，可以启动任意多个节点，它们之间会自动发现。</p> <p><strong>使用默认的配置</strong></p> <p>使用默认的配置启动集群，打开命令行，转到<code>IGNITE_HOME</code>（Ignite安装文件夹），然后输入：</p> <p>Linux：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ bin/ignite.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Windows：</p> <div class="language-batch line-numbers-mode"><pre class="language-batch"><code>$ bin\ignite.bat
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输出大致如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[02:49:12] Ignite node started OK (id=ab5d18a6)
[02:49:12] Topology snapshot [ver=1, nodes=1, CPUs=8, heap=1.0GB]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>ignite.sh</code>会使用<code>config/default-config.xml</code>这个默认配置文件启动节点。</p> <p><strong>传入配置文件</strong></p> <p>如果要使用一个定制配置文件，可以将其作为参数传给<code>ignite.sh/bat</code>，如下：</p> <p>Linux：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ bin/ignite.sh examples/config/example-ignite.xml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Windows：</p> <div class="language-batch line-numbers-mode"><pre class="language-batch"><code>$ bin\ignite.bat examples\config\example-ignite.xml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>配置文件的路径，可以是绝对路径，也可以是相对于<code>IGNITE_HOME</code>（Ignite安装文件夹）的相对路径，也可以是类路径中的<code>META-INF</code>文件夹。</p> <div class="tip custom-block"><p class="custom-block-title">交互模式</p> <p>如果要使用交互模式选择一个配置文件，传入<code>-i</code>参数即可，就是<code>ignite.sh -i</code>。</p></div> <p>好，这样就成功了！</p> <h3 id="_1-3-3-使用maven"><a href="#_1-3-3-使用maven" aria-hidden="true" class="header-anchor">#</a> 1.3.3.使用Maven</h3> <p>下一步是将Ignite嵌入自己的应用，Java中的最简单的入门方式是使用Maven依赖系统。</p> <p>Ignite中只有<code>ignite-core</code>模块是必须的，一般来说，要使用基于Spring的xml配置，还需要<code>ignite-spring</code>模块，要使用SQL查询，还需要<code>ignite-indexing</code>模块。</p> <p>下面中的<code>${ignite-version}</code>需要替换为实际使用的版本。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-indexing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Maven配置</p> <p>关于如何包含个别的ignite maven模块的更多信息，可以参考<a href="#_1-4-maven%E9%85%8D%E7%BD%AE">Maven设置</a>章节。</p></div> <p>每个发布版中，都会有一个<a href="https://github.com/apache/ignite/tree/master/examples" target="_self" rel="noopener noreferrer">示例工程</a>，在开发环境中打开这个工程，然后转到<code>{ignite_version}/examples</code>文件夹找到<code>pom.xml</code>文件，依赖引入之后，各种示例就可以演示Ignite的各种功能了。</p> <h3 id="_1-3-4-第一个sql应用"><a href="#_1-3-4-第一个sql应用" aria-hidden="true" class="header-anchor">#</a> 1.3.4.第一个SQL应用</h3> <p>下面会创建两张表及其索引，分别为<code>City</code>表和<code>Person</code>表，分别表示居住在城市中的人，并且城市中会有很多的人，通过WITH子句然后指定<code>affinityKey=city_id</code>，可以将人对象和其居住的城市对象并置在一起。</p> <p>通过命令行或者嵌入式模式启动Ignite集群节点后，可以通过下面的语句创建SQL模式：</p> <p>SQL：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> City <span class="token punctuation">(</span>
  id LONG <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> name <span class="token keyword">VARCHAR</span><span class="token punctuation">)</span>
  <span class="token keyword">WITH</span> <span class="token string">&quot;template=replicated&quot;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Person <span class="token punctuation">(</span>
  id LONG<span class="token punctuation">,</span> name <span class="token keyword">VARCHAR</span><span class="token punctuation">,</span> city_id LONG<span class="token punctuation">,</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">,</span> city_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">WITH</span> <span class="token string">&quot;backups=1, affinityKey=city_id&quot;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_city_name <span class="token keyword">ON</span> City <span class="token punctuation">(</span>name<span class="token punctuation">)</span>

<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_person_name <span class="token keyword">ON</span> Person <span class="token punctuation">(</span>name<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>JDBC：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Register JDBC driver.</span>
Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;org.apache.ignite.IgniteJdbcThinDriver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Open JDBC connection.</span>
Connection conn <span class="token operator">=</span> DriverManager<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:ignite:thin://127.0.0.1/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create database tables.</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span>Statement stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Create table based on REPLICATED template.</span>
    stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token string">&quot;CREATE TABLE City (&quot;</span> <span class="token operator">+</span> 
    <span class="token string">&quot; id LONG PRIMARY KEY, name VARCHAR) &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot; WITH \&quot;template=replicated\&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Create table based on PARTITIONED template with one backup.</span>
    stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token string">&quot;CREATE TABLE Person (&quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot; id LONG, name VARCHAR, city_id LONG, &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot; PRIMARY KEY (id, city_id)) &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot; WITH \&quot;backups=1, affinityKey=city_id\&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token comment">// Create an index on the City table.</span>
    stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token string">&quot;CREATE INDEX idx_city_name ON City (name)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Create an index on the Person table.</span>
    stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token string">&quot;CREATE INDEX idx_person_name ON Person (name)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>ODBC：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>SQLHSTMT stmt<span class="token punctuation">;</span>

<span class="token comment">// Allocate a statement handle.</span>
<span class="token function">SQLAllocHandle</span><span class="token punctuation">(</span>SQL_HANDLE_STMT<span class="token punctuation">,</span> dbc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create table based on REPLICATED template.</span>
SQLCHAR query1<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;CREATE TABLE City (&quot;</span>
  <span class="token string">&quot;id LONG PRIMARY KEY, name VARCHAR) &quot;</span>
  <span class="token string">&quot;WITH \&quot;template=replicated\&quot;&quot;</span><span class="token punctuation">;</span>
SQLSMALLINT queryLen1 <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>SQLSMALLINT<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>query1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">SQLExecDirect</span><span class="token punctuation">(</span>stmt<span class="token punctuation">,</span> query<span class="token punctuation">,</span> queryLen<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create table based on PARTITIONED template with one backup.</span>
SQLCHAR query2<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;CREATE TABLE Person ( &quot;</span>
    <span class="token string">&quot;id LONG, name VARCHAR, city_id LONG &quot;</span>
    <span class="token string">&quot;PRIMARY KEY (id, city_id)) &quot;</span>
    <span class="token string">&quot;WITH \&quot;backups=1, affinityKey=city_id\&quot;&quot;</span><span class="token punctuation">;</span>
SQLSMALLINT queryLen2 <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>SQLSMALLINT<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>query2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">SQLExecDirect</span><span class="token punctuation">(</span>stmt<span class="token punctuation">,</span> query<span class="token punctuation">,</span> queryLen<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create an index on the City table.</span>
SQLCHAR query3<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;CREATE INDEX idx_city_name ON City (name)&quot;</span><span class="token punctuation">;</span>

SQLSMALLINT queryLen3 <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>SQLSMALLINT<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>query3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

SQLRETURN ret <span class="token operator">=</span> <span class="token function">SQLExecDirect</span><span class="token punctuation">(</span>stmt<span class="token punctuation">,</span> query3<span class="token punctuation">,</span> queryLen3<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create an index on the Person table.</span>
SQLCHAR query4<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;CREATE INDEX idx_person_name ON Person (name)&quot;</span><span class="token punctuation">;</span>

SQLSMALLINT queryLen4 <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>SQLSMALLINT<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>query4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ret <span class="token operator">=</span> <span class="token function">SQLExecDirect</span><span class="token punctuation">(</span>stmt<span class="token punctuation">,</span> query4<span class="token punctuation">,</span> queryLen4<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>下一步，需要往两个表中注入一些数据，比如：</p> <p>SQL：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> City <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Forest Hill'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> City <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Denver'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> City <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'St. Petersburg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Person <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> city_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'John Doe'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Person <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> city_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Jane Roe'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Person <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> city_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'Mary Major'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Person <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> city_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'Richard Miles'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>JDBC：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Register JDBC driver</span>
Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;org.apache.ignite.IgniteJdbcThinDriver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Open JDBC connection</span>
Connection conn <span class="token operator">=</span> DriverManager<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:ignite:thin://127.0.0.1/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Populate City table</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span>PreparedStatement stmt <span class="token operator">=</span>
conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO City (id, name) VALUES (?, ?)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    stmt<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;Forest Hill&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    stmt<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;Denver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    stmt<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;St. Petersburg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Populate Person table</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span>PreparedStatement stmt <span class="token operator">=</span>
conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO Person (id, name, city_id) VALUES (?, ?, ?)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    stmt<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    stmt<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;Jane Roe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    stmt<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;Mary Major&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    stmt<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;Richard Miles&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>ODBC：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>SQLHSTMT stmt<span class="token punctuation">;</span>

<span class="token comment">// Allocate a statement handle.</span>
<span class="token function">SQLAllocHandle</span><span class="token punctuation">(</span>SQL_HANDLE_STMT<span class="token punctuation">,</span> dbc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Populate City table.</span>
SQLCHAR query1<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;INSERT INTO City (id, name) VALUES (?, ?)&quot;</span><span class="token punctuation">;</span>

SQLRETURN ret <span class="token operator">=</span> <span class="token function">SQLPrepare</span><span class="token punctuation">(</span>stmt<span class="token punctuation">,</span> query1<span class="token punctuation">,</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>SQLSMALLINT<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>query1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">int32_t</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token function">strncpy</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;Forest Hill&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ret <span class="token operator">=</span> <span class="token function">SQLExecute</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>

key <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token function">strncpy</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;Denver&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ret <span class="token operator">=</span> <span class="token function">SQLExecute</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>

key <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token function">strncpy</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;Denver&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ret <span class="token operator">=</span> <span class="token function">SQLExecute</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Populate Person table</span>
SQLCHAR query2<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;INSERT INTO Person (id, name, city_id) VALUES (?, ?, ?)&quot;</span><span class="token punctuation">;</span>

ret <span class="token operator">=</span> <span class="token function">SQLPrepare</span><span class="token punctuation">(</span>stmt<span class="token punctuation">,</span> query2<span class="token punctuation">,</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>SQLSMALLINT<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>query2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token function">strncpy</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int32_t</span> city_id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
ret <span class="token operator">=</span> <span class="token function">SQLExecute</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>

key <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token function">strncpy</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;Jane Roe&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
city_id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
ret <span class="token operator">=</span> <span class="token function">SQLExecute</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>

key <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token function">strncpy</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;Mary Major&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
city_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
ret <span class="token operator">=</span> <span class="token function">SQLExecute</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>

key <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token function">strncpy</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&quot;Richard Miles&quot;</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
city_id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
ret <span class="token operator">=</span> <span class="token function">SQLExecute</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>Java API：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Connecting to the cluster.</span>
Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Getting a reference to an underlying cache created for City table above.</span>
IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">,</span> City<span class="token punctuation">&gt;</span></span> cityCache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;SQL_PUBLIC_CITY&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Getting a reference to an underlying cache created for Person table above.</span>
IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>PersonKey<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> personCache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;SQL_PUBLIC_PERSON&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Inserting entries into City.</span>
SqlFieldsQuery query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span>
    <span class="token string">&quot;INSERT INTO City (id, name) VALUES (?, ?)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cityCache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Forest Hill&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cityCache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;Denver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cityCache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;St. Petersburg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Inserting entries into Person.</span>
query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span>
    <span class="token string">&quot;INSERT INTO Person (id, name, city_id) VALUES (?, ?, ?)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

personCache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
personCache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;Jane Roe&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
personCache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;Mary Major&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
personCache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;Richard Miles&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>下面就可以查询数据了，可以查询人及其居住的城市，这会进行两个表的关联：</p> <p>SQL：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> p<span class="token punctuation">.</span>name<span class="token punctuation">,</span> c<span class="token punctuation">.</span>name
<span class="token keyword">FROM</span> Person p<span class="token punctuation">,</span> City c
<span class="token keyword">WHERE</span> p<span class="token punctuation">.</span>city_id <span class="token operator">=</span> c<span class="token punctuation">.</span>id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>JDBC：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Register JDBC driver</span>
Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;org.apache.ignite.IgniteJdbcThinDriver&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Open JDBC connection</span>
Connection conn <span class="token operator">=</span> DriverManager<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:ignite:thin://127.0.0.1/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get data</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span>Statement stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span>ResultSet rs <span class="token operator">=</span>
    stmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT p.name, c.name &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot; FROM Person p, City c &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot; WHERE p.city_id = c.id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>ODBC：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>SQLHSTMT stmt<span class="token punctuation">;</span>

<span class="token comment">// Allocate a statement handle</span>
<span class="token function">SQLAllocHandle</span><span class="token punctuation">(</span>SQL_HANDLE_STMT<span class="token punctuation">,</span> dbc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get data using an SQL join sample.</span>
SQLCHAR query<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;SELECT p.name, c.name &quot;</span>
  <span class="token string">&quot;FROM Person p, City c &quot;</span>
  <span class="token string">&quot;WHERE p.city_id = c.id&quot;</span><span class="token punctuation">;</span>

SQLSMALLINT queryLen <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>SQLSMALLINT<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

SQLRETURN ret <span class="token operator">=</span> <span class="token function">SQLExecDirect</span><span class="token punctuation">(</span>stmt<span class="token punctuation">,</span> query<span class="token punctuation">,</span> queryLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Java API：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Connecting to the cluster.</span>
Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Getting a reference to an underlying cache created for City table above.</span>
IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">,</span> City<span class="token punctuation">&gt;</span></span> cityCache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;SQL_PUBLIC_CITY&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Querying data from the cluster using a distributed JOIN.</span>
SqlFieldsQuery query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT p.name, c.name &quot;</span> <span class="token operator">+</span>
    <span class="token string">&quot; FROM Person p, City c WHERE p.city_id = c.id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

FieldsQueryCursor<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> cursor <span class="token operator">=</span> cityCache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

Iterator<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> iterator <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    List<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> row <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>row<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> row<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>这会产生如下的输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Mary Major, Forest Hill
Jane Roe, Denver
Richard Miles, Denver
John Doe, St. Petersburg
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_1-3-5-第一个计算应用"><a href="#_1-3-5-第一个计算应用" aria-hidden="true" class="header-anchor">#</a> 1.3.5.第一个计算应用</h3> <p>作为第一个计算应用，它会计算一句话中非空白字符的字符数量。作为一个示例，首先将一句话分割为多个单词，然后通过计算作业来计算每一个独立单词中的字符数量。最后，我们将从每个作业获得的结果简单相加来获得整个的数量。</p> <p>Java8：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">&quot;examples/config/example-ignite.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Collection<span class="token operator">&lt;</span>IgniteCallable<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> calls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Iterate through all the words in the sentence and create Callable jobs.</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> String word <span class="token operator">:</span> <span class="token string">&quot;Count characters using callable&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    calls<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>word<span class="token operator">:</span><span class="token operator">:</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Execute collection of Callables on the grid.</span>
  Collection<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">&gt;</span></span> res <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>calls<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Add up all the results.</span>
  <span class="token keyword">int</span> sum <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span>Integer<span class="token operator">:</span><span class="token operator">:</span>intValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
	System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Total number of characters is '&quot;</span> <span class="token operator">+</span> sum <span class="token operator">+</span> <span class="token string">&quot;'.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Java7:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">&quot;examples/config/example-ignite.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Collection<span class="token operator">&lt;</span>IgniteCallable<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> calls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// Iterate through all the words in the sentence and create Callable jobs.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> String word <span class="token operator">:</span> <span class="token string">&quot;Count characters using callable&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        calls<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteCallable</span><span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> Integer <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
                <span class="token keyword">return</span> word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token comment">// Execute collection of Callables on the grid.</span>
    Collection<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">&gt;</span></span> res <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>calls<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 
    <span class="token comment">// Add up individual word lengths received from remote nodes.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> len <span class="token operator">:</span> res<span class="token punctuation">)</span>
        sum <span class="token operator">+=</span> len<span class="token punctuation">;</span>
 
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt; Total number of characters in the phrase is '&quot;</span> <span class="token operator">+</span> sum <span class="token operator">+</span> <span class="token string">&quot;'.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">零部署</p> <p>注意，由于Ignite的<code>零部署</code>特性，当从IDE运行上面的程序时，远程节点没有经过显式地部署，就获得了计算作业。</p></div> <p>另一个例子，创建一个应用，它会读取第一个SQL应用中保存的数据，然后在这些对象上进行一些额外的处理。</p> <p>下面会创建一个天气警报应用，假定丹佛有一个天气警报，然后需要提醒丹佛的居民为恶劣天气做好准备。</p> <p>下面是代码片段：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> cityId <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// Id for Denver</span>

<span class="token comment">// Sending the logic to a cluster node that stores Denver and its residents.</span>
ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">affinityRun</span><span class="token punctuation">(</span><span class="token string">&quot;SQL_PUBLIC_CITY&quot;</span><span class="token punctuation">,</span> cityId<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IgniteRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
  <span class="token annotation punctuation">@IgniteInstanceResource</span>
  Ignite ignite<span class="token punctuation">;</span>
  
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Getting an access to Persons cache.</span>
    IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>BinaryObject<span class="token punctuation">,</span> BinaryObject<span class="token punctuation">&gt;</span></span> people <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span>
        <span class="token string">&quot;Person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withKeepBinary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    ScanQuery<span class="token generics function"><span class="token punctuation">&lt;</span>BinaryObject<span class="token punctuation">,</span> BinaryObject<span class="token punctuation">&gt;</span></span> query <span class="token operator">=</span> 
        <span class="token keyword">new</span> <span class="token class-name">ScanQuery</span> <span class="token generics function"><span class="token punctuation">&lt;</span>BinaryObject<span class="token punctuation">,</span> BinaryObject<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">try</span> <span class="token punctuation">(</span>QueryCursor<span class="token operator">&lt;</span>Cache<span class="token punctuation">.</span>Entry<span class="token generics function"><span class="token punctuation">&lt;</span>BinaryObject<span class="token punctuation">,</span> BinaryObject<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> cursor <span class="token operator">=</span>
           people<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      
      <span class="token comment">// Iteration over the local cluster node data using the scan query.</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>Cache<span class="token punctuation">.</span>Entry<span class="token generics function"><span class="token punctuation">&lt;</span>BinaryObject<span class="token punctuation">,</span> BinaryObject<span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        BinaryObject personKey <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token comment">// Picking Denver residents only only.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>personKey<span class="token punctuation">.</span><span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">&gt;</span></span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;CITY_ID&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> cityId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            person <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
            <span class="token comment">// Sending the warning message to the person.</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>在上例中使用了<code>affinityRun()</code>方法，并且指定了<code>SQL_PUBLIC_CITY</code>缓存，<code>cityId</code>以及一个新创建的<code>IgniteRunnable()</code>，这样确保了计算被发送到丹佛及其居民所在的节点，使得可以直接在数据所在的地方执行业务逻辑，避免了昂贵的序列化可网络开销。</p> <h3 id="_1-3-6-第一个数据网格应用"><a href="#_1-3-6-第一个数据网格应用" aria-hidden="true" class="header-anchor">#</a> 1.3.6.第一个数据网格应用</h3> <p>我们再来一个小例子，它从/往分布式缓存中获取/添加数据，并且执行基本的事务。</p> <p>因为在应用中使用了缓存，要确保它是经过配置的，我们可以用Ignite自带的示例配置，它已经做了一些缓存的配置。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ bin/ignite.sh examples/config/example-cache.xml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Put和Get：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">&quot;examples/config/example-ignite.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token string">&quot;myCacheName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// Store keys in cache (values will end up on different cache nodes).</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Got [key=&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;, val=&quot;</span> <span class="token operator">+</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>原子化操作：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Put-if-absent which returns previous value.</span>
Integer oldVal <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">getAndPutIfAbsent</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token comment">// Put-if-absent which returns boolean success flag.</span>
<span class="token keyword">boolean</span> success <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span><span class="token string">&quot;World&quot;</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token comment">// Replace-if-exists operation (opposite of getAndPutIfAbsent), returns previous value.</span>
oldVal <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">getAndReplace</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Replace-if-exists operation (opposite of putIfAbsent), returns boolean success flag.</span>
success <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;World&quot;</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token comment">// Replace-if-matches operation.</span>
success <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;World&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
<span class="token comment">// Remove-if-matches operation.</span>
success <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>事务：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span>Transaction tx <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">transactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">txStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Integer hello <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hello <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
        cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;World&quot;</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    tx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>分布式锁：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Lock cache key &quot;Hello&quot;.</span>
Lock lock <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;World&quot;</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">finally</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_1-3-7-第一个服务网格应用"><a href="#_1-3-7-第一个服务网格应用" aria-hidden="true" class="header-anchor">#</a> 1.3.7.第一个服务网格应用</h3> <p>Ignite的服务网格对于在集群中部署微服务非常有用，Ignite会处理和部署的服务有关的任务的生命周期，并且提供了在应用中调用服务的简单方式。</p> <p>作为一个示例，下面会开发一个服务，它会返回一个特定城市当前的天气预报。首先，它会创建一个只有一个方法的服务接口，这个接口扩展自<code>org.apache.ignite.services.Service</code>。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ignite<span class="token punctuation">.</span>services<span class="token punctuation">.</span>Service<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">WeatherService</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * Get a current temperature for a specific city in the world.
     *
     * @param countryCode Country code (ISO 3166 country codes).
     * @param cityName City name.
     * @return Current temperature in the city in JSON format.
     * @throws Exception if an exception happened.
     */</span>
    String <span class="token function">getCurrentTemperature</span><span class="token punctuation">(</span>String countryCode<span class="token punctuation">,</span> String cityName<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> Exception<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>服务的实现会接入天气频道然后获取天气数据，代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>BufferedReader<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStreamReader<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>HttpURLConnection<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>URL<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ignite<span class="token punctuation">.</span>services<span class="token punctuation">.</span>ServiceContext<span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeatherServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">WeatherService</span> <span class="token punctuation">{</span>
    <span class="token comment">/** Weather service URL. */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String WEATHER_URL <span class="token operator">=</span> <span class="token string">&quot;http://samples.openweathermap.org/data/2.5/weather?&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">/** Sample app ID. */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String appId <span class="token operator">=</span> <span class="token string">&quot;ca7345b4a1ef8c037f7749c09fcbf808&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">/** {@inheritDoc}. */</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span>ServiceContext ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Weather Service is initialized!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/** {@inheritDoc}. */</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span>ServiceContext ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Weather Service is started!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/** {@inheritDoc}. */</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancel</span><span class="token punctuation">(</span>ServiceContext ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Weather Service is stopped!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/** {@inheritDoc}. */</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> String <span class="token function">getCurrentTemperature</span><span class="token punctuation">(</span>String cityName<span class="token punctuation">,</span>
        String countryCode<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt; Requested weather forecast [city=&quot;</span> 
            <span class="token operator">+</span> cityName <span class="token operator">+</span> <span class="token string">&quot;, countryCode=&quot;</span> <span class="token operator">+</span> countryCode <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        String connStr <span class="token operator">=</span> WEATHER_URL <span class="token operator">+</span> <span class="token string">&quot;q=&quot;</span> <span class="token operator">+</span> cityName <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span>
            <span class="token operator">+</span> countryCode <span class="token operator">+</span> <span class="token string">&quot;&amp;appid=&quot;</span> <span class="token operator">+</span> appId<span class="token punctuation">;</span>

        URL url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>connStr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        HttpURLConnection conn <span class="token operator">=</span> null<span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// Connecting to the weather service.</span>
            conn <span class="token operator">=</span> <span class="token punctuation">(</span>HttpURLConnection<span class="token punctuation">)</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            conn<span class="token punctuation">.</span><span class="token function">setRequestMethod</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Read data from the weather server.</span>
            <span class="token keyword">try</span> <span class="token punctuation">(</span>BufferedReader reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>conn<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                String line<span class="token punctuation">;</span>
                StringBuilder builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span>
                    builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>conn <span class="token operator">!=</span> null<span class="token punctuation">)</span>
                conn<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><p>最后，服务需要在集群中进行部署，然后就可以在应用端进行调用，为了简化，服务在同一个应用中进行部署和调用，如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ignite<span class="token punctuation">.</span>Ignite<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ignite<span class="token punctuation">.</span>Ignition<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceGridExample</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// Deploying a single instance of the Weather Service </span>
            <span class="token comment">// in the whole cluster.</span>
            ignite<span class="token punctuation">.</span><span class="token function">services</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deployClusterSingleton</span><span class="token punctuation">(</span><span class="token string">&quot;WeatherService&quot;</span><span class="token punctuation">,</span>
               <span class="token keyword">new</span> <span class="token class-name">WeatherServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Requesting current weather for London.</span>
            WeatherService service <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">services</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token string">&quot;WeatherService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            String forecast <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">getCurrentTemperature</span><span class="token punctuation">(</span><span class="token string">&quot;London&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;UK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Weather forecast in London:&quot;</span> <span class="token operator">+</span> forecast<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="warning custom-block"><p class="custom-block-title">零部署和服务网格</p> <p>零部署是不支持服务网格的，如果希望将上面的服务部署在通过<code>ignite.sh</code>或者<code>ignite.bat</code>文件启动的节点上，那么就需要将服务的实现打成jar包然后放在<code>{apache_ignite_version}/libs</code>文件夹中。</p></div> <h3 id="_1-3-8-集群管理和监控"><a href="#_1-3-8-集群管理和监控" aria-hidden="true" class="header-anchor">#</a> 1.3.8.集群管理和监控</h3> <p>查看数据网格的数据、以及执行其它的管理和监控操作的最简单方式是使用<a href="/doc/tools/#_1-1-ignite-web控制台">Ignite Web控制台</a>，还有就是使用Ignite的<a href="/doc/tools/VisorManagementConsole.html#_3-1-命令行接口">Visor命令行</a>工具。</p> <h3 id="_1-3-9-docker和云镜像安装"><a href="#_1-3-9-docker和云镜像安装" aria-hidden="true" class="header-anchor">#</a> 1.3.9.Docker和云镜像安装</h3> <p>最新的Ignite Docker镜像以及AWS和Google计算引擎的云镜像，可以通过Ignite的<a href="https://ignite.apache.org/download.cgi#docker" target="_self" rel="noopener noreferrer">下载页面</a>获得。</p> <h3 id="_1-3-10-rpm-deb包安装"><a href="#_1-3-10-rpm-deb包安装" aria-hidden="true" class="header-anchor">#</a> 1.3.10.RPM|DEB包安装</h3> <p>Ignite可以通过官方的<a href="#_1-12-rpm%E5%92%8Cdeb%E5%8C%85%E5%AE%89%E8%A3%85">RPM和DEB仓库</a>进行安装。</p> <h3 id="_1-3-11-通过源代码构建"><a href="#_1-3-11-通过源代码构建" aria-hidden="true" class="header-anchor">#</a> 1.3.11.通过源代码构建</h3> <p>如果下载了源代码，可以使用下面的命令构建二进制包：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Unpack the source package</span>
$ unzip -q apache-ignite-<span class="token punctuation">{</span>version<span class="token punctuation">}</span>-src.zip
$ <span class="token function">cd</span> apache-ignite-<span class="token punctuation">{</span>version<span class="token punctuation">}</span>-src
 
<span class="token comment"># Build In-Memory Data Fabric release (without LGPL dependencies)</span>
$ mvn clean package -DskipTests
 
<span class="token comment"># Build In-Memory Data Fabric release (with LGPL dependencies)</span>
$ mvn clean package -DskipTests -Prelease,lgpl
 
<span class="token comment"># Build In-Memory Hadoop Accelerator release</span>
<span class="token comment"># (optionally specify version of hadoop to use)</span>
$ mvn clean package -DskipTests -Dignite.edition<span class="token operator">=</span>hadoop <span class="token punctuation">[</span>-Dhadoop.version<span class="token operator">=</span>X.X.X<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>源码包中的DEVNOTES.txt文件，有更多的细节。</p> <h3 id="_1-3-12-在jdk9-10-11中运行ignite"><a href="#_1-3-12-在jdk9-10-11中运行ignite" aria-hidden="true" class="header-anchor">#</a> 1.3.12.在JDK9/10/11中运行Ignite</h3> <p>Ignite使用了专有的SDK API，默认不再可用。为了运行Ignite，需要给JVM传递特定的标志，以使这些API可用。</p> <p>给应用的JVM添加如下的参数：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>--add-exports=java.base/jdk.internal.misc=ALL-UNNAMED 
--add-exports=java.base/sun.nio.ch=ALL-UNNAMED 
--add-exports=java.management/com.sun.jmx.mbeanserver=ALL-UNNAMED 
--add-exports=jdk.internal.jvmstat/sun.jvmstat.monitor=ALL-UNNAMED
--add-exports=java.base/sun.reflect.generics.reflectiveObjects=ALL-UNNAMED
--illegal-access=permit
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果使用的是启动脚本（<code>ignite.sh|bat</code>），那么什么都不需要做，因为这些参数脚本里面已经有了。</p> <h2 id="_1-4-maven配置"><a href="#_1-4-maven配置" aria-hidden="true" class="header-anchor">#</a> 1.4.Maven配置</h2> <h3 id="_1-4-1-摘要"><a href="#_1-4-1-摘要" aria-hidden="true" class="header-anchor">#</a> 1.4.1.摘要</h3> <p>如果项目里用Maven管理依赖，可以单独地导入各个Ignite模块。</p> <blockquote><p>注意，在下面的例子中，要将<code>${ignite.version}</code>替换为实际的版本。</p></blockquote> <h3 id="_1-4-2-常规依赖"><a href="#_1-4-2-常规依赖" aria-hidden="true" class="header-anchor">#</a> 1.4.2.常规依赖</h3> <p>Ignite强依赖于<code>ignite-core.jar</code>。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>然而，很多时候需要其它更多的依赖，比如，要使用Spring配置或者SQL查询等。</p> <p>下面就是最常用的可选模块：</p> <ul><li>ignite-indexing（可选，如果需要SQL查询）</li> <li>ignite-spring（可选，如果需要spring配置）</li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-indexing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_1-4-3-导入独立模块"><a href="#_1-4-3-导入独立模块" aria-hidden="true" class="header-anchor">#</a> 1.4.3.导入独立模块</h3> <p>可以一个个地导入Ignite模块，唯一必须的就是<code>ignite-core</code>，其它的都是可选的，所有可选模块都可以像核心模块一样导入，只是构件Id不同。</p> <p>现在提供如下模块：</p> <ul><li><code>ignite-spring</code>：基于Spring的配置支持</li> <li><code>ignite-indexing</code>：SQL查询和索引</li> <li><code>ignite-geospatial</code>：地理位置索引</li> <li><code>ignite-hibernate</code>：Hibernate集成</li> <li><code>ignite-web</code>：Web Session集群化</li> <li><code>ignite-schedule</code>：基于Cron的计划任务</li> <li><code>ignite-log4j</code>：Log4j日志</li> <li><code>ignite-jcl</code>：Apache Commons logging日志</li> <li><code>ignite-jta</code>：XA集成</li> <li><code>ignite-hadoop2-integration</code>：HDFS2.0集成</li> <li><code>ignite-rest-http</code>：HTTP REST请求</li> <li><code>ignite-scalar</code>：Ignite Scalar API</li> <li><code>ignite-slf4j</code>：SLF4J日志</li> <li><code>ignite-ssh</code>；SSH支持，远程机器上启动网格节点</li> <li><code>ignite-urideploy</code>：基于URI的部署</li> <li><code>ignite-aws</code>：AWS S3上的无缝集群发现</li> <li><code>ignite-aop</code>：网格支持AOP</li> <li><code>ignite-visor-console</code>：开源的命令行管理和监控工具</li></ul> <div class="warning custom-block"><p class="custom-block-title">构件版本</p> <p>注意，导入若干Ignite模块时，它们的版本号应该相同，比如，如果使用<code>ignite-core</code>1.8,所有其它的模块也必须导入1.8版本。</p></div> <h3 id="_1-4-4-lgpl依赖"><a href="#_1-4-4-lgpl依赖" aria-hidden="true" class="header-anchor">#</a> 1.4.4.LGPL依赖</h3> <p>下面的Ignite模块有LGPL依赖，因此无法部署到Maven中央仓库：</p> <ul><li><code>ignite-hibernate</code></li> <li><code>ignite-geospatial</code></li> <li><code>ignite-schedule</code></li></ul> <p>要使用这些模块，需要手工从源代码进行构建然后加入自己的项目，比如，要将<code>ignite-hibernate</code>安装到本地库，可以在Ignite的源代码包中运行如下的命令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mvn clean <span class="token function">install</span> -DskipTests -Plgpl -pl modules/hibernate -am
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">第三方仓库</p> <p>GridGain提供自己的<a href="http://www.gridgainsystems.com/nexus/content/repositories/external" target="_self" rel="noopener noreferrer">Maven仓库</a>，包含了Ignite的LGPL构件，比如<code>ignite-hibernate</code>。<br>
注意位于GridGain的Maven库中的构件仅仅为了方便使用，并不是官方的Ignite构件。</p></div> <h2 id="_1-5-ignite生命周期"><a href="#_1-5-ignite生命周期" aria-hidden="true" class="header-anchor">#</a> 1.5.Ignite生命周期</h2> <h3 id="_1-5-1-摘要"><a href="#_1-5-1-摘要" aria-hidden="true" class="header-anchor">#</a> 1.5.1.摘要</h3> <p>Ignite是基于JVM的，一个JVM可以运行一个或者多个逻辑Ignite节点（大多数情况下，一个JVM运行一个Ignite节点）。在整个Ignite文档中，会交替地使用术语Ignite运行时以及Ignite节点，比如说可以该主机运行5个节点，技术上通常意味着主机上启动5个JVM，每个JVM运行一个节点，Ignite也支持一个JVM运行多个节点，事实上，通常作为Ignite内部测试用。</p> <blockquote><p>Ignite运行时 == JVM进程 == Ignite节点（多数情况下）</p></blockquote> <h3 id="_1-5-2-ignition类"><a href="#_1-5-2-ignition类" aria-hidden="true" class="header-anchor">#</a> 1.5.2.Ignition类</h3> <p><code>Ignition</code>类在网络中启动各个Ignite节点，注意一台物理服务器（网络中的一台计算机）可以运行多个Ignite节点。
下面的代码是在全默认配置下在本地启动网格节点；</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者传入一个配置文件：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">&quot;examples/config/example-cache.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>配置文件的路径既可以是绝对路径，也可以是相对于IGNITE_HOME的相对路径，也可以是相对于类路径的META-INF文件夹。</p> <h3 id="_1-5-3-lifecyclebean"><a href="#_1-5-3-lifecyclebean" aria-hidden="true" class="header-anchor">#</a> 1.5.3.LifecycleBean</h3> <p>有时可能希望在Ignite节点启动和停止的之前和之后执行特定的操作，这个可以通过实现<code>LifecycleBean</code>接口实现，然后在spring的配置文件中通过指定<code>IgniteConfiguration</code>的<code>lifecycleBeans</code>属性实现。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>lifecycleBeans<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.mycompany.MyLifecycleBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>LifecycleBean</code>也可以像下面这样通过编程的方式实现：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create new configuration.</span>
IgniteConfiguration cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Provide lifecycle bean to configuration.</span>
cfg<span class="token punctuation">.</span><span class="token function">setLifecycleBeans</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyLifecycleBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// Start Ignite node with given configuration.</span>
Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>一个<code>LifecycleBean</code>的实现可能如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyLifecycleBean</span> <span class="token keyword">implements</span> <span class="token class-name">LifecycleBean</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLifecycleEvent</span><span class="token punctuation">(</span>LifecycleEventType evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>evt <span class="token operator">==</span> LifecycleEventType<span class="token punctuation">.</span>BEFORE_NODE_START<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Do something.</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>也可以将Ignite实例以及其它有用的资源注入<code>LifecycleBean</code>实现，查看<a href="#_1-8-%E8%B5%84%E6%BA%90%E6%B3%A8%E5%85%A5">资源注入</a>章节可以了解更多的信息。</p> <h3 id="_1-5-4-生命周期事件类型"><a href="#_1-5-4-生命周期事件类型" aria-hidden="true" class="header-anchor">#</a> 1.5.4.生命周期事件类型</h3> <p>当前支持如下生命周期事件类型：</p> <ul><li><code>BEFORE_NODE_START</code>：Ignite节点的启动程序初始化之前调用</li> <li><code>AFTER_NODE_START</code>：Ignite节点启动之后调用</li> <li><code>BEFORE_NODE_STOP</code>：Ignite节点的停止程序初始化之前调用</li> <li><code>AFTER_NODE_STOP</code>：Ignite节点停止之后调用</li></ul> <h2 id="_1-6-异步支持"><a href="#_1-6-异步支持" aria-hidden="true" class="header-anchor">#</a> 1.6.异步支持</h2> <h3 id="_1-6-1-摘要"><a href="#_1-6-1-摘要" aria-hidden="true" class="header-anchor">#</a> 1.6.1.摘要</h3> <p>Ignite的多数API即可以支持同步模式，也可以支持异步模式，异步方法后面追加了<code>Async</code>后缀。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Synchronous get</span>
V <span class="token function">get</span><span class="token punctuation">(</span>K key<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Asynchronous get</span>
IgniteFuture<span class="token generics function"><span class="token punctuation">&lt;</span>V<span class="token punctuation">&gt;</span></span> <span class="token function">getAsync</span><span class="token punctuation">(</span>K key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>异步操作返回的是一个<code>IgniteFuture</code>或其子类的实例，通过如下方式可以获得异步操作的结果，或者调用阻塞的<code>IgniteFuture.get()</code>方法，或者通过<code>IgniteFuture.listen()</code>方法或者<code>IgniteFuture.chain()</code>方法注册一个闭包，然后等待当操作完成后调用闭包。</p> <h3 id="_1-6-2-支持的接口"><a href="#_1-6-2-支持的接口" aria-hidden="true" class="header-anchor">#</a> 1.6.2.支持的接口</h3> <p>下面列出的接口可以用于同步或者异步模式：</p> <ul><li><code>IgniteCompute</code></li> <li><code>IgniteCache</code></li> <li><code>Transaction</code></li> <li><code>IgniteServices</code></li> <li><code>IgniteMessaging</code></li> <li><code>IgniteEvents</code></li></ul> <h3 id="_1-6-3-监听器和future链"><a href="#_1-6-3-监听器和future链" aria-hidden="true" class="header-anchor">#</a> 1.6.3.监听器和Future链</h3> <p>要在非阻塞模式下等待异步操作的结果（<code>IgniteFuture.get()</code>），可以使用<code>IgniteFuture.listen()</code>方法或者<code>IgniteFuture.chain()</code>方法注册一个闭包，当操作完成后，闭包会被调用，比如：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteCompute compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Execute a closure asynchronously.</span>
IgniteFuture<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> fut <span class="token operator">=</span> compute<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Listen for completion and print out the result.</span>
fut<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>f <span class="token operator">-</span><span class="token operator">&gt;</span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Job result: &quot;</span> <span class="token operator">+</span> f<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="warning custom-block"><p class="custom-block-title">闭包执行和线程池</p> <p>异步操作完成后，如果通过<code>IgniteFuture.listen()</code>或者<code>IgniteFuture.chain()</code>方法传递了闭包，那么闭包就会被调用线程以同步的方式执行，否则，闭包就会随着操作的完成异步地执行。
根据操作的类型，闭包可能被系统线程池中的线程调用（异步缓存操作），或者被公共线程池中的线程调用（异步计算操作）。因此需要避免在闭包实现中调用同步的缓存和计算操作，否则可能导致死锁。
要实现Ignite计算操作异步嵌套执行，可以使用自定义线程池，相关内容可以查看<a href="#_1-9-8-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BA%BF%E7%A8%8B%E6%B1%A0">自定义线程池</a>中的相关内容。</p></div> <h2 id="_1-7-客户端和服务端"><a href="#_1-7-客户端和服务端" aria-hidden="true" class="header-anchor">#</a> 1.7.客户端和服务端</h2> <h3 id="_1-7-1-摘要"><a href="#_1-7-1-摘要" aria-hidden="true" class="header-anchor">#</a> 1.7.1.摘要</h3> <p>Ignite有一个可选的概念，就是<strong>客户端节点</strong>和<strong>服务端节点</strong>，服务端节点参与缓存、计算执行、流式处理等等，而原生的客户端节点提供了远程连接服务端的能力。Ignite原生客户端可以使用完整的<code>Ignite</code> API集合，包括近缓存、事务、计算、流、服务等等。
所有的Ignite节点默认都是以<code>服务端</code>模式启动的，<code>客户端</code>模式需要显式地启用。</p> <h3 id="_1-7-2-配置客户端和服务端"><a href="#_1-7-2-配置客户端和服务端" aria-hidden="true" class="header-anchor">#</a> 1.7.2.配置客户端和服务端</h3> <p>可以通过<code>IgniteConfiguration.setClientMode(...)</code>属性配置一个节点，或者为客户端，或者为服务端。</p> <p>XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...   
    <span class="token comment">&lt;!-- Enable client mode. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>clientMode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Java:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteConfiguration cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Enable client mode.</span>
cfg<span class="token punctuation">.</span><span class="token function">setClientMode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start Ignite in client mode.</span>
Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>方便起见，也可以通过<code>Ignition</code>类来打开或者关闭客户端模式作为替代，这样可以使客户端和服务端共用一套配置。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>Ignition<span class="token punctuation">.</span><span class="token function">setClientMode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start Ignite in client mode.</span>
Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_1-7-3-创建分布式缓存"><a href="#_1-7-3-创建分布式缓存" aria-hidden="true" class="header-anchor">#</a> 1.7.3.创建分布式缓存</h3> <p>当在Ignite中创建缓存时，不管是通过XML方式，还是通过<code>Ignite.createCache(...)</code>或者<code>Ignite.getOrCreateCache(...)</code>方法，Ignite会自动地在所有的服务端节点中部署分布式缓存。</p> <blockquote><p>当分布式缓存创建之后，它会自动地部署在所有的已有或者未来的<strong>服务端</strong>节点上。</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Enable client mode locally.</span>
Ignition<span class="token punctuation">.</span><span class="token function">setClientMode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start Ignite in client mode.</span>
Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

CacheConfiguration cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set required cache configuration properties.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment">// Create cache on all the existing and future server nodes.</span>
<span class="token comment">// Note that since the local node is a client, it will not </span>
<span class="token comment">// be caching any data.</span>
IgniteCache<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token operator">&gt;</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_1-7-4-客户端或者服务端计算"><a href="#_1-7-4-客户端或者服务端计算" aria-hidden="true" class="header-anchor">#</a> 1.7.4.客户端或者服务端计算</h3> <p><code>IgniteCompute</code>默认会在所有的服务端节点上执行作业，然而，也可以通过创建相应的集群组来选择是只在服务端节点还是只在客户端节点上执行作业。</p> <p>服务端节点执行：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteCompute compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Execute computation on the server nodes (default behavior).</span>
compute<span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>客户端节点执行：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>ClusterGroup clientGroup <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forClients</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

IgniteCompute clientCompute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span>clientGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Execute computation on the client nodes.</span>
clientCompute<span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Client&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_1-7-5-管理慢客户端"><a href="#_1-7-5-管理慢客户端" aria-hidden="true" class="header-anchor">#</a> 1.7.5.管理慢客户端</h3> <p>很多部署环境中，客户端节点是在主集群外启动的，机器和网络都比较差，在这些场景中服务端可能产生负载（比如连续查询通知）而客户端没有能力处理，导致服务端的输出消息队列不断增长，这可能最终导致服务端出现内存溢出的情况，或者如果打开背压控制时导致整个集群阻塞。</p> <p>要管理这样的状况，可以配置允许向客户端节点输出消息的最大值，如果输出队列的大小超过配置的值，该客户端节点会从集群断开以防止拖慢整个集群。</p> <p>下面的例子显示了如何通过XML或者编程的方式配置慢客户端队列限值：</p> <p>Java：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteConfiguration cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Configure Ignite here.</span>

TcpCommunicationSpi commSpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpCommunicationSpi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
commSpi<span class="token punctuation">.</span><span class="token function">setSlowClientQueueLimit</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cfg<span class="token punctuation">.</span><span class="token function">setCommunicationSpi</span><span class="token punctuation">(</span>commSpi<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>grid.cfg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- Configure Ignite here. --&gt;</span>
  
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>communicationSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.communication.tcp.TcpCommunicationSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slowClientQueueLimit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_1-7-6-客户端重连"><a href="#_1-7-6-客户端重连" aria-hidden="true" class="header-anchor">#</a> 1.7.6.客户端重连</h3> <p>有几种情况客户端会从集群中断开：</p> <ul><li>由于网络原因，客户端无法和服务端重建连接；</li> <li>与服务端的连接有时被断开，客户端也可以重建与服务端的连接，但是由于服务端无法获得客户端心跳，服务端仍然断开客户端节点；</li> <li>慢客户端会被服务端节点踢出；</li></ul> <p>当一个客户端发现它与一个集群断开时，会为自己赋予一个新的节点<code>id</code>然后试图与该服务端重新连接。<code>注意</code>：这会产生一个副作用，就是当客户端重建连接时本地<code>ClusterNode</code>的<code>id</code>属性会发生变化，这意味着，如果业务逻辑依赖于这个<code>id</code>，就会受到影响。
当客户端处于一个断开状态并且试图重建与集群的连接过程中时，Ignite API会抛出一个特定的异常：<code>IgniteClientDisconnectedException</code>，这个异常提供了一个<code>future</code>，当客户端重连成功后它会完成（<code>IgniteCache</code>API会抛出<code>CacheException</code>，它有一个<code>IgniteClientDisconnectedException</code>作为它的cause）。这个<code>future</code>也可以通过<code>IgniteCluster.clientReconnectFuture()</code>方法获得。</p> <p>此外，客户端重连也有一些特定的事件（这些事件是本地化的，也就是说它们只会在客户端节点触发）：</p> <ul><li>EventType.EVT_CLIENT_NODE_DISCONNECTED</li> <li>EventType.EVT_CLIENT_NODE_RECONNECTED</li></ul> <p>下面的例子显示<code>IgniteClientDisconnectedException</code>如何使用：</p> <p>计算：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteCompute compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        compute<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IgniteClientDisconnectedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">reconnectFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Wait for reconnection.</span>

        <span class="token comment">// Can proceed and use the same IgniteCompute instance.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>缓存：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteCache cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CacheException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">IgniteClientDisconnectedException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      IgniteClientDisconnectedException cause <span class="token operator">=</span>
        <span class="token punctuation">(</span>IgniteClientDisconnectedException<span class="token punctuation">)</span>e<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      cause<span class="token punctuation">.</span><span class="token function">reconnectFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Wait for reconnection.</span>

      <span class="token comment">// Can proceed and use the same IgniteCache instance.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>客户端自动重连可以通过<code>TcpDiscoverySpi</code>的<code>clientReconnectDisabled</code>属性禁用，如果重连被禁用那么当发现与集群断开时客户端节点就会停止。</p> <p>下面的例子显示了如何禁用客户端重连：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteConfiguration cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Configure Ignite here.</span>

TcpDiscoverySpi discoverySpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoverySpi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

discoverySpi<span class="token punctuation">.</span><span class="token function">setClientReconnectDisabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cfg<span class="token punctuation">.</span><span class="token function">setDiscoverySpi</span><span class="token punctuation">(</span>discoverySpi<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_1-7-7-客户端节点强制服务端模式"><a href="#_1-7-7-客户端节点强制服务端模式" aria-hidden="true" class="header-anchor">#</a> 1.7.7.客户端节点强制服务端模式</h3> <p>客户端节点需要拓扑中有在线的服务端节点才能启动。</p> <p>然而，如果在没有运行中的服务端节点时还要启动一个客户端节点，可以通过如下方式在客户端节点强制服务端模式发现。</p> <p>如果不管服务端节点是否在线都要启动客户端节点非常必要，可以以如下的方式在客户端强制服务端模式发现：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteConfiguration cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cfg<span class="token punctuation">.</span><span class="token function">setClientMode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Configure Ignite here.</span>

TcpDiscoverySpi discoverySpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoverySpi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

discoverySpi<span class="token punctuation">.</span><span class="token function">setForceServerMode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cfg<span class="token punctuation">.</span><span class="token function">setDiscoverySpi</span><span class="token punctuation">(</span>discoverySpi<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这种情况下，如果网络中的所有节点都是服务端节点时发现就会发生。</p> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p>这种情况下为了发现能正常工作，发现SPI在所有节点上使用的所有地址应该是可以相互访问的。</p></div> <h2 id="_1-8-资源注入"><a href="#_1-8-资源注入" aria-hidden="true" class="header-anchor">#</a> 1.8.资源注入</h2> <h3 id="_1-8-1-摘要"><a href="#_1-8-1-摘要" aria-hidden="true" class="header-anchor">#</a> 1.8.1.摘要</h3> <p>Ignite中，预定义的资源都是可以进行依赖注入的，同时支持基于属性和基于方法的注入。任何加注正确注解的资源都会在初始化之前注入相对应的任务、作业、闭包或者SPI。</p> <h3 id="_1-8-2-基于属性和基于方法"><a href="#_1-8-2-基于属性和基于方法" aria-hidden="true" class="header-anchor">#</a> 1.8.2.基于属性和基于方法</h3> <p>可以通过在一个属性或者方法上加注注解来注入资源。当加注在属性上时，Ignite只是在注入阶段简单地设置属性的值（不会理会该属性的访问修饰符）。如果在一个方法上加注了资源注解，它会访问一个与注入资源相对应的输入参数的类型，如果匹配，那么在注入阶段，就会将适当的资源作为输入参数，然后调用该方法。</p> <p>基于属性：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">ignite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Collection<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> res <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteCallable</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Inject Ignite instance.  </span>
  <span class="token annotation punctuation">@IgniteInstanceResource</span>
  <span class="token keyword">private</span> Ignite ignite<span class="token punctuation">;</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> String <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span> 
    IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">getOrCreateCache</span><span class="token punctuation">(</span>CACHE_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Do some stuff with cache.</span>
     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>基于方法：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClusterJob</span> <span class="token keyword">implements</span> <span class="token class-name">ComputeJob</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">private</span> Ignite ignite<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token comment">// Inject Ignite instance.  </span>
    <span class="token annotation punctuation">@IgniteInstanceResource</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setIgnite</span><span class="token punctuation">(</span>Ignite ignite<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ignite <span class="token operator">=</span> ignite<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_1-8-3-预定义的资源"><a href="#_1-8-3-预定义的资源" aria-hidden="true" class="header-anchor">#</a> 1.8.3.预定义的资源</h3> <p>有很多的预定义资源可供注入：</p> <table><thead><tr><th>资源</th> <th>描述</th></tr></thead> <tbody><tr><td><code>CacheNameResource</code></td> <td>由<code>CacheConfiguration.getName()</code>提供，注入网格缓存名</td></tr> <tr><td><code>CacheStoreSessionResource</code></td> <td>注入当前的<code>CacheStoreSession</code>实例</td></tr> <tr><td><code>IgniteInstanceResource</code></td> <td>注入当前的Ignite实例</td></tr> <tr><td><code>JobContextResource</code></td> <td>注入<code>ComputeJobContext</code>的实例。作业的上下文持有关于一个作业执行的有用的信息。比如，可以获得包含与作业并置的条目的缓存的名字。</td></tr> <tr><td><code>LoadBalancerResource</code></td> <td>注入<code>ComputeLoadBalancer</code>的实例，注入后可以用于任务的负载平衡。</td></tr> <tr><td><code>LoggerResource</code></td> <td>注入<code>IgniteLogger</code>的实例，它可以用于向本地节点的日志写消息。</td></tr> <tr><td><code>ServiceResource</code></td> <td>通过指定服务名注入Ignite的服务。</td></tr> <tr><td><code>SpringApplicationContextResource</code></td> <td>注入Spring的<code>ApplicationContext</code>资源。</td></tr> <tr><td><code>SpringResource</code></td> <td>从Spring的<code>ApplicationContext</code>注入资源，当希望访问在Spring的ApplicationContext XML配置中指定的一个Bean时，可以用它。</td></tr> <tr><td><code>TaskContinuousMapperResource</code></td> <td>注入一个<code>ComputeTaskContinuousMapper</code>的实例，持续映射可以在任何时点从任务中发布作业，即使过了<em>map</em>的初始化阶段。</td></tr> <tr><td><code>TaskSessionResource</code></td> <td>注入<code>ComputeTaskSession</code>资源的实例，它为一个特定的任务执行定义了一个分布式的会话。</td></tr></tbody></table> <h2 id="_1-9-线程池"><a href="#_1-9-线程池" aria-hidden="true" class="header-anchor">#</a> 1.9.线程池</h2> <h3 id="_1-9-1-摘要"><a href="#_1-9-1-摘要" aria-hidden="true" class="header-anchor">#</a> 1.9.1.摘要</h3> <p>Ignite创建并且维护着一组线程池，根据使用的API不同分别用于不同的目的。本章节中会列出一些众所周知的内部线程池，然后会展示如何自定义线程池。在<code>IgniteConfiguration</code>的javadoc中，可以看到Ignite中可用的完整线程池列表。</p> <h3 id="_1-9-2-系统线程池"><a href="#_1-9-2-系统线程池" aria-hidden="true" class="header-anchor">#</a> 1.9.2.系统线程池</h3> <p>系统线程池处理所有与缓存相关的操作，除了SQL以及其它的查询类型，它们会使用查询线程池，同时这个线程池也负责处理Ignite计算任务的取消操作。</p> <p>默认的线程池数量为<code>max(8,CPU总核数)</code>，使用<code>IgniteConfiguration.setSystemThreadPoolSize(...)</code>可以进行调整。</p> <h3 id="_1-9-3-公共线程池"><a href="#_1-9-3-公共线程池" aria-hidden="true" class="header-anchor">#</a> 1.9.3.公共线程池</h3> <p>公共线程池负责Ignite的计算网格，所有的计算任务都由这个线程池接收然后处理。</p> <p>默认的线程池数量为<code>max(8,CPU总核数)</code>，使用<code>IgniteConfiguration.setPublicThreadPoolSize(...)</code>可以进行调整。</p> <h3 id="_1-9-4-查询线程池"><a href="#_1-9-4-查询线程池" aria-hidden="true" class="header-anchor">#</a> 1.9.4.查询线程池</h3> <p>查询线程池处理集群内所有的SQL、扫描和SPI查询。</p> <p>默认的线程池数量为<code>max(8,CPU总核数)</code>，使用<code>IgniteConfiguration.setQueryThreadPoolSize(...)</code>可以进行调整。</p> <h3 id="_1-9-5-服务线程池"><a href="#_1-9-5-服务线程池" aria-hidden="true" class="header-anchor">#</a> 1.9.5.服务线程池</h3> <p>Ignite的服务网格调用使用的是服务线程池，Ignite的服务和计算网格组件都有专用的线程池，可以避免当一个服务实现希望调用一个计算（或者反之）时的线程争用和死锁。</p> <p>默认的线程池数量为<code>max(8,CPU总核数)</code>，使用<code>IgniteConfiguration.setServiceThreadPoolSize(...)</code>可以进行调整。</p> <h3 id="_1-9-6-平行线程池"><a href="#_1-9-6-平行线程池" aria-hidden="true" class="header-anchor">#</a> 1.9.6.平行线程池</h3> <p>平行线程池通过将操作展开为多个平行的执行，有助于显著加速基本的缓存操作以及事务，因为可以避免相互竞争。</p> <p>默认的线程池数量为<code>max(8,CPU总核数)</code>，使用<code>IgniteConfiguration.setStripedPoolSize(...)</code>可以进行调整。</p> <h3 id="_1-9-7-数据流处理器线程池"><a href="#_1-9-7-数据流处理器线程池" aria-hidden="true" class="header-anchor">#</a> 1.9.7.数据流处理器线程池</h3> <p>数据流处理器线程池用于处理来自<code>IgniteDataStreamer</code>的所有消息和请求，各种内置的使用<code>IgniteDataStreamer</code>的流适配器也可以。</p> <p>默认的线程池数量为<code>max(8,CPU总核数)</code>，使用<code>IgniteConfiguration.setDataStreamerThreadPoolSize(...)</code>可以进行调整。</p> <h3 id="_1-9-8-自定义线程池"><a href="#_1-9-8-自定义线程池" aria-hidden="true" class="header-anchor">#</a> 1.9.8.自定义线程池</h3> <p>对于Ignite的计算任务，也可以配置自定义的线程池，当希望同步地从一个计算任务调用另一个的时候很有用，因为可以避免死锁。要保证这一点，需要确保执行嵌套任务的线程池不同于上级任务的线程池。</p> <p>自定义线程池需要在<code>IgniteConfiguration</code>中进行定义，并且需要有一个唯一的名字：</p> <p>Java:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteConfiguration cfg <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

cfg<span class="token punctuation">.</span><span class="token function">setExecutorConfiguration</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExecutorConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;myPool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>XML:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>grid.cfg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>executorConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.ExecutorConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myPool<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>size<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>16<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这样，假定下面的计算任务由上面定义的<code>myPool</code>线程池中的线程执行：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InnerRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">IgniteRunnable</span> <span class="token punctuation">{</span>    
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello from inner runnable!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>怎么做呢，需要使用<code>IgniteCompute.withExecutor()</code>，它会被上级任务的实现马上执行，像下面这样：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OuterRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">IgniteRunnable</span> <span class="token punctuation">{</span>    
    <span class="token annotation punctuation">@IgniteInstanceResource</span>
    <span class="token keyword">private</span> Ignite ignite<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Synchronously execute InnerRunnable in custom executor.</span>
        ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withExecutor</span><span class="token punctuation">(</span><span class="token string">&quot;myPool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InnerRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>上级任务的执行可通过如下方式触发，对于这个场景，它会由公共线程池执行：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>ignite<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OuterRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p><strong>未定义线程池</strong>
如果应用请求在自定义线程池执行计算任务，而该线程池在Ignite节点中未定义，那么一个特定的警告消息就会在节点的日志中输出，然后任务就会被公共线程池接管执行。</p></blockquote> <h2 id="_1-10-二进制编组器"><a href="#_1-10-二进制编组器" aria-hidden="true" class="header-anchor">#</a> 1.10.二进制编组器</h2> <h3 id="_1-10-1-基本概念"><a href="#_1-10-1-基本概念" aria-hidden="true" class="header-anchor">#</a> 1.10.1.基本概念</h3> <p>从1.6版本开始，Ignite引入了一个在缓存中存储数据的新概念，名为<code>二进制对象</code>，这个新的序列化格式提供了若干个优势：</p> <ul><li>它可以从一个对象的序列化形式中读取一个任意的属性，而不需要将该对象完整地反序列化，这个功能完全删除了将缓存的键和值类部署到服务端节点类路径的必要性；</li> <li>它可以为同一个类型的对象增加和删除属性，给定的服务端节点不需要有模型类的定义，这个功能允许动态改变对象的结构，甚至允许多个客户端持有类定义的不同版本，它们是共存的；</li> <li>它可以根据类型名构造一个新的对象，根本不需要类定义，因此允许动态类型创建；</li></ul> <p>二进制对象只可以用于使用默认的二进制编组器时（即没有在配置中显式地设置其它的编组器）</p> <div class="tip custom-block"><p class="custom-block-title">限制</p> <p><code>BinaryObject</code>格式实现也带来了若干个限制：</p> <ol><li>在内部Ignite不会写属性以及类型的名字，但是使用一个小写的名字哈希来标示一个属性或者类型，这意味着属性或者类型不能有同样的名字哈希。即使序列化不会在哈希冲突的情况下工作，但Ignite在配置级别提供了一种方法来解决此冲突；</li> <li>同样的原因，<code>BinaryObject</code>格式在类的不同层次上也不允许有同样的属性名；</li> <li>如果类实现了<code>Externalizable</code>接口，Ignite会使用<code>OptimizedMarshaller</code>，<code>OptimizedMarshaller</code>会使用<code>writeExternal()</code>和<code>readExternal()</code>来进行类对象的序列化和反序列化，这需要将实现<code>Externalizable</code>的类加入服务端节点的类路径中。</li></ol></div> <p><code>IgniteBinary</code>入口，可以从Ignite的实例获得，包含了操作二进制对象的所有必要的方法。</p> <div class="tip custom-block"><p class="custom-block-title">自动化哈希值计算和Equals实现</p> <p>如果一个对象可以被序列化到二进制形式，那么Ignite会在序列化期间计算它的哈希值并且将其写入最终的二进制数组。另外，Ignite还为二进制对象的比较需求提供了equals方法的自定义实现。这意味着，不需要为在Ignite中使用的自定义键和值覆写<code>GetHashCode</code>和<code>Equals</code>方法，除非它们无法序列化成二进制形式。</p> <p>比如，<code>Externalizable</code>类型的对象无法被序列化成二进制形式，这时就需要自行实现<code>hashCode</code>和<code>equals</code>方法，具体可以看上面的限制章节。</p></div> <h3 id="_1-10-2-配置二进制对象"><a href="#_1-10-2-配置二进制对象" aria-hidden="true" class="header-anchor">#</a> 1.10.2.配置二进制对象</h3> <p>在绝大多数情况下不需要额外地配置二进制对象。
但是，如果需要覆写默认的类型和属性ID计算或者加入<code>BinarySerializer</code>，可以为<code>IgniteConfiguration</code>定义一个<code>BinaryConfiguration</code>对象，这个对象除了为每个类型指定映射以及序列化器之外还可以指定一个全局的Name映射、一个全局ID映射以及一个全局的二进制序列化器。对于每个类型的配置，通配符也是支持的，这时提供的配置会适用于匹配类型名称模板的所有类型。
配置二进制类型：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ignite.cfg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>binaryConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.BinaryConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>nameMapper<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>globalNameMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>idMapper<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>globalIdMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>typeConfigurations<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.binary.BinaryTypeConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>typeName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.examples.*<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>serializer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>exampleSerializer<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_1-10-3-binaryobject缓存api"><a href="#_1-10-3-binaryobject缓存api" aria-hidden="true" class="header-anchor">#</a> 1.10.3.BinaryObject缓存API</h3> <p>Ignite默认使用反序列化值作为最常见的使用场景，要启用<code>BinaryObject</code>处理，需要获得一个<code>IgniteCache</code>的实例然后使用<code>withKeepBinary()</code>方法。启用之后，如果可能，这个标志会确保从缓存返回的对象都是<code>BinaryObject</code>格式的。将值传递给<code>EntryProcessor</code>和<code>CacheInterceptor</code>也是同样的处理。</p> <div class="tip custom-block"><p class="custom-block-title">平台类型</p> <p>注意当通过<code>withKeepBinary()</code>方法启用<code>BinaryObject</code>处理时并不是所有的对象都会表示为<code>BinaryObject</code>，会有一系列的<code>平台</code>类型，包括基本类型，String，UUID，Date，Timestamp，BigDecimal，Collections，Maps和Arrays，它们不会被表示为<code>BinaryObject</code>。</p> <p>注意在下面的示例中，键类型为<code>Integer</code>，它是不会被修改，因为它是<code>平台</code>类型。</p></div> <p>获取BinaryObject：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create a regular Person object and put it to the cache.</span>
Person person <span class="token operator">=</span> <span class="token function">buildPerson</span><span class="token punctuation">(</span>personId<span class="token punctuation">)</span><span class="token punctuation">;</span>
ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>personId<span class="token punctuation">,</span> person<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get an instance of binary-enabled cache.</span>
IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> BinaryObject<span class="token punctuation">&gt;</span></span> binaryCache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withKeepBinary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the above person object in the BinaryObject format.</span>
BinaryObject binaryPerson <span class="token operator">=</span> binaryCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>personId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_1-10-4-使用binaryobjectbuilder修改二进制对象"><a href="#_1-10-4-使用binaryobjectbuilder修改二进制对象" aria-hidden="true" class="header-anchor">#</a> 1.10.4.使用BinaryObjectBuilder修改二进制对象</h3> <p><code>BinaryObject</code>实例是不能修改的，要更新属性或者创建新的<code>BinaryObject</code>，必须使用<code>BinaryObjectBuilder</code>的实例。</p> <p><code>BinaryObjectBuilder</code>的实例可以通过<code>IgniteBinary</code>入口获得。它可以使用类型名创建，这时返回的对象不包含任何属性，或者它也可以通过一个已有的<code>BinaryObject</code>创建，这时返回的对象会包含从给定的<code>BinaryObject</code>中拷贝的所有属性。</p> <p>获取<code>BinaryObjectBuilder</code>实例的另外一个方式是调用已有<code>BinaryObject</code>实例的<code>toBuilder()</code>方法，这种方式创建的对象也会从<code>BinaryObject</code>中拷贝所有的数据。</p> <div class="tip custom-block"><p class="custom-block-title">限制</p> <ul><li>无法修改已有字段的类型；</li> <li>无法变更枚举值的顺序，也无法在枚举值列表的开始或者中部添加新的常量，但是可以在列表的末尾添加新的常量。</li></ul></div> <p>下面是一个使用<code>BinaryObject</code>API来处理服务端节点的数据而不需要将程序部署到服务端以及不需要实际的数据反序列化的示例：</p> <p>EntryProcessor内的BinaryObject：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// The EntryProcessor is to be executed for this key.</span>
<span class="token keyword">int</span> key <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> BinaryObject<span class="token punctuation">&gt;</span></span><span class="token function">withKeepBinary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>
  key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CacheEntryProcessor</span><span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> BinaryObject<span class="token punctuation">,</span> Object<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token keyword">public</span> Object <span class="token function">process</span><span class="token punctuation">(</span>MutableEntry<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> BinaryObject<span class="token punctuation">&gt;</span></span> entry<span class="token punctuation">,</span>
                          Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> objects<span class="token punctuation">)</span> <span class="token keyword">throws</span> EntryProcessorException <span class="token punctuation">{</span>
		    <span class="token comment">// Create builder from the old value.</span>
        BinaryObjectBuilder bldr <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//Update the field in the builder.</span>
        bldr<span class="token punctuation">.</span><span class="token function">setField</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Ignite&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Set new value to the entry.</span>
        entry<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>bldr<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_1-10-5-binaryobject类型元数据"><a href="#_1-10-5-binaryobject类型元数据" aria-hidden="true" class="header-anchor">#</a> 1.10.5.BinaryObject类型元数据</h3> <p>像上面描述的那样，二进制对象结构可以在运行时进行修改，因此获取一个存储在缓存中的一个特定类型的信息也可能是有用的，比如属性名，属性类型，属性类型名，关系属性名，Ignite通过<code>BinaryType</code>接口满足这样的需求。</p> <p>这个接口还引入了一个属性getter的更快的版本，叫做<code>BinaryField</code>。这个概念类似于Java的反射，可以缓存<code>BinaryField</code>实例中读取的属性的特定信息，它有助于从一个很大的二进制对象集合中读取同一个属性。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>Collection<span class="token generics function"><span class="token punctuation">&lt;</span>BinaryObject<span class="token punctuation">&gt;</span></span> persons <span class="token operator">=</span> <span class="token function">getPersons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

BinaryField salary <span class="token operator">=</span> null<span class="token punctuation">;</span>

<span class="token keyword">double</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span>BinaryObject person <span class="token operator">:</span> persons<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>salary <span class="token operator">==</span> null<span class="token punctuation">)</span>
        salary <span class="token operator">=</span> person<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;salary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    total <span class="token operator">+=</span> salary<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cnt<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">double</span> avg <span class="token operator">=</span> total <span class="token operator">/</span> cnt<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_1-10-6-binaryobject和cachestore"><a href="#_1-10-6-binaryobject和cachestore" aria-hidden="true" class="header-anchor">#</a> 1.10.6.BinaryObject和CacheStore</h3> <p>在缓存API上调用<code>withKeepBinary()</code>方法对于将用户对象传入<code>CacheStore</code>的方式不起作用，这么做是故意的，因为大多数情况下单个<code>CacheStore</code>实现要么使用反序列化类，要么使用<code>BinaryObject</code>表示。要控制对象传入Store的方式，需要使用<code>CacheConfiguration</code>的<code>storeKeepBinary</code>标志，当该标志设置为<code>false</code>时，会将反序列化值传入Store，否则会使用<code>BinaryObject</code>表示。</p> <p>下面是一个使用<code>BinaryObject</code>的Store的伪代码实现的示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheExampleBinaryStore</span> <span class="token keyword">extends</span> <span class="token class-name">CacheStoreAdapter</span><span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> BinaryObject<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@IgniteInstanceResource</span>
    <span class="token keyword">private</span> Ignite ignite<span class="token punctuation">;</span>

    <span class="token comment">/** {@inheritDoc} */</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> BinaryObject <span class="token function">load</span><span class="token punctuation">(</span>Integer key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        IgniteBinary binary <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">binary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        List<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> rs <span class="token operator">=</span> <span class="token function">loadRow</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

        BinaryObjectBuilder bldr <span class="token operator">=</span> binary<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token string">&quot;Person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            bldr<span class="token punctuation">.</span><span class="token function">setField</span><span class="token punctuation">(</span><span class="token function">name</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> rs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> bldr<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/** {@inheritDoc} */</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span>Cache<span class="token punctuation">.</span>Entry<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">BinaryObject</span><span class="token operator">&gt;</span> entry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        BinaryObject obj <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        BinaryType type <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Collection<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> fields <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">fieldNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        List<span class="token generics function"><span class="token punctuation">&lt;</span>Object<span class="token punctuation">&gt;</span></span> row <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>fields<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span>String fieldName <span class="token operator">:</span> fields<span class="token punctuation">)</span>
            row<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token function">saveRow</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> row<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_1-10-7-二进制name映射器和二进制id映射器"><a href="#_1-10-7-二进制name映射器和二进制id映射器" aria-hidden="true" class="header-anchor">#</a> 1.10.7.二进制Name映射器和二进制ID映射器</h3> <p>在内部，Ignite不会写属性或者类型名字的完整字符串，而是因为性能的原因，为类型或者属性名写一个整型哈希值作为替代。经过测试，在类型相同时，属性名或者类型名的哈希值冲突实际上是不存在的，为了获得性能，使用哈希值是安全的。对于当不同的类型或者属性确实冲突的场合，<code>BinaryNameMapper</code>和<code>BinaryIdMapper</code>可以为该类型或者属性名覆写自动生成的哈希值。</p> <p><code>BinaryNameMapper</code> - 映射类型/类和属性名到不同的名字；</p> <p><code>BinaryIdMapper</code> - 映射从<code>BinaryNameMapper</code>来的类型和属性名到ID，以便于Ignite内部使用。</p> <p>Ignite直接支持如下的映射器实现：</p> <ul><li><code>BinaryBasicNameMapper</code>：<code>BinaryNameMapper</code>的一个基本实现，对于一个给定的类，根据使用的<code>setSimpleName(boolean useSimpleName)</code>属性值，会返回一个完整或者简单的名字；</li> <li><code>BinaryBasicIdMapper</code>：<code>BinaryIdMapper</code>的一个基本实现，它有一个<code>setLowerCase(boolean isLowerCase)</code>配置属性，如果属性设置为<code>false</code>，那么会返回一个给定类型或者属性名的哈希值，如果设置为<code>true</code>，会返回一个给定类型或者属性名的小写形式的哈希值。</li></ul> <p>如果仅仅使用Java或者.NET客户端并且在<code>BinaryConfiguration</code>中没有指定映射器，那么Ignite会使用<code>BinaryBasicNameMapper</code>并且<code>simpleName</code>属性会被设置为<code>false</code>，使用<code>BinaryBasicIdMapper</code>并且<code>lowerCase</code>属性会被设置为<code>true</code>。</p> <p>如果使用了C++客户端并且在<code>BinaryConfiguration</code>中没有指定映射器，那么Ignite会使用<code>BinaryBasicNameMapper</code>并且<code>simpleName</code>属性会被设置为<code>true</code>，使用<code>BinaryBasicIdMapper</code>并且<code>lowerCase</code>属性会被设置为<code>true</code>。</p> <p>如果使用Java、.Net或者C++，默认是不需要任何配置的，只有当需要平台协同、名字转换复杂的情况下，才需要配置映射器。</p> <h2 id="_1-11-日志"><a href="#_1-11-日志" aria-hidden="true" class="header-anchor">#</a> 1.11.日志</h2> <p>Ignite支持各种日志库和框架，可以直接使用<a href="https://logging.apache.org/log4j/2.x/" target="_self" rel="noopener noreferrer">Log4j</a>、<a href="https://logging.apache.org/log4j/2.x/" target="_self" rel="noopener noreferrer">Log4j2</a>、<a href="https://commons.apache.org/proper/commons-logging/guide.html" target="_self" rel="noopener noreferrer">JCL</a>和<a href="https://www.slf4j.org/manual.html" target="_self" rel="noopener noreferrer">SLF4J</a>，本文会描述如何使用它们。</p> <h3 id="_1-11-1-log4j"><a href="#_1-11-1-log4j" aria-hidden="true" class="header-anchor">#</a> 1.11.1.Log4j</h3> <p>如果在启动独立集群节点时要使用Log4j模块，需要在执行<code>ignite.{sh|bat}</code>脚本前，将<code>optional/ignite-log4j</code>文件夹移动到Ignite发行版的<code>lib</code>目录下，这时这个模块目录中的内容会被添加到类路径。</p> <p>如果项目中使用maven进行依赖管理，那么需要添加如下的依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>将<code>${ignite.version}</code>替换为实际使用的Ignite版本。</p> <p>要使用Log4j进行日志记录，需要配置<code>IgniteConfiguration</code>的<code>gridLogger</code>属性，如下所示：</p> <p>XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>gridLogger<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.logger.log4j.Log4JLogger<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>log4j.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- Other Ignite configurations --&gt;</span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Java：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteConfiguration cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

IgniteLogger log <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Log4JLogger</span><span class="token punctuation">(</span><span class="token string">&quot;log4j.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cfg<span class="token punctuation">.</span><span class="token function">setGridLogger</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start Ignite node.</span>
Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

ignite<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Info Message Logged!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在上面的配置中，<code>log4j.xml</code>的路径要么是绝对路径，要么是相对路径，相对路径可以相对于<code>META-INF</code>，也可以相对于<code>IGNITE_HOME</code>。</p> <h3 id="_1-11-2-log4j2"><a href="#_1-11-2-log4j2" aria-hidden="true" class="header-anchor">#</a> 1.11.2.Log4j2</h3> <p>如果在启动独立集群节点时要使用Log4j2模块，需要在执行<code>ignite.{sh|bat}</code>脚本前，将<code>optional/ignite-log4j2</code>文件夹移动到Ignite发行版的<code>lib</code>目录下，这时这个模块目录中的内容会被添加到类路径。</p> <p>如果项目中使用maven进行依赖管理，那么需要添加如下的依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-log4j2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>将<code>${ignite.version}</code>替换为实际使用的Ignite版本。</p> <p>要使用Log4j2进行日志记录，需要配置<code>IgniteConfiguration</code>的<code>gridLogger</code>属性，如下所示：</p> <p>XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>gridLogger<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.logger.log4j2.Log4J2Logger<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>log4j2.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- Other Ignite configurations --&gt;</span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Java：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteConfiguration cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

IgniteLogger log <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Log4J2Logger</span><span class="token punctuation">(</span><span class="token string">&quot;log4j2.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cfg<span class="token punctuation">.</span><span class="token function">setGridLogger</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start Ignite node.</span>
Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

ignite<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Info Message Logged!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在上面的配置中，<code>log4j2.xml</code>的路径要么是绝对路径，要么是相对路径，相对路径可以相对于<code>META-INF</code>，也可以相对于<code>IGNITE_HOME</code>。</p> <h3 id="_1-11-3-jcl"><a href="#_1-11-3-jcl" aria-hidden="true" class="header-anchor">#</a> 1.11.3.JCL</h3> <p>如果在启动独立集群节点时要使用JCL模块，需要在执行<code>ignite.{sh|bat}</code>脚本前，将<code>optional/ignite-jcl</code>文件夹移动到Ignite发行版的<code>lib</code>目录下，这时这个模块目录中的内容会被添加到类路径。</p> <p>如果项目中使用maven进行依赖管理，那么需要添加如下的依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-jcl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>将<code>${ignite.version}</code>替换为实际使用的Ignite版本。</p> <p>要使用JCL进行日志记录，需要配置<code>IgniteConfiguration</code>的<code>gridLogger</code>属性，如下所示：</p> <p>XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>gridLogger<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.logger.jcl.JclLogger<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.commons.logging.Log<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.commons.logging.impl.Log4JLogger<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>log4j.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor-arg</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- Other Ignite configurations --&gt;</span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Java：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteConfiguration cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

IgniteLogger log <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JclLogger</span><span class="token punctuation">(</span><span class="token keyword">new</span> 
  <span class="token class-name">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>logging<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>Log4JLogger</span><span class="token punctuation">(</span><span class="token string">&quot;log4j.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cfg<span class="token punctuation">.</span><span class="token function">setGridLogger</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start Ignite node.</span>
Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

ignite<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Info Message Logged!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_1-11-4-slf4j"><a href="#_1-11-4-slf4j" aria-hidden="true" class="header-anchor">#</a> 1.11.4.SLF4J</h3> <p>如果在启动独立集群节点时要使用SLF4J模块，需要在执行<code>ignite.{sh|bat}</code>脚本前，将<code>optional/ignite-slf4j</code>文件夹移动到Ignite发行版的<code>lib</code>目录下，这时这个模块目录中的内容会被添加到类路径。</p> <p>如果项目中使用maven进行依赖管理，那么需要添加如下的依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>将<code>${ignite.version}</code>替换为实际使用的Ignite版本。</p> <p>要使用JCL进行日志记录，需要配置<code>IgniteConfiguration</code>的<code>gridLogger</code>属性，如下所示：</p> <p>XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>gridLogger<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.logger.slf4j.Slf4jLogger<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- Other Ignite configurations --&gt;</span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Java：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteConfiguration cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

IgniteLogger log <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Slf4jLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cfg<span class="token punctuation">.</span><span class="token function">setGridLogger</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start Ignite node.</span>
Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>

ignite<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Info Message Logged!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>要了解更多的信息，可以看<a href="https://www.slf4j.org/docs.html" target="_self" rel="noopener noreferrer">SLF4J手册</a>。</p> <h3 id="_1-11-5-默认日志"><a href="#_1-11-5-默认日志" aria-hidden="true" class="header-anchor">#</a> 1.11.5.默认日志</h3> <p>Ignite默认会使用<code>java.util.logging.Logger</code>（JUL），通过<code>$IGNITE_HOME/config/java.util.logging.properties</code>配置文件进行配置，然后将日志写入<code>$IGNITE_HOME/work/log</code>文件夹，要修改这个日志目录，需要使用<code>IGNITE_LOG_DIR</code>环境变量。</p> <p>另外，Ignite启动于<em>quiet</em>模式，会阻止<code>INFO</code>和<code>DEBUG</code>日志的输出。要关闭<em>quiet</em>模式，可以使用<code>-DIGNITE_QUIET=false</code>系统属性。注意，<em>quiet</em>模式的所有信息都是输出到标准输出（STDOUT）的。</p> <div class="warning custom-block"><p class="custom-block-title">如果使用jul-to-slf4j桥，要确保配置正确</p> <p>如果使用了<code>jul-to-slf4j</code>桥，需要特别关注下Ignite中的JUL日志级别。如果在org.apache上配置了<code>DEBUG</code>级别，那么最终的日志级别会为<code>INFO</code>。这意味着在生成日志时会产生十倍的负载，然后在通过桥时被丢弃。JUL默认级别为<code>INFO</code>，在<code>org.apache.ignite.logger.java.JavaLogger#isDebugEnabled</code>中设置一个断点，会发现JUL子系统会生成<code>DEBUG</code>级别的日志。</p></div> <h2 id="_1-12-rpm和deb包安装"><a href="#_1-12-rpm和deb包安装" aria-hidden="true" class="header-anchor">#</a> 1.12.RPM和DEB包安装</h2> <h3 id="_1-12-1-摘要"><a href="#_1-12-1-摘要" aria-hidden="true" class="header-anchor">#</a> 1.12.1.摘要</h3> <p>Ignite可以通过<a href="https://www.apache.org/dist/ignite/rpm" target="_self" rel="noopener noreferrer">RPM</a>或者<a href="https://www.apache.org/dist/ignite/deb" target="_self" rel="noopener noreferrer">DEB</a>仓库进行安装。</p> <div class="warning custom-block"><p class="custom-block-title">确认Linux发行版</p> <p>Ignite的RPM/DEB包，在如下的Linux发行版中进行了验证：</p> <ul><li>Ubuntu 14.10及以上的版本；</li> <li>Debian 9.3及以上的版本；</li> <li>CentOS 7.4.1708及以上的版本</li></ul> <p>只要包可以安装，其它的发行版也是支持的。</p></div> <h3 id="_1-12-2-仓库的配置"><a href="#_1-12-2-仓库的配置" aria-hidden="true" class="header-anchor">#</a> 1.12.2.仓库的配置</h3> <p>配置Ignite的RPM或者DEB仓库，如下所示（如果必要，需要根据提示接受GPG密钥），其中包括了特定发行版的配置：</p> <p>Debian：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Install dirmngr (if not already installed) for apt-key ability to retrieve remote GPG keys</span>
<span class="token function">sudo</span> apt update
<span class="token function">sudo</span> apt <span class="token function">install</span> dirmngr --no-install-recommends
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>RPM：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">bash</span> -c <span class="token string">'cat &lt;&lt;EOF &gt; /etc/yum.repos.d/ignite.repo
[ignite]
name=Apache Ignite
baseurl=http://apache.org/dist/ignite/rpm/
gpgcheck=1
repo_gpgcheck=1
gpgkey=http://apache.org/dist/ignite/KEYS
       http://bintray.com/user/downloadSubjectPublicKey?username=bintray
EOF'</span>
<span class="token function">sudo</span> yum check-update
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>DEB：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">bash</span> -c <span class="token string">'cat &lt;&lt;EOF &gt; /etc/apt/sources.list.d/ignite.list
deb http://apache.org/dist/ignite/deb/ apache-ignite main
EOF'</span>
<span class="token function">sudo</span> apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 379CE192D401AB61
<span class="token function">sudo</span> apt update
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_1-12-3-ignite的安装"><a href="#_1-12-3-ignite的安装" aria-hidden="true" class="header-anchor">#</a> 1.12.3.Ignite的安装</h3> <p>安装Ignite的最新版：</p> <p>RPM：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> apache-ignite
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>DEB：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> apt <span class="token function">install</span> apache-ignite --no-install-recommends
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装后的结构如下：</p> <table><thead><tr><th>文件夹</th> <th>映射至</th> <th>描述</th></tr></thead> <tbody><tr><td><code>/usr/share/apache-ignite</code></td> <td></td> <td>Ignite安装的根目录</td></tr> <tr><td><code>/usr/share/apache-ignite/bin</code></td> <td></td> <td>二进制文件文件夹（脚本以及可执行程序）</td></tr> <tr><td><code>/etc/apache-ignite</code></td> <td><code>/usr/share/apache-ignite/config</code></td> <td>默认配置文件</td></tr> <tr><td><code>/var/log/apache-ignite</code></td> <td><code>/var/lib/apache-ignite/log</code></td> <td>日志目录</td></tr> <tr><td><code>/usr/lib/apache-ignite</code></td> <td><code>/usr/share/apache-ignite/libs</code></td> <td>核心和可选库</td></tr> <tr><td><code>/var/lib/apache-ignite</code></td> <td><code>/usr/share/apache-ignite/work</code></td> <td>Ignite的工作目录</td></tr> <tr><td><code>/usr/share/doc/apache-ignite</code></td> <td></td> <td>文档</td></tr> <tr><td><code>/usr/share/license/apache-ignite-&lt;version&gt;</code></td> <td></td> <td>协议</td></tr> <tr><td><code>/etc/systemd/system</code></td> <td></td> <td><code>systemd</code>服务配置</td></tr></tbody></table> <h3 id="_1-12-4-将ignite作为服务"><a href="#_1-12-4-将ignite作为服务" aria-hidden="true" class="header-anchor">#</a> 1.12.4.将Ignite作为服务</h3> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p>如果运行于Windows10 WSL或者Docker，那么需要将Ignite作为一个独立的进程（而不是一个服务），具体可以看下面的章节。</p></div> <p>用一个配置文件启动一个Ignite节点，可以这样做：<code>sudo systemctl start apache-ignite@&lt;config_name&gt;</code>，注意这里的<code>&lt;config_name&gt;</code>参数是相对于<code>/etc/apache-ignite</code>文件夹的。</p> <p>运行Ignite服务：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl start apache-ignite@default-config.xml    <span class="token comment"># start Ignite service</span>
journalctl -fe                                           <span class="token comment"># check logs</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果要开启随着系统启动而节点自动重启，如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl <span class="token function">enable</span> apache-ignite@<span class="token operator">&lt;</span>config name<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_1-12-5-将ignite作为独立进程"><a href="#_1-12-5-将ignite作为独立进程" aria-hidden="true" class="header-anchor">#</a> 1.12.5.将Ignite作为独立进程</h3> <p>使用下面的命令，可以将Ignite启动为一个独立的进程（先要切换到<code>/usr/share/apache-ignite</code>），如果要修改默认的配置，可以更新<code>/etc/apache-ignite/default-config.xml</code>文件。</p> <p>首先，切换到<code>ignite</code>用户，如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> -u ignite /usr/bin/env <span class="token function">bash</span>    <span class="token comment"># switch to ignite user</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后切换到Ignite的bin文件夹，启动一个节点：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cd</span> /usr/share/apache-ignite         <span class="token comment"># navigate to Ignite home folder</span>
bin/ignite.sh                       <span class="token comment"># run Ignite with default configuration</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_1-12-6-在windows10-wsl中运行ignite"><a href="#_1-12-6-在windows10-wsl中运行ignite" aria-hidden="true" class="header-anchor">#</a> 1.12.6.在Windows10 WSL中运行Ignite</h3> <p><strong>网络配置</strong></p> <p>在Windows 10 WSL环境下运行Ignite，需要对具有高级安全的Windows防御防火墙进行正确的配置：</p> <ul><li>运行<code>具有高级安全的Windows防御防火墙</code>；</li> <li>选择左侧的<code>入站规则</code>菜单；</li> <li>选择右侧的<code>新建规则</code>菜单；</li> <li>选择<code>程序</code>复选框然后点击<code>下一步</code>；</li> <li>在<code>程序路径</code>字段中输入<code>%SystemRoot%\System32\wsl.exe</code>，然后点击<code>下一步</code>；</li> <li>选择<code>允许连接</code>复选框，然后点击<code>下一步</code>；</li> <li>选择<code>域</code>、<code>私有</code>和<code>公开</code>复选框，然后点击<code>下一步</code>；</li> <li>在<code>名字</code>字段中给起个名字（在<code>描述</code>字段中，也可以可选地写一段描述），然后点击<code>完成</code>。</li></ul> <p>这个配置好的规则将允许Windows 10 WSL环境中的Ignite节点暴露于局域网中。</p> <p><strong>启动Ignite集群</strong></p> <p>由于特殊的网络堆栈实现，如果要在一个Windows10 WSL环境中运行多个节点，需要对配置进行自定义（可以看下面的<code>wsl-default-config</code>），启动命令如下：<code>bin/ignite.sh config/wsl-default-config.xml -J-DNODE=&lt;00..99&gt;</code>。</p> <p>wsl-default-config.xml：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>placeholderConfig<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.springframework.beans.factory.config.PropertyPlaceholderConfigurer<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ignite.cfg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>discoverySpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>localPort<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>475${NODE}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ipFinder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.discovery.tcp.ipfinder.multicast.TcpDiscoveryMulticastIpFinder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>addresses<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>127.0.0.1:47500..47599<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>communicationSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.communication.tcp.TcpCommunicationSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>localPort<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>481${NODE}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>首先，以<code>ignite</code>用户登录，如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> -u ignite /usr/bin/env <span class="token function">bash</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后转到Ignite的主文件夹，然后在本地启动希望数量的节点（最多100）：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Navigate to Ignite home folder</span>
<span class="token function">cd</span> /usr/share/apache-ignite

<span class="token comment"># Run several local nodes</span>
bin/ignite.sh config/wsl-default-config.xml -J-DNODE<span class="token operator">=</span>00 <span class="token operator">&amp;</span>
bin/ignite.sh config/wsl-default-config.xml -J-DNODE<span class="token operator">=</span>01 <span class="token operator">&amp;</span>
<span class="token punctuation">..</span>.
bin/ignite.sh config/wsl-default-config.xml -J-DNODE<span class="token operator">=</span>99 <span class="token operator">&amp;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_1-13-异常处理"><a href="#_1-13-异常处理" aria-hidden="true" class="header-anchor">#</a> 1.13.异常处理</h2> <p>下表描述了Ignite API支持的异常以及可以用来处理这些异常的操作。可以查看javadoc中的<code>throws</code>子句，查看是否存在已检查异常。</p> <table><thead><tr><th>异常</th> <th>描述</th> <th>要采取的动作</th> <th>运行时异常</th></tr></thead> <tbody><tr><td><code>IgniteException</code></td> <td>此异常表示网格中存在错误。</td> <td>操作失败，从方法退出。</td> <td>是</td></tr> <tr><td><code>IgniteClientDisconnectedException</code></td> <td>当客户端节点与集群断开连接时，Ignite API（缓存操作、计算API和数据结构操作）会抛出此异常。</td> <td>在<code>future</code>中等待并重试。</td> <td>是</td></tr> <tr><td><code>IgniteAuthenticationException</code></td> <td>当节点身份验证失败或安全身份验证失败时，会抛出此异常。</td> <td>操作失败，从方法退出。</td> <td>否</td></tr> <tr><td><code>IgniteClientException</code></td> <td>缓存操作会抛出此异常。</td> <td>根据异常消息确定下一步的动作。</td> <td>是</td></tr> <tr><td><code>IgniteDeploymentException</code></td> <td>当Ignite API（计算网格相关）未能在节点上部署作业或任务时，会抛出此异常。</td> <td>操作失败，从方法退出。</td> <td>是</td></tr> <tr><td><code>IgniteInterruptedException</code></td> <td>此异常用于将标准<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/InterruptedException.html" target="_self" rel="noopener noreferrer">InterruptedException</a>包装为<code>IgniteException</code>。</td> <td>清除中断标志后重试。</td> <td>是</td></tr> <tr><td><code>IgniteSpiException</code></td> <td>SPI引发的异常，如<code>CollisionSpi</code>、<code>LoadBalancingSpi</code>、<br><code>TcpDiscoveryIpFinder</code>、<code>FailoverSpi</code>、<code>UriDeploymentSpi</code>等。</td> <td>操作失败，从方法退出。</td> <td>是</td></tr> <tr><td><code>IgniteSQLException</code></td> <td>SQL查询处理失败会抛出此异常，该异常会包含相关规范定义的<a href="https://static.javadoc.io/org.apache.ignite/ignite-core/2.5.0/org/apache/ignite/internal/processors/cache/query/IgniteQueryErrorCode.html" target="_self" rel="noopener noreferrer">错误代码</a>。</td> <td>操作失败，从方法退出。</td> <td>是</td></tr> <tr><td><code>IgniteAccessControlException</code></td> <td>认证/授权失败时会抛出此异常。</td> <td>操作失败，从方法退出。</td> <td>否</td></tr> <tr><td><code>IgniteCacheRestartingException</code></td> <td>如果缓存正在重启，Ignite的缓存API会抛出此异常。</td> <td>在<code>future</code>中等待并重试。</td> <td>是</td></tr> <tr><td><code>IgniteFutureTimeoutException</code></td> <td>当<code>future</code>的计算超时时，会抛出此异常。</td> <td>要么增加超时限制要么方法退出。</td> <td>是</td></tr> <tr><td><code>IgniteFutureCancelledException</code></td> <td>当<code>future</code>的计算因为被取消而无法获得结果时，会抛出此异常。</td> <td>可进行重试。</td> <td>是</td></tr> <tr><td><code>IgniteIllegalStateException</code></td> <td>此异常表示Ignite实例对于请求的操作处于无效状态。</td> <td>操作失败，从方法退出。</td> <td>是</td></tr> <tr><td><code>IgniteNeedReconnectException</code></td> <td>此异常显示节点应尝试重新连接到集群。</td> <td>可进行重试。</td> <td>否</td></tr> <tr><td><code>IgniteDataIntegrityViolationException</code></td> <td>如果发现数据完整性冲突，会抛出此异常。</td> <td>操作失败，从方法退出。</td> <td>是</td></tr> <tr><td><code>IgniteOutOfMemoryException</code></td> <td>系统没有足够内存处理Ignite操作（缓存操作）时，会抛出此异常。</td> <td>操作失败，从方法退出。</td> <td>是</td></tr> <tr><td><code>IgniteTxOptimisticCheckedException</code></td> <td>当事务以乐观方式失败时，会抛出此异常。</td> <td>可进行重试</td> <td>否</td></tr> <tr><td><code>IgniteTxRollbackCheckedException</code></td> <td>当事务自动回滚时，会抛出此异常。</td> <td>可进行重试。</td> <td>否</td></tr> <tr><td><code>IgniteTxTimeoutCheckedException</code></td> <td>当事务超时时，会抛出此异常。</td> <td>可进行重试。</td> <td>否</td></tr> <tr><td><code>ClusterTopologyException</code></td> <td>当集群拓扑发生错误（比如节点故障）时会抛出此异常（针对计算和事件API）。</td> <td>在<code>future</code>中等待并重试。</td> <td>是</td></tr></tbody></table> <h2 id="_1-14-faq"><a href="#_1-14-faq" aria-hidden="true" class="header-anchor">#</a> 1.14.FAQ</h2> <p><strong>1.堆内和堆外内存存储有何不同？</strong></p> <p>当处理很大的堆时，通过在Java主堆空间外部缓存数据，可以使缓存克服漫长的JVM垃圾收集（GC）导致的暂停，但是数据仍然在内存中。
<a href="https://apacheignite.readme.io/docs/off-heap-memory" target="_self" rel="noopener noreferrer">更多信息</a></p> <p><strong>2.Apache Ignite是一个键值存储么？</strong></p> <p>Apache Ignite是一个具有计算能力的、有弹性的内存中的分布式对象存储。在其最简单的形式中，是的，Apache Ignite可以作为一个键/值存储（缓存），但是也暴露了更丰富的API来与数据交互，比如完整的ANSI99兼容的SQL查询、文本检索、事务等等。
<a href="https://apacheignite.readme.io/docs/jcache" target="_self" rel="noopener noreferrer">更多信息</a></p> <p><strong>3.Apache Ignite是否支持JSON文档？</strong></p> <p>当前，Apache Ignite并不完整支持JSON文档，但是当前处于beta阶段的Node.js客户端会支持JSON文档。</p> <p><strong>4.Apache Ignite是否可以用于Apache Hive？</strong></p> <p>是，Apache Ignite的Hadoop加速器提供了一系列的组件，支持在任何的Hadoop发行版中执行内存中的Hadoop作业执行和文件系统操作，包括Apache Hive。
<a href="https://apacheignite-fs.readme.io/docs/running-apache-hive-over-ignited-hadoop" target="_self" rel="noopener noreferrer">在Ignite化的Hadoop中运行Apache Hive</a></p> <p><strong>5.在事务隔离的悲观模式中，是否锁定键的读和写？</strong></p> <p>是的，主要的问题在于，在<code>悲观</code>模式中，访问是会获得锁，而在<code>乐观</code>模式中，锁是在提交阶段获得的。
<a href="https://apacheignite.readme.io/docs/transactions" target="_self" rel="noopener noreferrer">更多信息</a></p> <p><strong>6.是否可以用Hibernate访问Apache Ignite？</strong></p> <p>是的，Apache Ignite可以用作Hibernate的二级缓存（或者L2缓存），它可以显著地提升应用的持久化层的速度。
<a href="https://apacheignite.readme.io/docs/hibernate-l2-cache" target="_self" rel="noopener noreferrer">更多信息</a></p> <p><strong>7.Apache Ignite是否支持JDBC？</strong></p> <p>是的，Apache Ignite提供了JDBC驱动，可以在缓存中使用标准SQL查询和JDBC API获得分布式的数据。
<a href="https://apacheignite.readme.io/docs/jdbc-driver" target="_self" rel="noopener noreferrer">更多信息</a></p> <p><strong>8.Apache Ignite是否保证消息的顺序？</strong></p> <p>是的，如果希望收到消息的顺序与发送消息的顺序一致，可以使用<code>sendOrdered(...)</code>方法。可以传递一个超时时间来指定一条消息在队列中的等待时间，它会等待本来应在其之前发送的消息。如果超时时间过期，所有的还没有到达该节点中一个给定主题的消息都会被忽略。
<a href="https://apacheignite.readme.io/docs/messaging" target="_self" rel="noopener noreferrer">更多信息</a></p> <p><strong>9.是否可以运行Java和.Net闭包？它是如何工作的？</strong></p> <p>.Net节点可以同时执行Java和.Net闭包，而标准Java节点只能执行Java闭包。当启动ApacheIgnite.exe时，它会使用位于<code>IGNITE_HOME/platforms/dotnet/bin</code>的一个脚本在同一个进程下同时启动JVM和CLR，.Net闭包会被CLR处理执行。</p> <p><strong>10.Java和.Net之间的转换成本是什么？</strong></p> <p>仅有的最小可能的开销是一个额外的数组复制+JNI调用，在本地测试时这个开销可能降低性能，但在真正的分布式负载环境下可以忽略不计。</p> <p><strong>11.闭包是如何传输的？</strong></p> <p>每个闭包都是一个特定类的对象。当它要被发送时会序列化成二进制的形式，通过线路发送到一个远程节点然后在那里反序列化。该远程节点在类路径中应该有该闭包类，或者开启peerClassLoading以从发送端加载该类。</p> <p><strong>12.SQL查询是否被负载平衡？</strong></p> <p>SQL查询总是被广播到保存有要查询的数据的每个节点，例外就是本地SQL查询(query.setLocal(true))，它只是在一个本地节点执行，还有就是可以精确标识节点的部分查询。</p> <p><strong>13.用户是否可以控制资源分配？即，是否可以限制用户A为50个节点，但是用户B可以在所有的100个节点上执行任务？</strong></p> <p>多租户只在缓存中存在，它们可以在创建在一个节点的子集上（可以看<code>CacheConfiguration.setNodeFilter</code>）以及在每个缓存基础上安全地赋予权限。</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间：: </span> <span class="time">2/14/2019, 11:22:59 AM</span></div></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/doc/java/Clustering.html">
          2.集群化
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.e2badc4a.js" defer></script><script src="/assets/js/92.bae3e01d.js" defer></script>
  </body>
</html>
