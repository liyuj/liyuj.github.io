<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>15.机器学习网格 | Apache Ignite中文站</title>
    <meta name="description" content="Ignite内存计算平台的中文文档及相关资料">
    <link rel="shortcut icon" type="image/x-icon" href="https://ignite.apache.org/favicon.ico">
  <script src="https://hm.baidu.com/hm.js?03f40be28ff9a31fd798fd6b9dac0946"></script>
    
    <link rel="preload" href="/assets/css/0.styles.2f07efcc.css" as="style"><link rel="preload" href="/assets/js/app.c10ccc02.js" as="script"><link rel="preload" href="/assets/js/22.3a608efe.js" as="script"><link rel="prefetch" href="/assets/js/10.60912227.js"><link rel="prefetch" href="/assets/js/11.112220d4.js"><link rel="prefetch" href="/assets/js/12.187ba699.js"><link rel="prefetch" href="/assets/js/13.84b45d53.js"><link rel="prefetch" href="/assets/js/14.775279aa.js"><link rel="prefetch" href="/assets/js/15.3feeb0d0.js"><link rel="prefetch" href="/assets/js/16.ce9ac455.js"><link rel="prefetch" href="/assets/js/17.072b8b0d.js"><link rel="prefetch" href="/assets/js/18.f35d5c65.js"><link rel="prefetch" href="/assets/js/19.b9e36588.js"><link rel="prefetch" href="/assets/js/2.146adad1.js"><link rel="prefetch" href="/assets/js/20.ed5bbb2a.js"><link rel="prefetch" href="/assets/js/21.f1daec06.js"><link rel="prefetch" href="/assets/js/23.2525050a.js"><link rel="prefetch" href="/assets/js/24.ea66fb7e.js"><link rel="prefetch" href="/assets/js/25.4f0cd6cf.js"><link rel="prefetch" href="/assets/js/26.3cf5ce71.js"><link rel="prefetch" href="/assets/js/27.8e13a920.js"><link rel="prefetch" href="/assets/js/28.92e624c1.js"><link rel="prefetch" href="/assets/js/29.da11026d.js"><link rel="prefetch" href="/assets/js/3.b582b299.js"><link rel="prefetch" href="/assets/js/30.a00aae0f.js"><link rel="prefetch" href="/assets/js/31.e8419146.js"><link rel="prefetch" href="/assets/js/32.fc892370.js"><link rel="prefetch" href="/assets/js/33.dd62f999.js"><link rel="prefetch" href="/assets/js/34.dea7b900.js"><link rel="prefetch" href="/assets/js/35.0c8bf95e.js"><link rel="prefetch" href="/assets/js/36.0624ab50.js"><link rel="prefetch" href="/assets/js/37.e6bc2960.js"><link rel="prefetch" href="/assets/js/38.07272dbb.js"><link rel="prefetch" href="/assets/js/39.e6b10ad6.js"><link rel="prefetch" href="/assets/js/4.6368427a.js"><link rel="prefetch" href="/assets/js/40.963d3b41.js"><link rel="prefetch" href="/assets/js/41.06c85aff.js"><link rel="prefetch" href="/assets/js/42.285a7cab.js"><link rel="prefetch" href="/assets/js/43.8ea19614.js"><link rel="prefetch" href="/assets/js/44.950523c0.js"><link rel="prefetch" href="/assets/js/45.20cc6649.js"><link rel="prefetch" href="/assets/js/46.de123505.js"><link rel="prefetch" href="/assets/js/47.a1d1cb78.js"><link rel="prefetch" href="/assets/js/48.68fe87d7.js"><link rel="prefetch" href="/assets/js/49.67bcca01.js"><link rel="prefetch" href="/assets/js/5.ff00980f.js"><link rel="prefetch" href="/assets/js/50.c70aa03c.js"><link rel="prefetch" href="/assets/js/51.f57160c0.js"><link rel="prefetch" href="/assets/js/52.4fcac289.js"><link rel="prefetch" href="/assets/js/53.7c7f06e5.js"><link rel="prefetch" href="/assets/js/54.6e65cf7f.js"><link rel="prefetch" href="/assets/js/55.d95a2312.js"><link rel="prefetch" href="/assets/js/56.0ab7fb98.js"><link rel="prefetch" href="/assets/js/57.edacf517.js"><link rel="prefetch" href="/assets/js/58.a0534115.js"><link rel="prefetch" href="/assets/js/59.a1c54c3b.js"><link rel="prefetch" href="/assets/js/6.56ec278a.js"><link rel="prefetch" href="/assets/js/60.aba7056a.js"><link rel="prefetch" href="/assets/js/61.361d72ff.js"><link rel="prefetch" href="/assets/js/62.f6436dd6.js"><link rel="prefetch" href="/assets/js/63.45c29a3e.js"><link rel="prefetch" href="/assets/js/64.fd9b6b15.js"><link rel="prefetch" href="/assets/js/65.419f6ae0.js"><link rel="prefetch" href="/assets/js/66.0ddacd8c.js"><link rel="prefetch" href="/assets/js/67.7cc334ca.js"><link rel="prefetch" href="/assets/js/68.b79bc8b4.js"><link rel="prefetch" href="/assets/js/69.d5e6fd87.js"><link rel="prefetch" href="/assets/js/7.c2a445c7.js"><link rel="prefetch" href="/assets/js/70.8fba6959.js"><link rel="prefetch" href="/assets/js/71.959f5030.js"><link rel="prefetch" href="/assets/js/72.91efcf94.js"><link rel="prefetch" href="/assets/js/73.a66dbfa9.js"><link rel="prefetch" href="/assets/js/74.69b616f1.js"><link rel="prefetch" href="/assets/js/75.5d8414fe.js"><link rel="prefetch" href="/assets/js/76.9216bc92.js"><link rel="prefetch" href="/assets/js/77.2b6f58b9.js"><link rel="prefetch" href="/assets/js/78.23035e6c.js"><link rel="prefetch" href="/assets/js/79.cb127c47.js"><link rel="prefetch" href="/assets/js/8.cdf084fa.js"><link rel="prefetch" href="/assets/js/80.126d1550.js"><link rel="prefetch" href="/assets/js/81.e8372e53.js"><link rel="prefetch" href="/assets/js/82.57358aa4.js"><link rel="prefetch" href="/assets/js/83.87daf194.js"><link rel="prefetch" href="/assets/js/84.deab7d85.js"><link rel="prefetch" href="/assets/js/85.e5559dd3.js"><link rel="prefetch" href="/assets/js/86.82a3ea5b.js"><link rel="prefetch" href="/assets/js/87.9259131e.js"><link rel="prefetch" href="/assets/js/88.f298d27d.js"><link rel="prefetch" href="/assets/js/89.e7fa3249.js"><link rel="prefetch" href="/assets/js/9.657947c0.js"><link rel="prefetch" href="/assets/js/90.c0e9f24c.js"><link rel="prefetch" href="/assets/js/91.ecc95cbc.js"><link rel="prefetch" href="/assets/js/92.8003e6a1.js"><link rel="prefetch" href="/assets/js/93.16879087.js"><link rel="prefetch" href="/assets/js/94.e7936529.js"><link rel="prefetch" href="/assets/js/95.3d2bf7af.js"><link rel="prefetch" href="/assets/js/96.1e6838e6.js"><link rel="prefetch" href="/assets/js/97.de37ccbd.js"><link rel="prefetch" href="/assets/js/98.f20d2fa6.js"><link rel="prefetch" href="/assets/js/99.e4d481a2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2f07efcc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/doc/2.6.0/" class="home-link router-link-active"><!----> <span class="site-name">Apache Ignite中文站</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/doc/2.6.0/" class="nav-link">首页</a></div><div class="nav-item"><a href="/doc/2.6.0/java/" class="nav-link router-link-active">Java</a></div><div class="nav-item"><a href="/doc/2.6.0/sql/" class="nav-link">SQL</a></div><div class="nav-item"><a href="/doc/2.6.0/integration/" class="nav-link">集成</a></div><div class="nav-item"><a href="/doc/2.6.0/spark/" class="nav-link">Ignite&amp;Spark</a></div><div class="nav-item"><a href="/doc/2.6.0/tools/" class="nav-link">工具</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://www.gridgainchina.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GridGain中国官网
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">2.6.0</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">2.7.0</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/java/MachineLearningGrid.html" class="nav-link router-link-exact-active router-link-active">2.6.0</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/doc/2.6.0/" class="nav-link">首页</a></div><div class="nav-item"><a href="/doc/2.6.0/java/" class="nav-link router-link-active">Java</a></div><div class="nav-item"><a href="/doc/2.6.0/sql/" class="nav-link">SQL</a></div><div class="nav-item"><a href="/doc/2.6.0/integration/" class="nav-link">集成</a></div><div class="nav-item"><a href="/doc/2.6.0/spark/" class="nav-link">Ignite&amp;Spark</a></div><div class="nav-item"><a href="/doc/2.6.0/tools/" class="nav-link">工具</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://www.gridgainchina.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GridGain中国官网
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">2.6.0</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">2.7.0</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/java/MachineLearningGrid.html" class="nav-link router-link-exact-active router-link-active">2.6.0</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/doc/2.6.0/java/" class="sidebar-link">1.基本概念</a></li><li><a href="/doc/2.6.0/java/Clustering.html" class="sidebar-link">2.集群化</a></li><li><a href="/doc/2.6.0/java/Key-ValueDataGrid.html" class="sidebar-link">3.键-值数据网格</a></li><li><a href="/doc/2.6.0/java/Security.html" class="sidebar-link">4.安全</a></li><li><a href="/doc/2.6.0/java/DataLoadingStreaming.html" class="sidebar-link">5.数据注入和流处理</a></li><li><a href="/doc/2.6.0/java/DistributedDataStructures.html" class="sidebar-link">6.分布式数据结构</a></li><li><a href="/doc/2.6.0/java/ComputeGrid.html" class="sidebar-link">7.计算网格</a></li><li><a href="/doc/2.6.0/java/ServiceGrid.html" class="sidebar-link">8.服务网格</a></li><li><a href="/doc/2.6.0/java/MessagingEvents.html" class="sidebar-link">9.消息和事件</a></li><li><a href="/doc/2.6.0/java/DurableMemory.html" class="sidebar-link">10.固化内存</a></li><li><a href="/doc/2.6.0/java/ProductionReadiness.html" class="sidebar-link">11.生产准备</a></li><li><a href="/doc/2.6.0/java/PlatformsProtocols.html" class="sidebar-link">12.平台和协议</a></li><li><a href="/doc/2.6.0/java/Plugins.html" class="sidebar-link">13.插件</a></li><li><a href="/doc/2.6.0/java/Deployment.html" class="sidebar-link">14.部署</a></li><li><a href="/doc/2.6.0/java/MachineLearningGrid.html" class="active sidebar-link">15.机器学习网格</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-1-机器学习网格" class="sidebar-link">15.1.机器学习网格</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-1-1-摘要" class="sidebar-link">15.1.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-1-2-算法和适用性" class="sidebar-link">15.1.2.算法和适用性</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-1-3-入门" class="sidebar-link">15.1.3.入门</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-2-预处理" class="sidebar-link">15.2.预处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-2-1-摘要" class="sidebar-link">15.2.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-2-2-规范化预处理器" class="sidebar-link">15.2.2.规范化预处理器</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-2-3-示例" class="sidebar-link">15.2.3.示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-3-分区化的数据集" class="sidebar-link">15.3.分区化的数据集</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-3-1-摘要" class="sidebar-link">15.3.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-3-2-使用" class="sidebar-link">15.3.2.使用</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-3-3-示例" class="sidebar-link">15.3.3.示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-4-线性回归" class="sidebar-link">15.4.线性回归</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-4-1-摘要" class="sidebar-link">15.4.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-4-2-模型" class="sidebar-link">15.4.2.模型</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-4-3-训练法" class="sidebar-link">15.4.3.训练法</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-4-4-示例" class="sidebar-link">15.4.4.示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-5-k-均值聚类" class="sidebar-link">15.5.K-均值聚类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-5-1-模型" class="sidebar-link">15.5.1.模型</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-5-2-训练法" class="sidebar-link">15.5.2.训练法</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-5-3-示例" class="sidebar-link">15.5.3.示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-6-遗传算法" class="sidebar-link">15.6.遗传算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-6-1-摘要" class="sidebar-link">15.6.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-6-2-使用" class="sidebar-link">15.6.2.使用</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-6-3-启动" class="sidebar-link">15.6.3.启动</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-6-4-apache-zeppelin集成" class="sidebar-link">15.6.4.Apache Zeppelin集成</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-6-5-词汇表" class="sidebar-link">15.6.5.词汇表</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-7-多层感知" class="sidebar-link">15.7.多层感知</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-7-1-摘要" class="sidebar-link">15.7.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-7-2-模型" class="sidebar-link">15.7.2.模型</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-7-3-训练法" class="sidebar-link">15.7.3.训练法</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-7-4-示例" class="sidebar-link">15.7.4.示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-8-决策树" class="sidebar-link">15.8.决策树</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-8-1-摘要" class="sidebar-link">15.8.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-8-2-模型" class="sidebar-link">15.8.2.模型</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-8-3-训练法" class="sidebar-link">15.8.3.训练法</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-8-4-示例" class="sidebar-link">15.8.4.示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-9-k-nn分类" class="sidebar-link">15.9.k-NN分类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-9-1-模型" class="sidebar-link">15.9.1.模型</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-9-2-示例" class="sidebar-link">15.9.2.示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-10-k-nn回归" class="sidebar-link">15.10.k-NN回归</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-10-1-模型" class="sidebar-link">15.10.1.模型</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-10-2-示例" class="sidebar-link">15.10.2.示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-11-svm二进制分类" class="sidebar-link">15.11.SVM二进制分类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-11-1-模型" class="sidebar-link">15.11.1.模型</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-11-2-训练法" class="sidebar-link">15.11.2.训练法</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-11-3-示例" class="sidebar-link">15.11.3.示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-12-svm多类分类" class="sidebar-link">15.12.SVM多类分类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-12-1-模型" class="sidebar-link">15.12.1.模型</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-12-2-训练法" class="sidebar-link">15.12.2.训练法</a></li><li class="sidebar-sub-header"><a href="/doc/2.6.0/java/MachineLearningGrid.html#_15-12-3-示例" class="sidebar-link">15.12.3.示例</a></li></ul></li></ul></li><li><a href="/doc/2.6.0/java/Persistence.html" class="sidebar-link">16.持久化</a></li><li><a href="/doc/2.6.0/java/TestsAndBenchmarking.html" class="sidebar-link">17.基准测试</a></li><li><a href="/doc/2.6.0/java/Metrics.html" class="sidebar-link">18.指标</a></li><li><a href="/doc/2.6.0/java/ThinClients.html" class="sidebar-link">19.瘦客户端</a></li><li><a href="/doc/2.6.0/java/KubernetesDeployment.html" class="sidebar-link">20.Kubernetes部署</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="_15-机器学习网格"><a href="#_15-机器学习网格" aria-hidden="true" class="header-anchor">#</a> 15.机器学习网格</h1> <h2 id="_15-1-机器学习网格"><a href="#_15-1-机器学习网格" aria-hidden="true" class="header-anchor">#</a> 15.1.机器学习网格</h2> <h3 id="_15-1-1-摘要"><a href="#_15-1-1-摘要" aria-hidden="true" class="header-anchor">#</a> 15.1.1.摘要</h3> <p>Ignite的机器学习（ML）是一组简单的、可扩展以及高效的工具，在不需要成本高昂的数据转换的前提下，就可以构建可预测的机器学习模型。</p> <p>将机器和深度学习加入Ignite的原理是很简单的，当前，如果要想让机器学习成为主流，数据科学家要解决两个主要的问题：</p> <ul><li>首先，模型是在不同的系统中训练和部署（训练结束之后）的，数据科学家需要等待ETL或者其他的数据传输过程，来将数据移至比如Apache Mahout或者Apache Spark这样的系统进行训练，然后还要等待这个过程结束并且将模型部署到生产环境。在系统间移动TB级的数据可能花费数小时的时间，此外，训练部分通常发生在旧的数据集上；</li> <li>第二个问题和扩展性有关。机器学习和深度学习需要处理的数据量不断增长，已经无法放在单一的服务器上。这促使数据科学家要么提出更复杂的解决方案，要么切换到比如Spark或者TensorFlow这样的分布式计算平台上。但是这些平台通常只能解决模型训练的一部分问题，这给开发者之后的生产部署带来了很多的困难。
<img src="https://files.readme.io/6def194-machine_learning-2.png" alt></li></ul> <p><strong>无ETL和大规模可扩展性</strong></p> <p>Ignite的机器学习依赖于Ignite基于内存的存储，这给机器学习和深度学习任务带来了大规模的扩展性，并且取消了在不同系统间进行ETL产生的等待。比如，在Ignite集群的内存和磁盘中存储的数据上，开发者可以直接进行深度学习和机器学习的训练和推理，然后，Ignite提供了一系列的机器学习和深度学习算法，对Ignite的分布式并置处理进行优化，这样在处理大规模的数据集或者不断增长的输入数据流时，这样的实现提供了内存级的速度和近乎无限的扩展性，而不需要将数据移到另外的存储。通过消除数据的移动以及长时间的处理等待，Ignite的机器学习可以持续地进行学习，可以在最新数据到来之时实时地对决策进行改进。</p> <p><strong>容错和持续学习</strong></p> <p>Ignite的机器学习能够对节点的故障容错。这意味着如果在学习期间节点出现故障，所有的恢复过程对用户是透明的，学习过程不会被中断，就像所有节点都正常那样获得结果。</p> <h3 id="_15-1-2-算法和适用性"><a href="#_15-1-2-算法和适用性" aria-hidden="true" class="header-anchor">#</a> 15.1.2.算法和适用性</h3> <p><strong>分类</strong></p> <p>根据训练的数据集，对标的的种类进行标识。</p> <p><em>适用领域</em>：垃圾邮件检测、图像识别、信用评分、疾病识别。</p> <p><em>算法</em>：支持向量机（SVM）、最近邻、决策树分类和神经网络。</p> <p><strong>回归</strong></p> <p>对因变量y与一个或多个解释变量（或自变量）x之间的关系进行建模。</p> <p><em>适用领域</em>：药物反应，股票价格，超市收入。</p> <p><em>算法</em>：线性回归、决策树回归、最近邻和神经网络。</p> <p><strong>聚类</strong></p> <p>对对象进行分组的方式，即在同一个组（叫做簇）中的对象（某种意义上）比其它簇中的对象更相似。</p> <p><em>适用领域</em>：客户细分、实验结果分组、购物项目分组。</p> <p><em>算法</em>：K均值</p> <p><strong>预处理</strong></p> <p>特征提取和规范化。</p> <p><em>适用领域</em>：对比如文本这样的输入数据进行转换，以便用于机器学习算法，然后提取需要拟合的特征，对数据进行规范化。</p> <p><em>算法</em>：Ignite的机器学习支持使用分区化的数据集自定义预处理，同时也有默认的预处理器。</p> <h3 id="_15-1-3-入门"><a href="#_15-1-3-入门" aria-hidden="true" class="header-anchor">#</a> 15.1.3.入门</h3> <p>机器学习入门的最快方式是构建和运行示例代码，学习它的输出和代码，机器学习的的示例代码位于Ignite发行版的<code>examples</code>文件夹中。</p> <p>下面是相关的步骤：</p> <ol><li>下载Ignite的2.4及以后的版本；</li> <li>在比如IntelliJ IDEA或者Eclipse这样的IDE中打开<code>examples</code>工程；</li> <li>在IDE中打开<code>src/main/java/org/apache/ignite/examples/ml</code>文件夹然后运行ML或者DL的示例。</li></ol> <p>这些示例不需要特别的配置，所有的ML或者DL示例在没有人为干预的情况下，都可以正常地启动、运行、停止，然后在控制台中输出有意义的信息。另外，还支持一个跟踪器API示例，它会启动一个Web浏览器然后生成一些HTML输出。</p> <p><strong>通过Maven获取</strong></p> <p>在工程中像下面这样添加Maven依赖后，就可以使用Ignite提供的机器学习功能：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-ml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
&lt;/dependency
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>将<code>${ignite-version}</code>替换为实际使用的Ignite版本。</p> <p><strong>从源代码构建</strong></p> <p>Ignite机器学习最新版的jar包已经上传到Maven仓库，如果需要获取该jar包然后部署到特定的环境中，那么要么从Maven仓库中进行下载，或者从源代码进行构建，如果要从源代码进行构建，按照如下步骤进行操作：</p> <ul><li>下载Ignite最新发行版的源代码；</li> <li>清空Maven的本地仓库（这个是避免旧版本的可能影响）；</li> <li>从工程的根目录构建并安装Ignite；</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mvn clean <span class="token function">install</span> -DskipTests -Dmaven.javadoc.skip<span class="token operator">=</span>true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>在本地仓库的<code>{user_dir}/.m2/repository/org/apache/ignite/ignite-ml/{ignite-version}/ignite-ml-{ignite-version}.jar</code>中找到机器学习的jar包；</li> <li>如果要从源代码构建ML或者DL的示例，执行如下的命令：</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cd</span> examples
mvn clean package -DskipTests
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果必要，可以参考项目根目录的<code>DEVNOTES.txt</code>文件以及<code>ignite-ml</code>模块的<code>README</code>文件，以了解更多的信息。</p> <h2 id="_15-2-预处理"><a href="#_15-2-预处理" aria-hidden="true" class="header-anchor">#</a> 15.2.预处理</h2> <h3 id="_15-2-1-摘要"><a href="#_15-2-1-摘要" aria-hidden="true" class="header-anchor">#</a> 15.2.1.摘要</h3> <p>预处理是将存储于Ignite中的原始数据转换为特征向量，以便于机器学习算法的进一步使用，这个过程可以被视为一个转换链。正常流程是从Ignite数据中提取特征，对特征进行转换然后进行规范化，相关的转换代码如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Define feature extractor.</span>
IgniteBiFunction<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> extractor <span class="token operator">=</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> v<span class="token punctuation">;</span>

<span class="token comment">// Define feature transformer on top of extractor.</span>
IgniteBiFunction<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> extractorTransformer <span class="token operator">=</span> 
    extractor<span class="token punctuation">.</span><span class="token function">andThen</span><span class="token punctuation">(</span>v <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token function">transform</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define feature normalizer on top of transformer and extractor.</span>
IgniteBiFunction<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> extractorTransformerNormalizer <span class="token operator">=</span> 
    normalizationTrainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>ignite<span class="token punctuation">,</span> upstreamCache<span class="token punctuation">,</span> transformer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_15-2-2-规范化预处理器"><a href="#_15-2-2-规范化预处理器" aria-hidden="true" class="header-anchor">#</a> 15.2.2.规范化预处理器</h3> <p>除了可以自定义预处理器之外，Ignite还提供了一个内置的规范化预处理器，它会根据如下的函数对间隔的[0,1]进行规范化。
<img src="https://files.readme.io/ae0ef26-CodeCogsEqn_2.gif" alt>
为了规范化，需要创建一个<code>NormalizationTrainer</code>，然后将其与规范化预处理器进行匹配：</p> <p>基于缓存的数据集：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create normalization trainer.</span>
NormalizationTrainer<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> normalizationTrainer <span class="token operator">=</span> 
    <span class="token keyword">new</span> <span class="token class-name">NormalizationTrainer</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train normalization preprocessor.</span>
IgniteBiFunction<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> preprocessor <span class="token operator">=</span>
    normalizationTrainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
        ignite<span class="token punctuation">,</span>
        upstreamCache<span class="token punctuation">,</span>
        <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>coordinates
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create linear regression trainer.</span>
LinearRegressionLSQRTrainer trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinearRegressionLSQRTrainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train model.</span>
LinearRegressionModel mdl <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
    ignite<span class="token punctuation">,</span>
    upstreamCache<span class="token punctuation">,</span>
    preprocessor<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>label
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make a prediction. </span>
<span class="token keyword">double</span> prediction <span class="token operator">=</span> mdl<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>preprocessor<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>本地数据集：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create normalization trainer.</span>
NormalizationTrainer<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> normalizationTrainer <span class="token operator">=</span> 
    <span class="token keyword">new</span> <span class="token class-name">NormalizationTrainer</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train normalization preprocessor.</span>
IgniteBiFunction<span class="token operator">&lt;</span>Integer<span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> preprocessor <span class="token operator">=</span>
    normalizationTrainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
        upstreamMap<span class="token punctuation">,</span>
        <span class="token number">10</span><span class="token punctuation">,</span>          <span class="token comment">// Number of partitions.</span>
        <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>coordinates
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create linear regression trainer.</span>
LinearRegressionLSQRTrainer trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinearRegressionLSQRTrainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train model.</span>
LinearRegressionModel mdl <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
    upstreamMap<span class="token punctuation">,</span>
    <span class="token number">10</span><span class="token punctuation">,</span>          <span class="token comment">// Number of partitions.</span>
    preprocessor<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>label
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make a prediction. </span>
<span class="token keyword">double</span> prediction <span class="token operator">=</span> mdl<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="_15-2-3-示例"><a href="#_15-2-3-示例" aria-hidden="true" class="header-anchor">#</a> 15.2.3.示例</h3> <p>要了解规范化预处理器在实践中是如何使用的，可以看这个<a href="https://github.com/apache/ignite/blob/master/examples/src/main/java/org/apache/ignite/examples/ml/preprocessing/NormalizationExample.java" target="_self" rel="noopener noreferrer">示例</a>，该实例也会随着每个Ignite发行版进行发布。</p> <h2 id="_15-3-分区化的数据集"><a href="#_15-3-分区化的数据集" aria-hidden="true" class="header-anchor">#</a> 15.3.分区化的数据集</h2> <h3 id="_15-3-1-摘要"><a href="#_15-3-1-摘要" aria-hidden="true" class="header-anchor">#</a> 15.3.1.摘要</h3> <p>分区化的数据集是在Ignite的计算和存储能力之上构建的抽象层，可以在遵循无ETL和容错的原则下，进行算法运算。</p> <p>分区化的数据集的主要原理是Ignite的计算网格实现的经典MapReduce范式。</p> <p>MapReduce的主要优势在于，可以在分布于整个集群的数据上执行运算，而不需要大量的网络数据传输，这个想法对应于分区化的数据集，采用如下的方式：</p> <ul><li>每个数据集都是分区的；</li> <li>分区在每个节点的本地，持有持久化的训练上下文以及可恢复的训练数据；</li> <li>在一个数据集上执行的计算，会被拆分为<em>Map</em>操作和<em>Reduce</em>操作，Map操作负责在每个分区上执行运算，而Reduce操作会将Map操作的结果汇总为最终的结果。</li></ul> <p><strong>训练上下文（分区上下文）</strong> 是Ignite分区中的持久化部分，因此在分区化的数据集关闭之前，对应于这部分的变更都会被一直维护，训练上下文不用担心节点故障，但是需要额外的时间进行读写，因此只有在无法使用分区数据的时候才使用它。</p> <p><strong>训练数据（分区数据）</strong> 是分区的一部分，可以在任何时候从上游数据以及上下文中恢复，因此没必要在持久化存储中维护分区数据，而是在每个节点的本地存储（堆内、堆外甚至GPU存储）中持有，如果节点故障，可以从其它节点的上游数据以及上下文中恢复。</p> <p>为什么选择分区而不是节点作为数据集和学习的构建单元呢？</p> <p>Ignite中的一个基本思想是，分区是原子化的，这意味着分区无法在多个节点上进行拆分（具体可以看<code>分区和复制</code>相关的章节）。在再平衡或者节点故障的情况下，分区在其它节点恢复时，数据和它在原来节点时保持一致。</p> <p>而在机器学习算法中，这很重要，因为大多数机器学习算法是迭代的，并且需要在迭代之间保持一定的上下文，该上下文无法被拆分或者合并，并且应该在整个学习期间保持一致的状态。</p> <h3 id="_15-3-2-使用"><a href="#_15-3-2-使用" aria-hidden="true" class="header-anchor">#</a> 15.3.2.使用</h3> <p>要构造一个分区化的数据集，可以这么做：</p> <ul><li>有一个上游的数据源，可以是Ignite的缓存或者仅仅是一个数据的Map；</li> <li>分区上下文生成器，它定义了如何从对应于该分区的上游数据构建分区上下文；</li> <li>分区数据生成器，它定义了如何从对应于该分区的上游数据构建分区数据；</li></ul> <p>基于缓存的数据集：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>Dataset<span class="token generics function"><span class="token punctuation">&lt;</span>MyPartitionContext<span class="token punctuation">,</span> MyPartitionData<span class="token punctuation">&gt;</span></span> dataset <span class="token operator">=</span>
    <span class="token keyword">new</span> <span class="token class-name">CacheBasedDatasetBuilder</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
        ignite<span class="token punctuation">,</span>                            <span class="token comment">// Upstream Data Source</span>
        upstreamCache
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">MyPartitionContextBuilder</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Training Context Builder</span>
        <span class="token keyword">new</span> <span class="token class-name">MyPartitionDataBuilder</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment">// Training Data Builder</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>本地数据集：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>Dataset<span class="token generics function"><span class="token punctuation">&lt;</span>MyPartitionContext<span class="token punctuation">,</span> MyPartitionData<span class="token punctuation">&gt;</span></span> dataset <span class="token operator">=</span>
    <span class="token keyword">new</span> <span class="token class-name">LocalDatasetBuilder</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
        upstreamMap<span class="token punctuation">,</span>                       <span class="token comment">// Upstream Data Source</span>
        <span class="token number">10</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">MyPartitionContextBuilder</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Partition Context Builder</span>
        <span class="token keyword">new</span> <span class="token class-name">MyPartitionDataBuilder</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment">// Partition Data Builder</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>之后就可以在这个数据集上通过MapReduce的方式执行各种计算了。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">int</span> numerOfRows <span class="token operator">=</span> dataset<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>partitionData<span class="token punctuation">,</span> partitionIdx<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> partitionData<span class="token punctuation">.</span><span class="token function">getRows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> a <span class="token operator">==</span> null <span class="token operator">?</span> b <span class="token operator">:</span> a <span class="token operator">+</span> b
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>最后，所有的计算完成后，注意一定要关闭数据集和释放资源。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>dataset<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_15-3-3-示例"><a href="#_15-3-3-示例" aria-hidden="true" class="header-anchor">#</a> 15.3.3.示例</h3> <p>要了解分区化的数据集在实践中是如何使用的，可以看这个<a href="https://github.com/apache/ignite/blob/master/examples/src/main/java/org/apache/ignite/examples/ml/dataset/AlgorithmSpecificDatasetExample.java" target="_self" rel="noopener noreferrer">示例</a>，该实例也会随着每个Ignite发行版进行发布。</p> <h2 id="_15-4-线性回归"><a href="#_15-4-线性回归" aria-hidden="true" class="header-anchor">#</a> 15.4.线性回归</h2> <h3 id="_15-4-1-摘要"><a href="#_15-4-1-摘要" aria-hidden="true" class="header-anchor">#</a> 15.4.1.摘要</h3> <p>Ignite支持普通最小二乘线性回归算法，这是最基本也是最强大的机器学习算法之一，本文会说明该算法的工作方式以及Ignite是如何实现的。</p> <p>线性回归算法的基本原理是，假定因变量y和自变量x有如下的关系：
<img src="https://files.readme.io/58d1de5-111.gif" alt>
注意，后续的文档中会使用向量x和b的点积，并且明确地避免使用常数项，当向量x由一个等于1的值补充时，在数学上是正确的。</p> <p>如果向量b已知，上面的假设可以基于特征向量x进行预测，它反映在Ignite中负责预测的<code>LinearRegressionModel</code>类中。</p> <h3 id="_15-4-2-模型"><a href="#_15-4-2-模型" aria-hidden="true" class="header-anchor">#</a> 15.4.2.模型</h3> <p>线性回归的模型表示为<code>LinearRegressionModel</code>类，它能够对给定的特征向量进行预测，如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>LinearRegressionModel model <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> prediction <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>observation<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>模型是完全独立的对象，训练之后可以被保存、序列化以及恢复。</p> <h3 id="_15-4-3-训练法"><a href="#_15-4-3-训练法" aria-hidden="true" class="header-anchor">#</a> 15.4.3.训练法</h3> <p>线性回归是一种监督学习算法，这意味着为了找到参数（向量b），需要在训练数据集上进行训练，并且使损失函数最小化。
<img src="https://files.readme.io/b20f1ce-222.gif" alt>
Ignite支持两种线性回归训练法，基于LSQR算法的训练法以及另一个基于随机梯度下降法的训练法。</p> <p><strong>LSQR训练法</strong></p> <p>LSQR算法是为线性方程组找到大的、稀疏的最小二乘解，Ignite实现了这个算法的分布式版本。</p> <p>基于缓存的数据集：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create linear regression trainer.</span>
LinearRegressionLSQRTrainer trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinearRegressionLSQRTrainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train model.</span>
LinearRegressionModel mdl <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
    ignite<span class="token punctuation">,</span>
    upstreamCache<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>coordinates<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>label
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make a prediction. </span>
<span class="token keyword">double</span> prediction <span class="token operator">=</span> mdl<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>本地数据集：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create linear regression trainer.</span>
LinearRegressionLSQRTrainer trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinearRegressionLSQRTrainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train model.</span>
LinearRegressionModel mdl <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
    upstreamMap<span class="token punctuation">,</span>
    <span class="token number">10</span><span class="token punctuation">,</span>          <span class="token comment">// Number of partitions.</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>coordinates<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>label
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make a prediction. </span>
<span class="token keyword">double</span> prediction <span class="token operator">=</span> mdl<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>SGD训练法</strong></p> <p>另一个线性回归训练法会使用随机梯度下降法来寻找损失函数的最小值。该训练法的配置类似于多层感知训练法的配置，可以指定更新类型（<code>Nesterov</code>的SGD，RProp）、最大迭代次数、批量大小、局部迭代次数和种子。</p> <p>基于缓存的数据集：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create linear regression trainer.</span>
LinearRegressionSGDTrainer<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinearRegressionSGDTrainer</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">UpdatesStrategy</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">RPropUpdateCalculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        RPropParameterUpdate<span class="token operator">:</span><span class="token operator">:</span>sumLocal<span class="token punctuation">,</span>
        RPropParameterUpdate<span class="token operator">:</span><span class="token operator">:</span>avg
    <span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token number">100000</span><span class="token punctuation">,</span>  <span class="token comment">// Max iterations.</span>
    <span class="token number">10</span><span class="token punctuation">,</span>      <span class="token comment">// Batch size.</span>
    <span class="token number">100</span><span class="token punctuation">,</span>     <span class="token comment">// Local iterations.</span>
    <span class="token number">123</span>L     <span class="token comment">// Random seed.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train model.</span>
LinearRegressionModel mdl <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
    ignite<span class="token punctuation">,</span>
    upstreamCache<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>coordinates<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>label
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make a prediction. </span>
<span class="token keyword">double</span> prediction <span class="token operator">=</span> mdl<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>本地数据集：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create linear regression trainer.</span>
LinearRegressionSGDTrainer<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinearRegressionSGDTrainer</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">UpdatesStrategy</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">RPropUpdateCalculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        RPropParameterUpdate<span class="token operator">:</span><span class="token operator">:</span>sumLocal<span class="token punctuation">,</span>
        RPropParameterUpdate<span class="token operator">:</span><span class="token operator">:</span>avg
    <span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token number">100000</span><span class="token punctuation">,</span>  <span class="token comment">// Max iterations.</span>
    <span class="token number">10</span><span class="token punctuation">,</span>      <span class="token comment">// Batch size.</span>
    <span class="token number">100</span><span class="token punctuation">,</span>     <span class="token comment">// Local iterations.</span>
    <span class="token number">123</span>L     <span class="token comment">// Random seed.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train model.</span>
LinearRegressionModel mdl <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
    upstreamMap<span class="token punctuation">,</span>
    <span class="token number">10</span><span class="token punctuation">,</span>          <span class="token comment">// Number of partitions.</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>coordinates<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>label
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make a prediction. </span>
<span class="token keyword">double</span> prediction <span class="token operator">=</span> mdl<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_15-4-4-示例"><a href="#_15-4-4-示例" aria-hidden="true" class="header-anchor">#</a> 15.4.4.示例</h3> <p>要了解线性回归在实践中是如何使用的，可以看这个<a href="https://github.com/apache/ignite/tree/master/examples/src/main/java/org/apache/ignite/examples/ml/regression/linear" target="_self" rel="noopener noreferrer">示例</a>，该实例也会随着每个Ignite发行版进行发布。</p> <h2 id="_15-5-k-均值聚类"><a href="#_15-5-k-均值聚类" aria-hidden="true" class="header-anchor">#</a> 15.5.K-均值聚类</h2> <p>在Ignite的机器学习组件中，提供了一个K-均值聚类算法的实现。</p> <h3 id="_15-5-1-模型"><a href="#_15-5-1-模型" aria-hidden="true" class="header-anchor">#</a> 15.5.1.模型</h3> <p>K-均值聚类的目标是，将n个待观测值分为k个簇，这里每个观测值和所属的簇都有最近的均值，这被称为簇的原型。</p> <p>该模型持有一个k中心向量以及距离指标，这些由比如欧几里得、海明或曼哈顿这样的机器学习框架提供。</p> <p>通过如下的方式，可以预测给定的特征向量：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>MeansModel mdl <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

<span class="token keyword">double</span> prediction <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>observation<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_15-5-2-训练法"><a href="#_15-5-2-训练法" aria-hidden="true" class="header-anchor">#</a> 15.5.2.训练法</h3> <p>K均值是一种无监督学习算法，它解决了将对象分组的聚类问题，即在同一个组（叫做簇）中的对象（某种意义上）比其它簇中的对象更相似。</p> <p>K均值是一种参数化的迭代算法，在每个迭代中，计算每个簇中的新的均值，作为观测值的质心。</p> <p>目前，Ignite为K均值分类算法支持若干个参数：</p> <ul><li><code>k</code>：可能的簇的数量；</li> <li><code>maxIterations</code>：终止条件（另一个是ε）；</li> <li>ε-δ收敛（新旧质心值之间的增量）；</li> <li>距离：机器学习框架提供的距离指标之一，例如欧几里得、海明或曼哈顿；</li> <li>种子：一个初始化参数，有助于重现模型（该训练法有一个随机初始化步骤，以获得第一个质心）。</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Set up the trainer</span>
KMeansTrainer trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KMeansTrainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">withDistance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EuclideanDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">withK</span><span class="token punctuation">(</span>AMOUNT_OF_CLUSTERS<span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">withMaxIterations</span><span class="token punctuation">(</span>MAX_ITERATIONS<span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">withEpsilon</span><span class="token punctuation">(</span>PRECISION<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Build the model</span>
KMeansModel knnMdl <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
  datasetBuilder<span class="token punctuation">,</span>
  featureExtractor<span class="token punctuation">,</span>
  labelExtractor
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_15-5-3-示例"><a href="#_15-5-3-示例" aria-hidden="true" class="header-anchor">#</a> 15.5.3.示例</h3> <p>要了解线性回归在实践中是如何使用的，可以看这个<a href="https://github.com/apache/ignite/tree/master/examples/src/main/java/org/apache/ignite/examples/ml/clustering" target="_self" rel="noopener noreferrer">示例</a>，该实例也会随着每个Ignite发行版进行发布。</p> <p>训练数据集是鸢尾花数据集的一个子集（具有标签1和标签2，它们是线性可分离的两类数据集），可以从<a href="https://archive.ics.uci.edu/ml/datasets/iris" target="_self" rel="noopener noreferrer">UCL机器学习库</a>加载。</p> <h2 id="_15-6-遗传算法"><a href="#_15-6-遗传算法" aria-hidden="true" class="header-anchor">#</a> 15.6.遗传算法</h2> <h3 id="_15-6-1-摘要"><a href="#_15-6-1-摘要" aria-hidden="true" class="header-anchor">#</a> 15.6.1.摘要</h3> <p>Ignite的机器学习组件包括一组遗传算法（GA），它是一种通过模拟生物进化过程来解决优化问题的一种方法。 遗传算法非常适合于以最优的方式检索大量复杂的数据集，在现实世界中，遗传算法的应用包括：汽车设计、计算机游戏、机器人、投资、交通和运输等等。</p> <p>所有的遗传操作，比如适应度计算、交叉和变异，都会被建模为分布式的ComputeTask。此外，这些ComputeTask会通过Ignite的关系并置，将ComputeJob分发到染色体实际存储的节点。</p> <p>下图是遗传算法的架构：
<img src="https://files.readme.io/07790ee-GAGrid_Overview.png" alt>
下图是遗传算法的执行步骤：
<img src="https://files.readme.io/352730c-GAProcessDiagram2.png" alt></p> <h3 id="_15-6-2-使用"><a href="#_15-6-2-使用" aria-hidden="true" class="header-anchor">#</a> 15.6.2.使用</h3> <p>下面会使用<code>HelloWorldGAExample</code>进行演示，一步步讲解遗传算法如何使用，目标是得到“HELLO WORLD”这个短语。</p> <p><strong>创建一个GAConfiguration</strong></p> <p>开始，需要创建一个<code>GAConfiguration</code>对象，这个类可以定义遗传算法的行为。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">&quot;examples/config/example-ignite.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Create GAConfiguration</span>
    gaConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GAConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>定义基因和染色体</strong></p> <p>下一步，需要定义<code>Gene</code>，对于本示例对应的问题域，&quot;HELLO WORLD&quot;短语，因为离散部分都是字母，所以使用<code>Character</code>来对<code>Gene</code>建模，接下来，使用<code>Character</code>定义有27个<code>Gene</code>的基因库，下面的代码描述了这个过程：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>List<span class="token generics function"><span class="token punctuation">&lt;</span>Gene<span class="token punctuation">&gt;</span></span> genePool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> chars <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">,</span> <span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'H'</span><span class="token punctuation">,</span> <span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token string">'J'</span><span class="token punctuation">,</span> <span class="token string">'K'</span><span class="token punctuation">,</span> <span class="token string">'L'</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token string">'N'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'P'</span><span class="token punctuation">,</span> <span class="token string">'Q'</span><span class="token punctuation">,</span> <span class="token string">'R'</span><span class="token punctuation">,</span> <span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token string">'T'</span><span class="token punctuation">,</span> <span class="token string">'U'</span><span class="token punctuation">,</span> <span class="token string">'V'</span><span class="token punctuation">,</span> <span class="token string">'W'</span><span class="token punctuation">,</span> <span class="token string">'X'</span><span class="token punctuation">,</span> <span class="token string">'Y'</span><span class="token punctuation">,</span> <span class="token string">'Z'</span><span class="token punctuation">,</span> <span class="token string">' '</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> chars<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Gene gene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gene</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Character</span><span class="token punctuation">(</span>chars<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    genePool<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>gene<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
    
gaConfig<span class="token punctuation">.</span><span class="token function">setGenePool</span><span class="token punctuation">(</span>genePool<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>下一步，需要定义染色体，这是遗传算法的核心，因为它要对最优解进行建模。染色体由<code>Gene</code>构成，它表示了特定解的离散部分。
对于本示例来说，因为目标是包含“HELLO WORLD”的短语，所以染色体应该有11个基因（即字符），从代码上来说，需要将<code>GAConfiguration</code>的染色体长度设定为11。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Set the Chromosome Length to '11' since 'HELLO WORLD' contains 11 characters.</span>
gaConfig<span class="token punctuation">.</span><span class="token function">setChromosomeLength</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在遗传算法的执行过程中，染色体通过交叉和变异的过程演化为最优解，然后，根据一个适应度得分，会选择一个最优解。</p> <blockquote><p>遗传算法从内部来说，会将染色体存储在染色体缓存中。</p></blockquote> <p>最优解：
<img src="https://files.readme.io/baca393-helloworld_genes.png" alt></p> <p><strong>实现适应度函数</strong></p> <p>遗传算法可以智能地执行自然选择的大部分过程，但是遗传算法是不了解具体的问题域的，因此需要定义一个适应度函数，它需要扩展自遗传算法的<code>IFitnessFunction</code>类，然后为每个染色体计算适应度得分，这个适应度得分用于决定各个解之间的优化程度，下面的代码会演示这个适应度函数：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldFitnessFunction</span> <span class="token keyword">implements</span> <span class="token class-name">IFitnessFunction</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> String targetString <span class="token operator">=</span> <span class="token string">&quot;HELLO WORLD&quot;</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>Gene<span class="token punctuation">&gt;</span></span> genes<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">double</span> matches <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> genes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Character<span class="token punctuation">)</span> <span class="token punctuation">(</span>genes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>targetString<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                matches <span class="token operator">=</span> matches <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">return</span> matches<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>下一步，在<code>GAConfiguration</code>中配置HelloWorldFitnessFunction：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create and set Fitness function</span>
HelloWorldFitnessFunction function <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloWorldFitnessFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gaConfig<span class="token punctuation">.</span><span class="token function">setFitnessFunction</span><span class="token punctuation">(</span>function<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>定义终止条件</strong></p> <p>下一步需要为遗传算法指定一个合适的终止条件，终止条件依赖于问题域，对于本示例来说，当染色体的适应度得分为11时，遗传算法就应该终止了。终止条件是通过实现<code>ITerminateCriteria</code>接口实现的，它只有一个方法<code>isTerminateConditionMet()</code>。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldTerminateCriteria</span> <span class="token keyword">implements</span> <span class="token class-name">ITerminateCriteria</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> IgniteLogger igniteLogger <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Ignite ignite <span class="token operator">=</span> null<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token function">HelloWorldTerminateCriteria</span><span class="token punctuation">(</span>Ignite ignite<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ignite <span class="token operator">=</span> ignite<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>igniteLogger <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isTerminationConditionMet</span><span class="token punctuation">(</span>Chromosome fittestChromosome<span class="token punctuation">,</span> <span class="token keyword">double</span> averageFitnessScore<span class="token punctuation">,</span> <span class="token keyword">int</span> currentGeneration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> isTerminate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        igniteLogger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;##########################################################################################&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        igniteLogger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Generation: &quot;</span> <span class="token operator">+</span> currentGeneration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        igniteLogger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Fittest is Chromosome Key: &quot;</span> <span class="token operator">+</span> fittestChromosome<span class="token punctuation">)</span><span class="token punctuation">;</span>
        igniteLogger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Chromsome: &quot;</span> <span class="token operator">+</span> fittestChromosome<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printPhrase</span><span class="token punctuation">(</span>GAGridUtils<span class="token punctuation">.</span><span class="token function">getGenesInOrderForChromosome</span><span class="token punctuation">(</span>ignite<span class="token punctuation">,</span> fittestChromosome<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        igniteLogger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Avg Chromsome Fitness: &quot;</span> <span class="token operator">+</span> averageFitnessScore<span class="token punctuation">)</span><span class="token punctuation">;</span>
        igniteLogger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;##########################################################################################&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>fittestChromosome<span class="token punctuation">.</span><span class="token function">getFitnessScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            isTerminate <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">return</span> isTerminate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    
    <span class="token comment">/**
     * Helper to print Phrase
     * 
     * @param genes
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">printPhrase</span><span class="token punctuation">(</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>Gene<span class="token punctuation">&gt;</span></span> genes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
        StringBuffer sbPhrase <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Gene gene <span class="token operator">:</span> genes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sbPhrase<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Character<span class="token punctuation">)</span> gene<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        igniteLogger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>sbPhrase<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>下一步，需要为<code>GAConfiguration</code>配置<code>HelloWorldTerminateCriteria</code>：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create and set TerminateCriteria</span>
HelloWorldTerminateCriteria termCriteria <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloWorldTerminateCriteria</span><span class="token punctuation">(</span>ignite<span class="token punctuation">)</span><span class="token punctuation">;</span>
gaConfig<span class="token punctuation">.</span><span class="token function">setTerminateCriteria</span><span class="token punctuation">(</span>termCriteria<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>种群的进化</strong></p> <p>最后一步就是通过<code>GAConfiguration</code>初始化一个<code>GAGrid</code>实例和Ignite实例，然后就可以调用<code>GAGrid.evolve()</code>执行种群的进化。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Initialize GAGrid</span>
gaGrid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GAGrid</span><span class="token punctuation">(</span>gaConfig<span class="token punctuation">,</span> ignite<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Evolve the population</span>
Chromosome fittestChromosome <span class="token operator">=</span> gaGrid<span class="token punctuation">.</span><span class="token function">evolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_15-6-3-启动"><a href="#_15-6-3-启动" aria-hidden="true" class="header-anchor">#</a> 15.6.3.启动</h3> <p>如果要使用遗传算法，打开命令终端，转到<code>IGNITE_HOME</code>目录，然后执行下面的脚本：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ bin/ignite.sh examples/config/example-ignite.xml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在集群的每个节点中重复这个步骤。</p> <p>然后打开另一个命令终端，转到<code>IGNITE_HOME</code>目录，然后输入：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mvn exec:java -Dexec.mainClass<span class="token operator">=</span><span class="token string">&quot;org.apache.ignite.examples.ml.genetic.helloworld.HelloWorldGAExample&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>启动之后，集群中的每个节点会看到类似下面的输出：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>21:41:49,327<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token punctuation">[</span>GridCacheProcessor<span class="token punctuation">]</span> Started cache <span class="token punctuation">[</span>name<span class="token operator">=</span>populationCache, mode<span class="token operator">=</span>PARTITIONED<span class="token punctuation">]</span>
<span class="token punctuation">[</span>21:41:49,365<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token punctuation">[</span>GridCacheProcessor<span class="token punctuation">]</span> Started cache <span class="token punctuation">[</span>name<span class="token operator">=</span>geneCache, mode<span class="token operator">=</span>REPLICATED<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>下一步，在若干代之后，会看到下面的输出：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>19:04:17,307<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Generation: 208
<span class="token punctuation">[</span>19:04:17,307<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Fittest is Chromosome Key: Chromosome <span class="token punctuation">[</span>fitnessScore<span class="token operator">=</span>11.0, id<span class="token operator">=</span>319, genes<span class="token operator">=</span><span class="token punctuation">[</span>8, 5, 12, 12, 15, 27, 23, 15, 18, 12, 4<span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>19:04:17,307<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Chromosome: Chromosome <span class="token punctuation">[</span>fitnessScore<span class="token operator">=</span>11.0, id<span class="token operator">=</span>319, genes<span class="token operator">=</span><span class="token punctuation">[</span>8, 5, 12, 12, 15, 27, 23, 15, 18, 12, 4<span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>19:04:17,310<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> HELLO WORLD
<span class="token punctuation">[</span>19:04:17,311<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Avg Chromosome Fitness: 5.252
<span class="token punctuation">[</span>19:04:17,311<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> 
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 53.883 sec
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_15-6-4-apache-zeppelin集成"><a href="#_15-6-4-apache-zeppelin集成" aria-hidden="true" class="header-anchor">#</a> 15.6.4.Apache Zeppelin集成</h3> <p>Apache Zeppelin是一个基于Web的笔记本，可以进行交互式的数据分析。下面会介绍如何利用Zeppelin的可视化特性来显示由遗传算法生成的优化解。</p> <blockquote><p>下面的步骤，对所有遗传算法的示例都有效。</p></blockquote> <p><strong>Zeppelin的安装和配置</strong></p> <p>步骤如下：</p> <ol><li>从<a href="http://zeppelin.apache.org/download.html" target="_self" rel="noopener noreferrer">这里</a>下载最新版的Zeppelin安装包；</li> <li>将压缩包解压到一个目录中，该目录就作为<code>ZEPPELIN_HOME</code>；</li> <li>将<code>ignite-core-2.5.0.jar</code>从<code>IGNITE_HOME/libs</code>目录中复制到<code>ZEPPELIN_HOME/interpreter/jdbc</code>目录中，该包中包含Ignite的JDBC Thin模式驱动，Zeppelin会使用这个驱动从遗传算法网格中获取优化后的数据；</li></ol> <p>Zeppelin安装配置好后，可以通过如下命令启动：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./bin/zeppelin-daemon.sh start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Zeppelin启动之后，会看到下面的首页：
<img src="https://files.readme.io/0a3daa8-Zeppelin_StartPage.png" alt>
下一步，选择<code>Interpreter</code>菜单项：
<img src="https://files.readme.io/23548f1-Zeppelin_Interpreter.png" alt>
这个页面中包含了所有已配置的解释器的配置项。
下一步，点击<code>Create</code>按钮，配置一个新的JDBC解释器，使用下表中的配置参数配置这个JDBC解释器：</p> <table><thead><tr><th>配置项</th> <th>值</th></tr></thead> <tbody><tr><td>Interpreter Name</td> <td>jdbc_ignite_sql</td></tr> <tr><td>Interpreter group</td> <td>jdbc</td></tr> <tr><td>default.driver</td> <td>org.apache.ignite.IgniteJdbcThinDriver</td></tr> <tr><td>default.url</td> <td>jdbc:ignite:thin//localhost:10800</td></tr></tbody></table> <p><img src="https://files.readme.io/b7bcbeb-Zeppelin_CreateNewInterpreter_JDBC.png" alt>
点击<code>Save</code>按钮对变更的配置进行更新，配置变更后要记得重启解释器。</p> <p><strong>创建新的记事本</strong></p> <p>在<code>Notebook</code>标签页中，点击<code>Create new note</code>菜单项可以创建一个新的记事本：
<img src="https://files.readme.io/1ef9f54-Zeppelin_CreateNote_Step1.png" alt>
给记事本命名为<code>GAGridNotebook</code>，然后选中<code>jdbc_ignite_sql</code>作为默认的解释器，如下图所示，点击<code>Create Note</code>继续：
<img src="https://files.readme.io/c56edb9-Zeppeln_CreateNewNote.png" alt>
到目前为止，新创建的笔记本如下图所示，如果要执行SQL查询，需要添加<code>%jdbc_ignite_sql</code>前缀：
<img src="https://files.readme.io/6d8489d-Zeppelin_GAGridNotebook2.png" alt></p> <p><strong>记事本的使用</strong></p> <p>通过自定义SQL函数改进遗传的优化结果，可以改进遗传算法的知识发现，结果集中的列是由单个遗传样本的染色体大小动态驱动的。</p> <p><strong>自定义SQL函数</strong></p> <p>在遗传算法的分布式缓存<code>geneCache</code>中，如下的SQL函数可以用：</p> <table><thead><tr><th>函数名</th> <th>描述</th></tr></thead> <tbody><tr><td><code>getSolutionsDesc()</code></td> <td>获得优化解，按照适应度得分倒序排列。</td></tr> <tr><td><code>getSolutionsAsc()</code></td> <td>获得优化解，按照适应度得分升序排列。</td></tr> <tr><td><code>getSolutionById(key)</code></td> <td>通过染色体键获取优化解。</td></tr></tbody></table> <p>要使用<code>GAGridNotebook</code>，可以启动一个独立的Ignite节点：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ bin/ignite.sh IGNITE_HOME/examples/config/example-config.xml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>运行<code>HelloWorldGAExample</code>这个示例：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mvn exec:java -Dexec.mainClass<span class="token operator">=</span><span class="token string">&quot;org.apache.ignite.examples.ml.genetic.helloworld.HelloWorldGAExample&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>当遗传算法为第一代生成最优解后，就可以进行数据查询了。</p> <p><strong>第一代</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">##########################################################################################</span>
<span class="token punctuation">[</span>13:55:22,589<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Generation: 1
<span class="token punctuation">[</span>13:55:22,596<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Fittest is Chromosome Key: Chromosome <span class="token punctuation">[</span>fitnessScore<span class="token operator">=</span>3.0, id<span class="token operator">=</span>460, genes<span class="token operator">=</span><span class="token punctuation">[</span>8, 3, 21, 5, 2, 22, 1, 19, 18, 12, 9<span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>13:55:22,596<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Chromosome: Chromosome <span class="token punctuation">[</span>fitnessScore<span class="token operator">=</span>3.0, id<span class="token operator">=</span>460, genes<span class="token operator">=</span><span class="token punctuation">[</span>8, 3, 21, 5, 2, 22, 1, 19, 18, 12, 9<span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>13:55:22,598<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> HCUEBVASRLI
<span class="token punctuation">[</span>13:55:22,598<span class="token punctuation">]</span><span class="token punctuation">[</span>INFO<span class="token punctuation">]</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> Avg Chromosome Fitness: 0.408
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在Zeppelin的窗口中，输入下面的SQL然后点击<code>execute</code>按钮：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>%jdbc_ignite_sql <span class="token keyword">select</span> * from <span class="token string">&quot;geneCache&quot;</span>.getSolutionsDesc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>若干代之后，会发现解已经演变到最后的短语&quot;HELLO WORLD&quot;，对于HellowWorldGAExample这个示例，遗传算法会为每一代维护一个500个解的种群，另外，本示例的解会包含总共11个基因，适应度得分最高的，会被认为是“最适合”。
<img src="https://files.readme.io/52055cb-Zeppelin_HelloWorldGATest.png" alt></p> <h3 id="_15-6-5-词汇表"><a href="#_15-6-5-词汇表" aria-hidden="true" class="header-anchor">#</a> 15.6.5.词汇表</h3> <p><strong>染色体</strong>：是一系列基因，一个染色体代表一个潜在的解；</p> <p><strong>交叉</strong>：是染色体内的基因结合以获得新染色体的过程；</p> <p><strong>适应度得分</strong>：是一个数值评分，测量一个特定染色体（即：解）相对于种群中其他染色体的价值；</p> <p><strong>基因</strong>：是组成染色体的离散构建块；</p> <p><strong>遗传算法（GA）</strong>：是通过模拟生物进化过程来求解优化问题的一种方法。遗传算法持续增强种群潜在的解。在每次迭代中，遗传算法从当前种群中选择最合适的个体，为下一代创造后代。在随后的世代中，遗传算法将种群进化为最优解；</p> <p><strong>变异</strong>：是染色体内的基因被随机更新以产生新特性的过程；</p> <p><strong>种群</strong>：是潜在的解或染色体的集合；</p> <p><strong>选择</strong>：是为下一代选择候选解（染色体）的过程。</p> <h2 id="_15-7-多层感知"><a href="#_15-7-多层感知" aria-hidden="true" class="header-anchor">#</a> 15.7.多层感知</h2> <h3 id="_15-7-1-摘要"><a href="#_15-7-1-摘要" aria-hidden="true" class="header-anchor">#</a> 15.7.1.摘要</h3> <p>多层感知（MLP）是神经网络的基本形式，它由一个输入层和0或多个转换层组成，每个转换层都通过如下的方程依赖于前一个转换层：
<img src="https://files.readme.io/60458a8-333.gif" alt>
在上面的方程中，点运算符是两个向量的点积，由σ表示的函数称为激活函数，<code>w</code>表示的向量称为权重，<code>b</code>表示的向量成为偏差。每个转换层都和权重、激活以及可选的偏差有关，MLP中中所有权重和偏差的集合，就被称为MLP的参数集。</p> <h3 id="_15-7-2-模型"><a href="#_15-7-2-模型" aria-hidden="true" class="header-anchor">#</a> 15.7.2.模型</h3> <p>神经网络的模型由<code>MultilayerPerceptron</code>类表示，它可以对给定的特征向量通过如下方式进行预测：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>MultilayerPerceptron mlp <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Matrix prediction <span class="token operator">=</span> mlp<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>模型是完全独立的对象，	训练后可以保存、序列化和恢复。</p> <h3 id="_15-7-3-训练法"><a href="#_15-7-3-训练法" aria-hidden="true" class="header-anchor">#</a> 15.7.3.训练法</h3> <p>批量训练是监督模型训练的常用方法之一。在这种方法中，训练是迭代进行的，在每次迭代中，提取标记数据的<code>subpart(batch)</code>（由近似函数的输入和该函数的相应值组成的数据，通常称为“地面实况”），在这里使用这个子部分训练和更新模型参数，进行更新以使批处理中的损失函数最小化。</p> <p>Ignite的<code>MLPTrainer</code>就是用于分布式批量训练的，它运行于MapReduce模式，每个迭代（称为全局迭代）由若干个并行迭代组成，这些迭代又相应地由若干局部步骤组成，每个局部迭代由它自己的工作进程来执行，并执行指定数量的本地步骤（成为同步周期）来计算模型参数的更新，然后会在发起训练的节点上累计所有的更新，并将其转换为全局更新，全局更新会被反馈给所有的工作进程，在达到标准之前，这个过程会一直持续。</p> <p><code>MLPTrainer</code>是参数化的，其中包括神经网络架构、损失函数、更新策略（<code>SGD</code>、<code>RProp</code>、<code>Nesterov</code>）、最大迭代数量、批处理大小、本地迭代和种子数量。</p> <p><strong>基于缓存的数据集</strong>、</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Define a layered architecture.</span>
MLPArchitecture arch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MLPArchitecture</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">withAddedLayer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> Activators<span class="token punctuation">.</span>RELU<span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">withAddedLayer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> Activators<span class="token punctuation">.</span>SIGMOID<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a neural network trainer.</span>
MLPTrainer<span class="token generics function"><span class="token punctuation">&lt;</span>SimpleGDParameterUpdate<span class="token punctuation">&gt;</span></span> trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MLPTrainer</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
    arch<span class="token punctuation">,</span>
    LossFunctions<span class="token punctuation">.</span>MSE<span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">UpdatesStrategy</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">SimpleGDUpdateCalculator</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        SimpleGDParameterUpdate<span class="token operator">:</span><span class="token operator">:</span>sumLocal<span class="token punctuation">,</span>
        SimpleGDParameterUpdate<span class="token operator">:</span><span class="token operator">:</span>avg
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">3000</span><span class="token punctuation">,</span>   <span class="token comment">// Max iterations.</span>
    <span class="token number">4</span><span class="token punctuation">,</span>      <span class="token comment">// Batch size.</span>
    <span class="token number">50</span><span class="token punctuation">,</span>     <span class="token comment">// Local iterations.</span>
    <span class="token number">123</span>L    <span class="token comment">// Random seed.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train model.</span>
MultilayerPerceptron mlp <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
    ignite<span class="token punctuation">,</span>
    upstreamCache<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>coordinates<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>label
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make a prediction. </span>
Matrix prediction <span class="token operator">=</span> mlp<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>本地数据集：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Define a layered architecture.</span>
MLPArchitecture arch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MLPArchitecture</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">withAddedLayer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> Activators<span class="token punctuation">.</span>RELU<span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">withAddedLayer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> Activators<span class="token punctuation">.</span>SIGMOID<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Define a neural network trainer.</span>
MLPTrainer<span class="token generics function"><span class="token punctuation">&lt;</span>SimpleGDParameterUpdate<span class="token punctuation">&gt;</span></span> trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MLPTrainer</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
    arch<span class="token punctuation">,</span>
    LossFunctions<span class="token punctuation">.</span>MSE<span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">UpdatesStrategy</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">SimpleGDUpdateCalculator</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        SimpleGDParameterUpdate<span class="token operator">:</span><span class="token operator">:</span>sumLocal<span class="token punctuation">,</span>
        SimpleGDParameterUpdate<span class="token operator">:</span><span class="token operator">:</span>avg
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">3000</span><span class="token punctuation">,</span>   <span class="token comment">// Max iterations.</span>
    <span class="token number">4</span><span class="token punctuation">,</span>      <span class="token comment">// Batch size.</span>
    <span class="token number">50</span><span class="token punctuation">,</span>     <span class="token comment">// Local iterations.</span>
    <span class="token number">123</span>L    <span class="token comment">// Random seed.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train model.</span>
MultilayerPerceptron mlp <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
    upstreamMap<span class="token punctuation">,</span>
    <span class="token number">10</span><span class="token punctuation">,</span>          <span class="token comment">// Number of partitions.</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>coordinates<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>label
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make a prediction. </span>
Matrix prediction <span class="token operator">=</span> mlp<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="_15-7-4-示例"><a href="#_15-7-4-示例" aria-hidden="true" class="header-anchor">#</a> 15.7.4.示例</h3> <p>要了解多层感知在实践中是如何使用的，可以看这个<a href="https://github.com/apache/ignite/blob/master/examples/src/main/java/org/apache/ignite/examples/ml/nn/MLPTrainerExample.java" target="_self" rel="noopener noreferrer">示例</a>，该实例也会随着每个Ignite发行版进行发布。</p> <h2 id="_15-8-决策树"><a href="#_15-8-决策树" aria-hidden="true" class="header-anchor">#</a> 15.8.决策树</h2> <h3 id="_15-8-1-摘要"><a href="#_15-8-1-摘要" aria-hidden="true" class="header-anchor">#</a> 15.8.1.摘要</h3> <p>决策树是监督学习中一个简单而强大的模型。其主要思想是将特征空间分割成区域，每个区域中的值变化不大。一个区域中的值变化的度量被称为区域的纯度。</p> <p>Ignite对于行数据存储，提供了一种优化算法，具体可以看<a href="#_15-3-%E5%88%86%E5%8C%BA%E5%8C%96%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86">15.3.分区化的数据集</a>。</p> <p>拆分是递归进行的，每次拆分创建的区域又可以进一步拆分，因此，整个过程可以用二叉树来描述，其中每个节点都代表一个特定的区域，其子节点为由另一个拆分派生出来的区域。</p> <p>让一个训练集的每个样本独属于一些空间<code>S</code>，并且让<code>p_i</code>成为具有指数<code>i</code>的特征的一个预测，然后通过具有指数<code>i</code>的连续特征进行拆分：
<img src="https://files.readme.io/b62ca98-555.gif" alt>
由分类特征和某些集合<code>x</code>的值进行拆分：
<img src="https://files.readme.io/f2c63c7-666.gif" alt>
这里<code>X_0</code>是<code>x</code>的一个子集。</p> <p>该模型的工作方式为，当算法达到配置的最大深度时，拆分过程停止，或者任何区域的拆分没有导致明显的纯度损失。从<code>S</code>预测点<code>s</code>的值是将树向下遍历，直到节点对应的区域包含<code>s</code>，并返回与该叶子相关联的值。</p> <h3 id="_15-8-2-模型"><a href="#_15-8-2-模型" aria-hidden="true" class="header-anchor">#</a> 15.8.2.模型</h3> <p>决策树分类的模型由<code>DecisionTreeNode</code>表示，对于给定的特征向量进行预测，如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>DecisionTreeNode mdl <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">double</span> prediction <span class="token operator">=</span> mdl<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>observation<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>模型是完全独立的对象，训练之后可以保存、序列化以及恢复。</p> <h3 id="_15-8-3-训练法"><a href="#_15-8-3-训练法" aria-hidden="true" class="header-anchor">#</a> 15.8.3.训练法</h3> <p>决策树算法可用于基于纯度度量和节点实例化方法的分类和回归。</p> <p><strong>分类</strong></p> <p>分类决策树可用于<a href="https://en.wikipedia.org/wiki/Decision_tree_learning#Gini_impurity" target="_self" rel="noopener noreferrer">Gini</a>纯度度量，使用方法如下：</p> <p>基于缓存的数据集：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create decision tree classification trainer.</span>
DecisionTreeClassificationTrainer trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecisionTreeClassificationTrainer</span><span class="token punctuation">(</span>
    <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// Max deep. </span>
    <span class="token number">0</span>  <span class="token comment">// Min impurity decrease.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train model.</span>
DecisionTreeNode mdl <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
    ignite<span class="token punctuation">,</span>
    upstreamCache<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>coordinates<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>label
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make a prediction. </span>
<span class="token keyword">double</span> prediction <span class="token operator">=</span> mdl<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>本地数据集：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create decision tree classification trainer.</span>
DecisionTreeClassificationTrainer trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecisionTreeClassificationTrainer</span><span class="token punctuation">(</span>
    <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// Max deep. </span>
    <span class="token number">0</span>  <span class="token comment">// Min impurity decrease.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train model.</span>
DecisionTreeNode mdl <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
    upstreamMap<span class="token punctuation">,</span>
    <span class="token number">10</span><span class="token punctuation">,</span>          <span class="token comment">// Number of partitions.</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>coordinates<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>label
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make a prediction. </span>
<span class="token keyword">double</span> prediction <span class="token operator">=</span> mdl<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>回归</strong></p> <p>回归决策树使用<a href="https://en.wikipedia.org/wiki/Mean_squared_error" target="_self" rel="noopener noreferrer">MSE</a>纯度度量，使用方法如下：</p> <p>基于缓存的数据集：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create decision tree classification trainer.</span>
DecisionTreeRegressionTrainer trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecisionTreeRegressionTrainer</span><span class="token punctuation">(</span>
    <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// Max deep. </span>
    <span class="token number">0</span>  <span class="token comment">// Min impurity decrease.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train model.</span>
DecisionTreeNode mdl <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
    ignite<span class="token punctuation">,</span>
    upstreamCache<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>y
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make a prediction. </span>
<span class="token keyword">double</span> prediction <span class="token operator">=</span> mdl<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>本地数据集：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create decision tree classification trainer.</span>
DecisionTreeRegressionTrainer trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecisionTreeRegressionTrainer</span><span class="token punctuation">(</span>
    <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// Max deep. </span>
    <span class="token number">0</span>  <span class="token comment">// Min impurity decrease.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train model.</span>
DecisionTreeNode mdl <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
    upstreamMap<span class="token punctuation">,</span>
    <span class="token number">10</span><span class="token punctuation">,</span>          <span class="token comment">// Number of partitions.</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> pnt<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pnt<span class="token punctuation">.</span>y
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make a prediction. </span>
<span class="token keyword">double</span> prediction <span class="token operator">=</span> mdl<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_15-8-4-示例"><a href="#_15-8-4-示例" aria-hidden="true" class="header-anchor">#</a> 15.8.4.示例</h3> <p>要了解决策树在实践中是如何使用的，可以看这个<a href="https://github.com/apache/ignite/blob/master/examples/src/main/java/org/apache/ignite/examples/ml/tree/DecisionTreeClassificationTrainerExample.java" target="_self" rel="noopener noreferrer">分类示例</a>和<a href="https://github.com/apache/ignite/blob/master/examples/src/main/java/org/apache/ignite/examples/ml/tree/DecisionTreeRegressionTrainerExample.java" target="_self" rel="noopener noreferrer">回归示例</a>，这些实例也会随着每个Ignite发行版进行发布。</p> <h2 id="_15-9-k-nn分类"><a href="#_15-9-k-nn分类" aria-hidden="true" class="header-anchor">#</a> 15.9.k-NN分类</h2> <p>对于广泛使用的k-NN（k-最近邻）算法，Ignite支持它的两个版本，一个是分类任务，另一个是回归任务。</p> <p>本文会描述k-NN作为分类任务的解决方案。</p> <h3 id="_15-9-1-模型"><a href="#_15-9-1-模型" aria-hidden="true" class="header-anchor">#</a> 15.9.1.模型</h3> <p>K-NN算法是一种非参数方法，其输入由特征空间中的K-最近训练样本组成。</p> <p>另外，k-NN分类的输出表示为类的成员。一个对象按其邻居的多数票进行分类。该对象会被分配为K近邻中最常见的一个特定类。<code>k</code>是正整数，通常很小，当<code>k</code>为1时是一个特殊的情况，该对象会简单地分配给该单近邻的类。</p> <p>目前，Ignite为k-NN分类算法提供了若干参数：</p> <ul><li><code>k</code>：最近邻数量；</li> <li><code>distanceMeasure</code>：ML框架提供的距离度量之一，例如欧几里得、海明或曼哈顿；</li> <li><code>KNNStrategy</code>：可以为<code>SIMPLE</code>或者<code>WEIGHTED</code>（开启加权k-NN算法）；</li> <li><code>dataCache</code>：持有一组已知分类的对象的训练集。</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create trainer</span>
KNNClassificationTrainer trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KNNClassificationTrainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train model.</span>
KNNClassificationModel knnMdl <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
    ignite<span class="token punctuation">,</span>
    dataCache<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Arrays<span class="token punctuation">.</span><span class="token function">copyOfRange</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withK</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withDistanceMeasure</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EuclideanDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withStrategy</span><span class="token punctuation">(</span>KNNStrategy<span class="token punctuation">.</span>SIMPLE<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make a prediction. </span>
<span class="token keyword">double</span> prediction <span class="token operator">=</span> knnMdl<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>vectorizedData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_15-9-2-示例"><a href="#_15-9-2-示例" aria-hidden="true" class="header-anchor">#</a> 15.9.2.示例</h3> <p>要了解k-NN分类在实践中是如何使用的，可以看这个<a href="https://github.com/apache/ignite/tree/master/examples/src/main/java/org/apache/ignite/examples/ml/knn/classification" target="_self" rel="noopener noreferrer">示例</a>，该实例也会随着每个Ignite发行版进行发布。</p> <p>训练数据集是可以从<a href="https://archive.ics.uci.edu/ml/datasets/iris" target="_self" rel="noopener noreferrer">UCI机器学习库</a>加载的鸢尾花数据集。</p> <h2 id="_15-10-k-nn回归"><a href="#_15-10-k-nn回归" aria-hidden="true" class="header-anchor">#</a> 15.10.k-NN回归</h2> <p>对于广泛使用的k-NN（k-最近邻）算法，Ignite支持它的两个版本，一个是分类任务，另一个是回归任务。</p> <p>本文会描述k-NN作为回归任务的解决方案。</p> <h3 id="_15-10-1-模型"><a href="#_15-10-1-模型" aria-hidden="true" class="header-anchor">#</a> 15.10.1.模型</h3> <p>K-NN算法是一种非参数方法，其输入由特征空间中的K-最近训练样本组成。每个训练样本具有与给定的训练样本相关联的数值形式的属性值。</p> <p>K-NN算法使用所有训练集来预测给定测试样本的属性值，这个预测的属性值是其k近邻值的平均值。如果<code>k</code>是1，那么测试样本会被简单地分配给单个最近邻的属性值。</p> <p>目前，Ignite为k-NN分类算法提供了若干参数：</p> <ul><li><code>k</code>：最近邻数量；</li> <li><code>distanceMeasure</code>：ML框架提供的距离度量之一，例如欧几里得、海明或曼哈顿；</li> <li><code>KNNStrategy</code>：可以为<code>SIMPLE</code>或者<code>WEIGHTED</code>（开启加权k-NN算法）；</li> <li><code>datasetBuilder</code>：帮助访问已知类的对象的训练集。</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create trainer</span>
KNNRegressionTrainer trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KNNRegressionTrainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Train model.</span>
KNNRegressionModel knnMdl <span class="token operator">=</span> <span class="token punctuation">(</span>KNNRegressionModel<span class="token punctuation">)</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
      datasetBuilder<span class="token punctuation">,</span>
      <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Arrays<span class="token punctuation">.</span><span class="token function">copyOfRange</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withK</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withDistanceMeasure</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ManhattanDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withStrategy</span><span class="token punctuation">(</span>KNNStrategy<span class="token punctuation">.</span>WEIGHTED<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Make a prediction. </span>
<span class="token keyword">double</span> prediction <span class="token operator">=</span> knnMdl<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>vectorizedData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_15-10-2-示例"><a href="#_15-10-2-示例" aria-hidden="true" class="header-anchor">#</a> 15.10.2.示例</h3> <p>要了解k-NN回归在实践中是如何使用的，可以看这个<a href="https://github.com/apache/ignite/tree/master/examples/src/main/java/org/apache/ignite/examples/ml/knn/regression" target="_self" rel="noopener noreferrer">示例</a>，该实例也会随着每个Ignite发行版进行发布。</p> <p>训练数据集是可以从<a href="https://archive.ics.uci.edu/ml/datasets/iris" target="_self" rel="noopener noreferrer">UCI机器学习库</a>加载的鸢尾花数据集。</p> <h2 id="_15-11-svm二进制分类"><a href="#_15-11-svm二进制分类" aria-hidden="true" class="header-anchor">#</a> 15.11.SVM二进制分类</h2> <p>支持向量机（SVM）是相关数据分析学习算法中的监督学习模型，用于分类和回归分析。</p> <p>给定一组训练样本，每一个被标记为属于两个类别中的一个，SVM训练算法会建立一个模型，该模型将新的样本分配给其中一个类别，使其成为非概率二进制线性分类器。</p> <p>Ignite机器学习模块只支持线性支持向量机。更多信息请参见维基百科中的<a href="https://en.wikipedia.org/wiki/Support_vector_machine" target="_self" rel="noopener noreferrer">支持向量机</a>。</p> <h3 id="_15-11-1-模型"><a href="#_15-11-1-模型" aria-hidden="true" class="header-anchor">#</a> 15.11.1.模型</h3> <p>SVM的模型表示为<code>SVMLinearBinaryClassificationModel</code>，它通过如下的方式对给定的特征向量进行预测：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>SVMLinearBinaryClassificationModel model <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

<span class="token keyword">double</span> prediction <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>observation<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>目前，对于<code>SVMLinearBinaryClassificationModel</code>，Ignite支持一组参数：</p> <ul><li><code>isKeepingRawLabels</code>：-1,和+1，分别对应false值和从分离超平面的原始距离（默认值false）；</li> <li><code>threshold</code>：如果原始值大于该阈值（默认值：0.0），则向观察者分配1个标签。</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>SVMLinearBinaryClassificationModel model <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

<span class="token keyword">double</span> prediction <span class="token operator">=</span> model
  <span class="token punctuation">.</span><span class="token function">withRawLabels</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withThreshold</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>observation<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_15-11-2-训练法"><a href="#_15-11-2-训练法" aria-hidden="true" class="header-anchor">#</a> 15.11.2.训练法</h3> <p>基于具有铰链损失函数的高效通信分布式双坐标上升算法（COCOA），提供软余量SVM线性分类训练法的基类。该训练法将输入作为具有-1和+1两个分类的标签化数据集，并进行二进制分类。</p> <p>关于这个算法的论文可以在<a href="https://arxiv.org/abs/1409.1458" target="_self" rel="noopener noreferrer">这里</a>找到。</p> <p>目前，Ignite为<code>SVMLinearBinaryClassificationTrainer</code>支持如下参数：</p> <ul><li><code>amountOfIterations</code>：外部SDCA算法的迭代量。（默认值：200）；</li> <li><code>amountOfLocIterations</code>：本地SDCA算法的迭代量。（默认值：100）；</li> <li><code>lambda</code>：正则化参数（默认值：0.4）。</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Set up the trainer</span>
SVMLinearBinaryClassificationTrainer trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SVMLinearBinaryClassificationTrainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withAmountOfIterations</span><span class="token punctuation">(</span>AMOUNT_OF_ITERATIONS<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withAmountOfLocIterations</span><span class="token punctuation">(</span>AMOUNT_OF_LOC_ITERATIONS<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withLambda</span><span class="token punctuation">(</span>LAMBDA<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Build the model</span>
SVMLinearBinaryClassificationModel mdl <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
  datasetBuilder<span class="token punctuation">,</span>
  featureExtractor<span class="token punctuation">,</span>
  labelExtractor
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_15-11-3-示例"><a href="#_15-11-3-示例" aria-hidden="true" class="header-anchor">#</a> 15.11.3.示例</h3> <p>要了解SVM线性分类器在实践中是如何使用的，可以看这个<a href="https://github.com/apache/ignite/blob/master/examples/src/main/java/org/apache/ignite/examples/ml/svm/binary/SVMBinaryClassificationExample.java" target="_self" rel="noopener noreferrer">示例</a>，该实例也会随着每个Ignite发行版进行发布。</p> <p>训练数据集可以从<a href="https://archive.ics.uci.edu/ml/datasets/iris" target="_self" rel="noopener noreferrer">UCI机器学习库</a>加载，其是鸢尾花数据集的子集（具有标签1和标签2的分类，它们是线性可分离的两类数据集）。</p> <h2 id="_15-12-svm多类分类"><a href="#_15-12-svm多类分类" aria-hidden="true" class="header-anchor">#</a> 15.12.SVM多类分类</h2> <p>多类SVM的目的是通过使用支持向量机将标签分配给样本，其中标签是从多个元素的有限集合中提取的。</p> <p>这个实现方法是通过一对所有的方法将单个多类问题总结成多个二进制分类问题。</p> <p>一对所有的方法是建立二进制分类器的过程，它将一个标签和其余的区分开。</p> <h3 id="_15-12-1-模型"><a href="#_15-12-1-模型" aria-hidden="true" class="header-anchor">#</a> 15.12.1.模型</h3> <p>该模型持有<code>&lt;ClassLabel, SVMLinearBinaryClassificationModel&gt;</code>对，它通过如下的方式对给定的特征向量进行预测：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>SVMLinearMultiClassClassificationModel model <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

<span class="token keyword">double</span> prediction <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">predict</span><span class="token punctuation">(</span>observation<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_15-12-2-训练法"><a href="#_15-12-2-训练法" aria-hidden="true" class="header-anchor">#</a> 15.12.2.训练法</h3> <p>目前，Ignite为<code>SVMLinearMultiClassClassificationTrainer</code>支持如下的参数：</p> <ul><li><code>amountOfIterations</code>：外部SDCA算法的迭代量。（默认值：200）；</li> <li><code>amountOfLocIterations</code>：本地SDCA算法的迭代量。（默认值：100）；</li> <li><code>lambda</code>：正则化参数（默认值：0.4）。</li></ul> <p>所有属性都会被传播到一对所有<code>SVMLinearBinaryClassificationTrainer</code>的每个对。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Set up the trainer</span>
SVMLinearMultiClassClassificationTrainer trainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SVMLinearMultiClassClassificationTrainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withAmountOfIterations</span><span class="token punctuation">(</span>AMOUNT_OF_ITERATIONS<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withAmountOfLocIterations</span><span class="token punctuation">(</span>AMOUNT_OF_LOC_ITERATIONS<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withLambda</span><span class="token punctuation">(</span>LAMBDA<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Build the model</span>
SVMLinearMultiClassClassificationModel mdl <span class="token operator">=</span> trainer<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>
  datasetBuilder<span class="token punctuation">,</span>
  featureExtractor<span class="token punctuation">,</span>
  labelExtractor
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_15-12-3-示例"><a href="#_15-12-3-示例" aria-hidden="true" class="header-anchor">#</a> 15.12.3.示例</h3> <p>要了解SVM线性多类分类器在实践中是如何使用的，可以看这个<a href="https://github.com/apache/ignite/blob/master/examples/src/main/java/org/apache/ignite/examples/ml/svm/multiclass/SVMMultiClassClassificationExample.java" target="_self" rel="noopener noreferrer">示例</a>，该实例也会随着每个Ignite发行版进行发布。</p> <p>预处理的分类数据集可以从<a href="https://archive.ics.uci.edu/ml/datasets/iris" target="_self" rel="noopener noreferrer">UCI机器学习库</a>加载。</p> <p>共有三个带标签的分类：1 (building_windows_float_processed)，3 (vehicle_windows_float_processed)，7 (headlamps) 以及特征名：'Na-Sodium'，'Mg-Magnesium'，'Al-Aluminum'，'Ba-Barium'，'Fe-Iron'。</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间：: </span> <span class="time">12/11/2018, 10:35:46 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/doc/2.6.0/java/Deployment.html" class="prev">
          14.部署
        </a></span> <span class="next"><a href="/doc/2.6.0/java/Persistence.html">
          16.持久化
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/22.3a608efe.js" defer></script><script src="/assets/js/app.c10ccc02.js" defer></script>
  </body>
</html>
