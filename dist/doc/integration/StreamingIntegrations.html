<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>7.流计算集成 | Apache Ignite中文站</title>
    <meta name="description" content="Ignite内存计算平台的中文文档及相关资料">
    <link rel="shortcut icon" type="image/x-icon" href="https://ignite.apache.org/favicon.ico">
  <script src="https://hm.baidu.com/hm.js?03f40be28ff9a31fd798fd6b9dac0946"></script>
    
    <link rel="preload" href="/assets/css/0.styles.f86987ee.css" as="style"><link rel="preload" href="/assets/js/app.c6242c58.js" as="script"><link rel="preload" href="/assets/js/59.7d119bc3.js" as="script"><link rel="prefetch" href="/assets/js/10.b05dcd55.js"><link rel="prefetch" href="/assets/js/100.10672db5.js"><link rel="prefetch" href="/assets/js/101.643224b8.js"><link rel="prefetch" href="/assets/js/11.65b62558.js"><link rel="prefetch" href="/assets/js/12.97a6a0fb.js"><link rel="prefetch" href="/assets/js/13.9bbd062e.js"><link rel="prefetch" href="/assets/js/14.766eb24c.js"><link rel="prefetch" href="/assets/js/15.d21d135c.js"><link rel="prefetch" href="/assets/js/16.edef4948.js"><link rel="prefetch" href="/assets/js/17.88981c5f.js"><link rel="prefetch" href="/assets/js/18.2c768cff.js"><link rel="prefetch" href="/assets/js/19.5d0e4ca5.js"><link rel="prefetch" href="/assets/js/2.7c57ecc6.js"><link rel="prefetch" href="/assets/js/20.ef62d525.js"><link rel="prefetch" href="/assets/js/21.cbf4b847.js"><link rel="prefetch" href="/assets/js/22.4079398d.js"><link rel="prefetch" href="/assets/js/23.0a32bba6.js"><link rel="prefetch" href="/assets/js/24.3e1b1def.js"><link rel="prefetch" href="/assets/js/25.246dfeff.js"><link rel="prefetch" href="/assets/js/26.d15bb8aa.js"><link rel="prefetch" href="/assets/js/27.45e0d979.js"><link rel="prefetch" href="/assets/js/28.9c9566a7.js"><link rel="prefetch" href="/assets/js/29.8a90725d.js"><link rel="prefetch" href="/assets/js/3.d3c59160.js"><link rel="prefetch" href="/assets/js/30.1999c048.js"><link rel="prefetch" href="/assets/js/31.f7ccb19b.js"><link rel="prefetch" href="/assets/js/32.abe44cb6.js"><link rel="prefetch" href="/assets/js/33.90414d66.js"><link rel="prefetch" href="/assets/js/34.765bd404.js"><link rel="prefetch" href="/assets/js/35.871a2453.js"><link rel="prefetch" href="/assets/js/36.7b9e0c1d.js"><link rel="prefetch" href="/assets/js/37.3e0b9493.js"><link rel="prefetch" href="/assets/js/38.0a0cd8b2.js"><link rel="prefetch" href="/assets/js/39.8e2f1385.js"><link rel="prefetch" href="/assets/js/4.a8e7d184.js"><link rel="prefetch" href="/assets/js/40.fb1b4d7e.js"><link rel="prefetch" href="/assets/js/41.b5e6ca76.js"><link rel="prefetch" href="/assets/js/42.8cd3af9a.js"><link rel="prefetch" href="/assets/js/43.361a87ca.js"><link rel="prefetch" href="/assets/js/44.74993f14.js"><link rel="prefetch" href="/assets/js/45.0eae9696.js"><link rel="prefetch" href="/assets/js/46.31709510.js"><link rel="prefetch" href="/assets/js/47.c5918e91.js"><link rel="prefetch" href="/assets/js/48.7ea97588.js"><link rel="prefetch" href="/assets/js/49.5c32e4d6.js"><link rel="prefetch" href="/assets/js/5.90fa6a51.js"><link rel="prefetch" href="/assets/js/50.6ac6e293.js"><link rel="prefetch" href="/assets/js/51.dbe73911.js"><link rel="prefetch" href="/assets/js/52.cec173cb.js"><link rel="prefetch" href="/assets/js/53.c7c15900.js"><link rel="prefetch" href="/assets/js/54.cb355a0c.js"><link rel="prefetch" href="/assets/js/55.fd0a3bdd.js"><link rel="prefetch" href="/assets/js/56.0969982c.js"><link rel="prefetch" href="/assets/js/57.3fe71c1e.js"><link rel="prefetch" href="/assets/js/58.467d265e.js"><link rel="prefetch" href="/assets/js/6.9a2be00d.js"><link rel="prefetch" href="/assets/js/60.d7ed5194.js"><link rel="prefetch" href="/assets/js/61.553dc796.js"><link rel="prefetch" href="/assets/js/62.f86f452f.js"><link rel="prefetch" href="/assets/js/63.e639b543.js"><link rel="prefetch" href="/assets/js/64.ce957254.js"><link rel="prefetch" href="/assets/js/65.c42a6c62.js"><link rel="prefetch" href="/assets/js/66.d416b725.js"><link rel="prefetch" href="/assets/js/67.4de8f292.js"><link rel="prefetch" href="/assets/js/68.33a4d743.js"><link rel="prefetch" href="/assets/js/69.25aef38b.js"><link rel="prefetch" href="/assets/js/7.2fce0861.js"><link rel="prefetch" href="/assets/js/70.16284fbd.js"><link rel="prefetch" href="/assets/js/71.a5c8da01.js"><link rel="prefetch" href="/assets/js/72.7e2d0bb8.js"><link rel="prefetch" href="/assets/js/73.9a6a6181.js"><link rel="prefetch" href="/assets/js/74.eade4612.js"><link rel="prefetch" href="/assets/js/75.2b9a3dd9.js"><link rel="prefetch" href="/assets/js/76.625b0b6f.js"><link rel="prefetch" href="/assets/js/77.1b7e6bd4.js"><link rel="prefetch" href="/assets/js/78.4a67e188.js"><link rel="prefetch" href="/assets/js/79.665ce52f.js"><link rel="prefetch" href="/assets/js/8.666e0228.js"><link rel="prefetch" href="/assets/js/80.803c3908.js"><link rel="prefetch" href="/assets/js/81.246de8e0.js"><link rel="prefetch" href="/assets/js/82.1736fbf6.js"><link rel="prefetch" href="/assets/js/83.6a574a18.js"><link rel="prefetch" href="/assets/js/84.716faaac.js"><link rel="prefetch" href="/assets/js/85.e08e66ef.js"><link rel="prefetch" href="/assets/js/86.aa9fc630.js"><link rel="prefetch" href="/assets/js/87.bb11e0fb.js"><link rel="prefetch" href="/assets/js/88.fd21119f.js"><link rel="prefetch" href="/assets/js/89.031811d5.js"><link rel="prefetch" href="/assets/js/9.fd53330e.js"><link rel="prefetch" href="/assets/js/90.02a0be50.js"><link rel="prefetch" href="/assets/js/91.de83a7d2.js"><link rel="prefetch" href="/assets/js/92.59b6884e.js"><link rel="prefetch" href="/assets/js/93.a1c15b43.js"><link rel="prefetch" href="/assets/js/94.5dc944c0.js"><link rel="prefetch" href="/assets/js/95.1655b38f.js"><link rel="prefetch" href="/assets/js/96.e3a60ec5.js"><link rel="prefetch" href="/assets/js/97.2017adba.js"><link rel="prefetch" href="/assets/js/98.44f84e33.js"><link rel="prefetch" href="/assets/js/99.1b494f66.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f86987ee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Apache Ignite中文站</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link">Java</a></div><div class="nav-item"><a href="/doc/sql/" class="nav-link">SQL</a></div><div class="nav-item"><a href="/doc/integration/" class="nav-link router-link-active">集成</a></div><div class="nav-item"><a href="/doc/spark/" class="nav-link">Ignite&amp;Spark</a></div><div class="nav-item"><a href="/doc/tools/" class="nav-link">工具</a></div><div class="nav-item"><a href="/doc/gridgain/" class="nav-link">商业版</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.zybuluo.com/liyuj/note/230739" target="_blank" rel="noopener noreferrer" class="nav-link external">
  历史版本
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">最新版本</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/integration/StreamingIntegrations.html" class="nav-link router-link-exact-active router-link-active">2.7.0</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/" class="nav-link">2.6.0</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link">Java</a></div><div class="nav-item"><a href="/doc/sql/" class="nav-link">SQL</a></div><div class="nav-item"><a href="/doc/integration/" class="nav-link router-link-active">集成</a></div><div class="nav-item"><a href="/doc/spark/" class="nav-link">Ignite&amp;Spark</a></div><div class="nav-item"><a href="/doc/tools/" class="nav-link">工具</a></div><div class="nav-item"><a href="/doc/gridgain/" class="nav-link">商业版</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.zybuluo.com/liyuj/note/230739" target="_blank" rel="noopener noreferrer" class="nav-link external">
  历史版本
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">最新版本</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/integration/StreamingIntegrations.html" class="nav-link router-link-exact-active router-link-active">2.7.0</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/" class="nav-link">2.6.0</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/doc/integration/" class="sidebar-link">1.介绍</a></li><li><a href="/doc/integration/Clustering.html" class="sidebar-link">2.集群发现</a></li><li><a href="/doc/integration/WebSessionClustering.html" class="sidebar-link">3.Web会话集群化</a></li><li><a href="/doc/integration/OSGiSupport.html" class="sidebar-link">4.OSGi支持</a></li><li><a href="/doc/integration/Spring.html" class="sidebar-link">5.Spring</a></li><li><a href="/doc/integration/CassandraIntegration.html" class="sidebar-link">6.Cassandra集成</a></li><li><a href="/doc/integration/StreamingIntegrations.html" class="active sidebar-link">7.流计算集成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-1-摘要" class="sidebar-link">7.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-2-kafka流处理器" class="sidebar-link">7.2.Kafka流处理器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-2-1-摘要" class="sidebar-link">7.2.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-2-2-通过kafka连接器的数据流" class="sidebar-link">7.2.2.通过Kafka连接器的数据流</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-2-3-使用ignite的kafka流处理器模块的数据流" class="sidebar-link">7.2.3.使用Ignite的Kafka流处理器模块的数据流</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-3-camel流处理器" class="sidebar-link">7.3.Camel流处理器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-3-1-摘要" class="sidebar-link">7.3.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-3-2-直接摄取" class="sidebar-link">7.3.2.直接摄取</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-3-3-间接摄取" class="sidebar-link">7.3.3.间接摄取</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-3-4-设置一个响应" class="sidebar-link">7.3.4.设置一个响应</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-3-5-maven依赖" class="sidebar-link">7.3.5.Maven依赖</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-3-6-apache-camel" class="sidebar-link">7.3.6.Apache Camel</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-4-jms流处理器" class="sidebar-link">7.4.JMS流处理器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-4-1-摘要" class="sidebar-link">7.4.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-4-2-特性" class="sidebar-link">7.4.2.特性</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-4-3-实例化jms流处理器" class="sidebar-link">7.4.3.实例化JMS流处理器</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-4-4-示例" class="sidebar-link">7.4.4.示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-5-mqtt流处理器" class="sidebar-link">7.5.MQTT流处理器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-5-1-摘要" class="sidebar-link">7.5.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-5-2-特性" class="sidebar-link">7.5.2.特性</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-5-3-示例" class="sidebar-link">7.5.3.示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-6-storm流处理器" class="sidebar-link">7.6.Storm流处理器</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-7-flink流处理器" class="sidebar-link">7.7.Flink流处理器</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-8-twitter流处理器" class="sidebar-link">7.8.Twitter流处理器</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-9-flume流处理器" class="sidebar-link">7.9.Flume流处理器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-9-1-摘要" class="sidebar-link">7.9.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-9-2-设置" class="sidebar-link">7.9.2.设置</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-10-zeromq流处理器" class="sidebar-link">7.10.ZeroMQ流处理器</a></li><li class="sidebar-sub-header"><a href="/doc/integration/StreamingIntegrations.html#_7-11-rocketmq流处理器" class="sidebar-link">7.11.RocketMQ流处理器</a></li></ul></li><li><a href="/doc/integration/Hibernate.html" class="sidebar-link">8.Hibernate</a></li><li><a href="/doc/integration/MyBatis.html" class="sidebar-link">9.MyBatis</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="_7-流计算集成"><a href="#_7-流计算集成" aria-hidden="true" class="header-anchor">#</a> 7.流计算集成</h1> <h2 id="_7-1-摘要"><a href="#_7-1-摘要" aria-hidden="true" class="header-anchor">#</a> 7.1.摘要</h2> <p>Ignite可以和主要的流处理技术和框架进行集成，比如Kafka、Camel、Storm或者JMS，为基于Ignite的架构带来了更强大的功能。</p> <h2 id="_7-2-kafka流处理器"><a href="#_7-2-kafka流处理器" aria-hidden="true" class="header-anchor">#</a> 7.2.Kafka流处理器</h2> <h3 id="_7-2-1-摘要"><a href="#_7-2-1-摘要" aria-hidden="true" class="header-anchor">#</a> 7.2.1.摘要</h3> <p>Apache Ignite的Kafka流处理器模块提供了从Kafka到Ignite缓存的流处理功能。</p> <p>下面两个方法中的任何一个都可以用于获得这样的流处理功能：</p> <ul><li>使用和Ignite sink的Kafka连接器功能；</li> <li>在Maven工程中导入Kafka的流处理器模块然后实例化KafkaStreamer用于数据流处理。</li></ul> <h3 id="_7-2-2-通过kafka连接器的数据流"><a href="#_7-2-2-通过kafka连接器的数据流" aria-hidden="true" class="header-anchor">#</a> 7.2.2.通过Kafka连接器的数据流</h3> <p>通过从Kafka的主题拉取数据然后将其写入特定的Ignite缓存，IgniteSinkConnector可以用于将数据从Kafka导入Ignite缓存。
连接器位于<code>optional/ignite-kafka</code>，它和它的依赖需要位于一个Kafka运行实例的类路径中，下面会详细描述。</p> <p>关于Kafka连接器的更多信息，可以参考<a href="http://kafka.apache.org/documentation.html#connect" target="_self" rel="noopener noreferrer">Kafka文档</a>。</p> <p><strong>设置和运行</strong></p> <ul><li>将下面的jar包放入Kafka的类路径；</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>ignite-kafka-x.x.x.jar &lt;-- with IgniteSinkConnector
ignite-core-x.x.x.jar
cache-api-1.0.0.jar
ignite-spring-1.5.0-SNAPSHOT.jar
spring-aop-4.1.0.RELEASE.jar
spring-beans-4.1.0.RELEASE.jar
spring-context-4.1.0.RELEASE.jar
spring-core-4.1.0.RELEASE.jar
spring-expression-4.1.0.RELEASE.jar
commons-logging-1.1.1.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>准备worker的配置,比如；</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>bootstrap.servers=localhost:9092

key.converter=org.apache.kafka.connect.storage.StringConverter
value.converter=org.apache.kafka.connect.storage.StringConverter
key.converter.schemas.enable=false
value.converter.schemas.enable=false

internal.key.converter=org.apache.kafka.connect.storage.StringConverter
internal.value.converter=org.apache.kafka.connect.storage.StringConverter
internal.key.converter.schemas.enable=false
internal.value.converter.schemas.enable=false

offset.storage.file.filename=/tmp/connect.offsets
offset.flush.interval.ms=10000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>准备连接器的配置，比如：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code># connector
name=my-ignite-connector
connector.class=org.apache.ignite.stream.kafka.connect.IgniteSinkConnector
tasks.max=2
topics=someTopic1,someTopic2

# cache
cacheName=myCache
cacheAllowOverwrite=true
igniteCfg=/some-path/ignite.xml
singleTupleExtractorCls=my.company.MyExtractor
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这里<em>cacheName</em>等于<code>some-path/ignite.xml</code>中指定的缓存名，之后<code>someTopic1,someTopic2</code>主题的数据就会被拉取和存储。如果希望覆盖缓存中的已有值，可以将<code>cacheAllowOverwrite</code>设置为<code>true</code>。如果需要解析输入的数据然后形成新的键和值，则需要实现一个<em>StreamSingleTupleExtractor</em>然后像上面那样指定<em>singleTupleExtractorCls</em>。</p> <p>还可以设置<code>cachePerNodeDataSize</code>和<code>cachePerNodeParOps</code>，用于调整每个节点的缓冲区以及每个节点中并行流操作的最大值。
可以将test中的<code>example-ignite.xml</code>文件作为一个简单缓存配置文件的示例。</p> <ul><li>启动连接器，作为一个示例，像下面这样在独立模式中：</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>bin/connect-standalone.sh myconfig/connect-standalone.properties myconfig/ignite-connector.properties
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>流程检查</strong></p> <p>要执行一个非常基本的功能检查，可以这样做：</p> <ul><li>启动Zookeeper；</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>bin/zookeeper-server-start.sh config/zookeeper.properties
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>启动Kafka服务：</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>bin/kafka-server-start.sh config/server.properties
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>为Kafka服务提供一些数据：</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>bin/kafka-console-producer.sh --broker-list localhost:9092 --topic <span class="token function">test</span> --property parse.key<span class="token operator">=</span>true --property key.separator<span class="token operator">=</span>,
k1,v1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>启动连接器：</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>bin/connect-standalone.sh myconfig/connect-standalone.properties myconfig/ignite-connector.properties
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>检查缓存中的值，比如，通过REST API：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>http://node1:8080/ignite?cmd=size&amp;cacheName=cache1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_7-2-3-使用ignite的kafka流处理器模块的数据流"><a href="#_7-2-3-使用ignite的kafka流处理器模块的数据流" aria-hidden="true" class="header-anchor">#</a> 7.2.3.使用Ignite的Kafka流处理器模块的数据流</h3> <p>如果使用Maven来管理项目的依赖，首先要像下面这样添加Kafka流处理器的模块依赖(将'${ignite.version}'替换为实际的版本号)：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0
                        http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>假定有一个缓存，键和值都是<em>String</em>类型，可以像下面这样启动流处理器：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>KafkaStreamer<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> kafkaStreamer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaStreamer</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

IgniteDataStreamer<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> stmr <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">dataStreamer</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// allow overwriting cache data</span>
stmr<span class="token punctuation">.</span><span class="token function">allowOverwrite</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

kafkaStreamer<span class="token punctuation">.</span><span class="token function">setIgnite</span><span class="token punctuation">(</span>ignite<span class="token punctuation">)</span><span class="token punctuation">;</span>
kafkaStreamer<span class="token punctuation">.</span><span class="token function">setStreamer</span><span class="token punctuation">(</span>stmr<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// set the topic</span>
kafkaStreamer<span class="token punctuation">.</span><span class="token function">setTopic</span><span class="token punctuation">(</span>someKafkaTopic<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// set the number of threads to process Kafka streams</span>
kafkaStreamer<span class="token punctuation">.</span><span class="token function">setThreads</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// set Kafka consumer configurations</span>
kafkaStreamer<span class="token punctuation">.</span><span class="token function">setConsumerConfig</span><span class="token punctuation">(</span>kafkaConsumerConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// set extractor</span>
kafkaStreamer<span class="token punctuation">.</span><span class="token function">setSingleTupleExtractor</span><span class="token punctuation">(</span>strExtractor<span class="token punctuation">)</span><span class="token punctuation">;</span>

kafkaStreamer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment">// stop on shutdown</span>
kafkaStreamer<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

strm<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>要了解有关Kafka消费者属性的详细信息，可以参照<a href="http://kafka.apache.org/documentation.html" target="_self" rel="noopener noreferrer">Kafka文档</a>。</p> <h2 id="_7-3-camel流处理器"><a href="#_7-3-camel流处理器" aria-hidden="true" class="header-anchor">#</a> 7.3.Camel流处理器</h2> <h3 id="_7-3-1-摘要"><a href="#_7-3-1-摘要" aria-hidden="true" class="header-anchor">#</a> 7.3.1.摘要</h3> <p>本章节聚焦于<a href="http://camel.apache.org/" target="_self" rel="noopener noreferrer">Apache Camel</a>流处理器，它也可以被视为一个<em>统一的流处理器</em>，因为他可以从Camel支持的任何技术或者协议中消费消息然后注入一个Ignite缓存。</p> <blockquote><p><strong>Apache Camel是什么？</strong>
如果不知道<a href="http://camel.apache.org/" target="_self" rel="noopener noreferrer">Apache Camel</a>是什么，本章节的后面会做一个简介。</p></blockquote> <p>使用这个流处理器，基于如下技术可以将数据条目注入一个Ignite缓存：</p> <ul><li>通过提取消息头和消息体，调用一个Web服务(SOAP或者REST);</li> <li>为消息监听一个TCP或者UDP通道；</li> <li>通过FTP接收文件的内容或者写入本地文件系统；</li> <li>通过POP3或者IMAP发送接收到的消息；</li> <li>一个MongoDB Tailable游标；</li> <li>一个AWS SQS队列；</li> <li>其他的；</li></ul> <p>这个流处理器支持两种摄取模式，<strong>直接摄取</strong>和<strong>间接摄取</strong>。</p> <blockquote><p><strong>一个Ignite Camel组件</strong>
还有一个camel-ignite<a href="https://camel.apache.org/ignite.html" target="_self" rel="noopener noreferrer">组件</a>，通过该组件，可以与Ignite缓存、计算、事件、消息等进行交互。</p></blockquote> <p><img src="https://files.readme.io/e07582b-dTjcpt5TkCO88MSVTAdg_Screen-Shot-2016-01-28-at-18-04-41.png" alt="Ignite Camel流处理器架构视图"></p> <h3 id="_7-3-2-直接摄取"><a href="#_7-3-2-直接摄取" aria-hidden="true" class="header-anchor">#</a> 7.3.2.直接摄取</h3> <p>直接摄取使得通过一个提取器元组的帮助可以从任意Camel端点获得消息然后直接进入Ignite，这个被称为<strong>直接摄取</strong>。</p> <p>下面是一个代码示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Start Apache Ignite.</span>
Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create an streamer pipe which ingests into the 'mycache' cache.</span>
IgniteDataStreamer<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> pipe <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">dataStreamer</span><span class="token punctuation">(</span><span class="token string">&quot;mycache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create a Camel streamer and connect it.</span>
CamelStreamer<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> streamer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CamelStreamer</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
streamer<span class="token punctuation">.</span><span class="token function">setIgnite</span><span class="token punctuation">(</span>ignite<span class="token punctuation">)</span><span class="token punctuation">;</span>  
streamer<span class="token punctuation">.</span><span class="token function">setStreamer</span><span class="token punctuation">(</span>pipe<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This endpoint starts a Jetty server and consumes from all network interfaces on port 8080 and context path /ignite.</span>
streamer<span class="token punctuation">.</span><span class="token function">setEndpointUri</span><span class="token punctuation">(</span><span class="token string">&quot;jetty:http://0.0.0.0:8080/ignite?httpMethodRestrict=POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This is the tuple extractor. We'll assume each message contains only one tuple.</span>
<span class="token comment">// If your message contains multiple tuples, use a StreamMultipleTupleExtractor.</span>
<span class="token comment">// The Tuple Extractor receives the Camel Exchange and returns a Map.Entry&lt;?,?&gt; with the key and value.</span>
streamer<span class="token punctuation">.</span><span class="token function">setSingleTupleExtractor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StreamSingleTupleExtractor</span><span class="token generics function"><span class="token punctuation">&lt;</span>Exchange<span class="token punctuation">,</span> String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> Map<span class="token punctuation">.</span>Entry<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> <span class="token function">extract</span><span class="token punctuation">(</span>Exchange exchange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        String stationId <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;X-StationId&quot;</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String temperature <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GridMapEntry</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>stationId<span class="token punctuation">,</span> temperature<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start the streamer.</span>
streamer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_7-3-3-间接摄取"><a href="#_7-3-3-间接摄取" aria-hidden="true" class="header-anchor">#</a> 7.3.3.间接摄取</h3> <p>多于更多的复杂场景，也可以创建一个Camel route在输入的消息上执行复杂的处理，比如转换、验证、拆分、聚合、幂等、重新排序、富集等，然后只是将结果注入Ignite缓存，这个被称为间接摄取。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Create a CamelContext with a custom route that will:</span>
<span class="token comment">//  (1) consume from our Jetty endpoint.</span>
<span class="token comment">//  (2) transform incoming JSON into a Java object with Jackson.</span>
<span class="token comment">//  (3) uses JSR 303 Bean Validation to validate the object.</span>
<span class="token comment">//  (4) dispatches to the direct:ignite.ingest endpoint, where the streamer is consuming from.</span>
CamelContext context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultCamelContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
context<span class="token punctuation">.</span><span class="token function">addRoutes</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RouteBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        <span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;jetty:http://0.0.0.0:8080/ignite?httpMethodRestrict=POST&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">unmarshal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>JsonLibrary<span class="token punctuation">.</span>Jackson<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">&quot;bean-validator:validate&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string">&quot;direct:ignite.ingest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Remember our Streamer is now consuming from the Direct endpoint above.</span>
streamer<span class="token punctuation">.</span><span class="token function">setEndpointUri</span><span class="token punctuation">(</span><span class="token string">&quot;direct:ignite.ingest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_7-3-4-设置一个响应"><a href="#_7-3-4-设置一个响应" aria-hidden="true" class="header-anchor">#</a> 7.3.4.设置一个响应</h3> <p>响应默认只是简单地将一个原来的请求的副本反馈给调用者（如果是一个同步端点）。如果希望定制这个响应，需要设置一个Camel的<code>Processor</code>作为一个<code>responseProcessor</code>。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>streamer<span class="token punctuation">.</span><span class="token function">setResponseProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Processor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span>Exchange exchange<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        exchange<span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span>Exchange<span class="token punctuation">.</span>HTTP_RESPONSE_CODE<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        exchange<span class="token punctuation">.</span><span class="token function">getOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span><span class="token string">&quot;OK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_7-3-5-maven依赖"><a href="#_7-3-5-maven依赖" aria-hidden="true" class="header-anchor">#</a> 7.3.5.Maven依赖</h3> <p>要使用<code>ignite-camel</code>流处理器，需要添加如下的依赖：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-camel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>也可以加入<code>camel-core</code>作为一个过度依赖。</p> <blockquote><p><strong>不要忘记添加Camel组件依赖</strong>
还要确保添加流处理器中要用到的Camel组件的依赖。</p></blockquote> <h3 id="_7-3-6-apache-camel"><a href="#_7-3-6-apache-camel" aria-hidden="true" class="header-anchor">#</a> 7.3.6.Apache Camel</h3> <p><a href="http://camel.apache.org/" target="_self" rel="noopener noreferrer">Apache Camel</a>是一个企业级集成框架，围绕Gregor Hohpe和Bobby Woolf推广的<a href="http://www.enterpriseintegrationpatterns.com/" target="_self" rel="noopener noreferrer">企业集成模式</a>思想，比如<em>通道</em>、<em>管道</em>、<em>过滤器</em>、<em>拆分器</em>、<em>聚合器</em>、<em>路由器</em>、<em>重新排序器</em>等等，他可以像一个乐高玩具一样连接彼此来创建一个将系统连接在一起的集成路径。</p> <p>到目前为止，Camel有超过200个组件，很多都是针对不同技术的适配器，比如<strong>JMS</strong>、<strong>SOAP</strong>、<strong>HTTP</strong>、<strong>文件</strong>、<strong>FTP</strong>、<strong>POP3</strong>、<strong>SMTP</strong>、<strong>SSH</strong>；包括云服务，比如<strong>AWS</strong>，<strong>GCE</strong>、<strong>Salesforce</strong>；社交网络，比如<strong>Twitter</strong>、<strong>Facebook</strong>；甚至包括新一代的数据库，比如<strong>MongoDB</strong>、<strong>Cassandra</strong>；以及数据处理技术，比如<strong>Hadoop(HDFS,HBase)<strong>以及</strong>Spark</strong>。</p> <p>Camel可以运行在各种环境中，同时也被Ignite支持：独立的Java程序、OSGi、Servlet容器、Spring Boot、JEE应用服务器等等。他是完全模块化的，因此只需要部署实际需要的组件，其他都不需要。</p> <p>要了解更多的信息，可以参照<a href="https://camel.apache.org/what-is-camel.html" target="_self" rel="noopener noreferrer">Camel是什么？</a>。</p> <h2 id="_7-4-jms流处理器"><a href="#_7-4-jms流处理器" aria-hidden="true" class="header-anchor">#</a> 7.4.JMS流处理器</h2> <h3 id="_7-4-1-摘要"><a href="#_7-4-1-摘要" aria-hidden="true" class="header-anchor">#</a> 7.4.1.摘要</h3> <p>Ignite提供了一个JMS数据流处理器，他会从JMS代理中消费消息，将消息转换为缓存数据格式然后插入Ignite缓存。</p> <h3 id="_7-4-2-特性"><a href="#_7-4-2-特性" aria-hidden="true" class="header-anchor">#</a> 7.4.2.特性</h3> <p>这个数据流处理器支持如下的特性：</p> <ul><li>从队列或者主题中消费消息；</li> <li>支持从主题长期订阅；</li> <li>通过<code>threads</code>参数支持并发的消费者；
<ul><li>当从队列中消费消息时，这个组件会启动尽可能多的<code>会话</code>对象，每个都持有单独的<code>MessageListener</code>实例，因此实现了<em>自然</em>的并发；</li> <li>当从主题消费消息时，显然无法启动多个线程，因为这样会导致消费重复的消息，因此，通过一个内部的线程池来实现<em>虚拟</em>的并发。</li></ul></li> <li>通过<code>transacted</code>参数支持事务级的会话；</li> <li>通过<code>batched</code>参数支持批量的消费，他会对在一个本地JMS事务的范围内接受的消息进行分组（不需要支持XA）。依赖于代理，这个技术提供了一个很高的吞吐量，因为它减少了必要的消息往返确认的量，虽然存在复制消息的开销（特别是在事务的中间发生了一个事件）。
<ul><li>当达到<code>batchClosureMillis</code>时间或者会话收到了至少<code>batchClosureSize</code>消息后批次会被提交；</li> <li>基于时间的闭包按照设定的频率触发，然后并行地应用到所有的<code>会话</code>；</li> <li>基于大小的闭包会应用到所有单独的<code>会话</code>（因为事务在JMS中是会话绑定的），因此当该<code>会话</code>消费了那么多消息后就会被触发。</li> <li>两个选项是互相兼容的，可以禁用任何一个，但是当批次启用之后不能两个都启用。</li></ul></li> <li>支持通过实现特定的<code>Destination</code>对象或者名字来指定目的地。</li></ul> <p>本实现已经在<a href="http://activemq.apache.org/" target="_self" rel="noopener noreferrer">Apache ActiveMQ</a>中进行了测试，但是只要客户端库实现了<a href="http://download.oracle.com/otndocs/jcp/7195-jms-1.1-fr-spec-oth-JSpec/" target="_self" rel="noopener noreferrer">JMS 1.1 规范</a>的所有JMS代理都是支持的。</p> <h3 id="_7-4-3-实例化jms流处理器"><a href="#_7-4-3-实例化jms流处理器" aria-hidden="true" class="header-anchor">#</a> 7.4.3.实例化JMS流处理器</h3> <p>实例化JMS流处理器时，需要具体化下面的泛型：</p> <ul><li><code>T extends Message</code>：流处理器会接收到的JMS<code>Message</code>的类型，如果他可以接收多个，可以使用通用的<code>Message</code>类型；</li> <li><code>K</code> ：缓存键的类型；</li> <li><code>V</code> ：缓存值的类型；</li></ul> <p>要配置JMS流处理器，还需要提供如下的必要属性：</p> <ul><li><code>connectionFactory</code>：<code>ConnectionFactory</code>的实例，通过代理进行必要的配置，他也可以是一个<code>ConnectionFactory</code>池；</li> <li><code>destination</code>或者(<code>destinationName</code>和<code>destinationType</code>)：一个<code>Destination</code>对象（通常是一个代理指定的JMS<code>Queue</code>或者<code>Topic</code>接口的实现），或者是目的地名字的组合（队列或者主题名）和到或者<code>Queue</code>或者<code>Topic</code>的<code>Class</code>引用的类型， 在后一种情况下，流处理器通过<code>Session.createQueue(String)</code>或者<code>Session.createTopic(String)</code>来获得一个目的地；</li> <li><code>transformer</code>：一个<code>MessageTransformer&lt;T, K, V&gt;</code>的实现，他会消化一个类型为<code>T</code>的JMS消息然后产生一个要添加的缓存条目<code>Map&lt;K, V&gt;</code>，他也可以返回<code>null</code>或者空的<code>Map</code>来忽略传入的消息。</li></ul> <h3 id="_7-4-4-示例"><a href="#_7-4-4-示例" aria-hidden="true" class="header-anchor">#</a> 7.4.4.示例</h3> <p>下面的示例通过<code>String</code>类型的键和<code>String</code>类型的值来填充一个缓存，要消费的<code>TextMessage</code>格式如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>raulk,Raul Kripalani
dsetrakyan,Dmitriy Setrakyan
sv,Sergi Vladykin
gm,Gianfranco Murador
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>下面是代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// create a data streamer</span>
IgniteDataStreamer<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> dataStreamer <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">dataStreamer</span><span class="token punctuation">(</span><span class="token string">&quot;mycache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataStreamer<span class="token punctuation">.</span><span class="token function">allowOverwrite</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// create a JMS streamer and plug the data streamer into it</span>
JmsStreamer<span class="token generics function"><span class="token punctuation">&lt;</span>TextMessage<span class="token punctuation">,</span> String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> jmsStreamer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JmsStreamer</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jmsStreamer<span class="token punctuation">.</span><span class="token function">setIgnite</span><span class="token punctuation">(</span>ignite<span class="token punctuation">)</span><span class="token punctuation">;</span>
jmsStreamer<span class="token punctuation">.</span><span class="token function">setStreamer</span><span class="token punctuation">(</span>dataStreamer<span class="token punctuation">)</span><span class="token punctuation">;</span>
jmsStreamer<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
jmsStreamer<span class="token punctuation">.</span><span class="token function">setDestination</span><span class="token punctuation">(</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
jmsStreamer<span class="token punctuation">.</span><span class="token function">setTransacted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jmsStreamer<span class="token punctuation">.</span><span class="token function">setTransformer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageTransformer</span><span class="token generics function"><span class="token punctuation">&lt;</span>TextMessage<span class="token punctuation">,</span> String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> <span class="token function">apply</span><span class="token punctuation">(</span>TextMessage message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> answer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String text<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            text <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JMSException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            LOG<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;Could not parse message.&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> Collections<span class="token punctuation">.</span><span class="token function">emptyMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>String s <span class="token operator">:</span> text<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            String<span class="token punctuation">[</span><span class="token punctuation">]</span> tokens <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            answer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tokens<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> answer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

jmsStreamer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// on application shutdown</span>
jmsStreamer<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataStreamer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>要使用这个组件，必须通过构建系统(Maven, Ivy, Gradle,sbt等)导入如下的模块:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-jms11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_7-5-mqtt流处理器"><a href="#_7-5-mqtt流处理器" aria-hidden="true" class="header-anchor">#</a> 7.5.MQTT流处理器</h2> <h3 id="_7-5-1-摘要"><a href="#_7-5-1-摘要" aria-hidden="true" class="header-anchor">#</a> 7.5.1.摘要</h3> <p>该流处理器使用<a href="https://eclipse.org/paho/" target="_self" rel="noopener noreferrer">Eclipse Paho</a>作为MQTT客户端，从一个MQTT主题消费消息，然后将键值对提供给<code>IgniteDataStreamer</code>实例。</p> <p>必须提供一个流的元组提取器(不管是单条目的，还是多条目的提取器)来处理传入的消息，然后提取元组以插入缓存。</p> <h3 id="_7-5-2-特性"><a href="#_7-5-2-特性" aria-hidden="true" class="header-anchor">#</a> 7.5.2.特性</h3> <p>这个流处理器支持：</p> <ul><li>一次订阅一个或者多个主题；</li> <li>为一个主题或者多个主题指定订阅者的QoS；</li> <li>设置<a href="https://www.eclipse.org/paho/files/javadoc/org/eclipse/paho/client/mqttv3/MqttConnectOptions.html" target="_self" rel="noopener noreferrer">MqttConnectOptions</a>以开启比如<em>会话持久化</em>这样的特性；</li> <li>指定客户端ID。如果未指定会生成以及维护一个随机的ID，指导重新连接；</li> <li>(重新)连接重试可以通过<a href="https://github.com/rholder/guava-retrying" target="_self" rel="noopener noreferrer">guava-retrying库</a>实现，<em>重试等待</em>和<em>重试停止</em>是可以配置的；</li> <li>直到客户端第一次连接，都会阻塞start()方法。</li></ul> <h3 id="_7-5-3-示例"><a href="#_7-5-3-示例" aria-hidden="true" class="header-anchor">#</a> 7.5.3.示例</h3> <p>下面的代码显示了如何使用这个流处理器：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Start Ignite.</span>
Ignite ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get a data streamer reference.</span>
IgniteDataStreamer<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> dataStreamer <span class="token operator">=</span> <span class="token function">grid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dataStreamer</span><span class="token punctuation">(</span><span class="token string">&quot;mycache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create an MQTT data streamer  </span>
MqttStreamer<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> streamer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MqttStreamer</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
streamer<span class="token punctuation">.</span><span class="token function">setIgnite</span><span class="token punctuation">(</span>ignite<span class="token punctuation">)</span><span class="token punctuation">;</span>
streamer<span class="token punctuation">.</span><span class="token function">setStreamer</span><span class="token punctuation">(</span>dataStreamer<span class="token punctuation">)</span><span class="token punctuation">;</span>
streamer<span class="token punctuation">.</span><span class="token function">setBrokerUrl</span><span class="token punctuation">(</span>brokerUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
streamer<span class="token punctuation">.</span><span class="token function">setBlockUntilConnected</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set a single tuple extractor to extract items in the format 'key,value' where key =&gt; Int, and value =&gt; String</span>
<span class="token comment">// (using Guava here).</span>
streamer<span class="token punctuation">.</span><span class="token function">setSingleTupleExtractor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StreamSingleTupleExtractor</span><span class="token generics function"><span class="token punctuation">&lt;</span>MqttMessage<span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> Map<span class="token punctuation">.</span>Entry<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> <span class="token function">extract</span><span class="token punctuation">(</span>MqttMessage msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> s <span class="token operator">=</span> Splitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">splitToList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getPayload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GridMapEntry</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>Integer<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Consume from multiple topics at once.</span>
streamer<span class="token punctuation">.</span><span class="token function">setTopics</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;def&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ghi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jkl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mno&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start the MQTT Streamer.</span>
streamer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>要了解有关选项的更多信息，可以参考<code>ignite-mqtt</code>模块的javadoc。</p> <h2 id="_7-6-storm流处理器"><a href="#_7-6-storm流处理器" aria-hidden="true" class="header-anchor">#</a> 7.6.Storm流处理器</h2> <p>Apache Ignite的Storm流处理器模块提供了从Storm到Ignite缓存的流处理功能。</p> <p>通过如下步骤可以将数据注入Ignite缓存：</p> <ul><li>在Maven工程中导入Ignite的Storm流处理器模块。如果使用Maven来管理项目的依赖，可以像下面这样添加Storm模块依赖（将<code>${ignite.version}</code>替换为实际使用的版本）：</li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0
                        http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-storm<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>创建一个Ignite配置文件（可以以modules/storm/src/test/resources/example-ignite.xml文件作为示例）并且确保他可以被流处理器访问；</li> <li>确保输入流处理器的键值数据通过名为<code>ignite</code>的属性指定（或者通过StormStreamer.setIgniteTupleField(...)也可以指定一个不同的）。作为一个示例可以看<code>TestStormSpout.declareOutputFields(...)</code>。</li> <li>为流处理器创建一个网络，带有所有依赖制作一个jar文件然后运行如下的命令：</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>storm jar ignite-storm-streaming-jar-with-dependencies.jar my.company.ignite.MyStormTopology
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_7-7-flink流处理器"><a href="#_7-7-flink流处理器" aria-hidden="true" class="header-anchor">#</a> 7.7.Flink流处理器</h2> <p>Apache Ignite Flink Sink模块是一个流处理连接器，他可以将Flink数据注入Ignite缓存，该Sink会将输入的数据注入Ignite缓存。每当创建一个Sink，都需要提供一个Ignite缓存名和Ignite网格配置文件。</p> <p>通过如下步骤，可以开启到Ignite缓存的数据注入：</p> <ul><li>在Maven工程中导入Ignite的Flink Sink模块。如果使用Maven来管理项目的依赖的话，可以像下面这样添加Flink模块依赖（将<code>${ignite.version}</code>替换为实际使用的版本）；</li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0
                        http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>创建一个Ignite配置文件，并且确保它可以被Sink访问；</li> <li>确保输入Sink的数据被指定然后启动Sink；</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteSink igniteSink <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteSink</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ignite.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

igniteSink<span class="token punctuation">.</span><span class="token function">setAllowOverwrite</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
igniteSink<span class="token punctuation">.</span><span class="token function">setAutoFlushFrequency</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
igniteSink<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

DataStream<span class="token generics function"><span class="token punctuation">&lt;</span>Map<span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

<span class="token comment">// Sink data into the grid.</span>
stream<span class="token punctuation">.</span><span class="token function">addSink</span><span class="token punctuation">(</span>igniteSink<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    env<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// Exception handling.</span>
<span class="token punctuation">}</span>
<span class="token keyword">finally</span> <span class="token punctuation">{</span>
    igniteSink<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>可以参考ignite-flink模块的javadoc来了解可用选项的详细信息。</p> <h2 id="_7-8-twitter流处理器"><a href="#_7-8-twitter流处理器" aria-hidden="true" class="header-anchor">#</a> 7.8.Twitter流处理器</h2> <p>Ignite的Twitter流处理器模块会从Twitter消费微博然后将转换后的键值对&lt;tweetId, text&gt;注入Ignite缓存。
要将来自Twitter的数据流注入Ignite缓存，需要：</p> <ul><li>在Maven工程里导入Ignite的twitter模块；
如果使用maven来管理项目的依赖，那么可以像下面这样添加依赖：</li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-twitter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>将<code>${ignite.version}</code>替换为实际使用的Ignite版本。</p> <ul><li>在代码中配置必要的参数，然后启动流处理器，比如：</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteDataStreamer dataStreamer <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">dataStreamer</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataStreamer<span class="token punctuation">.</span><span class="token function">allowOverwrite</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataStreamer<span class="token punctuation">.</span><span class="token function">autoFlushFrequency</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

OAuthSettings oAuthSettings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OAuthSettings</span><span class="token punctuation">(</span><span class="token string">&quot;setting1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;setting2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;setting3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;setting4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

TwitterStreamer<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> streamer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TwitterStreamer</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>oAuthSettings<span class="token punctuation">)</span><span class="token punctuation">;</span>
streamer<span class="token punctuation">.</span><span class="token function">setIgnite</span><span class="token punctuation">(</span>ignite<span class="token punctuation">)</span><span class="token punctuation">;</span>
streamer<span class="token punctuation">.</span><span class="token function">setStreamer</span><span class="token punctuation">(</span>dataStreamer<span class="token punctuation">)</span><span class="token punctuation">;</span>

Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;track&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;apache, twitter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;follow&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3004445758&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

streamer<span class="token punctuation">.</span><span class="token function">setApiParams</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Twitter Streaming API params.</span>
streamer<span class="token punctuation">.</span><span class="token function">setEndpointUrl</span><span class="token punctuation">(</span>endpointUrl<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Twitter streaming API endpoint.</span>
streamer<span class="token punctuation">.</span><span class="token function">setThreadsCount</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

streamer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>可以参考<a href="https://dev.twitter.com/streaming/overview" target="_self" rel="noopener noreferrer">Twitter流API文档</a>来了解各种参数的详细信息。</p> <h2 id="_7-9-flume流处理器"><a href="#_7-9-flume流处理器" aria-hidden="true" class="header-anchor">#</a> 7.9.Flume流处理器</h2> <h3 id="_7-9-1-摘要"><a href="#_7-9-1-摘要" aria-hidden="true" class="header-anchor">#</a> 7.9.1.摘要</h3> <p>Apache Flume是一个高效的收集、汇总以及移动大量的日志数据的分布式的、高可靠和高可用的服务（<a href="https://github.com/apache/flume" target="_self" rel="noopener noreferrer">https://github.com/apache/flume</a>）。</p> <p>IgniteSink是一个Flume池，他会从相对应的Flume通道中提取事件然后将数据注入Ignite缓存，目前支持Flume的1.6.0版本。
在启动Flume代理之前，就像下面章节描述的，IgniteSink及其依赖需要包含在代理的类路径中。</p> <h3 id="_7-9-2-设置"><a href="#_7-9-2-设置" aria-hidden="true" class="header-anchor">#</a> 7.9.2.设置</h3> <ul><li>通过实现EventTransformer接口创建一个转换器；</li> <li>在${FLUME_HOME}中的plugins.d目录下创建<code>ignite</code>子目录，如果plugins.d目录不存在，创建它；</li> <li>构建前述的转换器并且拷贝到<code>${FLUME_HOME}/plugins.d/ignite/lib</code>目录；</li> <li>从Ignite发行版中拷贝其他的Ignite相关的jar包到<code>${FLUME_HOME}/plugins.d/ignite/libext</code>，如下所示；</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>plugins.d/
`-- ignite
 |-- lib
 |   `-- ignite-flume-transformer-x.x.x.jar &lt;-- your jar
 `-- libext
     |-- cache-api-1.0.0.jar
     |-- ignite-core-x.x.x.jar
     |-- ignite-flume-x.x.x.jar &lt;-- IgniteSink
     |-- ignite-spring-x.x.x.jar
     |-- spring-aop-4.1.0.RELEASE.jar
     |-- spring-beans-4.1.0.RELEASE.jar
     |-- spring-context-4.1.0.RELEASE.jar
     |-- spring-core-4.1.0.RELEASE.jar
     `-- spring-expression-4.1.0.RELEASE.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>在Flume配置文件中，指定带有缓存属性的Ignite XML配置文件的位置（可以将<em>flume/src/test/resources/example-ignite.xml</em>作为一个基本的样例），缓存属性中包含要创建缓存的缓存名称（与Ignite配置文件中的相同），EventTransformer的实现类以及可选的批处理大小。所有的属性都显示在下面的表格中（必须项为粗体）。</li></ul> <table><thead><tr><th>属性名称</th> <th>默认值</th> <th>描述</th></tr></thead> <tbody><tr><td><strong>channel</strong></td> <td></td> <td>-</td></tr> <tr><td><strong>type</strong></td> <td>组件类型名，应该为<code>org.apache.ignite.stream.flume.IgniteSink</code></td> <td>-</td></tr> <tr><td><strong>igniteCfg</strong></td> <td>Ignite的XML配置文件</td> <td>-</td></tr> <tr><td><strong>cacheName</strong></td> <td>缓存名，与igniteCfg中的一致</td> <td>-</td></tr> <tr><td><strong>eventTransformer</strong></td> <td>org.apache.ignite.stream.flume.EventTransformer的实现类名</td> <td>-</td></tr> <tr><td><strong>batchSize</strong></td> <td>每事务要写入的事件数</td> <td>100</td></tr></tbody></table> <p>名字为<em>a1</em>的Sink代理配置片段如下所示：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>a1.sinks.k1.type = org.apache.ignite.stream.flume.IgniteSink
a1.sinks.k1.igniteCfg = /some-path/ignite.xml
a1.sinks.k1.cacheName = testCache
a1.sinks.k1.eventTransformer = my.company.MyEventTransformer
a1.sinks.k1.batchSize = 100
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>指定代码和配置后（可以参照Flume的文档），就可以运行Flume的代理了。</p> <h2 id="_7-10-zeromq流处理器"><a href="#_7-10-zeromq流处理器" aria-hidden="true" class="header-anchor">#</a> 7.10.ZeroMQ流处理器</h2> <p>Ignite的ZeroMQ流处理器模块具有将<a href="http://zeromq.org/" target="_self" rel="noopener noreferrer">ZeroMQ</a>数据流注入Ignite缓存的功能。
要将数据流注入Ignite缓存，需要按照如下步骤操作：</p> <ol><li>将Ignite的ZeroMQ流处理器模块加入Maven依赖：
如果使用Maven来管理项目的依赖，那么需要添加如下的ZeroMQ模块依赖(注意将<code>${ignite.version}</code>替换为实际使用的版本号)：</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-zeromq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li>要么实现<a href="https://github.com/apache/ignite/blob/f2f82f09b35368f25e136c9fce5e7f2198a91171/modules/core/src/main/java/org/apache/ignite/stream/StreamSingleTupleExtractor.java" target="_self" rel="noopener noreferrer">StreamSingleTupleExtractor</a>，要么实现<a href="https://github.com/apache/ignite/blob/f2f82f09b35368f25e136c9fce5e7f2198a91171/modules/core/src/main/java/org/apache/ignite/stream/StreamMultipleTupleExtractor.java" target="_self" rel="noopener noreferrer">StreamMultipleTupleExtractor</a>，<a href="https://github.com/apache/ignite/blob/7492843ad9e22c91764fb8d0c3a096b8ce6c653e/modules/zeromq/src/test/java/org/apache/ignite/stream/zeromq/ZeroMqStringSingleTupleExtractor.java" target="_self" rel="noopener noreferrer">这里</a>可以了解更多的细节。</li> <li>像下面这样设置提取器，并且初始化流处理器：</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">(</span>IgniteDataStreamer<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> dataStreamer <span class="token operator">=</span>
     <span class="token function">grid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dataStreamer</span><span class="token punctuation">(</span><span class="token string">&quot;myCacheName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    dataStreamer<span class="token punctuation">.</span><span class="token function">allowOverwrite</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dataStreamer<span class="token punctuation">.</span><span class="token function">autoFlushFrequency</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">(</span>IgniteZeroMqStreamer streamer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteZeroMqStreamer</span><span class="token punctuation">(</span>
      <span class="token number">1</span><span class="token punctuation">,</span> ZeroMqTypeSocket<span class="token punctuation">.</span>PULL<span class="token punctuation">,</span> <span class="token string">&quot;tcp://localhost:5671&quot;</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      streamer<span class="token punctuation">.</span><span class="token function">setIgnite</span><span class="token punctuation">(</span><span class="token function">grid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      streamer<span class="token punctuation">.</span><span class="token function">setStreamer</span><span class="token punctuation">(</span>dataStreamer<span class="token punctuation">)</span><span class="token punctuation">;</span>

      streamer<span class="token punctuation">.</span><span class="token function">setSingleTupleExtractor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ZeroMqStringSingleTupleExtractor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      streamer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="_7-11-rocketmq流处理器"><a href="#_7-11-rocketmq流处理器" aria-hidden="true" class="header-anchor">#</a> 7.11.RocketMQ流处理器</h2> <p>这个流处理器模块提供了从<a href="https://github.com/apache/incubator-rocketmq" target="_self" rel="noopener noreferrer">Apache RocketMQ</a>到Ignite的流化处理功能。</p> <p>如果要使用Ignite的RocketMQ流处理器模块：</p> <ol><li>将其导入自己的Maven工程；
如果使用Maven管理项目的依赖，需要想下面这样添加RocketMQ的模块依赖（将<code>${ignite.version}</code>替换为实际使用的Ignite版本）：</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0
                        http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.ignite<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ignite-rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ignite.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>2.实现<code>StreamSingleTupleExtractor</code>或者<code>StreamMultipleTupleExtractor</code>，看下面的<code>MyTupleExtractor</code>示例。
对于一个简单的实现，可以看看<code>RocketMQStreamerTest.java</code>。
3.初始化之后启动：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteDataStreamer<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> dataStreamer <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">dataStreamer</span><span class="token punctuation">(</span>MY_CACHE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

dataStreamer<span class="token punctuation">.</span><span class="token function">allowOverwrite</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dataStreamer<span class="token punctuation">.</span><span class="token function">autoFlushFrequency</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

streamer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RocketMQStreamer</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//configure.</span>
streamer<span class="token punctuation">.</span><span class="token function">setIgnite</span><span class="token punctuation">(</span>ignite<span class="token punctuation">)</span><span class="token punctuation">;</span>
streamer<span class="token punctuation">.</span><span class="token function">setStreamer</span><span class="token punctuation">(</span>dataStreamer<span class="token punctuation">)</span><span class="token punctuation">;</span>
streamer<span class="token punctuation">.</span><span class="token function">setNameSrvAddr</span><span class="token punctuation">(</span>NAMESERVER_IP_PORT<span class="token punctuation">)</span><span class="token punctuation">;</span>
streamer<span class="token punctuation">.</span><span class="token function">setConsumerGrp</span><span class="token punctuation">(</span>CONSUMER_GRP<span class="token punctuation">)</span><span class="token punctuation">;</span>
streamer<span class="token punctuation">.</span><span class="token function">setTopic</span><span class="token punctuation">(</span>TOPIC_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
streamer<span class="token punctuation">.</span><span class="token function">setMultipleTupleExtractor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyTupleExtractor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

streamer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment">// stop on shutdown</span>
streamer<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

dataStreamer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>在javadoc中可以找到更多可用选项的信息。</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间：: </span> <span class="time">1/20/2019, 11:55:17 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/doc/integration/CassandraIntegration.html" class="prev">
          6.Cassandra集成
        </a></span> <span class="next"><a href="/doc/integration/Hibernate.html">
          8.Hibernate
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.c6242c58.js" defer></script><script src="/assets/js/59.7d119bc3.js" defer></script>
  </body>
</html>
