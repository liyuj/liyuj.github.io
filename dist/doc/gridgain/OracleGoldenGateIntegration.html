<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1.Oracle GoldenGate集成 | Apache Ignite中文站</title>
    <meta name="description" content="Ignite内存计算平台的中文文档及相关资料">
    <link rel="shortcut icon" type="image/x-icon" href="https://ignite.apache.org/favicon.ico">
  <script src="https://hm.baidu.com/hm.js?03f40be28ff9a31fd798fd6b9dac0946"></script>
    
    <link rel="preload" href="/assets/css/0.styles.f86987ee.css" as="style"><link rel="preload" href="/assets/js/app.381913f1.js" as="script"><link rel="preload" href="/assets/js/50.0af7190c.js" as="script"><link rel="prefetch" href="/assets/js/10.d2044875.js"><link rel="prefetch" href="/assets/js/100.107164fa.js"><link rel="prefetch" href="/assets/js/11.bf6ff4f6.js"><link rel="prefetch" href="/assets/js/12.550189b4.js"><link rel="prefetch" href="/assets/js/13.bae808d4.js"><link rel="prefetch" href="/assets/js/14.3b9b248b.js"><link rel="prefetch" href="/assets/js/15.8fda9c2c.js"><link rel="prefetch" href="/assets/js/16.c3affa37.js"><link rel="prefetch" href="/assets/js/17.e913ff43.js"><link rel="prefetch" href="/assets/js/18.d5e6e08c.js"><link rel="prefetch" href="/assets/js/19.b1033532.js"><link rel="prefetch" href="/assets/js/2.67b11a96.js"><link rel="prefetch" href="/assets/js/20.e07ab2a3.js"><link rel="prefetch" href="/assets/js/21.38615724.js"><link rel="prefetch" href="/assets/js/22.c57b3ce4.js"><link rel="prefetch" href="/assets/js/23.736edea3.js"><link rel="prefetch" href="/assets/js/24.37b4d1a9.js"><link rel="prefetch" href="/assets/js/25.dafb1ad4.js"><link rel="prefetch" href="/assets/js/26.b6b6006d.js"><link rel="prefetch" href="/assets/js/27.84d85805.js"><link rel="prefetch" href="/assets/js/28.6290ed01.js"><link rel="prefetch" href="/assets/js/29.23fd8c94.js"><link rel="prefetch" href="/assets/js/3.ec2e51de.js"><link rel="prefetch" href="/assets/js/30.5bde3d3b.js"><link rel="prefetch" href="/assets/js/31.1bc0a9a7.js"><link rel="prefetch" href="/assets/js/32.c74d70bb.js"><link rel="prefetch" href="/assets/js/33.b06809c6.js"><link rel="prefetch" href="/assets/js/34.935d6ae1.js"><link rel="prefetch" href="/assets/js/35.bcc19c8c.js"><link rel="prefetch" href="/assets/js/36.c070b612.js"><link rel="prefetch" href="/assets/js/37.3e0b9493.js"><link rel="prefetch" href="/assets/js/38.11b3684d.js"><link rel="prefetch" href="/assets/js/39.26dff670.js"><link rel="prefetch" href="/assets/js/4.1ee1b332.js"><link rel="prefetch" href="/assets/js/40.53a3b77d.js"><link rel="prefetch" href="/assets/js/41.27c96fef.js"><link rel="prefetch" href="/assets/js/42.970192bc.js"><link rel="prefetch" href="/assets/js/43.c6ece485.js"><link rel="prefetch" href="/assets/js/44.0d58c883.js"><link rel="prefetch" href="/assets/js/45.0ee511a8.js"><link rel="prefetch" href="/assets/js/46.77f38a6c.js"><link rel="prefetch" href="/assets/js/47.41fa9710.js"><link rel="prefetch" href="/assets/js/48.bcdad433.js"><link rel="prefetch" href="/assets/js/49.f27768df.js"><link rel="prefetch" href="/assets/js/5.5fac8b97.js"><link rel="prefetch" href="/assets/js/51.cc9d96e1.js"><link rel="prefetch" href="/assets/js/52.08523692.js"><link rel="prefetch" href="/assets/js/53.fb31c32b.js"><link rel="prefetch" href="/assets/js/54.c107c43e.js"><link rel="prefetch" href="/assets/js/55.de7648c9.js"><link rel="prefetch" href="/assets/js/56.337cd579.js"><link rel="prefetch" href="/assets/js/57.d501aaf8.js"><link rel="prefetch" href="/assets/js/58.279b44b3.js"><link rel="prefetch" href="/assets/js/59.413e4c91.js"><link rel="prefetch" href="/assets/js/6.a9aa0670.js"><link rel="prefetch" href="/assets/js/60.62bcc2be.js"><link rel="prefetch" href="/assets/js/61.0cc4338e.js"><link rel="prefetch" href="/assets/js/62.0fcb56cf.js"><link rel="prefetch" href="/assets/js/63.39bd0025.js"><link rel="prefetch" href="/assets/js/64.332b1830.js"><link rel="prefetch" href="/assets/js/65.48557fdd.js"><link rel="prefetch" href="/assets/js/66.5e44e96e.js"><link rel="prefetch" href="/assets/js/67.5f86d9b1.js"><link rel="prefetch" href="/assets/js/68.ddf8c74b.js"><link rel="prefetch" href="/assets/js/69.ad94d131.js"><link rel="prefetch" href="/assets/js/7.bbc50e6a.js"><link rel="prefetch" href="/assets/js/70.4e734829.js"><link rel="prefetch" href="/assets/js/71.0b195d4f.js"><link rel="prefetch" href="/assets/js/72.feb7c9f1.js"><link rel="prefetch" href="/assets/js/73.c9e10448.js"><link rel="prefetch" href="/assets/js/74.a86516bf.js"><link rel="prefetch" href="/assets/js/75.39e11beb.js"><link rel="prefetch" href="/assets/js/76.30d32bf8.js"><link rel="prefetch" href="/assets/js/77.4011fd89.js"><link rel="prefetch" href="/assets/js/78.d7e05c37.js"><link rel="prefetch" href="/assets/js/79.a1dfcab0.js"><link rel="prefetch" href="/assets/js/8.9f7c7ae6.js"><link rel="prefetch" href="/assets/js/80.858f1ab2.js"><link rel="prefetch" href="/assets/js/81.bb4be5b4.js"><link rel="prefetch" href="/assets/js/82.0e544f43.js"><link rel="prefetch" href="/assets/js/83.b49a5a4f.js"><link rel="prefetch" href="/assets/js/84.a3d1ae01.js"><link rel="prefetch" href="/assets/js/85.181a4eef.js"><link rel="prefetch" href="/assets/js/86.083633c1.js"><link rel="prefetch" href="/assets/js/87.b276f21d.js"><link rel="prefetch" href="/assets/js/88.bb38a85a.js"><link rel="prefetch" href="/assets/js/89.508a46ad.js"><link rel="prefetch" href="/assets/js/9.c39b445e.js"><link rel="prefetch" href="/assets/js/90.b059c9b0.js"><link rel="prefetch" href="/assets/js/91.a127ffdc.js"><link rel="prefetch" href="/assets/js/92.851df455.js"><link rel="prefetch" href="/assets/js/93.e718c781.js"><link rel="prefetch" href="/assets/js/94.5119681d.js"><link rel="prefetch" href="/assets/js/95.fe2eb94a.js"><link rel="prefetch" href="/assets/js/96.60363eb0.js"><link rel="prefetch" href="/assets/js/97.c25ca0a7.js"><link rel="prefetch" href="/assets/js/98.54f33e0e.js"><link rel="prefetch" href="/assets/js/99.734e8c17.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f86987ee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Apache Ignite中文站</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link">Java</a></div><div class="nav-item"><a href="/doc/sql/" class="nav-link">SQL</a></div><div class="nav-item"><a href="/doc/integration/" class="nav-link">集成</a></div><div class="nav-item"><a href="/doc/spark/" class="nav-link">Ignite&amp;Spark</a></div><div class="nav-item"><a href="/doc/tools/" class="nav-link">工具</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.zybuluo.com/liyuj/note/230739" target="_blank" rel="noopener noreferrer" class="nav-link external">
  历史版本
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">最新版本</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/gridgain/OracleGoldenGateIntegration.html" class="nav-link router-link-exact-active router-link-active">2.7.0</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/" class="nav-link">2.6.0</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link">Java</a></div><div class="nav-item"><a href="/doc/sql/" class="nav-link">SQL</a></div><div class="nav-item"><a href="/doc/integration/" class="nav-link">集成</a></div><div class="nav-item"><a href="/doc/spark/" class="nav-link">Ignite&amp;Spark</a></div><div class="nav-item"><a href="/doc/tools/" class="nav-link">工具</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.zybuluo.com/liyuj/note/230739" target="_blank" rel="noopener noreferrer" class="nav-link external">
  历史版本
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">最新版本</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/gridgain/OracleGoldenGateIntegration.html" class="nav-link router-link-exact-active router-link-active">2.7.0</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/" class="nav-link">2.6.0</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Home</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="_1-oracle-goldengate集成"><a href="#_1-oracle-goldengate集成" aria-hidden="true" class="header-anchor">#</a> 1.Oracle GoldenGate集成</h1> <h2 id="_1-1-goldengate复制"><a href="#_1-1-goldengate复制" aria-hidden="true" class="header-anchor">#</a> 1.1.GoldenGate复制</h2> <p>针对与GoldenGate兼容的所有数据源和GridGain集群之间的数据实时集成和复制问题，GridGain的GoldenGate组件为这个需求提供了一套解决方案。配置好GoldenGate集成复制后，GridGain将自动从GoldenGate数据源中接收更新，同时还会将源数据转换为与GridGain兼容的缓存对象，GoldenGate还通过支持实时数据集成的核心功能实现了高可用性和灾难承受能力，同时保留了性能并确保了可扩展性。</p> <div class="tip custom-block"><p class="custom-block-title">兼容性</p> <p>GridGain兼容于Oracle GoldenGate的11.2及其以后的版本。
<a href="http://www.oracle.com/technetwork/middleware/goldengate/certify-100402.html" target="_self" rel="noopener noreferrer">http://www.oracle.com/technetwork/middleware/goldengate/certify-100402.html</a>，这个页面中包含了Oracle GoldenGate支持的数据源列表。</p></div> <h3 id="_1-1-1-角色"><a href="#_1-1-1-角色" aria-hidden="true" class="header-anchor">#</a> 1.1.1.角色</h3> <p>下面是GoldenGate复制过程中的主要角色：<code>源数据库</code>、<code>提取器</code>、<code>队列文件</code>以及<code>GridGain处理器</code>（GridGain Java适配器）。</p> <ul><li><code>源数据库</code>：包含源数据的数据库；</li> <li><code>提取器</code>：这个进程运行在源系统上，是GoldenGate的数据捕获机制。它既可以配置为源数据的初始加载，也可以配置为变更数据的增量同步。还可以配置为在支持DDL变更的数据库上传播任何DDL更改；</li> <li><code>队列文件</code>：这是GoldenGate存储于磁盘上的一系列文件，这些文件由提取进程写入和读取，根据配置，这些文件可以位于源系统，也可以位于目标系统。</li></ul> <p>GoldenGate复制有如下的方案：</p> <p>在源端复制到GridGain集群：</p> <p><img src="https://files.readme.io/jZaErH6rRuighpdsSa1H_extract.png" alt></p> <p>在目标端复制到GridGain集群：</p> <p><img src="https://files.readme.io/o7v7a4T5TXCFfoioo5A5_replicat.png" alt></p> <h3 id="_1-1-2-特性"><a href="#_1-1-2-特性" aria-hidden="true" class="header-anchor">#</a> 1.1.2.特性</h3> <p><strong>批处理</strong></p> <p>从源数据库过来的更新可以在不同的模式下执行。如果复制是在<code>事务</code>模式下完成的，则更新首先由事务机制累积，然后批量注入缓存中。</p> <p><strong>故障转移</strong></p> <p>GridGain的处理支持故障转移，如果由于某些原因GoldenGate在处理过程中失败或者复制停止，则GridGain会从最后成功的事务开始重新进行处理。</p> <p><strong>冲突解决</strong></p> <p>在双活或者多活场景中，多个数据源对缓存中同一个键的更新叫做冲突，为了确保跨越多个数据中心的冲突解决的一致性。</p> <h2 id="_1-2-gridgain处理器"><a href="#_1-2-gridgain处理器" aria-hidden="true" class="header-anchor">#</a> 1.2.GridGain处理器</h2> <p>GridGain处理器是一个GoldenGate的扩展，它会启动一个GridGain的客户端节点，接收不同的事件，接收从<code>提取</code>或者<code>复制</code>进程过来的更新信息，对信息进行处理，必要时执行缓存操作，然后回给Oracle GoldenGate一个反馈信息。</p> <p>从<code>源数据库</code>接收的更新将传递给数据源操作处理器，该处理器应由用户实现和设置。GridGain处理程序能处理GridGain集群中的任意缓存。如果更新处理因任何原因（例如网络问题等）失败，则GridGain处理程序返回错误代码，从而在GoldenGate中启动故障转移。</p> <p><code>数据源操作处理器</code>提供了一组API，进行数据库的关系模型到缓存之间的转换，该API可以访问GridGain的完整API：缓存API、数据流处理、计算操作等等（具体可以看下一章节），还可以进行冲突的解决。</p> <h3 id="_1-2-1-goldengate的配置"><a href="#_1-2-1-goldengate的配置" aria-hidden="true" class="header-anchor">#</a> 1.2.1.GoldenGate的配置</h3> <p>要使用GoldenGate集成组件，GoldenGate需要安装两个组件：</p> <ul><li>C/C++实现的动态链接或者共享库，通过一个C API与Oracle的GoldenGate提取进程集成作为<code>userexit (UE)</code>；</li> <li>一组Java库（jars），它包含了Oracle GoldenGate的Java API，这个Java框架通过Java本地化接口（JNI）与<code>userexit</code>进行通信。</li></ul> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>在下面的页面中，可以了解如何安装这些组件：<a href="https://docs.oracle.com/cd/E18101_01/doc.1111/e17814.pdf" target="_self" rel="noopener noreferrer">https://docs.oracle.com/cd/E18101_01/doc.1111/e17814.pdf</a></p></div> <p>要复制的所有模式和表，必要的日志级别要配置好，具体要看应用使用的数据库的文档（比如Oracle，可以看<a href="https://docs.oracle.com/goldengate/1212/gg-winux/GIORA/setup.htm#GIORA364" target="_self" rel="noopener noreferrer">https://docs.oracle.com/goldengate/1212/gg-winux/GIORA/setup.htm#GIORA364</a>）。</p> <h3 id="_1-2-2-gridgain处理器配置"><a href="#_1-2-2-gridgain处理器配置" aria-hidden="true" class="header-anchor">#</a> 1.2.2.GridGain处理器配置</h3> <p>要安装GridGain处理器，按照如下步骤操作：</p> <p>1.从<a href="http://www.gridgain.com/download/" target="_self" rel="noopener noreferrer">http://www.gridgain.com/download/</a>下载和解压GridGain的安装包；</p> <p>2.将<code>integration/gridgain-goldengate</code>文件夹复制到<code>GOLDENGATE_ROOT_DIRECTORY</code>；</p> <div class="warning custom-block"><p class="custom-block-title">注意</p> <p>对于GoldenGate的12.2.X版本，需要使用<code>integration/gridgain-goldengate-12.2</code>文件夹，其它与GoldenGate有关的模块，比如Oracle GoldenGate应用适配器，也要是相同的版本-12.2.X。</p></div> <p>3.使用<code>JavaUserExit</code>配置GoldenGate的<code>提取器</code>和<code>复制</code>，GridGain处理器是与提取适配器相关的(具体可以看<a href="https://docs.oracle.com/goldengate/1212/gg-winux/GWURF/gg_parameters.htm#GWURF995" target="_self" rel="noopener noreferrer">https://docs.oracle.com/goldengate/1212/gg-winux/GWURF/gg_parameters.htm#GWURF995</a>)。比如在下面的模式中，事务是在源数据库通过主提取进程捕获的，它会将数据写入GoldenGate的队列文件。然后会使用数据泵技术将事务发送给队列，队列会由提取适配器读取；</p> <p>dirprm/gridgain.prm：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># Extractor name.
EXTRACT GRIDGAIN
# Path to property file for `GridGain Handler`.
SETENV ( GGS_USEREXIT_CONF = &quot;dirprm/gridgain.props&quot;)
# Credentials for database.
USERID username, PASSWORD password
CUSEREXIT libggjava_ue.so CUSEREXIT INCLUDEUPDATEBEFORES, PASSTHRU
NOCOMPRESSUPDATES
SOURCEDEFS dirdef/per.def
TABLE *;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>4.实现GridGain的处理器然后复制包含该处理器的jar到<code>GOLDENGATE_ROOT_DIRECTORY/gridgain-goldengate</code>文件夹；</p> <p>5.在属性文件中配置GridGain的处理器，其中还应该有GridGain的XML配置文件的路径，该Spring上下文中应该包含前述步骤中实现的bean；</p> <p>文本：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># Handler name.</span>
<span class="token attr-name">gg.handlerlist</span><span class="token punctuation">=</span><span class="token attr-value">gridgain</span>

<span class="token comment"># Handler class name.</span>
<span class="token attr-name">gg.handler.gridgain.type</span><span class="token punctuation">=</span><span class="token attr-value">org.gridgain.oracle.goldengate.GridGainHandler</span>
<span class="token comment"># Path to GridGain configuration file. See XML tab.</span>
<span class="token attr-name">gg.handler.gridgain.configurationPath</span><span class="token punctuation">=</span><span class="token attr-value">dirprm/gridgain-configuration.xml</span>
<span class="token comment"># GoldenGate Handler bean name.</span>
<span class="token attr-name">gg.handler.gridgain.operationHandlerBeanName</span><span class="token punctuation">=</span><span class="token attr-value">personOpHandler</span>

<span class="token comment"># GoldenGate settings </span>
<span class="token attr-name">gg.report.time</span><span class="token punctuation">=</span><span class="token attr-value">30sec</span>
<span class="token attr-name">gg.classpath</span><span class="token punctuation">=</span><span class="token attr-value">gridgain-goldengate/*</span>

<span class="token attr-name">javawriter.stats.full</span><span class="token punctuation">=</span><span class="token attr-value">TRUE</span>
<span class="token attr-name">javawriter.stats.display</span><span class="token punctuation">=</span><span class="token attr-value">TRUE</span>
<span class="token attr-name">javawriter.bootoptions</span><span class="token punctuation">=</span><span class="token attr-value">-Xmx1024m -Xms1024m -Djava.class.path=ggjava/ggjava.jar:gg-lib/log4j.xml</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>personOpHandler<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>personOpHandler<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.gridgain.oracle.goldengate.handler.PersonOperationHandler<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ignite.cfg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>localHost<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>127.0.0.1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.CacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>atomicityMode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ATOMIC<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>backups<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.CacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>address<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>atomicityMode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>TRANSACTIONAL<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>backups<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>GridGain处理器有如下的属性：</p> <table><thead><tr><th>属性</th> <th>描述</th> <th>默认值</th></tr></thead> <tbody><tr><td><code>type</code></td> <td>GridGain处理器的主类，此值必须有下一个值：<code>org.gridgain.oracle.GridGainHandler</code></td> <td>无</td></tr> <tr><td><code>configurationPath</code></td> <td>GridGain XML配置文件的路径，该文件中必须有由<code>operationHandlerBeanName</code>属性命名的bean</td> <td>无</td></tr> <tr><td><code>mode</code></td> <td>操作模式。可用值为：<code>op</code>、<code>tx</code>、<code>meta</code>和<code>all</code></td> <td><code>op</code></td></tr> <tr><td><code>operationHandlerBeanName</code></td> <td>GridGain处理器bean的名字，该bean必须在XML配置文件中存在，必须实现<code>DataSourceOperationHandler</code>接口</td> <td>无</td></tr></tbody></table> <h2 id="_1-3-数据源操作处理器"><a href="#_1-3-数据源操作处理器" aria-hidden="true" class="header-anchor">#</a> 1.3.数据源操作处理器</h2> <p><code>DataSourceOperationHandler</code>接口可以将从<code>数据源</code>过来的更新转换为对应的缓存对象，并且执行缓存操作，<code>DataSourceOperationHandler</code>接口应该由开发者实现。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * An function that allows applications to perform operations on updates from 
 * DataBase and store they to cache. The callback will be invoked on each 
 * operations such as insert, update, delete rows and etc.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DataSourceOperationHandler</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * Init method. This method will be invoked before the handler starts 
     * to receive updates from database.
     *
     * @param ignite Ignite instance.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span>Ignite ignite<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Handle single operation update. This method invoked when 
     * {@link GridGainHandler#setMode(String)} in &quot;op&quot; mode.
     *
     * @param dsOp An operation on a data source, containing the current 
     *      column values (after the operation occurred) and optionally 
     *      the &quot;before&quot; values (before the operation occurred). An operation
     *      can in general be a database operation such as 
     *      insert/update/delete or a primary-key update.
     * @param opCtx Operation context contains information about operations.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleOperation</span><span class="token punctuation">(</span>DsOperation dsOp<span class="token punctuation">,</span> OperationContext opCtx<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Handle transaction update. This method invoked when 
     * {@link GridGainHandler#setMode(String)} in &quot;tx&quot; mode.
     *
     * @param tx Data source transaction. This object contains info about 
     *      whole transaction: changed rows, value, type and etc.
     * @param opCtx Operation context contains information about operations.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleTransaction</span><span class="token punctuation">(</span>DsTransaction tx<span class="token punctuation">,</span> OperationContext opCtx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p><code>init</code>方法会在处理器开始接收来自源数据库的更新之前被调用，这个好位置可以用于创建缓存、检查配置等。对于来自数据库的每个更新，GridGain处理器会调用<code>handleOperation</code>或者<code>handleTransaction</code>方法，如果处理器工作于<code>tx</code>模式，<code>handleTransaction</code>方法会被调用，否则会调用<code>handleOperation</code>方法。这些方法的实现可以使用任何Ignite的API：缓存操作、计算、消息等等，下面是一个伪代码实现的示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * The class transforms updates (id, name and salary columns)
 * to Person cache value and save it to cluster.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonOperationHandler</span> <span class="token keyword">implements</span> <span class="token class-name">DataSourceOperationHandler</span> <span class="token punctuation">{</span>
    <span class="token comment">/** Column name that contains &quot;Name&quot;. */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String NAME_COL <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">/** Column name that contains &quot;Salary&quot;. */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String SALARY_COL <span class="token operator">=</span> <span class="token string">&quot;salary&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">/** Ignite instance. */</span>
    <span class="token keyword">private</span> Ignite ignite<span class="token punctuation">;</span>

    <span class="token comment">/** Cache person. */</span>
    <span class="token keyword">private</span> IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> cache<span class="token punctuation">;</span>

    <span class="token comment">/** {@inheritDoc} */</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span>Ignite ignite<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ignite <span class="token operator">=</span> ignite<span class="token punctuation">;</span>

        cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;persons&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/** {@inheritDoc} */</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleOperation</span><span class="token punctuation">(</span>DsOperation dsOp<span class="token punctuation">,</span> OperationContext opCtx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handle</span><span class="token punctuation">(</span>dsOp<span class="token punctuation">,</span> opCtx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/** {@inheritDoc} */</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleTransaction</span><span class="token punctuation">(</span>DsTransaction tx<span class="token punctuation">,</span> OperationContext opCtx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span>Transaction igniteTx <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">transactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">txStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>DsOperation op <span class="token operator">:</span> tx<span class="token punctuation">.</span><span class="token function">getOperations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token function">handle</span><span class="token punctuation">(</span>op<span class="token punctuation">,</span> opCtx<span class="token punctuation">)</span><span class="token punctuation">;</span>

            igniteTx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * The methods convert data from database to {@code Person} object and performs cache operation.
     *
     * @param dsOp An operation on a data source, containing the 
     *      current column values (after the operation occurred)
     *      and optionally the &quot;before&quot; values (before the operation occurred). 
     *      An operation can in general be a database operation such as 
     *      insert/update/delete or a primary-key update.
     * @param opCtx Operation context contains information about operations.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span>DsOperation dsOp<span class="token punctuation">,</span> OperationContext opCtx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        TableMetaData tableMeta <span class="token operator">=</span> opCtx<span class="token punctuation">.</span><span class="token function">getMetaData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">getTableMetaData</span><span class="token punctuation">(</span>dsOp<span class="token punctuation">.</span><span class="token function">getTableName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Op op <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Op</span><span class="token punctuation">(</span>dsOp<span class="token punctuation">,</span> tableMeta<span class="token punctuation">,</span>  opCtx<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        DsColumn id <span class="token operator">=</span> op<span class="token punctuation">.</span><span class="token function">getColumn</span><span class="token punctuation">(</span>tableMeta
            <span class="token punctuation">.</span><span class="token function">getColumnMetaData</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ColumnName</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> null <span class="token operator">||</span> id<span class="token punctuation">.</span><span class="token function">getAfterValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> null<span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token string">&quot;Column id doesn't exist! Id: &quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> key <span class="token operator">=</span> Integer<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">getBeforeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>op<span class="token punctuation">.</span><span class="token function">getOpType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            cache<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>op<span class="token punctuation">.</span><span class="token function">getOpType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            String name <span class="token operator">=</span> null<span class="token punctuation">;</span>
            Double salary <span class="token operator">=</span> null<span class="token punctuation">;</span>

            DsColumn nameCol <span class="token operator">=</span> op<span class="token punctuation">.</span><span class="token function">getColumn</span><span class="token punctuation">(</span>tableMeta<span class="token punctuation">.</span><span class="token function">getColumnMetaData</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ColumnName</span><span class="token punctuation">(</span>NAME_COL<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            DsColumn salaryCol <span class="token operator">=</span> op<span class="token punctuation">.</span><span class="token function">getColumn</span><span class="token punctuation">(</span>tableMeta<span class="token punctuation">.</span><span class="token function">getColumnMetaData</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ColumnName</span><span class="token punctuation">(</span>SALARY_COL<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nameCol<span class="token punctuation">.</span><span class="token function">isMissing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                name <span class="token operator">=</span> nameCol<span class="token punctuation">.</span><span class="token function">getAfterValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>salaryCol<span class="token punctuation">.</span><span class="token function">isMissing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                salary <span class="token operator">=</span> Double<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>salaryCol<span class="token punctuation">.</span><span class="token function">getAfterValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> name<span class="token punctuation">,</span> salary<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            String name <span class="token operator">=</span> null<span class="token punctuation">;</span>
            Double salary <span class="token operator">=</span> null<span class="token punctuation">;</span>

            DsColumn nameCol <span class="token operator">=</span> op<span class="token punctuation">.</span><span class="token function">getColumn</span><span class="token punctuation">(</span>tableMeta<span class="token punctuation">.</span><span class="token function">getColumnMetaData</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ColumnName</span><span class="token punctuation">(</span>NAME_COL<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            DsColumn salaryCol <span class="token operator">=</span> op<span class="token punctuation">.</span><span class="token function">getColumn</span><span class="token punctuation">(</span>tableMeta<span class="token punctuation">.</span><span class="token function">getColumnMetaData</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ColumnName</span><span class="token punctuation">(</span>SALARY_COL<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nameCol<span class="token punctuation">.</span><span class="token function">isMissing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                name <span class="token operator">=</span> nameCol<span class="token punctuation">.</span><span class="token function">getAfterValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>salaryCol<span class="token punctuation">.</span><span class="token function">isMissing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                salary <span class="token operator">=</span> Double<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>salaryCol<span class="token punctuation">.</span><span class="token function">getAfterValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            cache<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PersonUpdater</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> salary<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * The class updates person.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">PersonUpdater</span> <span class="token keyword">implements</span> <span class="token class-name">CacheEntryProcessor</span><span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> Person<span class="token punctuation">,</span> Void<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token comment">/** */</span>
        <span class="token keyword">private</span> String name<span class="token punctuation">;</span>

        <span class="token comment">/** */</span>
        <span class="token keyword">private</span> Double salary<span class="token punctuation">;</span>

        <span class="token comment">/**
         * @param name Name.
         * @param salary Salary.
         */</span>
        <span class="token keyword">public</span> <span class="token function">PersonUpdater</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> Double salary<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">=</span> salary<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/** {@inheritDoc} */</span>
        <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> Void <span class="token function">process</span><span class="token punctuation">(</span>MutableEntry<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> entry<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> arguments<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> EntryProcessorException <span class="token punctuation">{</span>
            String oldName <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null <span class="token operator">?</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> null<span class="token punctuation">;</span>
            <span class="token keyword">double</span> oldSalary <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null <span class="token operator">?</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">salary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>

            Person p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>
                entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                name <span class="token operator">!=</span> null <span class="token operator">?</span> name <span class="token operator">:</span> oldName<span class="token punctuation">,</span>
                salary <span class="token operator">!=</span> null <span class="token operator">?</span> salary <span class="token operator">:</span> oldSalary
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

            entry<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br></div></div><p>该处理器需要在Spring XML配置文件中进行配置，它会启动GridGain的处理器。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>personOperationHandler<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>personOperationHandler<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.gridgain.oracle.goldengate.PersonOperationHandler<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>在<code>dirprm/gridgain.props</code>属性文件中，需要为GridGain的处理器配置<code>theoperationHandlerBeanName</code>属性。</p> <p>dirprm/gridgain.props：</p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">gg.handlerlist</span><span class="token punctuation">=</span><span class="token attr-value">gridgain</span>

<span class="token attr-name">gg.handler.gridgain.operationHandlerBeanName</span><span class="token punctuation">=</span><span class="token attr-value">personOperationHandler</span>

...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_1-4-goldengate冲突解决"><a href="#_1-4-goldengate冲突解决" aria-hidden="true" class="header-anchor">#</a> 1.4.GoldenGate冲突解决</h2> <p>当通过GoldenGate和GridGain缓存API更新缓存时，可以选择继续更新、保留旧值或通过合并旧值和新值生成其他值。为了实现这一点，GridGain提供了冲突解决方案。</p> <p>要对缓存操作和数据流处理使用冲突解决机制，需要使用<code>GridGain.cache(String cacheName, byte dataCenterId)</code>和<code>GridGain.dataStreamer(String cacheName, byte dataCenterId)</code>方法。它预计数据中心ID对于参与数据中心复制的所有拓扑都是唯一的，对于属于给定拓扑的所有节点也是唯一的。</p> <p>缓存：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Get GridGain plugin.</span>
GridGain gridGain <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span>GridGain<span class="token punctuation">.</span>PLUGIN_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get &quot;Person&quot; cache with given data center id.</span>
IgniteCache cache <span class="token operator">=</span> gridGain<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;Person&quot;</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment">/**
 * Conflict resolver for Person entity. In conflicts always used an entry 
 * with data center id equals 31.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonConflictResolver</span> <span class="token keyword">implements</span> <span class="token class-name">CacheConflictResolver</span><span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">/** {@inheritDoc} */</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resolve</span><span class="token punctuation">(</span>CacheConflictContext<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If we</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldEntry<span class="token punctuation">.</span><span class="token function">dataCenterId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">31</span><span class="token punctuation">)</span>
            ctx<span class="token punctuation">.</span><span class="token function">useOld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newEntry<span class="token punctuation">.</span><span class="token function">dataCenterId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">31</span><span class="token punctuation">)</span>
            ctx<span class="token punctuation">.</span><span class="token function">useNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>数据流处理：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Get GridGain plugin.</span>
GridGain gridGain <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span>GridGain<span class="token punctuation">.</span>PLUGIN_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get Data Streamer for cache with given data center id.</span>
IgniteDataStreamer cache <span class="token operator">=</span> gridGain<span class="token punctuation">.</span><span class="token function">dataStreamer</span><span class="token punctuation">(</span><span class="token string">&quot;Person&quot;</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  
<span class="token comment">/**
 * Conflict resolver for Person entity. In conflicts always used an entry 
 * with data center id equals 31.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonConflictResolver</span> <span class="token keyword">implements</span> <span class="token class-name">CacheConflictResolver</span><span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">/** {@inheritDoc} */</span>
    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resolve</span><span class="token punctuation">(</span>CacheConflictContext<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If we</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldEntry<span class="token punctuation">.</span><span class="token function">dataCenterId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">31</span><span class="token punctuation">)</span>
            ctx<span class="token punctuation">.</span><span class="token function">useOld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newEntry<span class="token punctuation">.</span><span class="token function">dataCenterId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">31</span><span class="token punctuation">)</span>
            ctx<span class="token punctuation">.</span><span class="token function">useNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间：: </span> <span class="time">1/13/2019, 10:06:27 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.381913f1.js" defer></script><script src="/assets/js/50.0af7190c.js" defer></script>
  </body>
</html>
