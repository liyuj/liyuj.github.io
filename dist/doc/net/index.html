<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基本概念 | Apache Ignite中文网</title>
    <meta name="description" content="轻量级分布式内存HTAP数据库及计算平台">
    <meta http-equiv="cache-control" content="no-store,no-cache,must-revalidate">
  <meta http-equiv="expires" content="0">
  <link rel="shortcut icon" type="image/x-icon" href="https://ignite.apache.org/favicon.ico">
  <script src="https://hm.baidu.com/hm.js?03f40be28ff9a31fd798fd6b9dac0946"></script>
    
    <link rel="preload" href="/assets/css/0.styles.74ba1269.css" as="style"><link rel="preload" href="/assets/js/app.0ce7ad92.js" as="script"><link rel="preload" href="/assets/js/2.df602b59.js" as="script"><link rel="preload" href="/assets/js/105.e2a0232d.js" as="script"><link rel="prefetch" href="/assets/js/10.92ca41a6.js"><link rel="prefetch" href="/assets/js/100.7dd75f04.js"><link rel="prefetch" href="/assets/js/101.58a43ea6.js"><link rel="prefetch" href="/assets/js/102.f2e4a952.js"><link rel="prefetch" href="/assets/js/103.158e3151.js"><link rel="prefetch" href="/assets/js/104.776c3081.js"><link rel="prefetch" href="/assets/js/106.b21cd2f6.js"><link rel="prefetch" href="/assets/js/107.ec65690c.js"><link rel="prefetch" href="/assets/js/108.738c71ea.js"><link rel="prefetch" href="/assets/js/109.6586d8bf.js"><link rel="prefetch" href="/assets/js/11.89d56baf.js"><link rel="prefetch" href="/assets/js/110.73aa9d65.js"><link rel="prefetch" href="/assets/js/111.9c03cdd8.js"><link rel="prefetch" href="/assets/js/112.fa28d764.js"><link rel="prefetch" href="/assets/js/113.331e1823.js"><link rel="prefetch" href="/assets/js/114.b6d50a42.js"><link rel="prefetch" href="/assets/js/115.57835adc.js"><link rel="prefetch" href="/assets/js/116.4303afee.js"><link rel="prefetch" href="/assets/js/117.1b74adf1.js"><link rel="prefetch" href="/assets/js/118.57ed7633.js"><link rel="prefetch" href="/assets/js/119.7c6851cb.js"><link rel="prefetch" href="/assets/js/12.c144abf2.js"><link rel="prefetch" href="/assets/js/120.4a435d2b.js"><link rel="prefetch" href="/assets/js/121.e565c1fa.js"><link rel="prefetch" href="/assets/js/122.cadcbcd3.js"><link rel="prefetch" href="/assets/js/123.6c512363.js"><link rel="prefetch" href="/assets/js/124.9facf7a2.js"><link rel="prefetch" href="/assets/js/125.02e3fb02.js"><link rel="prefetch" href="/assets/js/13.4534a8b6.js"><link rel="prefetch" href="/assets/js/14.45b12869.js"><link rel="prefetch" href="/assets/js/15.ff6b2573.js"><link rel="prefetch" href="/assets/js/16.3a698275.js"><link rel="prefetch" href="/assets/js/17.fd3fc036.js"><link rel="prefetch" href="/assets/js/18.df6cf7e3.js"><link rel="prefetch" href="/assets/js/19.f5ea0e96.js"><link rel="prefetch" href="/assets/js/20.8eb91f2c.js"><link rel="prefetch" href="/assets/js/21.bc28323e.js"><link rel="prefetch" href="/assets/js/22.3fffd7a3.js"><link rel="prefetch" href="/assets/js/23.6cc0e127.js"><link rel="prefetch" href="/assets/js/24.784b844b.js"><link rel="prefetch" href="/assets/js/25.ac0d5db7.js"><link rel="prefetch" href="/assets/js/26.52884e89.js"><link rel="prefetch" href="/assets/js/27.88d7eaea.js"><link rel="prefetch" href="/assets/js/28.453552c5.js"><link rel="prefetch" href="/assets/js/29.12a39f49.js"><link rel="prefetch" href="/assets/js/3.d68ca9e7.js"><link rel="prefetch" href="/assets/js/30.87d15e20.js"><link rel="prefetch" href="/assets/js/31.333642da.js"><link rel="prefetch" href="/assets/js/32.c367b364.js"><link rel="prefetch" href="/assets/js/33.7bdfcaf0.js"><link rel="prefetch" href="/assets/js/34.d10b200e.js"><link rel="prefetch" href="/assets/js/35.34078bb4.js"><link rel="prefetch" href="/assets/js/36.19f45a44.js"><link rel="prefetch" href="/assets/js/37.f1007974.js"><link rel="prefetch" href="/assets/js/38.5b2ea18f.js"><link rel="prefetch" href="/assets/js/39.b4230897.js"><link rel="prefetch" href="/assets/js/4.42cdabf3.js"><link rel="prefetch" href="/assets/js/40.388ed6ed.js"><link rel="prefetch" href="/assets/js/41.eac32d12.js"><link rel="prefetch" href="/assets/js/42.06c2944f.js"><link rel="prefetch" href="/assets/js/43.6d719b2b.js"><link rel="prefetch" href="/assets/js/44.dd507311.js"><link rel="prefetch" href="/assets/js/45.417aa669.js"><link rel="prefetch" href="/assets/js/46.6454b89c.js"><link rel="prefetch" href="/assets/js/47.a4d01061.js"><link rel="prefetch" href="/assets/js/48.3266d9c7.js"><link rel="prefetch" href="/assets/js/49.13eba933.js"><link rel="prefetch" href="/assets/js/5.65e7bc11.js"><link rel="prefetch" href="/assets/js/50.184aa249.js"><link rel="prefetch" href="/assets/js/51.edb971c2.js"><link rel="prefetch" href="/assets/js/52.2a579c14.js"><link rel="prefetch" href="/assets/js/53.d4ed47ac.js"><link rel="prefetch" href="/assets/js/54.c9fdd312.js"><link rel="prefetch" href="/assets/js/55.02b642c3.js"><link rel="prefetch" href="/assets/js/56.4fed2fdb.js"><link rel="prefetch" href="/assets/js/57.8fcdbc16.js"><link rel="prefetch" href="/assets/js/58.06601f22.js"><link rel="prefetch" href="/assets/js/59.623b7e57.js"><link rel="prefetch" href="/assets/js/6.8a24a128.js"><link rel="prefetch" href="/assets/js/60.224b58ed.js"><link rel="prefetch" href="/assets/js/61.2f5abbf3.js"><link rel="prefetch" href="/assets/js/62.d6412d84.js"><link rel="prefetch" href="/assets/js/63.a358d776.js"><link rel="prefetch" href="/assets/js/64.d20b5c70.js"><link rel="prefetch" href="/assets/js/65.ae2d2e83.js"><link rel="prefetch" href="/assets/js/66.2ecf3b92.js"><link rel="prefetch" href="/assets/js/67.b8b36e37.js"><link rel="prefetch" href="/assets/js/68.38191069.js"><link rel="prefetch" href="/assets/js/69.4bada1f6.js"><link rel="prefetch" href="/assets/js/7.18ae19ec.js"><link rel="prefetch" href="/assets/js/70.d4cac2bb.js"><link rel="prefetch" href="/assets/js/71.fb31c47f.js"><link rel="prefetch" href="/assets/js/72.735b2f2b.js"><link rel="prefetch" href="/assets/js/73.25e4bfb9.js"><link rel="prefetch" href="/assets/js/74.286983ae.js"><link rel="prefetch" href="/assets/js/75.35ecf268.js"><link rel="prefetch" href="/assets/js/76.8d561d27.js"><link rel="prefetch" href="/assets/js/77.5bf042c1.js"><link rel="prefetch" href="/assets/js/78.36dc90a9.js"><link rel="prefetch" href="/assets/js/79.16efb08f.js"><link rel="prefetch" href="/assets/js/8.a226cc9f.js"><link rel="prefetch" href="/assets/js/80.ed5d8e2f.js"><link rel="prefetch" href="/assets/js/81.641fe8d8.js"><link rel="prefetch" href="/assets/js/82.f5d72960.js"><link rel="prefetch" href="/assets/js/83.3726e7f2.js"><link rel="prefetch" href="/assets/js/84.90d19d7c.js"><link rel="prefetch" href="/assets/js/85.bd636699.js"><link rel="prefetch" href="/assets/js/86.d84c8665.js"><link rel="prefetch" href="/assets/js/87.8e816fa3.js"><link rel="prefetch" href="/assets/js/88.45724f43.js"><link rel="prefetch" href="/assets/js/89.7aabf797.js"><link rel="prefetch" href="/assets/js/9.6c517b50.js"><link rel="prefetch" href="/assets/js/90.d1e87932.js"><link rel="prefetch" href="/assets/js/91.f1e70868.js"><link rel="prefetch" href="/assets/js/92.9428cc9e.js"><link rel="prefetch" href="/assets/js/93.22023960.js"><link rel="prefetch" href="/assets/js/94.66105444.js"><link rel="prefetch" href="/assets/js/95.8680903b.js"><link rel="prefetch" href="/assets/js/96.1ce809a1.js"><link rel="prefetch" href="/assets/js/97.6d5190eb.js"><link rel="prefetch" href="/assets/js/98.de0c6159.js"><link rel="prefetch" href="/assets/js/99.7c75c0bb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.74ba1269.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Apache Ignite中文网</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link">Java</a></div><div class="nav-item"><a href="/doc/cpp/" class="nav-link">C++</a></div><div class="nav-item"><a href="/doc/net/" class="nav-link router-link-exact-active router-link-active">C#/.NET</a></div><div class="nav-item"><a href="/doc/sql/" class="nav-link">SQL</a></div><div class="nav-item"><a href="/doc/integration/" class="nav-link">集成</a></div><div class="nav-item"><a href="/doc/spark/" class="nav-link">Ignite&amp;Spark</a></div><div class="nav-item"><a href="/doc/tools/" class="nav-link">工具</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/confluent/" class="nav-link">Confluent平台</a></div><div class="nav-item"><a href="https://www.zybuluo.com/liyuj/note/230739" target="_blank" rel="noopener noreferrer" class="nav-link external">
  历史版本
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">最新版本</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/net/" class="nav-link router-link-exact-active router-link-active">2.7.0</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/" class="nav-link">2.6.0</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link">Java</a></div><div class="nav-item"><a href="/doc/cpp/" class="nav-link">C++</a></div><div class="nav-item"><a href="/doc/net/" class="nav-link router-link-exact-active router-link-active">C#/.NET</a></div><div class="nav-item"><a href="/doc/sql/" class="nav-link">SQL</a></div><div class="nav-item"><a href="/doc/integration/" class="nav-link">集成</a></div><div class="nav-item"><a href="/doc/spark/" class="nav-link">Ignite&amp;Spark</a></div><div class="nav-item"><a href="/doc/tools/" class="nav-link">工具</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/confluent/" class="nav-link">Confluent平台</a></div><div class="nav-item"><a href="https://www.zybuluo.com/liyuj/note/230739" target="_blank" rel="noopener noreferrer" class="nav-link external">
  历史版本
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">最新版本</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc/net/" class="nav-link router-link-exact-active router-link-active">2.7.0</a></li><li class="dropdown-item"><!----> <a href="/doc/2.6.0/" class="nav-link">2.6.0</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/doc/net/" class="active sidebar-link">基本概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/net/#_1-ignite-net是什么？" class="sidebar-link">1.Ignite.NET是什么？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/net/#_1-1-固化内存" class="sidebar-link">1.1.固化内存</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_1-2-ignite持久化" class="sidebar-link">1.2.Ignite持久化</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_1-3-acid兼容" class="sidebar-link">1.3.ACID兼容</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_1-4-完整的sql支持" class="sidebar-link">1.4.完整的SQL支持</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_1-5-键-值" class="sidebar-link">1.5.键-值</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_1-6-并置处理" class="sidebar-link">1.6.并置处理</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_1-7-可扩展性和持久性" class="sidebar-link">1.7.可扩展性和持久性</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_1-8-ignite和ignite-net" class="sidebar-link">1.8.Ignite和Ignite.NET</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/net/#_2-ignite定位" class="sidebar-link">2.Ignite定位</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_3-入门" class="sidebar-link">3.入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/net/#_3-1-环境要求" class="sidebar-link">3.1.环境要求</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_3-2-安装" class="sidebar-link">3.2.安装</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_3-3-从命令行启动" class="sidebar-link">3.3.从命令行启动</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_3-4-第一个ignite计算应用" class="sidebar-link">3.4.第一个Ignite计算应用</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_3-5-第一个ignite数据网格应用" class="sidebar-link">3.5.第一个Ignite数据网格应用</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_3-6-ignite-visor管理控制台" class="sidebar-link">3.6.Ignite Visor管理控制台</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_3-7-linqpad入门" class="sidebar-link">3.7.LINQPad入门</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/net/#_4-跨平台支持" class="sidebar-link">4.跨平台支持</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/net/#_4-1-net-core" class="sidebar-link">4.1..NET Core</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_4-2-mono" class="sidebar-link">4.2.Mono</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_4-3-java检测" class="sidebar-link">4.3.Java检测</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_4-4-已知问题" class="sidebar-link">4.4.已知问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/net/#_5-配置" class="sidebar-link">5.配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/net/#_5-1-c-代码" class="sidebar-link">5.1.C#代码</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_5-2-app-config和web-config" class="sidebar-link">5.2.app.config和web.config</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_5-3-spring-xml" class="sidebar-link">5.3.Spring XML</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/net/#_6-独立节点" class="sidebar-link">6.独立节点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/net/#_6-1-通过命令行配置独立节点" class="sidebar-link">6.1.通过命令行配置独立节点</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_6-2-通过xml文件配置独立节点" class="sidebar-link">6.2.通过XML文件配置独立节点</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_6-3-加载用户程序集" class="sidebar-link">6.3.加载用户程序集</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_6-4-ignite-net作为windows服务" class="sidebar-link">6.4.Ignite.NET作为Windows服务</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/net/#_7-ignite-net生命周期" class="sidebar-link">7.Ignite.NET生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/net/#_7-1-ignition类" class="sidebar-link">7.1.Ignition类</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_7-2-ilifecyclehandler" class="sidebar-link">7.2.ILifecycleHandler</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_7-3-生命周期事件类型" class="sidebar-link">7.3.生命周期事件类型</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/net/#_8-异步支持" class="sidebar-link">8.异步支持</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/net/#_8-1-异步延续" class="sidebar-link">8.1.异步延续</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/net/#_9-客户端和服务端" class="sidebar-link">9.客户端和服务端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/net/#_9-1-概述" class="sidebar-link">9.1.概述</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_9-2-配置客户端和服务端" class="sidebar-link">9.2.配置客户端和服务端</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_9-3-创建分布式缓存" class="sidebar-link">9.3.创建分布式缓存</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_9-4-客户端或者服务端上的计算" class="sidebar-link">9.4.客户端或者服务端上的计算</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_9-5-客户端重连" class="sidebar-link">9.5.客户端重连</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_9-6-管理慢客户端" class="sidebar-link">9.6.管理慢客户端</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/net/#_10-性能优化技巧" class="sidebar-link">10.性能优化技巧</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/net/#_10-1-禁用内部事件通知" class="sidebar-link">10.1.禁用内部事件通知</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_10-2-调整缓存初始大小" class="sidebar-link">10.2.调整缓存初始大小</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_10-3-关闭备份" class="sidebar-link">10.3.关闭备份</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_10-4-调整退出策略" class="sidebar-link">10.4.调整退出策略</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_10-5-调整缓存数据再平衡" class="sidebar-link">10.5.调整缓存数据再平衡</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_10-6-配置线程池" class="sidebar-link">10.6.配置线程池</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_10-7-尽可能地使用ibinarizable" class="sidebar-link">10.7.尽可能地使用IBinarizable</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_10-8-使用并置计算" class="sidebar-link">10.8.使用并置计算</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_10-9-使用数据流处理器" class="sidebar-link">10.9.使用数据流处理器</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_10-10-批量处理消息" class="sidebar-link">10.10.批量处理消息</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_10-11-调整垃圾收集" class="sidebar-link">10.11.调整垃圾收集</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/net/#_11-序列化" class="sidebar-link">11.序列化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/net/#_11-1-ibinarizable" class="sidebar-link">11.1.IBinarizable</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_11-2-ibinaryserializer" class="sidebar-link">11.2.IBinarySerializer</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_11-3-iserializable" class="sidebar-link">11.3.ISerializable</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_11-4-ignite反射式序列化" class="sidebar-link">11.4.Ignite反射式序列化</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_11-5-使用entity-framework-pocos" class="sidebar-link">11.5.使用Entity Framework POCOs</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/net/#_12-二进制模式" class="sidebar-link">12.二进制模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/net/#_12-1-启用二进制模式" class="sidebar-link">12.1.启用二进制模式</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_12-2-修改二进制对象" class="sidebar-link">12.2.修改二进制对象</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_12-3-创建二进制对象" class="sidebar-link">12.3.创建二进制对象</a></li><li class="sidebar-sub-header"><a href="/doc/net/#_12-4-二进制类型元数据" class="sidebar-link">12.4.二进制类型元数据</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="基本概念"><a href="#基本概念" aria-hidden="true" class="header-anchor">#</a> 基本概念</h1> <h2 id="_1-ignite-net是什么？"><a href="#_1-ignite-net是什么？" aria-hidden="true" class="header-anchor">#</a> 1.Ignite.NET是什么？</h2> <div class="tip custom-block"><p class="custom-block-title">Ignite是：</p> <p>一个以内存为中心的分布式数据库、缓存和处理平台，可以在PB级数据中，以内存级的速度进行事务性、分析性以及流式负载的处理。</p></div> <p><img src="https://files.readme.io/11ace9c-0bad3a9-ignite_architecture.png" alt=""></p> <h3 id="_1-1-固化内存"><a href="#_1-1-固化内存" aria-hidden="true" class="header-anchor">#</a> 1.1.固化内存</h3> <p>Ignite的固化内存组件不仅仅将内存作为一个缓存层，还视为一个全功能的存储层。这意味着可以按需将持久化打开或者关闭。如果持久化关闭，那么Ignite就可以作为一个分布式的<strong>内存数据库</strong>或者<strong>内存数据网格</strong>，这完全取决于使用SQL和键-值API的喜好。如果持久化打开，那么Ignite就成为一个分布式的，<strong>可水平扩展的数据库</strong>，它会保证完整的数据一致性以及集群故障的可恢复能力。</p> <h3 id="_1-2-ignite持久化"><a href="#_1-2-ignite持久化" aria-hidden="true" class="header-anchor">#</a> 1.2.Ignite持久化</h3> <p>Ignite的原生持久化是一个分布式的、支持ACID以及兼容SQL的磁盘存储，它可以作为一个可选的磁盘层与Ignite的固化内存透明地集成，然后将数据和索引存储在SSD、闪存、3D XPoint以及其它类型的非易失性存储中。</p> <p>打开Ignite的持久化之后，就不需要将所有的数据和索引保存在内存中，或者在节点或者集群重启后对数据进行预热，因为固化内存和持久化紧密耦合之后，会将其视为一个二级存储层，这意味着在内存中数据和索引的一个子集如果丢失了，固化内存会从磁盘上进行获取。</p> <h3 id="_1-3-acid兼容"><a href="#_1-3-acid兼容" aria-hidden="true" class="header-anchor">#</a> 1.3.ACID兼容</h3> <p>存储在Ignite中的数据，在内存和磁盘上是同时支持ACID的，使Ignite成为一个<strong>强一致</strong>的系统，Ignite可以在整个拓扑的多台服务器上保持事务。</p> <h3 id="_1-4-完整的sql支持"><a href="#_1-4-完整的sql支持" aria-hidden="true" class="header-anchor">#</a> 1.4.完整的SQL支持</h3> <p>Ignite提供了完整的SQL、DDL和DML的支持，可以使用纯SQL而不用写代码与Ignite进行交互，这意味着只使用SQL就可以创建表和索引，以及插入、更新和查询数据。有这个完整的SQL支持，Ignite就可以作为一种<strong>分布式SQL数据库</strong>。</p> <h3 id="_1-5-键-值"><a href="#_1-5-键-值" aria-hidden="true" class="header-anchor">#</a> 1.5.键-值</h3> <p>Ignite的内存数据网格组件是一个完整的事务型<strong>分布式键值存储</strong>，它可以在有几百台服务器的集群上进行水平扩展。在打开持久化时，Ignite可以存储比内存容量更大的数据，并且在整个集群重启之后仍然可用。</p> <h3 id="_1-6-并置处理"><a href="#_1-6-并置处理" aria-hidden="true" class="header-anchor">#</a> 1.6.并置处理</h3> <p>大多数传统数据库是以客户机-服务器的模式运行的，这意味着数据必须发给客户端进行处理，这个方式需要在客户端和服务端之间进行大量的数据移动，通常来说不可扩展。而Ignite使用了另外一种方式，可以将轻量级的计算发给数据，即数据的<strong>并置</strong>计算，从结果上来说，Ignite扩展性更好，并且使数据移动最小化。</p> <h3 id="_1-7-可扩展性和持久性"><a href="#_1-7-可扩展性和持久性" aria-hidden="true" class="header-anchor">#</a> 1.7.可扩展性和持久性</h3> <p>Ignite是一个弹性的、可水平扩展的分布式系统，它支持按需地添加和删除节点，Ignite还可以存储数据的多个副本，这样可以使集群从部分故障中恢复。如果打开了持久化，那么Ignite中存储的数据可以在集群的完全故障中恢复。Ignite集群重启会非常快，因为数据从磁盘上获取，瞬间就具有了可操作性。从结果上来说，数据不需要在处理之前预加载到内存中，而Ignite会缓慢地恢复内存级的性能。</p> <h3 id="_1-8-ignite和ignite-net"><a href="#_1-8-ignite和ignite-net" aria-hidden="true" class="header-anchor">#</a> 1.8.Ignite和Ignite.NET</h3> <p>Ignite.NET构建于Ignite之上：</p> <ul><li>.NET会在同一个进程中启动JVM，并通过JNI与之通信；</li> <li>.NET、C++和Java节点会加入同一个集群，使用相同的缓存，并使用通用的二进制协议进行互操作；</li> <li>Java计算作业可以在任意节点上执行（.NET、C++和Java）；</li> <li>.NET计算作业只能运行在.NET节点上；</li></ul> <p>Ignite.NET还可以运行于<a href="#_16-%E7%98%A6%E5%AE%A2%E6%88%B7%E7%AB%AF">瘦客户端</a>模式，不需要Java/JVM，与服务端使用单一的TCP连接进行通信。</p> <h2 id="_2-ignite定位"><a href="#_2-ignite定位" aria-hidden="true" class="header-anchor">#</a> 2.Ignite定位</h2> <p><strong>Ignite是不是持久化或者纯内存存储？</strong></p> <p><strong>都是</strong>，Ignite的原生持久化可以打开，也可以关闭。这使得Ignite可以存储比可用内存容量更大的数据集。也就是说，可以只在内存中存储较少的操作性数据集，然后将不适合存储在内存中的较大数据集存储在磁盘上，即为了提高性能将内存作为一个缓存层。</p> <p><strong>Ignite是不是内存数据库（IMDB）？</strong></p> <p><strong>是</strong>，虽然Ignite的<em>固化内存</em>在内存和磁盘中都工作得很好，但是磁盘持久化是可以关闭的，使Ignite成为一个支持SQL以及分布式关联的<em>内存数据库</em>。</p> <p><strong>Ignite是不是内存数据网格（IMDG）？</strong></p> <p><strong>是</strong>，Ignite是一个全功能的数据网格，它既可以用于纯内存模式，也可以带有Ignite的原生持久化，它也可以与任何第三方数据库集成，包括RDBMS和NoSQL。</p> <p><strong>Ignite是不是一个分布式缓存？</strong></p> <p><strong>是</strong>，如果关闭原生持久化，Ignite就会成为一个分布式缓存，Ignite实现了JCache规范（JSR107），并且提供了比规范要求更多的功能，包括分区和复制模式、分布式ACID事务、SQL查询以及原生持久化等。</p> <p><strong>Ignite是不是分布式数据库？</strong></p> <p><strong>是</strong>，在整个集群的多个节点中，Ignite中的数据要么是<em>分区模式</em>的，要么是<em>复制模式</em>的，这给系统带来了伸缩性，增加了系统的弹性。Ignite可以自动控制数据如何分区，同时，开发者也可以插入自定义的分布（关联）函数，以及为了提高效率将部分数据并置在一起。</p> <p><strong>Ignite是不是SQL数据库？</strong></p> <p><strong>不完整</strong>，尽管Ignite的目标是和其它的关系型SQL数据库具有类似的行为，但是在处理约束和索引方面还是有不同的。Ignite支持<em>一级</em>和<em>二级</em>索引，但是只有一级索引支持<em>唯一性</em>，Ignite还不支持<em>外键</em>约束。</p> <p>总体来说，Ignite作为约束不支持任何会导致集群广播消息的更新以及显著降低系统性能和可伸缩性的操作。</p> <p><strong>Ignite是不是一个NoSQL数据库?</strong></p> <p><strong>不完全</strong>，和其它NoSQL数据库一样，Ignite支持高可用和水平扩展，但是，和其它的NoSQL数据库不同，Ignite支持SQL和ACID。</p> <p><strong>Ignite是不是事务型数据库？</strong></p> <p><strong>不完整</strong>，ACID事务是支持的，但是仅仅在键-值API级别，Ignite还支持<em>跨分区的事务</em>，这意味着事务可以跨越不同服务器不同分区中的键。</p> <p>Ignite在2.7版本中，通过MVCC技术，实现了包括SQL事务在内的全事务支持，不过目前还处于测试阶段。</p> <p><strong>Ignite是不是一个多模式数据库？</strong></p> <p><strong>是</strong>，Ignite的数据建模和访问，同时支持键值和SQL，另外，Ignite还为在分布式数据上的计算处理，提供了强大的API。</p> <p><strong>Ignite是不是键-值存储？</strong></p> <p><strong>是</strong>，Ignite提供了丰富的键-值API，兼容于JCache (JSR-107)，并且支持Java，C++和.NET。</p> <p><strong>固化内存是什么？</strong></p> <p>Ignite的<em>固化内存</em>架构使得Ignite可以将内存计算延伸至磁盘，它基于一个页面化的堆外内存分配器，它通过预写日志（WAL）的持久化来对数据进行固化，当持久化禁用之后，固化内存就会变成一个纯粹的内存存储。</p> <p><strong>并置处理是什么？</strong></p> <p>Ignite是一个分布式系统，因此，有能力将数据和数据以及数据和计算进行并置就变得非常重要，这会避免分布式数据噪声。当执行分布式SQL关联时数据的并置就变得非常的重要。Ignite还支持将用户的逻辑（函数，lambda等）直接发到数据所在的节点然后在本地进行数据的运算。</p> <h2 id="_3-入门"><a href="#_3-入门" aria-hidden="true" class="header-anchor">#</a> 3.入门</h2> <h3 id="_3-1-环境要求"><a href="#_3-1-环境要求" aria-hidden="true" class="header-anchor">#</a> 3.1.环境要求</h3> <ul><li>JDK：8+；</li> <li>OS：Windows(7及以上)，Windows Server（2008 R2及以上），Linux（支持.NET Core的任何发行版），macOS；</li> <li>网络：没有限制（建议10G）；</li> <li>硬件：无限制；</li> <li>.NET框架：.NET 4.0+, .NET Core 2.0+；</li> <li>IDE：.NET 4.0+, .NET Core 2.0+；</li></ul> <p>下面的内容基于Windows和Visual Studio，对于Linux和macOS平台的使用，请参见<a href="#_4-%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%94%AF%E6%8C%81">跨平台支持</a>。</p> <h3 id="_3-2-安装"><a href="#_3-2-安装" aria-hidden="true" class="header-anchor">#</a> 3.2.安装</h3> <p><strong>NuGet</strong></p> <p>NuGet是将Ignite.NET包含到项目中最便捷的方法，具体可以在软件包管理器控制台中输入以下内容：<code>Install-Package Apache.Ignite</code>进行安装。</p> <p>或者也可以在NuGet Gallery中搜索软件包：<a href="https://www.nuget.org/packages/Apache.Ignite/" target="_self" rel="noopener noreferrer">https://www.nuget.org/packages/Apache.Ignite/</a>。</p> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>安装NuGet软件包会更新项目的<code>post-build</code>事件，将Libs文件夹复制到输出目录，具体请参见<a href="#_14-%E9%83%A8%E7%BD%B2">部署</a>章节的内容。</p></div> <div class="tip custom-block"><p class="custom-block-title">更新NuGet软件包</p> <p>当要更新到新版本的Ignite.NET时，一定要清理<code>bin</code>文件夹并且重新构建，以更新Libs文件夹。</p></div> <p><strong>二进制发行版</strong></p> <p>二进制发行版包含了Ignite、Ignite.NET和Ignite.C++，可选的Java包，示例代码以及其他的内容。</p> <ul><li>从如下<a href="https://ignite.apache.org/download.cgi#binaries" target="_self" rel="noopener noreferrer">地址</a>下载二进制发行版；</li> <li>将压缩包解压到系统中某个安装文件夹中。</li></ul> <p>运行示例：</p> <ul><li>打开<code>platforms\dotnet\examples\Apache.Ignite.Examples.sln</code>；</li> <li>打开<code>Apache.Ignite.Examples</code>项目属性文件，通过<code>Startup object</code>复选框选择一个示例；</li> <li>可选：通过<code>Apache.Ignite.exe -configFileName=platforms\dotnet\examples\Apache.Ignite.Examples\App.config -assembly=[path_to_Apache.Ignite.ExamplesDll.dll]</code>启动一个独立的节点；</li> <li>使用<code>F5</code>或者<code>Ctrl-F5</code>运行示例。</li></ul> <p><strong>源代码发行版</strong></p> <p>Ignite.NET基于Ignite，需要首先构建Java源代码，具体请参见<a href="/doc/java/#_3-入门">这里</a>。</p> <p>可以使用一个<code>build.bat</code>或者<code>build.ps1</code>脚本（位于<code>modules\platforms\dotnet\</code>文件夹）来构建Java源代码、.NET源代码和NuGet软件包。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>rem Switch to Ignite.NET directory
<span class="token builtin class-name">cd</span> modules<span class="token punctuation">\</span>platforms<span class="token punctuation">\</span>dotnet

build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-3-从命令行启动"><a href="#_3-3-从命令行启动" aria-hidden="true" class="header-anchor">#</a> 3.3.从命令行启动</h3> <p>一个Ignite节点可以从命令行启动，可以使用默认的配置也可以传入一个配置文件。可以启动任意个节点，它们彼此之间会自动发现对方。假定当前位于Ignite的安装文件夹，可以在命令行中输入下面的命令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>platforms<span class="token punctuation">\</span>dotnet<span class="token punctuation">\</span>bin<span class="token punctuation">\</span>Apache.Ignite.exe
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以看到下面的信息：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[02:49:12] Ignite node started OK (id=ab5d18a6)
[02:49:12] Topology snapshot [ver=1, nodes=1, CPUs=8, heap=1.0GB]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">提示</p> <p>关于如何生成独立的Ignite.NET节点以及使用各种配置参数的更多信息，可以参见<a href="#_6-%E7%8B%AC%E7%AB%8B%E8%8A%82%E7%82%B9">独立节点</a>。</p></div> <h3 id="_3-4-第一个ignite计算应用"><a href="#_3-4-第一个ignite计算应用" aria-hidden="true" class="header-anchor">#</a> 3.4.第一个Ignite计算应用</h3> <p>下面是第一个网格应用，该应用将计算句子中的非空白字符数。例如将一个句子拆分为多个单词，并将统计每个单词中的字符数作为一个计算作业，最后将各个作业获得的结果相加即可得出总数。</p> <ul><li>创建一个新的控制台应用项目；</li> <li>使用NuGet时：安装Apache Ignite.NET NuGet软件包；</li> <li>使用完整发行版时：添加对platform\dotnet\bin\Apache.Ignite.Core.dll的引用。</li></ul> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> funcs <span class="token operator">=</span> <span class="token string">&quot;Count characters using callable&quot;</span><span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>word <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">ComputeFunc</span> <span class="token punctuation">{</span> Word <span class="token operator">=</span> word <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        ICollection<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> res <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>funcs<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">var</span> sum <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt; Total number of characters in the phrase is '{0}'.&quot;</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ComputeFunc</span> <span class="token punctuation">:</span> <span class="token class-name">IComputeFunc</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Word <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Word<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="_3-5-第一个ignite数据网格应用"><a href="#_3-5-第一个ignite数据网格应用" aria-hidden="true" class="header-anchor">#</a> 3.5.第一个Ignite数据网格应用</h3> <p>下面是一组简单的应用，它们会简单地进行一些分布式缓存的读写，然后执行基本的事务操作：</p> <p>写和读：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetOrCreateCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Store keys in cache (values will end up on different cache nodes).</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Got [key={0}, val={1}]&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> cache<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>原子化操作：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Put-if-absent which returns previous value.</span>
CacheResult<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> oldVal <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">GetAndPutIfAbsent</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Put-if-absent which returns boolean success flag.</span>
<span class="token keyword">bool</span> success <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">PutIfAbsent</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Replace-if-exists operation (opposite of getAndPutIfAbsent), returns previous value.</span>
oldVal <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">GetAndReplace</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Replace-if-exists operation (opposite of putIfAbsent), returns boolean success flag.</span>
success <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Replace-if-matches operation.</span>
success <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Remove-if-matches operation.</span>
success <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>事务：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> tx <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetTransactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">TxStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> hello <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>hello <span class="token operator">==</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
        cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>分布式锁：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Lock cache key &quot;11&quot;.</span>
<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> cacheLock <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    cacheLock<span class="token punctuation">.</span><span class="token function">Enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span>
    <span class="token punctuation">{</span>
        cacheLock<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_3-6-ignite-visor管理控制台"><a href="#_3-6-ignite-visor管理控制台" aria-hidden="true" class="header-anchor">#</a> 3.6.Ignite Visor管理控制台</h3> <p>要确认数据网格的内容以及执行一些其它的管理和监视操作，最简单的方法是使用Ignite的<a href="/doc/tools/VisorManagementConsole.html">Visor命令行工具</a>。</p> <p>通过下面的命令可以启动Visor：</p> <div class="language-batch line-numbers-mode"><pre class="language-batch"><code><span class="token command"><span class="token keyword">bin</span>\ignitevisorcmd.bat</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-7-linqpad入门"><a href="#_3-7-linqpad入门" aria-hidden="true" class="header-anchor">#</a> 3.7.LINQPad入门</h3> <p><a href="http://www.linqpad.net/" target="_self" rel="noopener noreferrer">LINQPad</a>非常适合快速入门。</p> <p>Apache Ignite.NET NuGet软件包包括LINQPad示例。</p> <ul><li>参考NuGet软件包：F4-&gt;添加NuGet ...；</li> <li>转到Samples选项卡 -&gt; nuget -&gt; Apache.Ignite；</li></ul> <p>更多的信息可以参见：<a href="https://ptupitsyn.github.io/Using-Apache-Ignite-Net-in-LINQPad/" target="_self" rel="noopener noreferrer">在LINQPad中使用Apache Ignite.NET</a>。</p> <h2 id="_4-跨平台支持"><a href="#_4-跨平台支持" aria-hidden="true" class="header-anchor">#</a> 4.跨平台支持</h2> <p>从2.4版本开始，同Windows平台一样，也可以在Linux和macOS平台上运行.NET节点以及开发Ignite.NET应用，.NET Core和Mono平台都是支持的。</p> <h3 id="_4-1-net-core"><a href="#_4-1-net-core" aria-hidden="true" class="header-anchor">#</a> 4.1..NET Core</h3> <p><strong>环境要求</strong></p> <ul><li><a href="https://www.microsoft.com/net/download/" target="_self" rel="noopener noreferrer">.NET Core SDK 2.0+</a>；</li> <li><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_self" rel="noopener noreferrer">Java 8+</a>（macOS需要JDK，否则JRE也可以）。</li></ul> <p><strong>使用NuGet</strong></p> <ul><li><code>dotnet new console</code>；</li> <li><code>dotnet add package Apache.Ignite</code>；</li></ul> <p>编辑<code>Program.cs</code>文件：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> Apache<span class="token punctuation">.</span>Ignite<span class="token punctuation">.</span>Core<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> IgniteTest
<span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li><code>dotnet run</code></li></ul> <p><strong>运行示例</strong></p> <p><a href="https://ignite.apache.org/download.cgi#binaries" target="_self" rel="noopener noreferrer">二进制发行版</a>中包含了.NET Core的示例：</p> <ul><li>从<a href="https://ignite.apache.org/download.cgi#binaries" target="_self" rel="noopener noreferrer">这里</a>下载二进制发行版然后解压；</li> <li><code>cd platforms/dotnet/examples/dotnetcore</code>；</li> <li><code>dotnet run</code>。</li></ul> <h3 id="_4-2-mono"><a href="#_4-2-mono" aria-hidden="true" class="header-anchor">#</a> 4.2.Mono</h3> <p><strong>环境要求</strong></p> <ul><li><a href="http://www.mono-project.com/download/" target="_self" rel="noopener noreferrer">Mono</a>；</li> <li><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_self" rel="noopener noreferrer">Java 8+</a>（macOS需要JDK，否则JRE也可以）。</li></ul> <p><strong>使用NuGet</strong></p> <p>请参见<a href="#_3-%E5%85%A5%E9%97%A8">入门</a>章节中的相关内容。</p> <p>一个额外的步骤是配置<code>IGNITE_HOME</code>环境变量或者<code>IgniteConfiguration.IgniteHome</code>，指向NuGet的包路径（通常是<code>packages/Apache.Ignite.2.4.0</code>）。</p> <p><strong>运行示例</strong></p> <p>Mono可以直接在.NET 4环境中构建和运行。</p> <ul><li><code>cd platforms/dotnet/examples</code>；</li> <li><code>nuget restore</code>；</li> <li><code>msbuild</code>；</li> <li><code>mono Apache.Ignite.Examples/bin/Debug/Apache.Ignite.Examples.exe</code>。</li></ul> <h3 id="_4-3-java检测"><a href="#_4-3-java检测" aria-hidden="true" class="header-anchor">#</a> 4.3.Java检测</h3> <p>Ignite.NET会在如下路径中查找Java运行环境：</p> <ul><li><code>HKLM\Software\JavaSoft\Java Runtime Environment</code>（Windows）；</li> <li><code>/usr/bin/java</code>（Linux）；</li> <li><code>/Library/Java/JavaVirtualMachines</code>（macOS）；</li></ul> <p>如果在其它位置自行安装Java环境，则需配置下面的任一配置项：</p> <ul><li><code>IgniteConfiguration.JvmDllPath</code>属性；</li> <li><code>JAVA_HOME</code>环境变量。</li></ul> <h3 id="_4-4-已知问题"><a href="#_4-4-已知问题" aria-hidden="true" class="header-anchor">#</a> 4.4.已知问题</h3> <p><strong>NU1701</strong></p> <p><code>warning NU1701: Package 'Apache.Ignite 2.4.0' was restored using '.NETFramework,Version=v4.6.1' instead of the project target framework '.NETCoreApp,Version=v2.0'. This package may not be fully compatible with your project.</code>。</p> <p>Ignite.NET完全支持.NET Core，但NuGet程序集针对的是.NET 4.0。通过在<code>csproj</code>文件中添加<code>&lt;PropertyGroup&gt;&lt;NoWarn&gt;NU1701&lt;/NoWarn&gt;&lt;/PropertyGroup&gt;</code>，可以安全地忽略此警告。</p> <p><strong>No Java runtime present, requesting install</strong></p> <p>在macOS上Java的<code>8u151</code>版本存在一个问题：<a href="https://bugs.openjdk.java.net/browse/JDK-7131356" target="_self" rel="noopener noreferrer">JDK-7131356</a>，一定要安装<code>8u152</code>及其以后的版本。</p> <p><strong>Serializing delegates is not supported on this platform</strong></p> <p>.NET Core不支持序列化委托，执行<code>System.MulticastDelegate.GetObjectData</code><a href="https://github.com/dotnet/coreclr/blob/master/src/mscorlib/src/System/MulticastDelegate.cs#L52" target="_self" rel="noopener noreferrer">会抛出异常</a>，因此Ignite.NET无法对委托或包含委托的对象进行序列化。</p> <p><strong>Could not load file or assembly 'System.Configuration.ConfigurationManager'</strong></p> <p>已知的<a href="https://github.com/dotnet/standard/issues/506" target="_self" rel="noopener noreferrer">.NET问题(506)</a>，有时需要额外的包引用：</p> <ul><li><code>dotnet add package System.Configuration.ConfigurationManager</code></li></ul> <h2 id="_5-配置"><a href="#_5-配置" aria-hidden="true" class="header-anchor">#</a> 5.配置</h2> <p>Ignite.NET节点可以通过多种方法来配置，具体表现为一组<code>Ignition.Start*</code>方法。</p> <h3 id="_5-1-c-代码"><a href="#_5-1-c-代码" aria-hidden="true" class="header-anchor">#</a> 5.1.C#代码</h3> <p>在C#代码中，完全可以通过<code>Ignition.Start(IgniteConfiguration)</code>配置Ignite.NET。</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    DiscoverySpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoverySpi</span>
    <span class="token punctuation">{</span>
        IpFinder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoveryStaticIpFinder</span>
        <span class="token punctuation">{</span>
            Endpoints <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;127.0.0.1:47500..47509&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        SocketTimeout <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    IncludedEventTypes <span class="token operator">=</span> EventType<span class="token punctuation">.</span>CacheAll<span class="token punctuation">,</span>
    JvmOptions <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;-Xms1024m&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-Xmx1024m&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_5-2-app-config和web-config"><a href="#_5-2-app-config和web-config" aria-hidden="true" class="header-anchor">#</a> 5.2.app.config和web.config</h3> <p><code>Ignition.StartFromApplicationConfiguration</code>方法会从<code>app.config</code>或<code>web.config</code>文件的<code>Apache.Ignite.Core.IgniteConfigurationSection</code>中读取配置。</p> <p>在二进制发行版的<code>Apache.Ignite.Core.dll</code>旁边，以及<code>Apache.Ignite.Schema</code>NuGet包中，可以找到<code>IgniteConfigurationSection.xsd</code>架构文件。在配置文件中编辑<code>IgniteConfigurationSection</code>时，将其包含在项目中并且构建动作为<code>None</code>，可以在Visual Studio中启用IntelliSense。</p> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>要将<code>IgniteConfigurationSection.xsd</code>架构文件添加到Visual Studio项目中，可以转到<code>Projects</code>菜单，然后单击<code>Add Existing Item...</code>菜单项，之后找到<code>IgniteConfigurationSection.xsd</code>并且选中。</p> <p>或者，安装NuGet软件包：<code>Install-Package Apache.Ignite.Schema</code>，这将自动将xsd文件添加到项目中。</p> <p>为了改善编辑体验，确保在工具-选项-文本编辑器-XML中启用了<code>语句完成</code>选项。</p></div> <p><strong>app.config</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configSections</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>igniteConfiguration<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Apache.Ignite.Core.IgniteConfigurationSection, Apache.Ignite.Core<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configSections</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>runtime</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gcServer</span> <span class="token attr-name">enabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>runtime</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://ignite.apache.org/schema/dotnet/IgniteConfigurationSection<span class="token punctuation">&quot;</span></span> <span class="token attr-name">gridName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myGrid1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>discoverySpi</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>TcpDiscoverySpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ipFinder</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>TcpDiscoveryStaticIpFinder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>endpoints</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>127.0.0.1:47500..47509<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>endpoints</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ipFinder</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>discoverySpi</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span> <span class="token attr-name">cacheMode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Replicated<span class="token punctuation">'</span></span> <span class="token attr-name">readThrough</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>true<span class="token punctuation">'</span></span> <span class="token attr-name">writeThrough</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>true<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>secondCache<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includedEventTypes</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span>42<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>int</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span>TaskFailed<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>int</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span>JobFinished<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>int</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includedEventTypes</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>userAttributes</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pair</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>myNode<span class="token punctuation">'</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>true<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>userAttributes</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>JvmOptions</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>-Xms1024m<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>-Xmx1024m<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>JvmOptions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p><strong>C#</strong></p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">StartFromApplicationConfiguration</span><span class="token punctuation">(</span><span class="token string">&quot;igniteConfiguration&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>Ignite配置段的语法</strong></p> <p>Ignite的配置段直接映射到<code>IgniteConfiguration</code>类。</p> <ul><li>简单属性（字符串、基础类型、枚举）映射到XML属性（属性名为驼峰式的C#属性名）；</li> <li>复杂属性映射到嵌套的XML元素（元素名为驼峰式的C#属性名）；</li> <li>当复杂属性是接口或抽象类时，<code>type</code>属性将用于指定类型，需要使用程序集限定名。对于内置类型（例如上面代码示例中的<code>TcpDiscoverySpi</code>），可以省略程序集名和命名空间；</li> <li>如有疑问，可以查询<code>IgniteConfigurationSection.xsd</code>。</li></ul> <h3 id="_5-3-spring-xml"><a href="#_5-3-spring-xml" aria-hidden="true" class="header-anchor">#</a> 5.3.Spring XML</h3> <p>Spring的XML文件可以使用原生的基于Java的Ignite配置，Spring的配置文件可以通过<code>Ignition.Start(string)</code>方法以及<code>IgniteConfiguration.SpringConfigUrl</code>属性传入。</p> <p>使用<code>IgniteConfiguration.SpringConfigUrl</code>属性时，Spring的配置会首先加载，在其之上才会应用其他的<code>IgniteConfiguration</code>属性，这样在Ignite.NET不直接支持某些Java属性时，此功能会有用。</p> <p><strong>Spring XML：</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>util</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/util<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/util
                           http://www.springframework.org/schema/util/spring-util.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>grid.cfg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>localHost<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>127.0.0.1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>gridName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>grid1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userAttributes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>my_attr<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>value1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.CacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cache1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>startSize<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>discoverySpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ipFinder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.discovery.tcp.ipfinder.vm.TcpDiscoveryVmIpFinder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>addresses<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>127.0.0.1:47500..47509<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>socketTimeout<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>300<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p><strong>C#：</strong></p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token string">&quot;spring-config.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_6-独立节点"><a href="#_6-独立节点" aria-hidden="true" class="header-anchor">#</a> 6.独立节点</h2> <p>Ignite.NET节点可以在.NET应用的代码中通过使用<code>Ignition.Start()</code>启动，也可以使用可执行的<code>Apache.Ignite.exe</code>（位于<code>{apache_ignite_release}\platforms\dotnet\bin</code>文件夹下）作为单独的进程启动。像通常一样，在内部<code>Apache.Ignite.exe</code>引用<code>Apache.Ignite.Core.dll</code>和使用<code>Ignition.Start()</code>，并且可以使用下面列出的命令行参数进行配置，方法是将它们作为命令行选项传递或直接在<code>Apache.Ignite.exe.config</code>文件中进行设置。</p> <h3 id="_6-1-通过命令行配置独立节点"><a href="#_6-1-通过命令行配置独立节点" aria-hidden="true" class="header-anchor">#</a> 6.1.通过命令行配置独立节点</h3> <p>下面是基本的Ignite参数，当使用<code>Apache.Ignite.exe</code>程序启动节点时，这些参数可以作为命令行参数传入：</p> <table><thead><tr><th>命令行参数</th> <th>含义</th></tr></thead> <tbody><tr><td><code>-IgniteHome</code></td> <td>Ignite安装目录路径（如果未提供会使用<code>IGNITE_HOME</code>环境变量）</td></tr> <tr><td><code>-ConfigFileName</code></td> <td><code>app.config</code>文件路径（如果未提供会使用<code>Apache.Ignite.exe.config</code>）</td></tr> <tr><td><code>-ConfigFileName</code></td> <td>配置文件中<code>IgniteConfigurationSection</code>的名字</td></tr> <tr><td><code>-SpringConfigUrl</code></td> <td>Spring配置文件路径</td></tr> <tr><td><code>-JvmDllPath</code></td> <td>JVM库<code>jvm.dll</code>的路径（如果未提供会使用<code>JAVA_HOME</code>环境变量）</td></tr> <tr><td><code>-JvmClasspath</code></td> <td>传递给JVM的类路径（在这里注册其它的jar文件）</td></tr> <tr><td><code>-SuppressWarnings</code></td> <td>是否输出警告信息</td></tr> <tr><td><code>-J&lt;javaOption&gt;</code></td> <td>JVM参数</td></tr> <tr><td><code>-Assembly</code></td> <td>要加载的其它.NET程序集</td></tr> <tr><td><code>-JvmInitialMemoryMB</code></td> <td>初始Java堆大小（MB），对应于<code>-Xms</code>Java参数</td></tr> <tr><td><code>-JvmMaxMemoryMB</code></td> <td>最大Java堆大小（MB），对应于<code>-Xmx</code>Java参数</td></tr> <tr><td><code>/install</code></td> <td>根据指定的参数将Ignite安装为Windows服务</td></tr> <tr><td><code>/uninstall</code></td> <td>卸载Ignite Windows服务</td></tr></tbody></table> <p>示例：</p> <div class="language-batch line-numbers-mode"><pre class="language-batch"><code><span class="token command"><span class="token keyword">Apache</span>.Ignite.exe -ConfigFileName=c:\ignite\my-config.xml -ConfigSectionName=igniteConfiguration -Assembly=c:\ignite\my-code.dll <span class="token parameter attr-name">-J</span>-Xms1024m <span class="token parameter attr-name">-J</span>-Xmx2048m</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_6-2-通过xml文件配置独立节点"><a href="#_6-2-通过xml文件配置独立节点" aria-hidden="true" class="header-anchor">#</a> 6.2.通过XML文件配置独立节点</h3> <p>通过<code>app.config</code>XML文件或/和Spring配置文件，也可以配置独立节点。上面列出的每个命令行参数，也可以用于<code>Apache.Ignite.exe.config</code>的<code>appSettings</code>段。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configSections</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>igniteConfiguration<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Apache.Ignite.Core.IgniteConfigurationSection, Apache.Ignite.Core<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configSections</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span> <span class="token attr-name">springConfigUrl</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>c:\ignite\spring.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myCache<span class="token punctuation">&quot;</span></span> <span class="token attr-name">cacheMode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Replicated<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appSettings</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Ignite.Assembly.1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>my-assembly.dll<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Ignite.Assembly.2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>my-assembly2.dll<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Ignite.ConfigSectionName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>igniteConfiguration<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appSettings</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这个示例定义了<code>igniteConfiguration</code>段，并通过<code>Ignite.ConfigSectionName</code>配置用其启动Ignite，它还引用了一个Spring配置文件，两者最终会组合在一起。</p> <h3 id="_6-3-加载用户程序集"><a href="#_6-3-加载用户程序集" aria-hidden="true" class="header-anchor">#</a> 6.3.加载用户程序集</h3> <p>某些Ignite的API涉及了远程代码执行，因此需要将代码和程序集一起加载到<code>Apache.Ignite.exe</code>，这可以通过<code>-Assembly</code>命令行参数或者<code>Ignite.Assembly</code>应用配置来实现。</p> <p>以下功能要求在所有节点上加载相应的程序集：</p> <ul><li><code>ICompute</code>（支持自动加载，具体可以参见<a href="/doc/net/Clustering.html#_7_远程程序集加载">远程程序集加载</a>）。</li> <li>带过滤器的扫描查询；</li> <li>带过滤器的持续查询；</li> <li><code>远程程序集加载</code>方法；</li> <li>带过滤器的<code>ICache.LoadCache</code>；</li> <li><code>IServices</code>；</li> <li><code>IMessaging.RemoteListen</code>；</li> <li><code>IEvents.RemoteQuery</code>。</li></ul> <div class="warning custom-block"><p class="custom-block-title">缺失用户程序集</p> <p>如果一个用户程序集无法加载，会抛出<code>Could not load file or assembly 'MyAssembly' or one of its dependencies</code>异常。</p> <p>注意任何程序集的<strong>依赖</strong>也是必须要加入该列表的。</p></div> <h3 id="_6-4-ignite-net作为windows服务"><a href="#_6-4-ignite-net作为windows服务" aria-hidden="true" class="header-anchor">#</a> 6.4.Ignite.NET作为Windows服务</h3> <p><code>Apache.Ignite.exe</code>可以安装为Windows的服务，因此可以通过<code>/install</code>命令行参数自动启动。每次服务启动时，所有其它命令行参数将被保留和使用。使用<code>/uninstall</code>可以卸载服务。</p> <div class="language-batch line-numbers-mode"><pre class="language-batch"><code><span class="token command"><span class="token keyword">Apache</span>.Ignite.exe <span class="token parameter attr-name">/install</span> <span class="token parameter attr-name">-J</span>-Xms513m <span class="token parameter attr-name">-J</span>-Xmx555m -ConfigSectionName=igniteConfiguration</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_7-ignite-net生命周期"><a href="#_7-ignite-net生命周期" aria-hidden="true" class="header-anchor">#</a> 7.Ignite.NET生命周期</h2> <p>Ignite.NET是基于进程的，单个进程代表一个或多个逻辑Ignite.NET节点（多数情况下单个进程仅运行一个Ignite.NET节点）。在整个Ignite文档中，几乎可以交替使用术语Ignite运行时和Ignite节点，例如当说要求“在该主机上运行5个节点”时，从技术上讲，大多数情况下在该主机上启动5个Ignite.NET进程即可，每个进程都运行一个Ignite节点。当然Ignite.NET也可以在单​​个进程中支持多个节点，比如大多数Ignite.NET自身内部测试即是这样的运行方式。</p> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>Ignite.NET运行时 == Ignite.NET进程 == Ignite.NET节点（多数情况下）</p></div> <h3 id="_7-1-ignition类"><a href="#_7-1-ignition类" aria-hidden="true" class="header-anchor">#</a> 7.1.Ignition类</h3> <p><code>Ignition</code>类可以在网络拓扑中启动一个独立的Ignite.NET节点，注意一台物理服务器（例如网络上的一台计算机），可以同时运行多个Ignite.NET节点。</p> <p>下面是在本地使用默认值启动一个节点的方法：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name">IIgnite</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>也可以传递一个配置文件：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name">IIgnite</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token string">&quot;examples/config/example-cache.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>配置文件的路径可以是绝对路径，也可以相对于<code>IGNITE_HOME</code>（Ignite安装文件夹）或者当前目录。</p> <h3 id="_7-2-ilifecyclehandler"><a href="#_7-2-ilifecyclehandler" aria-hidden="true" class="header-anchor">#</a> 7.2.ILifecycleHandler</h3> <p>有时在启动或者停止Ignite节点时需要执行特定的事件，这可以通过实现<code>ILifecycleHandler</code>接口实现，然后在<code>IgniteConfiguration</code>的<code>LifecycleHandlers</code>属性中指定。</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    LifecycleHandlers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token keyword">new</span> <span class="token class-name">LifecycleExampleHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>ILifecycleHandler</code>的实现大致如下：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">LifecycleExampleHandler</span> <span class="token punctuation">:</span> <span class="token class-name">ILifecycleHandler</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">OnLifecycleEvent</span><span class="token punctuation">(</span><span class="token class-name">LifecycleEventType</span> evt<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>evt <span class="token operator">==</span> LifecycleEventType<span class="token punctuation">.</span>AfterNodeStart<span class="token punctuation">)</span>
            Started <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>evt <span class="token operator">==</span> LifecycleEventType<span class="token punctuation">.</span>AfterNodeStop<span class="token punctuation">)</span>
            Started <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">bool</span> Started <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_7-3-生命周期事件类型"><a href="#_7-3-生命周期事件类型" aria-hidden="true" class="header-anchor">#</a> 7.3.生命周期事件类型</h3> <p>Ignite.NET支持如下的生命周期事件类型：</p> <table><thead><tr><th>事件类型</th> <th>描述</th></tr></thead> <tbody><tr><td><code>BeforeNodeStart</code></td> <td>启动节点启动过程之前调用</td></tr> <tr><td><code>AfterNodeStart</code></td> <td>节点启动之后调用</td></tr> <tr><td><code>BeforeNodeStop</code></td> <td>启动节点停止过程之前调用</td></tr> <tr><td><code>AfterNodeStop</code></td> <td>节点停止之后调用</td></tr></tbody></table> <h2 id="_8-异步支持"><a href="#_8-异步支持" aria-hidden="true" class="header-anchor">#</a> 8.异步支持</h2> <p>Ignite.NET API的所有分布式方法都可以以同步或者异步的方式执行，这些方法以<code>DoSomething</code>/<code>DoSomethingAsync</code>的方式成对表示。异步方法遵循基于任务的异步模式：它们返回System.Threading.Task，可以使用C# 5的<code>await</code>关键字来等待。</p> <p>支持取消的异步方法具有<code>CancellationToken</code>参数重载。</p> <p><strong>计算网格示例</strong></p> <p>下面的示例说明了同步计算和异步计算之间的区别。</p> <p>同步：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name">ICompute</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Execute a job and wait for the result.</span>
<span class="token keyword">string</span> res <span class="token operator">=</span> compute<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ComputeFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>下面是将上面的代码异步化：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Start asynchronous operation and obtain a Task that represents it</span>
Task<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> asyncRes <span class="token operator">=</span> compute<span class="token punctuation">.</span><span class="token function">CallAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ComputeFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Synchronously wait for the task to complete and obtain result</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>asyncRes<span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// OR use C# 5 await keyword</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">await</span> asyncRes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// OR use continuation</span>
asyncRes<span class="token punctuation">.</span><span class="token function">ContinueWith</span><span class="token punctuation">(</span>task <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>数据网格示例</strong></p> <p>下面是同步和异步调用的数据网格示例。</p> <p>同步：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>ICache<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token operator">&gt;</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

CacheResult<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> val <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">GetAndPut</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>下面是上面调用的异步形式：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Start asynchronous operation and obtain a Task that represents it</span>
Task<span class="token operator">&lt;</span>CacheResult<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;&gt;</span> asyncVal <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">GetAndPutAsync</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Synchronously wait for the task to complete and obtain result</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>asyncVal<span class="token punctuation">.</span>Result<span class="token punctuation">.</span>Success<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Use C# 5 await keyword</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">await</span> asyncVal<span class="token punctuation">)</span><span class="token punctuation">.</span>Success<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Use continuation</span>
asyncVal<span class="token punctuation">.</span><span class="token function">ContinueWith</span><span class="token punctuation">(</span>task <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span>Result<span class="token punctuation">.</span>Success<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_8-1-异步延续"><a href="#_8-1-异步延续" aria-hidden="true" class="header-anchor">#</a> 8.1.异步延续</h3> <p>Ignite中的异步操作是通过特殊的系统线程完成的，这些线程具有以下限制：</p> <ul><li>不应使用Ignite API；</li> <li>不应执行繁重的操作。</li></ul> <p>当<code>ConfigureAwait(false)</code>与<code>async</code>关键字一起使用时，代码可能最终在Ignite系统线程中：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;ints&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">PutAsync</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ConfigureAwait</span><span class="token punctuation">(</span><span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// All the code below executes in Ignite system thread.</span>
<span class="token comment">// Do not access Ignite APIs from here.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果需要执行多个等待的操作，请不要使用<code>ConfigureAwait(false)</code>。</p> <p>对于控制台、ASP.NET Core和某些其他类型的应用，<code>System.Threading.SynchronizationContext</code>未设置默认值，因此一个自定义的<code>SynchronizationContext</code>是必要的，以避免在Ignite系统线程上运行延续。最简单的方法是从这样的<code>SynchronizationContext</code>类派生：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Run async continuations on .NET Thread Pool threads.</span>
        SynchronizationContext<span class="token punctuation">.</span><span class="token function">SetSynchronizationContext</span><span class="token punctuation">(</span>
             <span class="token keyword">new</span> <span class="token class-name">ThreadPoolSynchronizationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">var</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetOrCreateCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;my-cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">PutAsync</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">PutAsync</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;Test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">PutAsync</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;Test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ThreadPoolSynchronizationContext</span> <span class="token punctuation">:</span> <span class="token class-name">SynchronizationContext</span>
<span class="token punctuation">{</span>
    <span class="token comment">// No-op.</span>
    <span class="token comment">// Don't use SynchronizationContext class directly because optimization</span>
    <span class="token comment">// in the Task class treats that the same way as null context.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="_9-客户端和服务端"><a href="#_9-客户端和服务端" aria-hidden="true" class="header-anchor">#</a> 9.客户端和服务端</h2> <h3 id="_9-1-概述"><a href="#_9-1-概述" aria-hidden="true" class="header-anchor">#</a> 9.1.概述</h3> <p>Ignite.NET有<code>客户端</code>和<code>服务端</code>节点的概念。服务端节点参与缓存、计算执行、流处理等，而原生客户端节点可以远程接入服务端，可以使用完整的Ignite API，包括客户端近缓存、事务、计算、流处理、服务网格等。</p> <p>所有Ignite节点默认均以<code>服务端</code>模式启动，<code>客户端</code>模式是需要显式指定的。</p> <p>另一个Ignite模式是<a href="#_16-%E7%98%A6%E5%AE%A2%E6%88%B7%E7%AB%AF">瘦客户端</a>，它与原生客户端有很大不同。瘦客户端非常轻量，不参与集群拓扑。每个瘦客户端都通过套接字接入特定的Ignite节点，并通过该节点执行所有操作。瘦客户端API与完整的Ignite API相似，但功能较少。</p> <h3 id="_9-2-配置客户端和服务端"><a href="#_9-2-配置客户端和服务端" aria-hidden="true" class="header-anchor">#</a> 9.2.配置客户端和服务端</h3> <p>通过<code>IgniteConfiguration.clientMode</code>属性，可以将一个节点配置为客户端或者服务端。</p> <p>或者为了方便，也可以在<code>Ignition</code>类本身上启用或禁用客户端模式，这样可以使客户端和服务端有同样的配置。</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>Ignition<span class="token punctuation">.</span>ClientMode <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>

<span class="token comment">// Start Ignite in client mode.</span>
<span class="token class-name">IIgnite</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_9-3-创建分布式缓存"><a href="#_9-3-创建分布式缓存" aria-hidden="true" class="header-anchor">#</a> 9.3.创建分布式缓存</h3> <p>当创建缓存时，不管是通过XML文件，还是通过<code>IIgnite.CreateCache(...)</code>或者<code>IIgnite.GetOrCreateCache(...)</code>方法，Ignite都会自动在所有服务端节点上部署分布式缓存。</p> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>一个分布式缓存创建之后，它会自动部署到所有的现有和未来的<code>服务端</code>节点上。</p></div> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Enable client mode locally.</span>
Ignition<span class="token punctuation">.</span>ClientMode <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>

<span class="token comment">// Start Ignite in client mode.</span>
<span class="token class-name">IIgnite</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create cache on all the existing and future server nodes.</span>
<span class="token comment">// Note that since the local node is a client, it will not</span>
<span class="token comment">// be caching any data.</span>
<span class="token keyword">var</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetOrCreateCache</span><span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;cacheName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_9-4-客户端或者服务端上的计算"><a href="#_9-4-客户端或者服务端上的计算" aria-hidden="true" class="header-anchor">#</a> 9.4.客户端或者服务端上的计算</h3> <p><code>IgniteCompute</code>默认会在所有的服务端节点上执行计算作业，不过通过创建对应的集群组，也可以选择只在服务端节点或者只在客户端节点上执行。</p> <p>服务端上的计算：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name">ICompute</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Execute computation on the server nodes (default behavior).</span>
compute<span class="token punctuation">.</span><span class="token function">Broadcast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyComputeAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>客户端上的计算：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name">IClusterGroup</span> clientGroup <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ForClientNodes</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">ICompute</span> clientCompute <span class="token operator">=</span> clientGroup<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Execute computation on the client nodes.</span>
clientCompute<span class="token punctuation">.</span><span class="token function">Broadcast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyComputeAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_9-5-客户端重连"><a href="#_9-5-客户端重连" aria-hidden="true" class="header-anchor">#</a> 9.5.客户端重连</h3> <p>在以下几种情况下，客户端节点可能会与集群断开连接：</p> <ul><li>当客户端节点由于网络问题而无法与服务端节点重建连接时；</li> <li>与服务端节点的连接断开了一段时间，客户端节点能够重建与服务端的连接，但是服务端因为未收到客户端心跳，仍然删除了客户端节点；</li> <li>速度慢的客户端可能会被服务器节点踢出。</li></ul> <p>当客户端确定它与集群断开时，它会被分配一个新的节点<code>id</code>，并尝试重新接入集群。不过要注意这有副作用，即如果客户端重新连接，则本地<code>ClusterNode</code>的<code>id</code>属性将更改，这意味着任何依赖于<code>id</code>值的应用逻辑都可能受到影响。</p> <p>当客户端处于断开状态并且正在进行重连尝试时，Ignite API会抛出一个特定的异常： <code>IgniteClientDisconnectedException</code>，此异常提供了一个<code>ClientReconnectTask</code>属性，该任务在重连完成后将会完成（<code>IgniteCache</code>API会抛出<code>CacheException</code>，其将<code>IgniteClientDisconnectedException</code>作为<code>InnerException</code>），该任务也可以通过<code>IIgnite.ClientReconnectTask</code>获得。</p> <p>客户端重连也有对应的Ignite事件（这些事件是本地事件，即它们仅在客户端节点上触发），包括：<code>EventType.ClientNodeDisconnected</code>和<code>EventType.ClientNodeReconnected</code>。</p> <p><code>IIgnite</code>中当然也有<code>ClientDisconnected</code>和<code>ClientReconnected</code>事件：</p> <p>计算：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> compute <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetCompute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        compute<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClientDisconnectedException</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span>ClientReconnectTask<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Wait for reconnection.</span>

        <span class="token comment">// Can proceed and use the same ICompute instance.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>缓存：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetOrCreateCache</span><span class="token punctuation">(</span><span class="token string">&quot;myCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">try</span>
  <span class="token punctuation">{</span>
    cache<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CacheException</span> e<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">var</span> discEx <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token class-name">InnerException</span> <span class="token keyword">as</span> ClientDisconnectedException<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>discEx <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      discEx<span class="token punctuation">.</span>ClientReconnectTask<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Can proceed and use the same ICache instance.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>使用<code>TcpDiscoverySpi</code>中的<code>ClientReconnectDisabled</code>属性，也可以禁用客户端的自动重连。如果重连被禁用，客户端节点会被停止。</p> <p>C#：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    DiscoverySpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpDiscoverySpi</span>
    <span class="token punctuation">{</span>
        ClientReconnectDisabled <span class="token operator">=</span> <span class="token keyword">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>app.config：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>discoverySpi</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>TcpDiscoverySpi<span class="token punctuation">&quot;</span></span> <span class="token attr-name">clientReconnectDisabled</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_9-6-管理慢客户端"><a href="#_9-6-管理慢客户端" aria-hidden="true" class="header-anchor">#</a> 9.6.管理慢客户端</h3> <p>在许多环境中，客户端节点是在主集群之外、网络较差、速度较慢的主机上启动的，这时服务端可能会生成客户端无法处理的负载（例如持续查询通知等），从而导致服务端上出站消息队列的增加。如果启用了背压控制，最终可能会导致服务端内存不足或阻塞整个集群。</p> <p>要管理这些情况，可以配置面向客户端节点的最大允许出站消息数。如果出站队列的大小超过此值，则此类客户端节点将与集群断开，从而阻止整体变慢。</p> <p>下面显示了如何配置慢客户端队列限制：</p> <p>C#：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    CommunicationSpi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TcpCommunicationSpi</span>
    <span class="token punctuation">{</span>
        SlowClientQueueLimit <span class="token operator">=</span> <span class="token number">1000</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>app.config：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>communicationSpi</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>TcpCommunicationSpi<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slowClientQueueLimit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Spring XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>grid.cfg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>communicationSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.spi.communication.tcp.TcpCommunicationSpi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slowClientQueueLimit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_10-性能优化技巧"><a href="#_10-性能优化技巧" aria-hidden="true" class="header-anchor">#</a> 10.性能优化技巧</h2> <p>Ignite.NET内存数据网格的性能和吞吐量很大程度上依赖于使用的功能以及配置，在几乎所有的场景中都可以通过简单地调整缓存的配置来优化缓存的性能。</p> <h3 id="_10-1-禁用内部事件通知"><a href="#_10-1-禁用内部事件通知" aria-hidden="true" class="header-anchor">#</a> 10.1.禁用内部事件通知</h3> <p>Ignite有丰富的事件系统来向用户通知各种各样的事件，包括缓存的修改、退出、压缩、拓扑的变化等。因为每秒钟可能产生上千的事件，它会对系统产生额外的负载，这会导致显著地性能下降。因此，强烈建议只有应用逻辑必要时才启用这些事件。事件通知默认是禁用的：</p> <p>C#：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    IncludedEventTypes <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        EventType<span class="token punctuation">.</span>TaskStarted<span class="token punctuation">,</span>
        EventType<span class="token punctuation">.</span>TaskFinished<span class="token punctuation">,</span>
        EventType<span class="token punctuation">.</span>TaskFailed
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>app.config：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includedEventTypes</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span>TaskStarted<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>int</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span>TaskFinished<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>int</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span>TaskFailed<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>int</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includedEventTypes</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Spring XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token comment">&lt;!-- Enable only some events and leave other ones disabled. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>includeEventTypes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">util:</span>constant</span> <span class="token attr-name">static-field</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.events.EventType.EVT_TASK_STARTED<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">util:</span>constant</span> <span class="token attr-name">static-field</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.events.EventType.EVT_TASK_FINISHED<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">util:</span>constant</span> <span class="token attr-name">static-field</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.events.EventType.EVT_TASK_FAILED<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_10-2-调整缓存初始大小"><a href="#_10-2-调整缓存初始大小" aria-hidden="true" class="header-anchor">#</a> 10.2.调整缓存初始大小</h3> <p>在大小和容量方面，Ignite的内部缓存映射的行为与普通的.NET Hashtable或Dictionary完全相同：它有初始容量（默认情况下很小），当没有空余时容量会增加一倍。内部缓存映射调整大小的过程会占用大量CPU且非常耗时，并且如果将巨大的数据集加载到缓存中（这是常规使用场景），则映射将不得不调整很多次。为避免这种情况，建议指定初始缓存映射容量，与数据集的预期大小相当。在加载期间这将节省大量CPU资源，因为不必调整映射的大小。例如如果希望将1亿数据加载到缓存中，则可以使用以下配置：</p> <p>C#：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    CacheConfiguration <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span>
        <span class="token punctuation">{</span>
            StartSize <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>app.config：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span> <span class="token attr-name">startSize</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>104857600<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Spring XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.CacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            ...
            <span class="token comment">&lt;!-- Set initial cache capacity to ~ 100M. --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>startSize<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#{100 * 1024 * 1024}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>上面的配置将节省<code>log₂(10⁸) − log₂(1024) ≈ 16</code>次缓存映射大小调整（初始映射容量默认为1024）。注意每次后续大小调整平均将比前一次多2倍的时间。</p> <h3 id="_10-3-关闭备份"><a href="#_10-3-关闭备份" aria-hidden="true" class="header-anchor">#</a> 10.3.关闭备份</h3> <p>如果使用了<code>分区</code>缓存，而且数据丢失并不是关键（比如，当有一个备份缓存存储时），可以考虑禁用<code>分区</code>缓存的备份。当备份启用时，缓存引擎会为每个条目维护一个远程拷贝，这需要网络交换，因此是耗时的。要禁用备份，可以使用如下的配置：</p> <p>C#：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    CacheConfiguration <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span>
        <span class="token punctuation">{</span>
            CacheMode <span class="token operator">=</span> CacheMode<span class="token punctuation">.</span>Partitioned<span class="token punctuation">,</span>
            Backups <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>app.config：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span> <span class="token attr-name">cacheMode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Partitioned<span class="token punctuation">&quot;</span></span> <span class="token attr-name">backups</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Spring XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.CacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            ...
            <span class="token comment">&lt;!-- Set cache mode. --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cacheMode<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>PARTITIONED<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token comment">&lt;!-- Set number of backups to 0--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>backups<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="warning custom-block"><p class="custom-block-title">可能的数据丢失</p> <p>如果没有启用<code>分区</code>缓存的备份，会丢失缓存在故障节点的所有数据，这对于缓存临时数据或者数据可以通过某种方式重建可能是可以接受的。禁用备份之前一定要确认对于应用来说丢失数据不是严重问题。</p></div> <h3 id="_10-4-调整退出策略"><a href="#_10-4-调整退出策略" aria-hidden="true" class="header-anchor">#</a> 10.4.调整退出策略</h3> <p>退出默认是禁用的，为了确保缓存中的数据不会增长到超过限值，需要使用退出机制并选择合适的退出策略，下面的示例是配置LRU退出策略，最大值为100000条数据：</p> <p>C#：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    CacheConfiguration <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span>
        <span class="token punctuation">{</span>
            EvictionPolicy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LruEvictionPolicy</span> <span class="token punctuation">{</span> MaxSize <span class="token operator">=</span> <span class="token number">1000000</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>app.config：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>
          	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>evictionPolicy</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>LruEvictionPolicy<span class="token punctuation">'</span></span> <span class="token attr-name">maxSize</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>1000000<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Spring XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.cache.CacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>evictionPolicy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- LRU eviction policy. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.cache.eviction.lru.LruEvictionPolicy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- Set the maximum cache size to 1 million (default is 100,000). --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>maxSize<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1000000<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>不管使用了哪个退出策略，缓存的性能取决于缓存中退出策略允许的最大数据量，即如果缓存大小超过了限值，就会发生退出。</p> <h3 id="_10-5-调整缓存数据再平衡"><a href="#_10-5-调整缓存数据再平衡" aria-hidden="true" class="header-anchor">#</a> 10.5.调整缓存数据再平衡</h3> <p>当新节点加入拓扑时，现有节点会放弃某些键的主备数据所有权，并转给新的节点，以使数据在整个网格中始终保持均衡。这可能需要额外的资源并影响缓存性能，要解决此可能的问题，需要考虑调整以下参数：</p> <ul><li>配置适合自己网络的再平衡批次大小。默认值为512KB，这意味着默认的再平衡消息约为512KB，不过可以根据网络性能将此值设置为更高或更低；</li> <li>配置再平衡限流以释放CPU。如果数据集很大并且有很多消息要发送，则CPU或网络可能会被过度消耗，这可能会持续降低应用的性能。这时应该启用数据再平衡限流，这有助于调整再平衡消息之间的等待时间，以确保再平衡过程不会对性能造成任何负面影响。注意在再平衡过程中，应用将继续正常运行；</li> <li>配置再平衡线程池大小。与上一点相反，有时可能需要通过使用更多的CPU内核来加快再平衡，这可以通过增加再平衡线程池中的线程数来实现（池中默认只有2个线程）。</li></ul> <p>以下是在缓存配置中配置所有上述参数的示例：</p> <p>C#：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    CacheConfiguration <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span>
        <span class="token punctuation">{</span>
            RebalanceBatchSize <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
            RebalanceThrottle <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span>Zero  <span class="token comment">// disable throttling</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>app.config：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cacheConfiguration</span> <span class="token attr-name">rebalanceBatchSize</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1048576<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rebalanceThrottle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0:0:0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cacheConfiguration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Spring XML：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.CacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- Set rebalance batch size to 1 MB. --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>rebalanceBatchSize<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#{1024 * 1024}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

            <span class="token comment">&lt;!-- Explicitly disable rebalance throttling. --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>rebalanceThrottle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            ...
        &lt;/bean
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_10-6-配置线程池"><a href="#_10-6-配置线程池" aria-hidden="true" class="header-anchor">#</a> 10.6.配置线程池</h3> <p>Ignite的主线程池大小默认为可用CPU核数的2倍。在大多数情况下，每个内核持有2个线程可以提高应用的性能，因为上下文切换会更少，CPU缓存也会更好地工作。不过如果预期作业会因I/O或任何其他原因而阻塞，则增加线程池大小可能是有意义的。以下是如何配置线程池的示例：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.IgniteConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token comment">&lt;!-- Configure internal thread pool. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>publicThreadPoolSize<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>64<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!-- Configure system thread pool. --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>systemThreadPoolSize<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>32<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_10-7-尽可能地使用ibinarizable"><a href="#_10-7-尽可能地使用ibinarizable" aria-hidden="true" class="header-anchor">#</a> 10.7.尽可能地使用IBinarizable</h3> <p>通过网络传输的每个对象都实现<code>Apache.Ignite.Core.Binary.IBinarizable</code>是一个最佳实践。这些可能是缓存键或值、作业、作业的参数或将通过网络发送到其他节点的任何内容。实现<code>IBinarizable</code>有时性能可能比标准序列化提高10倍以上。</p> <h3 id="_10-8-使用并置计算"><a href="#_10-8-使用并置计算" aria-hidden="true" class="header-anchor">#</a> 10.8.使用并置计算</h3> <p>Ignite可以在内存中执行MapReduce计算，不过大多数计算通常需要处理缓存在远程节点上的某些数据。从远程节点加载该数据通常非常昂贵，但是将计算发送到数据所在的节点要廉价得多。最简单的方法是使用<code>ICompute.AffinityRun()</code>方法，还有其他方法，包括<code>ICacheAffinity.MapKeysToNodes()</code>方法。并置计算概念的更多信息和代码示例，请参见<a href="/doc/net/DataGrid.html#_7-关联并置">关联并置</a>。</p> <h3 id="_10-9-使用数据流处理器"><a href="#_10-9-使用数据流处理器" aria-hidden="true" class="header-anchor">#</a> 10.9.使用数据流处理器</h3> <p>如果需要将大量数据加载到缓存中，可以使用<code>IDataStreamer</code>。数据流处理器在将更新发送到远程节点之前，会将更新恰当地批量化，还会适当地控制每个节点上并行操作的数量，以避免故障。通常它的性能比一堆单线程更新高10倍。更详细的说明和示例，请参见<a href="/doc/net/DataGrid.html#_8-数据加载">数据加载</a>章节。</p> <h3 id="_10-10-批量处理消息"><a href="#_10-10-批量处理消息" aria-hidden="true" class="header-anchor">#</a> 10.10.批量处理消息</h3> <p>如果能发送10个比较大的作业而不是100个小些的作业，那么应该选择发送大些的作业，这会降低网络上传输作业的数量以及显著地提升性能。类似的对于缓存条目也是一样，应该尽可能使用持有键值集合的API方法，而不是一个一个地传递。</p> <h3 id="_10-11-调整垃圾收集"><a href="#_10-11-调整垃圾收集" aria-hidden="true" class="header-anchor">#</a> 10.11.调整垃圾收集</h3> <p>如果由于垃圾收集（GC）导致吞吐量大幅波动，则应调整JVM参数。以下的JVM设置已经被证明可提供相当平稳的吞吐量，而不会出现大的波动：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>-XX:+UseParNewGC
-XX:+UseConcMarkSweepGC
-XX:+UseTLAB
-XX:NewSize=128m
-XX:MaxNewSize=128m
-XX:MaxTenuringThreshold=0
-XX:SurvivorRatio=1024
-XX:+UseCMSInitiatingOccupancyOnly
-XX:CMSInitiatingOccupancyFraction=60
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="_11-序列化"><a href="#_11-序列化" aria-hidden="true" class="header-anchor">#</a> 11.序列化</h2> <p>大多数用户定义的类都会使用Ignite.NET API通过网络传递给其他节点，这些类包括：</p> <ul><li>缓存键和值；</li> <li>缓存处理器和过滤器（<code>ICacheEntryProcessor</code>、<code>ICacheEntryFilter</code>、<code>ICacheEntryEventFilter</code>、<code>ICacheEntryEventListener</code>）；</li> <li>计算函数（<code>IComputeFunc</code>）、操作（<code>IComputeAction</code>）和作业（<code>IComputeJob</code>）；</li> <li>服务（<code>IService</code>）；</li> <li>事件和消息处理器（<code>IEventListener</code>，<code>IEventFilter</code>，<code>IMessageListener</code>）。</li></ul> <p>通过网络传输的这些类对象需要序列化，Ignite.NET支持以下序列化用户数据的方式：</p> <ul><li><code>Apache.Ignite.Core.Binary.IBinarizable</code>接口；</li> <li><code>Apache.Ignite.Core.Binary.IBinarySerializer</code>接口；</li> <li><code>System.Runtime.Serialization.ISerializable</code>接口；</li> <li>Ignite反射式序列化（当以上都不适用时）。</li></ul> <div class="warning custom-block"><p class="custom-block-title">Ignite.NET 2.0不需要在BinaryConfigurations中注册类型</p> <p>Ignite.NET的早期版本（1.9和更早版本）要求在<code>IgniteConfiguration.BinaryConfiguration</code>中注册所有的类型（除了<code>Serializable</code>），而在Ignite.NET 2.0和更高版本不再有此限制。</p></div> <div class="warning custom-block"><p class="custom-block-title">Ignite.NET 2.0允许在Serializable类型上使用SQL</p> <p>从2.0版本开始，所有序列化都以Ignite二进制格式执行，从而启用了所有的Ignite功能，例如SQL和<a href="#_12-%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%A8%A1%E5%BC%8F">二进制模式</a>，这包括带有和不带有<code>ISerializable</code>接口的<code>Serializable</code>类型。</p></div> <div class="tip custom-block"><p class="custom-block-title">自动化GetHashCode和Equals实现</p> <p>如果对象可以序列化为二进制形式，则Ignite将在序列化时计算其哈希值，并将其写入二进制数组。此外，Ignite还提供了<code>equals</code>方法的自定义实现，用于二进制对象的比较。这意味着无需覆盖自定义键和值的<code>GetHashCode</code>和<code>Equals</code>方法即可在Ignite中使用它们。</p></div> <h3 id="_11-1-ibinarizable"><a href="#_11-1-ibinarizable" aria-hidden="true" class="header-anchor">#</a> 11.1.IBinarizable</h3> <p><code>IBinarizable</code>方式提供了对序列化的细粒度控制，这是高性能生产代码的首选方法。</p> <p>首先，在自己的类中实现<code>IBinarizable</code>接口：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">:</span> <span class="token class-name">IBinarizable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Street <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> Zip <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">WriteBinary</span><span class="token punctuation">(</span><span class="token class-name">IBinaryWriter</span> writer<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Alphabetic field order is required for SQL DML to work.</span>
        <span class="token comment">// Even if DML is not used, alphabetic order is recommended.</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">&quot;street&quot;</span><span class="token punctuation">,</span> Street<span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteInt</span><span class="token punctuation">(</span><span class="token string">&quot;zip&quot;</span><span class="token punctuation">,</span> Zip<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ReadBinary</span><span class="token punctuation">(</span><span class="token class-name">IBinaryReader</span> reader<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      	<span class="token comment">// Read order does not matter, however, reading in the same order</span>
        <span class="token comment">// as writing improves performance.</span>
        Street <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token string">&quot;street&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Zip <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadInt</span><span class="token punctuation">(</span><span class="token string">&quot;zip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><code>IBinarizable</code>也可以在没有字段名的原始模式下实现，这提供了最快和最紧凑的序列化，但是SQL查询不可用：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">:</span> <span class="token class-name">IBinarizable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Street <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> Zip <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">WriteBinary</span><span class="token punctuation">(</span><span class="token class-name">IBinaryWriter</span> writer<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> rawWriter <span class="token operator">=</span> writer<span class="token punctuation">.</span><span class="token function">GetRawWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        rawWriter<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>Street<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rawWriter<span class="token punctuation">.</span><span class="token function">WriteInt</span><span class="token punctuation">(</span>Zip<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ReadBinary</span><span class="token punctuation">(</span><span class="token class-name">IBinaryReader</span> reader<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Read order must be the same as write order</span>
        <span class="token keyword">var</span> rawReader <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">GetRawReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Street <span class="token operator">=</span> rawReader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Zip <span class="token operator">=</span> rawReader<span class="token punctuation">.</span><span class="token function">ReadInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_11-2-ibinaryserializer"><a href="#_11-2-ibinaryserializer" aria-hidden="true" class="header-anchor">#</a> 11.2.IBinarySerializer</h3> <p><code>IBinarySerializer</code>与<code>IBinarizable</code>类似，但是将序列化逻辑与类实现分开。当无法修改类代码，并且在多个类之间共享序列化逻辑等场景时，这可能很有用。以下代码产生与上面的<code>Address</code>示例完全相同的序列化：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">:</span> <span class="token class-name">IBinarizable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Street <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> Zip <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddressSerializer</span> <span class="token punctuation">:</span> <span class="token class-name">IBinarySerializer</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">WriteBinary</span><span class="token punctuation">(</span><span class="token keyword">object</span> obj<span class="token punctuation">,</span> <span class="token class-name">IBinaryWriter</span> writer<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      	<span class="token keyword">var</span> addr <span class="token operator">=</span> <span class="token punctuation">(</span>Address<span class="token punctuation">)</span> obj<span class="token punctuation">;</span>

        writer<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">&quot;street&quot;</span><span class="token punctuation">,</span> addr<span class="token punctuation">.</span>Street<span class="token punctuation">)</span><span class="token punctuation">;</span>
        writer<span class="token punctuation">.</span><span class="token function">WriteInt</span><span class="token punctuation">(</span><span class="token string">&quot;zip&quot;</span><span class="token punctuation">,</span> addr<span class="token punctuation">.</span>Zip<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ReadBinary</span><span class="token punctuation">(</span><span class="token keyword">object</span> obj<span class="token punctuation">,</span> <span class="token class-name">IBinaryReader</span> reader<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      	<span class="token keyword">var</span> addr <span class="token operator">=</span> <span class="token punctuation">(</span>Address<span class="token punctuation">)</span> obj<span class="token punctuation">;</span>

        addr<span class="token punctuation">.</span>Street <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token string">&quot;street&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        addr<span class="token punctuation">.</span>Zip <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadInt</span><span class="token punctuation">(</span><span class="token string">&quot;zip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>序列化器应在配置中指定，如下：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IgniteConfiguration</span>
<span class="token punctuation">{</span>
    BinaryConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BinaryConfiguration</span>
    <span class="token punctuation">{</span>
        TypeConfigurations <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">BinaryTypeConfiguration</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span>Address<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Serializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AddressSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_11-3-iserializable"><a href="#_11-3-iserializable" aria-hidden="true" class="header-anchor">#</a> 11.3.ISerializable</h3> <p>实现<code>System.Runtime.Serialization.ISerializable</code>接口的类型将相应地进行序列化（通过调用<code>GetObjectData</code>和序列化构造函数）。所有的系统功能都支持：包括<code>IObjectReference</code>、<code>IDeserializationCallback</code>、<code>OnSerializingAttribute</code>、<code>OnSerializedAttribute</code>、<code>OnDeserializingAttribute</code>、<code>OnDeserializedAttribute</code>。</p> <p><code>GetObjectData</code>的结果以Ignite二进制格式写入，以下三个类提供相同的序列化表示形式：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">Reflective</span>
<span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">string</span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Binarizable</span> <span class="token punctuation">:</span> <span class="token class-name">IBinarizable</span>
<span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">string</span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">WriteBinary</span><span class="token punctuation">(</span><span class="token class-name">IBinaryWriter</span> writer<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		writer<span class="token punctuation">.</span><span class="token function">WriteInt</span><span class="token punctuation">(</span><span class="token string">&quot;Id&quot;</span><span class="token punctuation">,</span> Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
		writer<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ReadBinary</span><span class="token punctuation">(</span><span class="token class-name">IBinaryReader</span> reader<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		Id <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadInt</span><span class="token punctuation">(</span><span class="token string">&quot;Id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Name <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Serializable</span> <span class="token punctuation">:</span> <span class="token class-name">ISerializable</span>
<span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">string</span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">Serializable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

	<span class="token keyword">protected</span> <span class="token function">Serializable</span><span class="token punctuation">(</span><span class="token class-name">SerializationInfo</span> info<span class="token punctuation">,</span> <span class="token class-name">StreamingContext</span> context<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		Id <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">GetInt32</span><span class="token punctuation">(</span><span class="token string">&quot;Id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Name <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">GetObjectData</span><span class="token punctuation">(</span><span class="token class-name">SerializationInfo</span> info<span class="token punctuation">,</span> <span class="token class-name">StreamingContext</span> context<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		info<span class="token punctuation">.</span><span class="token function">AddValue</span><span class="token punctuation">(</span><span class="token string">&quot;Id&quot;</span><span class="token punctuation">,</span> Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
		info<span class="token punctuation">.</span><span class="token function">AddValue</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h3 id="_11-4-ignite反射式序列化"><a href="#_11-4-ignite反射式序列化" aria-hidden="true" class="header-anchor">#</a> 11.4.Ignite反射式序列化</h3> <p>Ignite反射式序列化本质上是一种<code>IBinarizable</code>方式，其是通过反射所有字段并发出读/写调用自动实现的。</p> <p>该机制没有条件，任何类或结构都可以序列化（包括所有系统类型、委托、表达式树、匿名类型等）。</p> <p>可以使用<code>NonSerialized</code>属性排除不需要的字段。</p> <p>可以通过<code>BinaryReflectiveSerializer</code>显式启用原始模式：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> binaryConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BinaryConfiguration</span>
<span class="token punctuation">{</span>
    TypeConfigurations <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">BinaryTypeConfiguration</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>MyClass<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Serializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BinaryReflectiveSerializer</span> <span class="token punctuation">{</span>RawMode <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>app.config：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>binaryConfiguration</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeConfigurations</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>binaryTypeConfiguration</span> <span class="token attr-name">typeName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Apache.Ignite.ExamplesDll.Binary.Address<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>serializer</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>Apache.Ignite.Core.Binary.BinaryReflectiveSerializer, Apache.Ignite.Core<span class="token punctuation">'</span></span> <span class="token attr-name">rawMode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>true<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>binaryTypeConfiguration</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeConfigurations</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>binaryConfiguration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>igniteConfiguration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如果没有这个配置，<code>BinaryConfiguration</code>是不需要的。</p> <p>性能与手工实现<code>IBinarizable</code>相同，反射只在启动阶段使用，用于遍历所有的字段并发出有效的IL代码。</p> <p>带有<code>Serializable</code>属性但没有<code>ISerializable</code>接口的类型使用Ignite反射式序列化器写入。</p> <h3 id="_11-5-使用entity-framework-pocos"><a href="#_11-5-使用entity-framework-pocos" aria-hidden="true" class="header-anchor">#</a> 11.5.使用Entity Framework POCOs</h3> <p>Ignite中可以直接使用Entity Framework POCOs。</p> <p>但是，Ignite无法直接序列化或反序列化POCO代理<a href="https://msdn.microsoft.com/en-us/data/jj592886.aspx" target="_self" rel="noopener noreferrer">https://msdn.microsoft.com/zh-cn/data/jj592886.aspx</a>，因为代理类型是动态类型。</p> <p>将EF对象与Ignite结合使用时，要确认禁用创建代理：</p> <p>Entity Framework 6：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>ctx<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span>ProxyCreationEnabled <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Entity Framework 5：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>ctx<span class="token punctuation">.</span>ContextOptions<span class="token punctuation">.</span>ProxyCreationEnabled <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_12-二进制模式"><a href="#_12-二进制模式" aria-hidden="true" class="header-anchor">#</a> 12.二进制模式</h2> <p>上一章节<a href="#_11-%E5%BA%8F%E5%88%97%E5%8C%96">序列化</a>讲解了Ignite.NET如何将用户定义类型（类和结构）的实例转换为序列化形式，反之亦然。</p> <p>Ignite还提供了一种直接以二进制（序列化）形式处理数据的方法，而无需在节点或整个集群中持有该类型，可能的场景是：</p> <ul><li>部分节点已加载类型并且可以处理反序列化形式的数据，但是部分节点因无法访问持有该类型的程序集，而无法处理二进制格式的数据（服务端节点）；</li> <li>类型在编译时未知，是动态构造的；</li> <li>当只需要处理大对象中的一小部分数据时，以二进制方式处理数据要比反序列化整个对象更快。</li></ul> <h3 id="_12-1-启用二进制模式"><a href="#_12-1-启用二进制模式" aria-hidden="true" class="header-anchor">#</a> 12.1.启用二进制模式</h3> <p>部分Ignite.NET API具有以下<code>WithKeepBinary()</code>方法：</p> <ul><li><code>ICache&lt;TK, TV&gt;.WithKeepBinary&lt;TK1, TV1&gt;()</code>；</li> <li><code>ICompute.WithKeepBinary()</code>；</li> <li><code>IServices.WithKeepBinary()</code>和<code>IServices.WithServerKeepBinary()</code>；</li> <li><code>IDataStreamer&lt;TK, TV&gt;.WithKeepBinary&lt;TK1, TV1&gt;</code>；</li></ul> <p>启用二进制模式后，这些方法会返回该API的新实例（当前实例不受影响），这意味着其会返回<code>IBinaryObject</code>实例，而不是用户定义的类型实例。</p> <div class="tip custom-block"><p class="custom-block-title">基本类型</p> <p>注意并非所有类型都可以表示为<code>IBinaryObject</code>，基本类型、<code>string</code>、<code>Guid</code>、<code>DateTime</code>以及这些类型的集合和数组总是返回原始对象。</p></div> <p>在下面的示例中，键类型<code>int</code>不变，因为它是基本类型：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>ICache<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> Person<span class="token operator">&gt;</span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCache</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;persons&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cache<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Joe&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

ICache<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> IBinaryObject<span class="token operator">&gt;</span> binaryCache <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">WithKeepBinary</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">IBinaryObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IBinaryObject</span> binaryPerson <span class="token operator">=</span> binaryCache<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">string</span> name <span class="token operator">=</span> binaryPerson<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetField</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>对于泛型API，要由用户提供适当的泛型类型参数。如果缓存中有多个键或值类型并且部分是基本类型，需要使用<code>.WithKeepBinary&lt;object, object&gt;</code>，然后将其安全地强制转换为<code>IBinaryObject</code>。</p> <h3 id="_12-2-修改二进制对象"><a href="#_12-2-修改二进制对象" aria-hidden="true" class="header-anchor">#</a> 12.2.修改二进制对象</h3> <p><code>IBinaryObject</code>是不可变的，调用<code>IBinaryObject.ToBuilder()</code>方法可以获得<code>IBinaryObjectBuilder</code>的一个实例，其持有所有二进制对象内容的副本，然后通过各种<code>.Set*</code>方法修改数据，并调用<code>Build()</code>方法来构造持有所有变更的<code>IBinaryObject</code>新实例：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>ICache<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> IBinaryObject<span class="token operator">&gt;</span> binaryCache <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">WithKeepBinary</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">IBinaryObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IBinaryObject</span> binaryPerson <span class="token operator">=</span> binaryCache<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">string</span> name <span class="token operator">=</span> binaryPerson<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetField</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IBinaryObjectBuilder</span> builder <span class="token operator">=</span> binaryPerson<span class="token punctuation">.</span><span class="token function">ToBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
builder<span class="token punctuation">.</span><span class="token function">SetField</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> name <span class="token operator">+</span> <span class="token string">&quot; - Copy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IBinaryObject</span> binaryPerson2 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
binaryCache<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> binaryPerson2<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_12-3-创建二进制对象"><a href="#_12-3-创建二进制对象" aria-hidden="true" class="header-anchor">#</a> 12.3.创建二进制对象</h3> <p>可以从头开始创建任意类型的二进制对象，而无需通过<code>IBinary.GetBuilder()</code>方法持有任何类/结构。具体请参见<code>BinaryModeExample.cs</code>。</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name">IIgnite</span> ignite <span class="token operator">=</span> Ignition<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IBinaryObjectBuilder</span> builder <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">GetBinary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;Book&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">IBinaryObject</span> book <span class="token operator">=</span> builder
  <span class="token punctuation">.</span><span class="token function">SetField</span><span class="token punctuation">(</span><span class="token string">&quot;ISBN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xyz&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">SetField</span><span class="token punctuation">(</span><span class="token string">&quot;Title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;War and Peace&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>还可以使用<code>IBinary.GetBuilder(Type)</code>重载来构造已知类型的实例。</p> <h3 id="_12-4-二进制类型元数据"><a href="#_12-4-二进制类型元数据" aria-hidden="true" class="header-anchor">#</a> 12.4.二进制类型元数据</h3> <p><code>IBinaryObject</code>的元数据（类型名，字段名和类型）可以通过<code>IBinaryObject.GetBinaryType()</code>方法获得，其会返回<code>IBinaryType</code>的实例。</p> <p>例如，以下代码会打印任意二进制对象的内容：</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token class-name">IBinaryObject</span> binaryObj <span class="token operator">=</span> binaryCache<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IBinaryType</span> binaryType <span class="token operator">=</span> binaryObj<span class="token punctuation">.</span><span class="token function">GetBinaryType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Object of type {0}:&quot;</span><span class="token punctuation">,</span> binaryType<span class="token punctuation">.</span>TypeName<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">string</span> field <span class="token keyword">in</span> binaryType<span class="token punctuation">.</span>Fields<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">object</span> fieldVal <span class="token operator">=</span> binaryObj<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetField</span><span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>field<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0} = {1}&quot;</span><span class="token punctuation">,</span> field<span class="token punctuation">,</span> fieldVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间：:</span> <span class="time">10/6/2019, 9:55:39 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0ce7ad92.js" defer></script><script src="/assets/js/2.df602b59.js" defer></script><script src="/assets/js/105.e2a0232d.js" defer></script>
  </body>
</html>
