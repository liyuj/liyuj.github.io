<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>7.Java开发向导 | Apache Ignite中文站</title>
    <meta name="description" content="Ignite内存计算平台的中文文档及相关资料">
    <link rel="shortcut icon" type="image/x-icon" href="https://ignite.apache.org/favicon.ico">
  <script src="https://hm.baidu.com/hm.js?03f40be28ff9a31fd798fd6b9dac0946"></script>
    
    <link rel="preload" href="/assets/css/styles.4b405027.css" as="style"><link rel="preload" href="/assets/js/app.4b405027.js" as="script"><link rel="preload" href="/assets/js/39.ffcbe0a9.js" as="script"><link rel="prefetch" href="/assets/css/1.styles.a437a9a0.css"><link rel="prefetch" href="/assets/css/2.styles.3571fef2.css"><link rel="prefetch" href="/assets/js/1.a437a9a0.js"><link rel="prefetch" href="/assets/js/10.51673fd2.js"><link rel="prefetch" href="/assets/js/11.3a48b608.js"><link rel="prefetch" href="/assets/js/12.473d5bd0.js"><link rel="prefetch" href="/assets/js/13.b9b6487a.js"><link rel="prefetch" href="/assets/js/14.8faec5cf.js"><link rel="prefetch" href="/assets/js/15.7f15fe2d.js"><link rel="prefetch" href="/assets/js/16.11486aa5.js"><link rel="prefetch" href="/assets/js/17.86e7d220.js"><link rel="prefetch" href="/assets/js/18.806726f5.js"><link rel="prefetch" href="/assets/js/19.b4f8c930.js"><link rel="prefetch" href="/assets/js/2.3571fef2.js"><link rel="prefetch" href="/assets/js/20.a94ba750.js"><link rel="prefetch" href="/assets/js/21.c61465da.js"><link rel="prefetch" href="/assets/js/22.77f24a1d.js"><link rel="prefetch" href="/assets/js/23.81792627.js"><link rel="prefetch" href="/assets/js/24.4baa7e6f.js"><link rel="prefetch" href="/assets/js/25.0a0d9134.js"><link rel="prefetch" href="/assets/js/26.c5b6435c.js"><link rel="prefetch" href="/assets/js/27.6a5df1b8.js"><link rel="prefetch" href="/assets/js/28.6ac15fcf.js"><link rel="prefetch" href="/assets/js/29.361c0df4.js"><link rel="prefetch" href="/assets/js/3.fbfa87a5.js"><link rel="prefetch" href="/assets/js/30.2adc72d2.js"><link rel="prefetch" href="/assets/js/31.f83391fc.js"><link rel="prefetch" href="/assets/js/32.51fbab4b.js"><link rel="prefetch" href="/assets/js/33.53b649eb.js"><link rel="prefetch" href="/assets/js/34.25f96fc1.js"><link rel="prefetch" href="/assets/js/35.528b6406.js"><link rel="prefetch" href="/assets/js/36.8b57b385.js"><link rel="prefetch" href="/assets/js/37.a03914f9.js"><link rel="prefetch" href="/assets/js/38.7b93d0e6.js"><link rel="prefetch" href="/assets/js/4.afe25c7e.js"><link rel="prefetch" href="/assets/js/40.9cf19e09.js"><link rel="prefetch" href="/assets/js/41.b30eb3e1.js"><link rel="prefetch" href="/assets/js/42.3d60bb79.js"><link rel="prefetch" href="/assets/js/43.e11ea75a.js"><link rel="prefetch" href="/assets/js/44.700777d7.js"><link rel="prefetch" href="/assets/js/45.f74cca0c.js"><link rel="prefetch" href="/assets/js/46.6770b19a.js"><link rel="prefetch" href="/assets/js/47.b3f0b38b.js"><link rel="prefetch" href="/assets/js/48.06303ba5.js"><link rel="prefetch" href="/assets/js/5.8cd19fb7.js"><link rel="prefetch" href="/assets/js/6.116886b7.js"><link rel="prefetch" href="/assets/js/7.3e54087f.js"><link rel="prefetch" href="/assets/js/8.9b6b770a.js"><link rel="prefetch" href="/assets/js/9.968cdfce.js">
    <link rel="stylesheet" href="/assets/css/1.styles.a437a9a0.css"><link rel="stylesheet" href="/assets/css/2.styles.3571fef2.css"><link rel="stylesheet" href="/assets/css/styles.4b405027.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Apache Ignite中文站</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link">Java</a></div><div class="nav-item"><a href="/doc/sql/" class="nav-link router-link-active">SQL</a></div><div class="nav-item"><a href="/doc/integration/" class="nav-link">集成</a></div><div class="nav-item"><a href="/doc/spark/" class="nav-link">Ignite&amp;Spark</a></div><div class="nav-item"><a href="/doc/tools/" class="nav-link">工具</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://www.gridgainchina.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GridGain中国官网
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/doc/java/" class="nav-link">Java</a></div><div class="nav-item"><a href="/doc/sql/" class="nav-link router-link-active">SQL</a></div><div class="nav-item"><a href="/doc/integration/" class="nav-link">集成</a></div><div class="nav-item"><a href="/doc/spark/" class="nav-link">Ignite&amp;Spark</a></div><div class="nav-item"><a href="/doc/tools/" class="nav-link">工具</a></div><div class="nav-item"><a href="https://my.oschina.net/liyuj" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://www.gridgainchina.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GridGain中国官网
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/doc/sql/" class="sidebar-link">1.介绍</a></li><li><a href="/doc/sql/SQLReference.html" class="sidebar-link">2.SQL参考</a></li><li><a href="/doc/sql/Architecture.html" class="sidebar-link">3.架构</a></li><li><a href="/doc/sql/JDBC.html" class="sidebar-link">4.JDBC</a></li><li><a href="/doc/sql/ODBC.html" class="sidebar-link">5.ODBC</a></li><li><a href="/doc/sql/ToolsAndAnalytics.html" class="sidebar-link">6.工具和分析</a></li><li><a href="/doc/sql/JavaDeveloperGuide.html" class="active sidebar-link">7.Java开发向导</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/sql/JavaDeveloperGuide.html#_7-1-sql-api" class="sidebar-link">7.1.SQL API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/sql/JavaDeveloperGuide.html#_7-1-1-sqlquery" class="sidebar-link">7.1.1.SqlQuery</a></li><li class="sidebar-sub-header"><a href="/doc/sql/JavaDeveloperGuide.html#_7-1-2-sqlfieldsqueries" class="sidebar-link">7.1.2.SqlFieldsQueries</a></li><li class="sidebar-sub-header"><a href="/doc/sql/JavaDeveloperGuide.html#_7-1-3-示例" class="sidebar-link">7.1.3.示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/sql/JavaDeveloperGuide.html#_7-2-模式和索引" class="sidebar-link">7.2.模式和索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/sql/JavaDeveloperGuide.html#_7-2-1-摘要" class="sidebar-link">7.2.1.摘要</a></li><li class="sidebar-sub-header"><a href="/doc/sql/JavaDeveloperGuide.html#_7-2-2-基于注解的配置" class="sidebar-link">7.2.2.基于注解的配置</a></li><li class="sidebar-sub-header"><a href="/doc/sql/JavaDeveloperGuide.html#_7-2-3-基于queryentity的配置" class="sidebar-link">7.2.3.基于QueryEntity的配置</a></li><li class="sidebar-sub-header"><a href="/doc/sql/JavaDeveloperGuide.html#_7-2-4-自定义键" class="sidebar-link">7.2.4.自定义键</a></li><li class="sidebar-sub-header"><a href="/doc/sql/JavaDeveloperGuide.html#_7-2-5-空间查询" class="sidebar-link">7.2.5.空间查询</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc/sql/JavaDeveloperGuide.html#_7-3-自定义sql函数" class="sidebar-link">7.3.自定义SQL函数</a></li><li class="sidebar-sub-header"><a href="/doc/sql/JavaDeveloperGuide.html#_7-4-查询取消" class="sidebar-link">7.4.查询取消</a></li></ul></li><li><a href="/doc/sql/PHPDeveloperGuide.html" class="sidebar-link">8.PHP开发向导</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="_7-java开发向导"><a href="#_7-java开发向导" aria-hidden="true" class="header-anchor">#</a> 7.Java开发向导</h1> <h2 id="_7-1-sql-api"><a href="#_7-1-sql-api" aria-hidden="true" class="header-anchor">#</a> 7.1.SQL API</h2> <p>除了JDBC驱动，Java开发者可以使用特定的SQL API来查询和修改存储于数据库中的数据。</p> <h3 id="_7-1-1-sqlquery"><a href="#_7-1-1-sqlquery" aria-hidden="true" class="header-anchor">#</a> 7.1.1.SqlQuery</h3> <p><code>SqlQuery</code>适用于查询执行完毕后需要获得返回的结果集中整个对象的场景，下面的代码片段显示了在实践中如何实现：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;personCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

SqlQuery sql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlQuery</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;salary &gt; ?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Find all persons earning more than 1,000.</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span>QueryCursor<span class="token operator">&lt;</span>Entry<span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> cursor <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>Entry<span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> e <span class="token operator">:</span> cursor<span class="token punctuation">)</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_7-1-2-sqlfieldsqueries"><a href="#_7-1-2-sqlfieldsqueries" aria-hidden="true" class="header-anchor">#</a> 7.1.2.SqlFieldsQueries</h3> <p>不需要查询整个对象，只需要指定几个特定的字段即可，这样可以最小化网络和序列化的开销。为此，Ignite实现了一个<code>字段查询</code>的概念。<code>SqlFieldsQuery</code>接受一个标准SQL查询作为它的构造器参数，然后像下面的示例那样立即执行：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;personCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Execute query to get names of all employees.</span>
SqlFieldsQuery sql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span>
  <span class="token string">&quot;select concat(firstName, ' ', lastName) from Person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Iterate over the result set.</span>
<span class="token keyword">try</span> <span class="token punctuation">(</span>QueryCursor<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> cursor <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>List<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> row <span class="token operator">:</span> cursor<span class="token punctuation">)</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;personName=&quot;</span> <span class="token operator">+</span> row<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p><strong>可查询字段定义</strong>
在<code>SqlQuery</code>和<code>SqlFieldsQuery</code>中的指定字段可以被访问之前，他们需要为SQL模式的一部分，使用标准的DDL命令，或者特定的Java注解，或者<code>QueryEntity</code>配置，都可以进行字段的定义。</p></blockquote> <p>通过<code>SqlFieldsQuery</code>，还可以使用DML命令进行数据的修改：
<strong>INSERT</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;personCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span>
    <span class="token string">&quot;INSERT INTO Person(id, firstName, lastName) VALUES(?, ?, ?)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">1</span>L<span class="token punctuation">,</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Smith&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>UPDATE</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;personCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;UPDATE Person set lastName = ? &quot;</span> <span class="token operator">+</span>
         <span class="token string">&quot;WHERE id &gt;= ?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token string">&quot;Jones&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>DELETE</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;personCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE FROM Person &quot;</span> <span class="token operator">+</span>
         <span class="token string">&quot;WHERE id &gt;= ?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token number">2</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>MERGE</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>IgniteCache<span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> ignite<span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token string">&quot;personCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;MERGE INTO Person(id, firstName, lastName)&quot;</span> <span class="token operator">+</span>
           <span class="token string">&quot; values (1, 'John', 'Smith'), (5, 'Mary', 'Jones')&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_7-1-3-示例"><a href="#_7-1-3-示例" aria-hidden="true" class="header-anchor">#</a> 7.1.3.示例</h3> <p>Ignite的发布版包括了一个可运行的<code>SqlDmlExample.java</code>，它是源代码的一部分，演示了上述提到的所有DML操作的使用。</p> <h2 id="_7-2-模式和索引"><a href="#_7-2-模式和索引" aria-hidden="true" class="header-anchor">#</a> 7.2.模式和索引</h2> <h3 id="_7-2-1-摘要"><a href="#_7-2-1-摘要" aria-hidden="true" class="header-anchor">#</a> 7.2.1.摘要</h3> <p>不管是通过注解或者通过QueryEntity的方式，表和索引建立之后，它们所属的模式名为<code>CacheConfiguration</code>对象中配置的缓存名，要修改的话，需要使用<code>CacheConfiguration.setSqlSchema</code>方法。
但是，如果表和索引是通过DDL语句的形式定义的，那么模式名就会完全不同，这时，表和索引所属的模式名默认为<code>PUBLIC</code>。
这时，不管使用上述的哪种方式配置的表，那么一定要确保查询时要指定正确的模式名。比如，假定80%的表都是通过DDL配置的，那么通过<code>SqlQuery.setSchema(&quot;PUBLIC&quot;)</code>方法将查询的默认模式配置成<code>PUBLIC</code>就会很有意义：
Java：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>IgniteCache cache = ignite.getOrCreateCache(
    new CacheConfiguration&lt;&gt;()
        .setName(&quot;Person&quot;)
        .setIndexedTypes(Long.class, Person.class));

// Creating City table.
cache.query(new SqlFieldsQuery(&quot;CREATE TABLE City &quot; +
    &quot;(id int primary key, name varchar, region varchar)&quot;).setSchema(&quot;PUBLIC&quot;)).getAll();

// Creating Organization table.
cache.query(new SqlFieldsQuery(&quot;CREATE TABLE Organization &quot; +
    &quot;(id int primary key, name varchar, cityName varchar)&quot;).setSchema(&quot;PUBLIC&quot;)).getAll();

// Joining data between City, Organizaion and Person tables. The latter
// was created with either annotations or QueryEntity approach.
SqlFieldsQuery qry = new SqlFieldsQuery(&quot;SELECT o.name from Organization o &quot; +
    &quot;inner join \&quot;Person\&quot;.Person p on o.id = p.orgId &quot; +
    &quot;inner join City c on c.name = o.cityName &quot; +
    &quot;where p.age &gt; 25 and c.region &lt;&gt; 'Texas'&quot;);

// Setting the query's default schema to PUBLIC.
// Table names from the query without the schema set will be
// resolved against PUBLIC schema.
// Person table belongs to &quot;Person&quot; schema (person cache) and this is why
// that schema name is set explicitly.
qry.setSchema(&quot;PUBLIC&quot;);

// Executing the query.
cache.query(qry).getAll();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_7-2-2-基于注解的配置"><a href="#_7-2-2-基于注解的配置" aria-hidden="true" class="header-anchor">#</a> 7.2.2.基于注解的配置</h3> <p>索引，和可查询的字段一样，是可以通过编程的方式用<code>@QuerySqlField</code>进行配置的。如下所示，期望的字段已经加注了该注解。
Java：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Indexed field. Will be visible for SQL engine. */</span>
  <span class="token annotation punctuation">@QuerySqlField</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token keyword">long</span> id<span class="token punctuation">;</span>
  
  <span class="token comment">/** Queryable field. Will be visible for SQL engine. */</span>
  <span class="token annotation punctuation">@QuerySqlField</span>
  <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
  
  <span class="token comment">/** Will NOT be visible for SQL engine. */</span>
  <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
  
  <span class="token comment">/**
   * Indexed field sorted in descending order. 
   * Will be visible for SQL engine.
   */</span>
  <span class="token annotation punctuation">@QuerySqlField</span><span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> descending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token keyword">float</span> salary<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Scala：</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">case</span> <span class="token keyword">class</span> Person <span class="token punctuation">(</span>
  <span class="token comment">/** Indexed field. Will be visible for SQL engine. */</span>
  @<span class="token punctuation">(</span>QuerySqlField <span class="token annotation punctuation">@field</span><span class="token punctuation">)</span><span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> id<span class="token operator">:</span> <span class="token builtin">Long</span><span class="token punctuation">,</span>

  <span class="token comment">/** Queryable field. Will be visible for SQL engine. */</span>
  @<span class="token punctuation">(</span>QuerySqlField <span class="token annotation punctuation">@field</span><span class="token punctuation">)</span> name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span>
  
  <span class="token comment">/** Will NOT be visisble for SQL engine. */</span>
  age<span class="token operator">:</span> <span class="token builtin">Int</span>
  
  <span class="token comment">/**
   * Indexed field sorted in descending order. 
   * Will be visible for SQL engine.
   */</span>
  @<span class="token punctuation">(</span>QuerySqlField <span class="token annotation punctuation">@field</span><span class="token punctuation">)</span><span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> descending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> salary<span class="token operator">:</span> <span class="token builtin">Float</span>
<span class="token punctuation">)</span> <span class="token keyword">extends</span> Serializable <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>在SQL查询中，类型名会被用作表名，这时，表名为<code>Person</code>（模式名的定义和使用前面已经描述）。
<code>id</code>和<code>salary</code>都是索引列，<code>id</code>字段升序排列（默认），而<code>salary</code>降序排列。
如果不希望索引一个字段，但是仍然想在SQL查询中使用它，那么在加注解时可以忽略<code>index = true</code>参数，这样的字段称为可查询字段，举例来说，上面的<code>name</code>就被定义为可查询字段。
最后，<code>age</code>既不是可查询字段也不是索引字段，在Ignite中，从SQL查询的角度看就是不可见的。
下面，就可以向下面这样执行SQL查询了：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>SqlFieldsQuery qry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT id, name FROM Person&quot;</span> <span class="token operator">+</span>
		<span class="token string">&quot;WHERE id &gt; 1500 LIMIT 10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p><strong>运行时更新索引和可查询字段</strong>
如果需要在运行时管理索引或者使新的字段对SQL引擎可见，可以使用ALTER TABLE, CREATE/DROP INDEX命令。
<strong>索引嵌套对象</strong>
使用注解，嵌套对象的字段也可以被索引以及查询，比如，假设<code>Person</code>对象有一个<code>Address</code>对象属性：</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Indexed field. Will be visible for SQL engine. */</span>
  <span class="token annotation punctuation">@QuerySqlField</span><span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token keyword">long</span> id<span class="token punctuation">;</span>

  <span class="token comment">/** Queryable field. Will be visible for SQL engine. */</span>
  <span class="token annotation punctuation">@QuerySqlField</span>
  <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
  
  <span class="token comment">/** Will NOT be visible for SQL engine. */</span>
  <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
  
  <span class="token comment">/** Indexed field. Will be visible for SQL engine. */</span>
  <span class="token annotation punctuation">@QuerySqlField</span><span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> Address address<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>Address</code>类的结构如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Indexed field. Will be visible for SQL engine. */</span>
  <span class="token annotation punctuation">@QuerySqlField</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> String street<span class="token punctuation">;</span>

  <span class="token comment">/** Indexed field. Will be visible for SQL engine. */</span>
  <span class="token annotation punctuation">@QuerySqlField</span><span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token keyword">int</span> zip<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>上例中，<code>@QuerySqlField(index = true)</code>注解加在了<code>Address</code>类的所有属性上，就像<code>Person</code>类的<code>Address</code>对象一样。
这样就可以执行下面这样的查询：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>QueryCursor<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> cursor <span class="token operator">=</span> personCache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span>
  <span class="token string">&quot;select * from Person where street = 'street1'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注意在查询的where子句中不需要指定<strong>address.street</strong>，这是因为<code>Address</code>类的字段会被合并到<code>Person</code>表中，这样会简化对<code>Address</code>中的字段的访问。</p> <blockquote><p><strong>Scala注解</strong>
在Scala类中，<code>@QuerySqlField</code>注解必须和<code>@Field</code>注解一起使用，这样的话这个字段对于Ignite才是可见的，就像这样的:<code>@(QuerySqlField @field)</code>。
也可以使用<code>ignite-scalar</code>模块的<code>@ScalarCacheQuerySqlField</code>注解作为替代，他不过是<code>@Field</code>注解的别名。</p></blockquote> <p><strong>注册索引类型</strong>
定义了索引字段和可查询字段之后，就需要和他们所属的对象类型一起，在SQL引擎中注册。
要告诉Ignite哪些类型应该被索引，需要通过<code>CacheConfiguration.setIndexedTypes</code>方法传入键-值对，如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Preparing configuration.</span>
CacheConfiguration<span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">,</span> Person<span class="token punctuation">&gt;</span></span> ccfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Registering indexed type.</span>
ccfg<span class="token punctuation">.</span><span class="token function">setIndexedTypes</span><span class="token punctuation">(</span>Long<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> Person<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>注意，这个方法只接收成对的类型，一个键类一个值类，基本类型需要使用包装器类。</p> <blockquote><p><strong>预定义字段</strong>
除了用<code>@QuerySqlField</code>注解标注的所有字段，每个表都有两个特别的预定义字段：<code>_key</code>和<code>_val</code>，它表示到整个键对象和值对象的链接。这很有用，比如当他们中的一个是基本类型并且希望用它的值进行过滤时。要做到这一点，执行一个<code>SELECT * FROM Person WHERE _key = 100</code>查询即可。</p></blockquote> <blockquote><p>多亏了二进制编组器，不需要将索引类型类加入集群节点的类路径中，SQL查询引擎不需要对象反序列化就可以钻取索引和可查询字段的值。</p></blockquote> <p><strong>分组索引</strong>
当查询条件复杂时可以使用多字段索引来加快查询的速度，这时可以用<code>@QuerySqlField.Group</code>注解。如果希望一个字段参与多个分组索引时也可以将多个<code>@QuerySqlField.Group</code>注解加入<code>orderedGroups</code>中。
比如，下面的<code>Person</code>类中<code>age</code>字段加入了名为<code>age_salary_idx</code>的分组索引，他的分组序号是0并且降序排列，同一个分组索引中还有一个字段<code>salary</code>,他的分组序号是3并且升序排列。最重要的是<code>salary</code>字段还是一个单列索引(除了<code>orderedGroups</code>声明之外，还加上了<code>index = true</code>)。分组中的<code>order</code>不需要是什么特别的数值，他只是用于分组内的字段排序。
<strong>Java：</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Indexed in a group index with &quot;salary&quot;. */</span>
  <span class="token annotation punctuation">@QuerySqlField</span><span class="token punctuation">(</span>orderedGroups<span class="token operator">=</span><span class="token punctuation">{</span><span class="token annotation punctuation">@QuerySqlField</span><span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span>
    name <span class="token operator">=</span> <span class="token string">&quot;age_salary_idx&quot;</span><span class="token punctuation">,</span> order <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> descending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>

  <span class="token comment">/** Indexed separately and in a group index with &quot;age&quot;. */</span>
  <span class="token annotation punctuation">@QuerySqlField</span><span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> orderedGroups<span class="token operator">=</span><span class="token punctuation">{</span><span class="token annotation punctuation">@QuerySqlField</span><span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span>
    name <span class="token operator">=</span> <span class="token string">&quot;age_salary_idx&quot;</span><span class="token punctuation">,</span> order <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token keyword">double</span> salary<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p>注意，将<code>@QuerySqlField.Group</code>放在<code>@QuerySqlField(orderedGroups={...})</code>外面是无效的。</p></blockquote> <h3 id="_7-2-3-基于queryentity的配置"><a href="#_7-2-3-基于queryentity的配置" aria-hidden="true" class="header-anchor">#</a> 7.2.3.基于QueryEntity的配置</h3> <p>索引和字段也可以通过<code>org.apache.ignite.cache.QueryEntity</code>进行配置，它便于利用Spring进行基于XML的配置。
在上面基于注解的配置中涉及的所有概念，对于基于<code>QueryEntity</code>的方式也都有效，此外，如果类型的字段通过<code>@QuerySqlField</code>进行了配置并且通过<code>CacheConfiguration.setIndexedTypes</code>注册过的，在内部也会被转换为查询实体。
下面的示例显示的是如何像可查询字段那样定义一个单一字段索引和分组索引。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.CacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mycache<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- Configure query entities --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>queryEntities<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.cache.QueryEntity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- Setting indexed type's key class --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>keyType<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.Long<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
              
                <span class="token comment">&lt;!-- Setting indexed type's value class --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>valueType<span class="token punctuation">&quot;</span></span>
                          <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.examples.Person<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

                <span class="token comment">&lt;!-- Defining fields that will be either indexed or queryable.
                Indexed fields are added to 'indexes' list below.--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fields<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.Long<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>salary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.Long <span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

                <span class="token comment">&lt;!-- Defining indexed fields.--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>indexes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
                        <span class="token comment">&lt;!-- Single field (aka. column) index --&gt;</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.cache.QueryIndex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
                      
                        <span class="token comment">&lt;!-- Group index. --&gt;</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.cache.QueryIndex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>salary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor-arg</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SORTED<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>SQL查询中会使用<code>valueType</code>的简称作为表名，这时，表名为<code>Person</code>。
QueryEntity定义之后，就可以执行下面的查询了：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>SqlFieldsQuery qry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT id, name FROM Person&quot;</span> <span class="token operator">+</span>
		<span class="token string">&quot;WHERE id &gt; 1500 LIMIT 10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_7-2-4-自定义键"><a href="#_7-2-4-自定义键" aria-hidden="true" class="header-anchor">#</a> 7.2.4.自定义键</h3> <p>如果只使用预定义的SQL数据类型作为缓存键，那么就没必要对和DML相关的配置做额外的操作，这些数据类型在<code>GridQueryProcessor#SQL_TYPES</code>常量中进行定义，列举如下：</p> <blockquote><p><strong>预定义SQL数据类型</strong>
1.所有的基本类型及其包装器，除了<code>char</code>和<code>Character</code>；
2.<code>String</code>;
3.<code>BigDecimal</code>;
4.<code>byte[]</code>;
5.<code>java.util.Date</code>, <code>java.sql.Date</code>, <code>java.sql.Timestamp</code>;
6.<code>java.util.UUID</code>。</p></blockquote> <p>然而，如果决定引入复杂的自定义缓存键，那么在DML语句中要指向这些字段就需要：</p> <ul><li>在<code>QueryEntity</code>中定义这些字段，与在值对象中配置字段一样；</li> <li>使用新的配置参数<code>QueryEntitty.setKeyFields(..)</code>来对键和值进行区分；</li></ul> <p>下面的例子展示了如何实现：
<strong>Java:</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Preparing cache configuration.</span>
CacheConfiguration cacheCfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;personCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Creating the query entity. </span>
QueryEntity entity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryEntity</span><span class="token punctuation">(</span><span class="token string">&quot;CustomKey&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Listing all the queryable fields.</span>
LinkedHashMap<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> flds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

flds<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;intKeyField&quot;</span><span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
flds<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;strKeyField&quot;</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

flds<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;firstName&quot;</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
flds<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;lastName&quot;</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

entity<span class="token punctuation">.</span><span class="token function">setFields</span><span class="token punctuation">(</span>flds<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Listing a subset of the fields that belong to the key.</span>
Set<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> keyFlds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

keyFlds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;intKeyField&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
keyFlds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;strKeyField&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

entity<span class="token punctuation">.</span><span class="token function">setKeyFields</span><span class="token punctuation">(</span>keyFlds<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// End of new settings, nothing else here is DML related</span>

entity<span class="token punctuation">.</span><span class="token function">setIndexes</span><span class="token punctuation">(</span>Collections<span class="token punctuation">.</span><span class="token generics function"><span class="token punctuation">&lt;</span>QueryIndex<span class="token punctuation">&gt;</span></span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

cacheCfg<span class="token punctuation">.</span><span class="token function">setQueryEntities</span><span class="token punctuation">(</span>Collections<span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ignite<span class="token punctuation">.</span><span class="token function">createCache</span><span class="token punctuation">(</span>cacheCfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p><strong>XML:</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.CacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>personCache<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- Configure query entities --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>queryEntities<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.cache.QueryEntity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- Registering key's class. --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>keyType<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>CustomKey<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
              
                <span class="token comment">&lt;!-- Registering value's class. --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>valueType<span class="token punctuation">&quot;</span></span>
                          <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.examples.Person<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

                <span class="token comment">&lt;!-- 
                    Defining all the fields that will be accessible from DML.
                --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fields<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>firstName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>lastName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                      	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>intKeyField<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.Integer<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                      	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>strKeyField<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.String<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
              
                <span class="token comment">&lt;!-- Defining the subset of key's fields --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>keyFields<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">&gt;</span></span>
                      	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>intKeyField<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">/&gt;</span></span>
                      	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>strKeyField<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><blockquote><p><strong>哈希值自动计算和equals实现</strong>
如果自定义键可以被序列化为二进制形式，那么Ignite会自动进行哈希值的计算并且实现<code>equals</code>方法。
但是，如果是<code>Externalizable</code>类型，那么就无法序列化为二进制形式，那么就需要自行实现<code>hashCode</code>和<code>equals</code>方法。</p></blockquote> <h3 id="_7-2-5-空间查询"><a href="#_7-2-5-空间查询" aria-hidden="true" class="header-anchor">#</a> 7.2.5.空间查询</h3> <p>这个空间模块只对<code>com.vividsolutions.jts</code>类型的对象有用。
要配置索引以及/或者几何类型的可查询字段，可以使用和已有的非几何类型同样的方法，首先，可以使用<code>org.apache.ignite.cache.QueryEntity</code>定义索引，他对于基于Spring的XML配置文件非常方便，第二，通过<code>@QuerySqlField</code>注解来声明索引也可以达到同样的效果，他在内部会转化为<code>QueryEntities</code>。
<strong>QuerySqlField：</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * Map point with indexed coordinates.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MapPoint</span> <span class="token punctuation">{</span>
    <span class="token comment">/** Coordinates. */</span>
    <span class="token annotation punctuation">@QuerySqlField</span><span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> Geometry coords<span class="token punctuation">;</span>

    <span class="token comment">/**
     * @param coords Coordinates.
     */</span>
    <span class="token keyword">private</span> <span class="token function">MapPoint</span><span class="token punctuation">(</span>Geometry coords<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>coords <span class="token operator">=</span> coords<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>QueryEntity:</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.configuration.CacheConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mycache<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- Configure query entities --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>queryEntities<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.cache.QueryEntity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>keyType<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>java.lang.Integer<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>valueType<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.examples.MapPoint<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fields<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>coords<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.vividsolutions.jts.geom.Geometry<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>indexes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.apache.ignite.cache.QueryIndex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>coords<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>使用上述方法定义了几何类型字段之后，就可以使用存储于这些字段中值进行查询了。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Query to find points that fit into a polygon.</span>
SqlQuery<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> MapPoint<span class="token punctuation">&gt;</span></span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlQuery</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>MapPoint<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;coords &amp;&amp; ?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Defining the polygon's boundaries.</span>
query<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span><span class="token string">&quot;POLYGON((0 0, 0 99, 400 500, 300 0, 0 0))&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Executing the query.</span>
Collection<span class="token operator">&lt;</span>Cache<span class="token punctuation">.</span>Entry<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> MapPoint<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> entries <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Printing number of points that fit into the area defined by the polygon.</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Fetched points [&quot;</span> <span class="token operator">+</span> entries<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><blockquote><p><strong>完整示例</strong>
Ignite中用于演示空间查询的可以立即执行的完整示例，可以在<a href="https://github.com/dmagda/geospatial" target="_self" rel="noopener noreferrer">这里</a>找到。</p></blockquote> <h2 id="_7-3-自定义sql函数"><a href="#_7-3-自定义sql函数" aria-hidden="true" class="header-anchor">#</a> 7.3.自定义SQL函数</h2> <p>Ignite的SQL引擎支持通过额外用Java编写的自定义SQL函数，来扩展ANSI-99规范定义的SQL函数集。
一个自定义SQL函数仅仅是一个加注了<code>@QuerySqlFunction</code>注解的公共静态方法。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Defining a custom SQL function.</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFunctions</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@QuerySqlFunction</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">sqr</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>持有自定义SQL函数的类需要使用<code>setSqlFunctionClasses(...)</code>方法在特定的<code>CacheConfiguration</code>中注册。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Preparing a cache configuration.</span>
CacheConfiguration cfg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Registering the class that contains custom SQL functions.</span>
cfg<span class="token punctuation">.</span><span class="token function">setSqlFunctionClasses</span><span class="token punctuation">(</span>MyFunctions<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>经过了上述配置的缓存部署之后，在SQL查询中就可以随意地调用自定义函数了，如下所示：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Preparing the query that uses customly defined 'sqr' function.</span>
SqlFieldsQuery query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlFieldsQuery</span><span class="token punctuation">(</span>
  <span class="token string">&quot;SELECT name FROM Blocks WHERE sqr(size) &gt; 100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Executing the query.</span>
cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>在自定义SQL函数可能要执行的所有节点上，通过<code>CacheConfiguration.setSqlFunctionClasses(...)</code>注册的类都需要添加到类路径中，否则在自定义函数执行时会抛出<code>ClassNotFoundException</code>异常。</p></blockquote> <h2 id="_7-4-查询取消"><a href="#_7-4-查询取消" aria-hidden="true" class="header-anchor">#</a> 7.4.查询取消</h2> <p>Ignite中有两种方式停止长时间运行的SQL查询，SQL查询时间长的原因，比如使用了未经优化的索引等。
第一个方法是为特定的<code>SqlQuery</code>和<code>SqlFieldsQuery</code>设置查询执行的超时时间。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>SqlQuery qry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlQuery</span><span class="token operator">&lt;</span>AffinityKey<span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> Person<span class="token operator">&gt;</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> joinSql<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Setting query execution timeout</span>
qry<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token number">10</span>_000<span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>第二个方法是使用<code>QueryCursor.close()</code>来终止查询。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>SqlQuery qry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlQuery</span><span class="token operator">&lt;</span>AffinityKey<span class="token generics function"><span class="token punctuation">&lt;</span>Long<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> Person<span class="token operator">&gt;</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> joinSql<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Getting query cursor.</span>
QueryCursor<span class="token generics function"><span class="token punctuation">&lt;</span>List<span class="token punctuation">&gt;</span></span> cursor <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>qry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
<span class="token comment">// Executing query.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        
<span class="token comment">// Halting the query that might be still in progress.</span>
cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间：: </span> <span class="time">9/20/2018, 10:45:26 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/doc/sql/ToolsAndAnalytics.html" class="prev">
          6.工具和分析
        </a></span> <span class="next"><a href="/doc/sql/PHPDeveloperGuide.html">
          8.PHP开发向导
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/39.ffcbe0a9.js" defer></script><script src="/assets/js/app.4b405027.js" defer></script>
  </body>
</html>
