(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{105:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"_7-java开发向导"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-java开发向导","aria-hidden":"true"}},[s._v("#")]),s._v(" 7.Java开发向导")]),s._v(" "),a("h2",{attrs:{id:"_7-1-sql-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-sql-api","aria-hidden":"true"}},[s._v("#")]),s._v(" 7.1.SQL API")]),s._v(" "),a("p",[s._v("除了JDBC驱动，Java开发者可以使用特定的SQL API来查询和修改存储于数据库中的数据。")]),s._v(" "),a("h3",{attrs:{id:"_7-1-1-sqlquery"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-1-sqlquery","aria-hidden":"true"}},[s._v("#")]),s._v(" 7.1.1.SqlQuery")]),s._v(" "),a("p",[a("code",[s._v("SqlQuery")]),s._v("适用于查询执行完毕后需要获得返回的结果集中整个对象的场景，下面的代码片段显示了在实践中如何实现：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("IgniteCache"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Long"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Person"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" cache "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" ignite"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("cache")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"personCache"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nSqlQuery sql "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("SqlQuery")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Person"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"salary > ?"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Find all persons earning more than 1,000.")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("QueryCursor"),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("Entry"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Long"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Person"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" cursor "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" cache"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sql"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("setArgs")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("1000")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Entry"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Long"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Person"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" e "),a("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" cursor"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    System"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("println")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("getValue")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("toString")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"_7-1-2-sqlfieldsqueries"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-2-sqlfieldsqueries","aria-hidden":"true"}},[s._v("#")]),s._v(" 7.1.2.SqlFieldsQueries")]),s._v(" "),a("p",[s._v("不需要查询整个对象，只需要指定几个特定的字段即可，这样可以最小化网络和序列化的开销。为此，Ignite实现了一个"),a("code",[s._v("字段查询")]),s._v("的概念。"),a("code",[s._v("SqlFieldsQuery")]),s._v("接受一个标准SQL查询作为它的构造器参数，然后像下面的示例那样立即执行：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("IgniteCache"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Long"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Person"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" cache "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" ignite"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("cache")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"personCache"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Execute query to get names of all employees.")]),s._v("\nSqlFieldsQuery sql "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("SqlFieldsQuery")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),a("span",{attrs:{class:"token string"}},[s._v("\"select concat(firstName, ' ', lastName) from Person\"")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Iterate over the result set.")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("QueryCursor"),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("List"),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("?")]),a("span",{attrs:{class:"token operator"}},[s._v(">>")]),s._v(" cursor "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" cache"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sql"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("List"),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("?")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" row "),a("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" cursor"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    System"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("println")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"personName="')]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" row"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("get")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("可查询字段定义")]),s._v("\n在"),a("code",[s._v("SqlQuery")]),s._v("和"),a("code",[s._v("SqlFieldsQuery")]),s._v("中的指定字段可以被访问之前，他们需要为SQL模式的一部分，使用标准的DDL命令，或者特定的Java注解，或者"),a("code",[s._v("QueryEntity")]),s._v("配置，都可以进行字段的定义。")])]),s._v(" "),a("p",[s._v("通过"),a("code",[s._v("SqlFieldsQuery")]),s._v("，还可以使用DML命令进行数据的修改：\n"),a("strong",[s._v("INSERT")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("IgniteCache"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Long"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Person"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" cache "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" ignite"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("cache")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"personCache"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\ncache"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("SqlFieldsQuery")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{attrs:{class:"token string"}},[s._v('"INSERT INTO Person(id, firstName, lastName) VALUES(?, ?, ?)"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("setArgs")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v("L"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"John"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"Smith"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("UPDATE")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("IgniteCache"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Long"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Person"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" cache "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" ignite"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("cache")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"personCache"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\ncache"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("SqlFieldsQuery")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"UPDATE Person set lastName = ? "')]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v("\n         "),a("span",{attrs:{class:"token string"}},[s._v('"WHERE id >= ?"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("setArgs")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"Jones"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("2")]),s._v("L"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("DELETE")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("IgniteCache"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Long"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Person"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" cache "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" ignite"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("cache")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"personCache"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\ncache"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("SqlFieldsQuery")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"DELETE FROM Person "')]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v("\n         "),a("span",{attrs:{class:"token string"}},[s._v('"WHERE id >= ?"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("setArgs")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("2")]),s._v("L"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("MERGE")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("IgniteCache"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Long"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Person"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" cache "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" ignite"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("cache")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"personCache"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\ncache"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("SqlFieldsQuery")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"MERGE INTO Person(id, firstName, lastName)"')]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v("\n           "),a("span",{attrs:{class:"token string"}},[s._v("\" values (1, 'John', 'Smith'), (5, 'Mary', 'Jones')\"")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_7-1-3-示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-3-示例","aria-hidden":"true"}},[s._v("#")]),s._v(" 7.1.3.示例")]),s._v(" "),a("p",[s._v("Ignite的发布版包括了一个可运行的"),a("code",[s._v("SqlDmlExample.java")]),s._v("，它是源代码的一部分，演示了上述提到的所有DML操作的使用。")]),s._v(" "),a("h2",{attrs:{id:"_7-2-模式和索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-模式和索引","aria-hidden":"true"}},[s._v("#")]),s._v(" 7.2.模式和索引")]),s._v(" "),a("h3",{attrs:{id:"_7-2-1-摘要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-1-摘要","aria-hidden":"true"}},[s._v("#")]),s._v(" 7.2.1.摘要")]),s._v(" "),a("p",[s._v("不管是通过注解或者通过QueryEntity的方式，表和索引建立之后，它们所属的模式名为"),a("code",[s._v("CacheConfiguration")]),s._v("对象中配置的缓存名，要修改的话，需要使用"),a("code",[s._v("CacheConfiguration.setSqlSchema")]),s._v("方法。\n但是，如果表和索引是通过DDL语句的形式定义的，那么模式名就会完全不同，这时，表和索引所属的模式名默认为"),a("code",[s._v("PUBLIC")]),s._v("。\n这时，不管使用上述的哪种方式配置的表，那么一定要确保查询时要指定正确的模式名。比如，假定80%的表都是通过DDL配置的，那么通过"),a("code",[s._v('SqlQuery.setSchema("PUBLIC")')]),s._v("方法将查询的默认模式配置成"),a("code",[s._v("PUBLIC")]),s._v("就会很有意义：\nJava：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('IgniteCache cache = ignite.getOrCreateCache(\n    new CacheConfiguration<>()\n        .setName("Person")\n        .setIndexedTypes(Long.class, Person.class));\n\n// Creating City table.\ncache.query(new SqlFieldsQuery("CREATE TABLE City " +\n    "(id int primary key, name varchar, region varchar)").setSchema("PUBLIC")).getAll();\n\n// Creating Organization table.\ncache.query(new SqlFieldsQuery("CREATE TABLE Organization " +\n    "(id int primary key, name varchar, cityName varchar)").setSchema("PUBLIC")).getAll();\n\n// Joining data between City, Organizaion and Person tables. The latter\n// was created with either annotations or QueryEntity approach.\nSqlFieldsQuery qry = new SqlFieldsQuery("SELECT o.name from Organization o " +\n    "inner join \\"Person\\".Person p on o.id = p.orgId " +\n    "inner join City c on c.name = o.cityName " +\n    "where p.age > 25 and c.region <> \'Texas\'");\n\n// Setting the query\'s default schema to PUBLIC.\n// Table names from the query without the schema set will be\n// resolved against PUBLIC schema.\n// Person table belongs to "Person" schema (person cache) and this is why\n// that schema name is set explicitly.\nqry.setSchema("PUBLIC");\n\n// Executing the query.\ncache.query(qry).getAll();\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("h3",{attrs:{id:"_7-2-2-基于注解的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-2-基于注解的配置","aria-hidden":"true"}},[s._v("#")]),s._v(" 7.2.2.基于注解的配置")]),s._v(" "),a("p",[s._v("索引，和可查询的字段一样，是可以通过编程的方式用"),a("code",[s._v("@QuerySqlField")]),s._v("进行配置的。如下所示，期望的字段已经加注了该注解。\nJava：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("Person")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("Serializable")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("/** Indexed field. Will be visible for SQL engine. */")]),s._v("\n  "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@QuerySqlField")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("true")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("long")]),s._v(" id"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),a("span",{attrs:{class:"token comment"}},[s._v("/** Queryable field. Will be visible for SQL engine. */")]),s._v("\n  "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@QuerySqlField")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" String name"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),a("span",{attrs:{class:"token comment"}},[s._v("/** Will NOT be visible for SQL engine. */")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" age"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),a("span",{attrs:{class:"token comment"}},[s._v("/**\n   * Indexed field sorted in descending order. \n   * Will be visible for SQL engine.\n   */")]),s._v("\n  "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@QuerySqlField")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("true")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" descending "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("true")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("float")]),s._v(" salary"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("Scala：")]),s._v(" "),a("div",{staticClass:"language-scala line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-scala"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" Person "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("/** Indexed field. Will be visible for SQL engine. */")]),s._v("\n  @"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("QuerySqlField "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@field")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("true")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" id"),a("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token builtin"}},[s._v("Long")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[s._v("/** Queryable field. Will be visible for SQL engine. */")]),s._v("\n  @"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("QuerySqlField "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@field")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" name"),a("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token builtin"}},[s._v("String")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  \n  "),a("span",{attrs:{class:"token comment"}},[s._v("/** Will NOT be visisble for SQL engine. */")]),s._v("\n  age"),a("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token builtin"}},[s._v("Int")]),s._v("\n  \n  "),a("span",{attrs:{class:"token comment"}},[s._v("/**\n   * Indexed field sorted in descending order. \n   * Will be visible for SQL engine.\n   */")]),s._v("\n  @"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("QuerySqlField "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@field")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("true")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" descending "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("true")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" salary"),a("span",{attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token builtin"}},[s._v("Float")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" Serializable "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("在SQL查询中，类型名会被用作表名，这时，表名为"),a("code",[s._v("Person")]),s._v("（模式名的定义和使用前面已经描述）。\n"),a("code",[s._v("id")]),s._v("和"),a("code",[s._v("salary")]),s._v("都是索引列，"),a("code",[s._v("id")]),s._v("字段升序排列（默认），而"),a("code",[s._v("salary")]),s._v("降序排列。\n如果不希望索引一个字段，但是仍然想在SQL查询中使用它，那么在加注解时可以忽略"),a("code",[s._v("index = true")]),s._v("参数，这样的字段称为可查询字段，举例来说，上面的"),a("code",[s._v("name")]),s._v("就被定义为可查询字段。\n最后，"),a("code",[s._v("age")]),s._v("既不是可查询字段也不是索引字段，在Ignite中，从SQL查询的角度看就是不可见的。\n下面，就可以向下面这样执行SQL查询了：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("SqlFieldsQuery qry "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("SqlFieldsQuery")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"SELECT id, name FROM Person"')]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v("\n\t\t"),a("span",{attrs:{class:"token string"}},[s._v('"WHERE id > 1500 LIMIT 10"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("运行时更新索引和可查询字段")]),s._v("\n如果需要在运行时管理索引或者使新的字段对SQL引擎可见，可以使用ALTER TABLE, CREATE/DROP INDEX命令。\n"),a("strong",[s._v("索引嵌套对象")]),s._v("\n使用注解，嵌套对象的字段也可以被索引以及查询，比如，假设"),a("code",[s._v("Person")]),s._v("对象有一个"),a("code",[s._v("Address")]),s._v("对象属性：")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("Person")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("/** Indexed field. Will be visible for SQL engine. */")]),s._v("\n  "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@QuerySqlField")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("true")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("long")]),s._v(" id"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[s._v("/** Queryable field. Will be visible for SQL engine. */")]),s._v("\n  "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@QuerySqlField")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" String name"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),a("span",{attrs:{class:"token comment"}},[s._v("/** Will NOT be visible for SQL engine. */")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" age"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  "),a("span",{attrs:{class:"token comment"}},[s._v("/** Indexed field. Will be visible for SQL engine. */")]),s._v("\n  "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@QuerySqlField")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("true")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" Address address"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[a("code",[s._v("Address")]),s._v("类的结构如下：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("Address")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("/** Indexed field. Will be visible for SQL engine. */")]),s._v("\n  "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@QuerySqlField")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("true")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" String street"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[s._v("/** Indexed field. Will be visible for SQL engine. */")]),s._v("\n  "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@QuerySqlField")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("true")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" zip"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("上例中，"),a("code",[s._v("@QuerySqlField(index = true)")]),s._v("注解加在了"),a("code",[s._v("Address")]),s._v("类的所有属性上，就像"),a("code",[s._v("Person")]),s._v("类的"),a("code",[s._v("Address")]),s._v("对象一样。\n这样就可以执行下面这样的查询：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("QueryCursor"),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("List"),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("?")]),a("span",{attrs:{class:"token operator"}},[s._v(">>")]),s._v(" cursor "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" personCache"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("SqlFieldsQuery")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),a("span",{attrs:{class:"token string"}},[s._v("\"select * from Person where street = 'street1'\"")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("注意在查询的where子句中不需要指定"),a("strong",[s._v("address.street")]),s._v("，这是因为"),a("code",[s._v("Address")]),s._v("类的字段会被合并到"),a("code",[s._v("Person")]),s._v("表中，这样会简化对"),a("code",[s._v("Address")]),s._v("中的字段的访问。")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("Scala注解")]),s._v("\n在Scala类中，"),a("code",[s._v("@QuerySqlField")]),s._v("注解必须和"),a("code",[s._v("@Field")]),s._v("注解一起使用，这样的话这个字段对于Ignite才是可见的，就像这样的:"),a("code",[s._v("@(QuerySqlField @field)")]),s._v("。\n也可以使用"),a("code",[s._v("ignite-scalar")]),s._v("模块的"),a("code",[s._v("@ScalarCacheQuerySqlField")]),s._v("注解作为替代，他不过是"),a("code",[s._v("@Field")]),s._v("注解的别名。")])]),s._v(" "),a("p",[a("strong",[s._v("注册索引类型")]),s._v("\n定义了索引字段和可查询字段之后，就需要和他们所属的对象类型一起，在SQL引擎中注册。\n要告诉Ignite哪些类型应该被索引，需要通过"),a("code",[s._v("CacheConfiguration.setIndexedTypes")]),s._v("方法传入键-值对，如下所示：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("// Preparing configuration.")]),s._v("\nCacheConfiguration"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Long"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Person"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" ccfg "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("CacheConfiguration")]),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Registering indexed type.")]),s._v("\nccfg"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("setIndexedTypes")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Long"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Person"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("注意，这个方法只接收成对的类型，一个键类一个值类，基本类型需要使用包装器类。")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("预定义字段")]),s._v("\n除了用"),a("code",[s._v("@QuerySqlField")]),s._v("注解标注的所有字段，每个表都有两个特别的预定义字段："),a("code",[s._v("_key")]),s._v("和"),a("code",[s._v("_val")]),s._v("，它表示到整个键对象和值对象的链接。这很有用，比如当他们中的一个是基本类型并且希望用它的值进行过滤时。要做到这一点，执行一个"),a("code",[s._v("SELECT * FROM Person WHERE _key = 100")]),s._v("查询即可。")])]),s._v(" "),a("blockquote",[a("p",[s._v("多亏了二进制编组器，不需要将索引类型类加入集群节点的类路径中，SQL查询引擎不需要对象反序列化就可以钻取索引和可查询字段的值。")])]),s._v(" "),a("p",[a("strong",[s._v("分组索引")]),s._v("\n当查询条件复杂时可以使用多字段索引来加快查询的速度，这时可以用"),a("code",[s._v("@QuerySqlField.Group")]),s._v("注解。如果希望一个字段参与多个分组索引时也可以将多个"),a("code",[s._v("@QuerySqlField.Group")]),s._v("注解加入"),a("code",[s._v("orderedGroups")]),s._v("中。\n比如，下面的"),a("code",[s._v("Person")]),s._v("类中"),a("code",[s._v("age")]),s._v("字段加入了名为"),a("code",[s._v("age_salary_idx")]),s._v("的分组索引，他的分组序号是0并且降序排列，同一个分组索引中还有一个字段"),a("code",[s._v("salary")]),s._v(",他的分组序号是3并且升序排列。最重要的是"),a("code",[s._v("salary")]),s._v("字段还是一个单列索引(除了"),a("code",[s._v("orderedGroups")]),s._v("声明之外，还加上了"),a("code",[s._v("index = true")]),s._v(")。分组中的"),a("code",[s._v("order")]),s._v("不需要是什么特别的数值，他只是用于分组内的字段排序。\n"),a("strong",[s._v("Java：")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("Person")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("Serializable")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v('/** Indexed in a group index with "salary". */')]),s._v("\n  "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@QuerySqlField")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("orderedGroups"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@QuerySqlField")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("Group")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    name "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"age_salary_idx"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" order "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" descending "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("true")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" age"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[s._v('/** Indexed separately and in a group index with "age". */')]),s._v("\n  "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@QuerySqlField")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("true")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" orderedGroups"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@QuerySqlField")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("Group")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    name "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"age_salary_idx"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" order "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("3")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("double")]),s._v(" salary"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("blockquote",[a("p",[s._v("注意，将"),a("code",[s._v("@QuerySqlField.Group")]),s._v("放在"),a("code",[s._v("@QuerySqlField(orderedGroups={...})")]),s._v("外面是无效的。")])]),s._v(" "),a("h3",{attrs:{id:"_7-2-3-基于queryentity的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-3-基于queryentity的配置","aria-hidden":"true"}},[s._v("#")]),s._v(" 7.2.3.基于QueryEntity的配置")]),s._v(" "),a("p",[s._v("索引和字段也可以通过"),a("code",[s._v("org.apache.ignite.cache.QueryEntity")]),s._v("进行配置，它便于利用Spring进行基于XML的配置。\n在上面基于注解的配置中涉及的所有概念，对于基于"),a("code",[s._v("QueryEntity")]),s._v("的方式也都有效，此外，如果类型的字段通过"),a("code",[s._v("@QuerySqlField")]),s._v("进行了配置并且通过"),a("code",[s._v("CacheConfiguration.setIndexedTypes")]),s._v("注册过的，在内部也会被转换为查询实体。\n下面的示例显示的是如何像可查询字段那样定义一个单一字段索引和分组索引。")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("bean")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("class")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.ignite.configuration.CacheConfiguration"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("name"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("mycache"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- Configure query entities --\x3e")]),s._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("queryEntities"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("list")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("bean")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("class")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.ignite.cache.QueryEntity"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- Setting indexed type's key class --\x3e")]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("keyType"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("java.lang.Long"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n              \n                "),a("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- Setting indexed type's value class --\x3e")]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("valueType"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n                          "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.ignite.examples.Person"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n\n                "),a("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- Defining fields that will be either indexed or queryable.\n                Indexed fields are added to 'indexes' list below.--\x3e")]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("fields"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("map")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("entry")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("key")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("id"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("java.lang.Long"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n                        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("entry")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("key")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("name"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("java.lang.String"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n                        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("entry")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("key")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("salary"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("java.lang.Long "),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n                    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("map")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n                "),a("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- Defining indexed fields.--\x3e")]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("indexes"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("list")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- Single field (aka. column) index --\x3e")]),s._v("\n                        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("bean")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("class")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.ignite.cache.QueryIndex"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                            "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("constructor-arg")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("id"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n                        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("bean")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                      \n                        "),a("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- Group index. --\x3e")]),s._v("\n                        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("bean")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("class")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.ignite.cache.QueryIndex"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                            "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("constructor-arg")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("list")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                                    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("value")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("id"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("value")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                                    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("value")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("salary"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("value")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("list")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                            "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("constructor-arg")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                            "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("constructor-arg")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("SORTED"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n                        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("bean")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("list")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("bean")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("list")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("bean")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br")])]),a("p",[s._v("SQL查询中会使用"),a("code",[s._v("valueType")]),s._v("的简称作为表名，这时，表名为"),a("code",[s._v("Person")]),s._v("。\nQueryEntity定义之后，就可以执行下面的查询了：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("SqlFieldsQuery qry "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("SqlFieldsQuery")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"SELECT id, name FROM Person"')]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v("\n\t\t"),a("span",{attrs:{class:"token string"}},[s._v('"WHERE id > 1500 LIMIT 10"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_7-2-4-自定义键"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-4-自定义键","aria-hidden":"true"}},[s._v("#")]),s._v(" 7.2.4.自定义键")]),s._v(" "),a("p",[s._v("如果只使用预定义的SQL数据类型作为缓存键，那么就没必要对和DML相关的配置做额外的操作，这些数据类型在"),a("code",[s._v("GridQueryProcessor#SQL_TYPES")]),s._v("常量中进行定义，列举如下：")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("预定义SQL数据类型")]),s._v("\n1.所有的基本类型及其包装器，除了"),a("code",[s._v("char")]),s._v("和"),a("code",[s._v("Character")]),s._v("；\n2."),a("code",[s._v("String")]),s._v(";\n3."),a("code",[s._v("BigDecimal")]),s._v(";\n4."),a("code",[s._v("byte[]")]),s._v(";\n5."),a("code",[s._v("java.util.Date")]),s._v(", "),a("code",[s._v("java.sql.Date")]),s._v(", "),a("code",[s._v("java.sql.Timestamp")]),s._v(";\n6."),a("code",[s._v("java.util.UUID")]),s._v("。")])]),s._v(" "),a("p",[s._v("然而，如果决定引入复杂的自定义缓存键，那么在DML语句中要指向这些字段就需要：")]),s._v(" "),a("ul",[a("li",[s._v("在"),a("code",[s._v("QueryEntity")]),s._v("中定义这些字段，与在值对象中配置字段一样；")]),s._v(" "),a("li",[s._v("使用新的配置参数"),a("code",[s._v("QueryEntitty.setKeyFields(..)")]),s._v("来对键和值进行区分；")])]),s._v(" "),a("p",[s._v("下面的例子展示了如何实现：\n"),a("strong",[s._v("Java:")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("// Preparing cache configuration.")]),s._v("\nCacheConfiguration cacheCfg "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("CacheConfiguration")]),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"personCache"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Creating the query entity. ")]),s._v("\nQueryEntity entity "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("QueryEntity")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"CustomKey"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"Person"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Listing all the queryable fields.")]),s._v("\nLinkedHashMap"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("String"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" flds "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("LinkedHashMap")]),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nflds"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("put")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"intKeyField"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Integer"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("getName")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflds"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("put")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"strKeyField"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("getName")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nflds"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("put")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"firstName"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("getName")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflds"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("put")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"lastName"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" String"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("getName")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nentity"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("setFields")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("flds"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Listing a subset of the fields that belong to the key.")]),s._v("\nSet"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("String"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" keyFlds "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("HashSet")]),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nkeyFlds"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("add")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"intKeyField"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nkeyFlds"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("add")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"strKeyField"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nentity"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("setKeyFields")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keyFlds"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// End of new settings, nothing else here is DML related")]),s._v("\n\nentity"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("setIndexes")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Collections"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("QueryIndex"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{attrs:{class:"token function"}},[s._v("emptyList")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\ncacheCfg"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("setQueryEntities")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Collections"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("singletonList")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("entity"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nignite"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("createCache")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cacheCfg"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("p",[a("strong",[s._v("XML:")])]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("bean")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("class")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.ignite.configuration.CacheConfiguration"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("name"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("personCache"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- Configure query entities --\x3e")]),s._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("queryEntities"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("list")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("bean")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("class")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.ignite.cache.QueryEntity"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- Registering key's class. --\x3e")]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("keyType"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("CustomKey"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n              \n                "),a("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- Registering value's class. --\x3e")]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("valueType"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n                          "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.ignite.examples.Person"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n\n                "),a("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- \n                    Defining all the fields that will be accessible from DML.\n                --\x3e")]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("fields"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("map")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("entry")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("key")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("firstName"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("java.lang.String"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n                        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("entry")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("key")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("lastName"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("java.lang.String"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n                      \t"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("entry")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("key")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("intKeyField"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("java.lang.Integer"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n                      \t"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("entry")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("key")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("strKeyField"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("java.lang.String"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n                    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("map")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n              \n                "),a("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- Defining the subset of key's fields --\x3e")]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("keyFields"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("set")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                      \t"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("value")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("intKeyField"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("value")]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n                      \t"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("value")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("strKeyField"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("value")]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n                    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("set")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("bean")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("list")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("bean")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("哈希值自动计算和equals实现")]),s._v("\n如果自定义键可以被序列化为二进制形式，那么Ignite会自动进行哈希值的计算并且实现"),a("code",[s._v("equals")]),s._v("方法。\n但是，如果是"),a("code",[s._v("Externalizable")]),s._v("类型，那么就无法序列化为二进制形式，那么就需要自行实现"),a("code",[s._v("hashCode")]),s._v("和"),a("code",[s._v("equals")]),s._v("方法。")])]),s._v(" "),a("h3",{attrs:{id:"_7-2-5-空间查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-5-空间查询","aria-hidden":"true"}},[s._v("#")]),s._v(" 7.2.5.空间查询")]),s._v(" "),a("p",[s._v("这个空间模块只对"),a("code",[s._v("com.vividsolutions.jts")]),s._v("类型的对象有用。\n要配置索引以及/或者几何类型的可查询字段，可以使用和已有的非几何类型同样的方法，首先，可以使用"),a("code",[s._v("org.apache.ignite.cache.QueryEntity")]),s._v("定义索引，他对于基于Spring的XML配置文件非常方便，第二，通过"),a("code",[s._v("@QuerySqlField")]),s._v("注解来声明索引也可以达到同样的效果，他在内部会转化为"),a("code",[s._v("QueryEntities")]),s._v("。\n"),a("strong",[s._v("QuerySqlField：")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("/**\n * Map point with indexed coordinates.\n */")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("MapPoint")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("/** Coordinates. */")]),s._v("\n    "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@QuerySqlField")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("index "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("true")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" Geometry coords"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[s._v("/**\n     * @param coords Coordinates.\n     */")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("MapPoint")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Geometry coords"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("this")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("coords "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" coords"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[a("strong",[s._v("QueryEntity:")])]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("bean")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("class")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.ignite.configuration.CacheConfiguration"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("name"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("mycache"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("\x3c!-- Configure query entities --\x3e")]),s._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("queryEntities"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("list")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("bean")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("class")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.ignite.cache.QueryEntity"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("keyType"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("java.lang.Integer"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("valueType"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.ignite.examples.MapPoint"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("fields"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("map")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("entry")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("key")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("coords"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("com.vividsolutions.jts.geom.Geometry"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n                    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("map")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("property")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("indexes"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("list")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("bean")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("class")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.ignite.cache.QueryIndex"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                            "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("constructor-arg")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("coords"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n                        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("bean")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("list")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n                "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("bean")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("list")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("property")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("bean")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("p",[s._v("使用上述方法定义了几何类型字段之后，就可以使用存储于这些字段中值进行查询了。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("// Query to find points that fit into a polygon.")]),s._v("\nSqlQuery"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Integer"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MapPoint"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" query "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("SqlQuery")]),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("MapPoint"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"coords && ?"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Defining the polygon's boundaries.")]),s._v("\nquery"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("setArgs")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"POLYGON((0 0, 0 99, 400 500, 300 0, 0 0))"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Executing the query.")]),s._v("\nCollection"),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("Cache"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Entry"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Integer"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MapPoint"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" entries "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" cache"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("query"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("getAll")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Printing number of points that fit into the area defined by the polygon.")]),s._v("\nSystem"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("println")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"Fetched points ["')]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" entries"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("size")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("']'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("完整示例")]),s._v("\nIgnite中用于演示空间查询的可以立即执行的完整示例，可以在"),a("a",{attrs:{href:"https://github.com/dmagda/geospatial",target:"_self",rel:"noopener noreferrer"}},[s._v("这里")]),s._v("找到。")])]),s._v(" "),a("h2",{attrs:{id:"_7-3-自定义sql函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-自定义sql函数","aria-hidden":"true"}},[s._v("#")]),s._v(" 7.3.自定义SQL函数")]),s._v(" "),a("p",[s._v("Ignite的SQL引擎支持通过额外用Java编写的自定义SQL函数，来扩展ANSI-99规范定义的SQL函数集。\n一个自定义SQL函数仅仅是一个加注了"),a("code",[s._v("@QuerySqlFunction")]),s._v("注解的公共静态方法。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("// Defining a custom SQL function.")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("MyFunctions")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token annotation punctuation"}},[s._v("@QuerySqlFunction")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("sqr")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("int")]),s._v(" x"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" x "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v(" x"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("持有自定义SQL函数的类需要使用"),a("code",[s._v("setSqlFunctionClasses(...)")]),s._v("方法在特定的"),a("code",[s._v("CacheConfiguration")]),s._v("中注册。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("// Preparing a cache configuration.")]),s._v("\nCacheConfiguration cfg "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("CacheConfiguration")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Registering the class that contains custom SQL functions.")]),s._v("\ncfg"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("setSqlFunctionClasses")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("MyFunctions"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("经过了上述配置的缓存部署之后，在SQL查询中就可以随意地调用自定义函数了，如下所示：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("// Preparing the query that uses customly defined 'sqr' function.")]),s._v("\nSqlFieldsQuery query "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("SqlFieldsQuery")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),a("span",{attrs:{class:"token string"}},[s._v('"SELECT name FROM Blocks WHERE sqr(size) > 100"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Executing the query.")]),s._v("\ncache"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("query"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("getAll")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("blockquote",[a("p",[s._v("在自定义SQL函数可能要执行的所有节点上，通过"),a("code",[s._v("CacheConfiguration.setSqlFunctionClasses(...)")]),s._v("注册的类都需要添加到类路径中，否则在自定义函数执行时会抛出"),a("code",[s._v("ClassNotFoundException")]),s._v("异常。")])]),s._v(" "),a("h2",{attrs:{id:"_7-4-查询取消"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-查询取消","aria-hidden":"true"}},[s._v("#")]),s._v(" 7.4.查询取消")]),s._v(" "),a("p",[s._v("Ignite中有两种方式停止长时间运行的SQL查询，SQL查询时间长的原因，比如使用了未经优化的索引等。\n第一个方法是为特定的"),a("code",[s._v("SqlQuery")]),s._v("和"),a("code",[s._v("SqlFieldsQuery")]),s._v("设置查询执行的超时时间。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("SqlQuery qry "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("SqlQuery")]),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("AffinityKey"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Long"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Person"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Person"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" joinSql"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Setting query execution timeout")]),s._v("\nqry"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("setTimeout")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("10")]),s._v("_000"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" TimeUnit"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SECONDS"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("第二个方法是使用"),a("code",[s._v("QueryCursor.close()")]),s._v("来终止查询。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("SqlQuery qry "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("SqlQuery")]),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("AffinityKey"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Long"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Person"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Person"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" joinSql"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Getting query cursor.")]),s._v("\nQueryCursor"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("List"),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" cursor "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" cache"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("qry"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        \n"),a("span",{attrs:{class:"token comment"}},[s._v("// Executing query.")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n        \n"),a("span",{attrs:{class:"token comment"}},[s._v("// Halting the query that might be still in progress.")]),s._v("\ncursor"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("close")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])])}],!1,null,null,null);e.options.__file="JavaDeveloperGuide.md";t.default=e.exports}}]);