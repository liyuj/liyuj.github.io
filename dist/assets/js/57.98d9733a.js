(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{132:function(a,t,e){"use strict";e.r(t);var r=e(0),n=Object(r.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"content"},[e("h1",{attrs:{id:"_3-kafka连接器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-kafka连接器","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.Kafka连接器")]),a._v(" "),e("h2",{attrs:{id:"_3-1-kafka认证连接器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-kafka认证连接器","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.1.Kafka认证连接器")]),a._v(" "),e("p",[a._v("Kafka连接器将Ignite和和Kafka集成在一起，从而将Ignite轻松地加入一个基于Kafka管道的系统中。")]),a._v(" "),e("p",[a._v("Kafka连接器具有扩展性和弹性，可以解决很多集成的难题，如果直接使用Kafka的"),e("code",[a._v("Producer")]),a._v("和"),e("code",[a._v("Consumer")]),a._v("API，则必须手工处理解决这些问题。")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://files.readme.io/73b2ea2-What_is_Kafka_Connector-Ignite-Kafka_Connector.png",alt:""}})]),a._v(" "),e("h3",{attrs:{id:"_3-1-1-kafka连接器功能特性："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-kafka连接器功能特性：","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.1.1.Kafka连接器功能特性：")]),a._v(" "),e("ul",[e("li",[e("strong",[a._v("配置驱动")]),a._v("：无需编码，参见Kafka连接器配置的相关章节；")]),a._v(" "),e("li",[e("strong",[a._v("可扩展且灵活的架构")]),a._v("：参见Kafka连接器架构相关的章节，了解Kafka连接器如何满足性能、扩展性和容错的要求，并深入了解Kafka连接器的内部实现；")]),a._v(" "),e("li",[e("strong",[a._v("支持Ignite的数据模式")]),a._v("：参见Kafka连接器数据模式相关的章节，了解Kafka连接器如何识别、持有和更新Ignite的数据模式，以实现从Ignite到其它具有Kafka连接器的系统（比如Cassandra、HDFS和关系数据库等等）的自动化数据流；")]),a._v(" "),e("li",[e("strong",[a._v("易于运维")]),a._v("：参见Kafka连接器监控的相关章节，以了解如何在生产中监控Kafka连接器；")]),a._v(" "),e("li",[e("strong",[a._v("GridGain和社区版Kafka连接器")]),a._v("：参见GridGain和Ignite的Kafka连接器对比相关的章节，了解GridGain的Kafka连接器与开源版之间的区别。")])]),a._v(" "),e("h3",{attrs:{id:"_3-1-2-入门"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-入门","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.1.2.入门")]),a._v(" "),e("p",[a._v("参见Kafka连接器入门相关的章节，了解如何安装、配置和运行Kafka的连接器，然后看一些实际的示例：")]),a._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#_3-8-%E4%BD%BF%E7%94%A8kafka%E8%BF%9E%E6%8E%A5%E5%99%A8%E5%9C%A8%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E6%8C%81%E4%B9%85%E5%8C%96ignite%E6%95%B0%E6%8D%AE"}},[a._v("示例：使用Kafka连接器在关系数据库中持久化Ignite数据")]),a._v(";")]),a._v(" "),e("li",[e("a",{attrs:{href:"#_3-9-%E4%BD%BF%E7%94%A8kafka%E8%BF%9E%E6%8E%A5%E5%99%A8%E8%BF%9B%E8%A1%8Cignite%E6%95%B0%E6%8D%AE%E5%A4%8D%E5%88%B6"}},[a._v("示例：使用Kafka连接器进行Ignite数据复制")]),a._v("。")])]),a._v(" "),e("h2",{attrs:{id:"_3-2-kafka连接器入门"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-kafka连接器入门","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.2.Kafka连接器入门")]),a._v(" "),e("h3",{attrs:{id:"_3-2-1-kafka连接器生态系统"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-kafka连接器生态系统","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.2.1.Kafka连接器生态系统")]),a._v(" "),e("p",[a._v("在一个分布式的Kafka连接器生态系统中，有不同类型的节点，本文档中使用以下的术语来指代特定的节点类型：")]),a._v(" "),e("ul",[e("li",[a._v("Kafka集群节点被称为"),e("code",[a._v("Kafka代理")]),a._v("；")]),a._v(" "),e("li",[a._v("Kafka连接器集群节点被称为"),e("code",[a._v("Kafka连接器工作节点")]),a._v("；")]),a._v(" "),e("li",[a._v("GridGain集群节点被称为"),e("code",[a._v("GridGain服务端")]),a._v("。")])]),a._v(" "),e("p",[e("img",{attrs:{src:"https://files.readme.io/37f4e2d-What_is_Kafka_Connector-Deployment.png",alt:""}})]),a._v(" "),e("h3",{attrs:{id:"_3-2-2-gridgain的kafka连接器安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-gridgain的kafka连接器安装","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.2.2.GridGain的Kafka连接器安装")]),a._v(" "),e("p",[a._v("Kafka连接器安装分为3个步骤：")]),a._v(" "),e("ol",[e("li",[a._v("准备连接器安装包；")]),a._v(" "),e("li",[a._v("在Kafka中注册GridGain连接器；")]),a._v(" "),e("li",[a._v("在GridGain中注册连接器（可选）。")])]),a._v(" "),e("p",[e("strong",[a._v("1.准备连接器安装包")])]),a._v(" "),e("p",[a._v("Kafka连接器是GridGain企业版或旗舰版8.4.9及以后版本的一部分，位于GridGain安装文件夹的"),e("code",[a._v("integration/gridgain-kafka-connect")]),a._v("目录中。")]),a._v(" "),e("p",[a._v("然后拉取缺失的依赖项：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cd")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$GRIDGAIN_HOME")]),a._v("/integration/gridgain-kafka-connect\n./copy-dependencies.sh\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[e("strong",[a._v("2.在Kafka中注册GridGain连接器")])]),a._v(" "),e("p",[a._v("对于每个Kafka的连接器工作节点：")]),a._v(" "),e("ol",[e("li",[a._v("将连接器包目录复制到期望的目标目录；")]),a._v(" "),e("li",[a._v("编辑Kafka连接器工作节点的配置（对于单工作节点Kafka连接器集群，编辑"),e("code",[a._v("$KAFKA_HOME/config/connect-standalone.properties")]),a._v("文件，对于多工作节点Kafka连接器集群，编辑"),e("code",[a._v("$KAFKA_HOME/config/connect-distributed.properties")]),a._v("），在插件目录中注册连接器，将"),e("code",[a._v("CONNECTORS_PATH")]),a._v("替换为之前复制的连接器安装包目录：")])]),a._v(" "),e("p",[a._v("connect-standalone.properties：")]),a._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("plugin.path")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("CONNECTORS_PATH/gridgain-kafka-connect")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[e("strong",[a._v("3.在GridGain中注册连接器")])]),a._v(" "),e("div",{staticClass:"tip custom-block"},[e("p",{staticClass:"custom-block-title"},[a._v("这是可选的")]),a._v(" "),e("p",[a._v("只有使用"),e("code",[a._v("BACKLOG")]),a._v("作为"),e("a",{attrs:{href:"#-3-3-1-2-%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB-%E5%86%8D%E5%B9%B3%E8%A1%A1%E5%92%8C%E5%88%86%E5%8C%BA%E5%81%8F%E7%A7%BB%E9%87%8F"}},[a._v("故障恢复策略")]),a._v("时，这个步骤才是必须的。")])]),a._v(" "),e("p",[a._v("在每个GridGain的服务端节点，将下面的jar包复制到"),e("code",[a._v("$GRIDGAIN_HOME/libs/user")]),a._v("目录中：")]),a._v(" "),e("ul",[e("li",[e("code",[a._v("gridgain-kafka-connect-8.4.9.jar")]),a._v("（位于GridGain节点的"),e("code",[a._v("$GRIDGAIN_HOME/integration/gridgain-kafka-connect/lib")]),a._v("目录中）；")]),a._v(" "),e("li",[e("code",[a._v("connect-api-2.0.0.jar")]),a._v("和"),e("code",[a._v("kafka-clients-2.0.0.jar")]),a._v("（位于Kafka连接器工作节点的"),e("code",[a._v("$KAFKA_HOME/libs")]),a._v("目录）。")])]),a._v(" "),e("h3",{attrs:{id:"_3-2-3-gridgain的kafka连接器配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-gridgain的kafka连接器配置","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.2.3.GridGain的Kafka连接器配置")]),a._v(" "),e("p",[a._v("GridGain源连接器的必要属性是连接器的名字、类名和描述如何接入GridGain源集群的Ignite的配置文件的路径，名为"),e("code",[a._v("gridgain-kafka-connect-source")]),a._v("的最小源连接器配置大致如下：")]),a._v(" "),e("p",[a._v("gridgain-kafka-connect-source.properties：")]),a._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("gridgain-kafka-connect-source")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("connector.class")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("org.gridgain.kafka.source.IgniteSourceConnector")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("igniteCfg")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("IGNITE_CONFIG_PATH/ignite-server-source.xml")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("p",[a._v("在"),e("a",{attrs:{href:"#_3-5-1-%E6%BA%90%E8%BF%9E%E6%8E%A5%E5%99%A8"}},[a._v("源连接器")]),a._v("章节中有更详细的属性说明。")]),a._v(" "),e("p",[a._v("GridGain接收连接器的必要属性是连接器的名字、类名、数据流来源的主题列表和描述如何接入GridGain接收集群的Ignite的配置文件的路径，名为"),e("code",[a._v("gridgain-kafka-connect-sink")]),a._v("的最小接收连接器配置大致如下：")]),a._v(" "),e("p",[a._v("gridgain-kafka-connect-sink.properties：")]),a._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("gridgain-kafka-connect-sink")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("topics")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("topic1,topic2,topic3")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("connector.class")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("org.gridgain.kafka.sink.IgniteSinkConnector")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("igniteCfg")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("IGNITE_CONFIG_PATH/ignite-server-sink.xml")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("p",[a._v("在"),e("a",{attrs:{href:"#_3-5-2-%E6%8E%A5%E6%94%B6%E8%BF%9E%E6%8E%A5%E5%99%A8"}},[a._v("池连接器")]),a._v("章节中有更详细的属性说明。")]),a._v(" "),e("h3",{attrs:{id:"_3-2-4-运行kafka连接器生态系统"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-运行kafka连接器生态系统","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.2.4.运行Kafka连接器生态系统")]),a._v(" "),e("p",[e("a",{attrs:{href:"https://docs.confluent.io/current/connect/userguide.html#installing-and-configuring-kconnect-long",target:"_self",rel:"noopener noreferrer"}},[a._v("Kafka连接器的安装和配置")]),a._v("，可以看相关的文档，简要来说，要做如下的内容：")]),a._v(" "),e("ol",[e("li",[a._v("安装和配置Kafka的连接器；")]),a._v(" "),e("li",[a._v("配置和启动Zookeeper；")]),a._v(" "),e("li",[a._v("配置和启动Kafka代理；")]),a._v(" "),e("li",[a._v("配置和启动Kafka连接器工作节点。")])]),a._v(" "),e("p",[a._v("了解了如何安装和配置Kafka连接器之后，下面就在一台主机中，使用默认的Zookeeper、Kafka代理和Kafka连接器工作节点配置文件运行Kafka生态系统的shell命令（生产上通常来说要在单独的主机中运行每个节点）：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$KAFKA_HOME")]),a._v("/bin/zookeeper-server-start.sh "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$KAFKA_HOME")]),a._v("/config/zookeeper.properties\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$KAFKA_HOME")]),a._v("/bin/kafka-server-start.sh "),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$KAFKA_HOME")]),a._v("/config/server.properties\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$KAFKA_HOME")]),a._v("/bin/connect-standalone.sh \\\n\t"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$KAFKA_HOME")]),a._v("/config/connect-standalone.properties \\\n\tgridgain-kafka-connect-source.properties \\\n\tgridgain-kafka-connect-sink.properties\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br")])]),e("h3",{attrs:{id:"_3-2-5-管理kafka连接器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-5-管理kafka连接器","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.2.5.管理Kafka连接器")]),a._v(" "),e("p",[a._v("每个Kafka工作节点都会暴露REST API，可以用来管理Kafka连接器（默认端口为8083），有关如何创建、删除、暂停和恢复连接器以及查看连接器和任务的状态，可以参见"),e("a",{attrs:{href:"https://docs.confluent.io/current/connect/references/restapi.html",target:"_self",rel:"noopener noreferrer"}},[a._v("Kafka连接器REST接口")]),a._v("文档。")]),a._v(" "),e("h2",{attrs:{id:"_3-3-kafka连接器架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-kafka连接器架构","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.3.Kafka连接器架构")]),a._v(" "),e("h3",{attrs:{id:"_3-3-1-源连接器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-源连接器","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.3.1.源连接器")]),a._v(" "),e("p",[a._v("GridGain的源连接器会从Ignite缓存中加载数据，然后注入Kafka主题，该连接器会监控Ignite中缓存的新增和删除，然后自动进行调整。")]),a._v(" "),e("h4",{attrs:{id:"_3-3-1-1-并行化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-1-并行化","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.3.1.1.并行化")]),a._v(" "),e("p",[a._v("在Kafka中，"),e("strong",[a._v("分区")]),a._v("是键/值/时间戳记录的流。与其它分布式系统类似，Kafka在节点之间分配分区以实现高可用性、可伸缩性和性能。\nKafka连接器架构是分层的："),e("strong",[a._v("连接器")]),a._v("会将输入分成分区，创建多个"),e("strong",[a._v("任务")]),a._v("并为每个任务分配一个或多个分区，最大任务数是可配置的。")]),a._v(" "),e("p",[a._v("GridGain源连接器将每个Ignite缓存视为分区。换句话说，负载由缓存平衡：如果只有一个缓存进行数据加载，这时就是非分布式（独立）GridGain Kafka源连接器操作模式。")]),a._v(" "),e("p",[a._v("在Kafka中，分区存储在"),e("strong",[a._v("主题")]),a._v("中（Kafka"),e("strong",[a._v("生产者")]),a._v("写入以及Kafka"),e("strong",[a._v("消费者")]),a._v("读取的地方），因此，GridGain的Kafka源连接器是在Ignite缓存和Kafka主题之间映射数据。")]),a._v(" "),e("h4",{attrs:{id:"_3-3-1-2-故障转移、再平衡和分区偏移量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-2-故障转移、再平衡和分区偏移量","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.3.1.2.故障转移、再平衡和分区偏移量")]),a._v(" "),e("p",[e("strong",[a._v("再平衡")]),a._v("即将Kafka连接器和任务在"),e("strong",[a._v("工作节点")]),a._v("（Kafka节点上运行的JVM进程）间重新分配，如下场景会发生再平衡：")]),a._v(" "),e("ul",[e("li",[a._v("节点加入或离开Kafka集群；")]),a._v(" "),e("li",[a._v("GridGain的Kafka源连接器检测到Ignite缓存（Kafka术语中的分区）被创建或被删除，然后自身请求再平衡。")])]),a._v(" "),e("p",[a._v("Kafka连接器提供源分区偏移量存储（不要与Kafka记录偏移量混淆），以支持在故障或任何其他原因导致的再平衡或重启后继续拉取数据。如果没有偏移量，连接器就必须从头开始重新加载所有数据，或丢失在连接器不可用期间生成的数据。例如，Confluent的文件源连接器将文件视为分区，并将文件中的位置视为偏移量，另一个例子是Confluent的JDBC源连接器将数据库表视为分区，将自增或时间戳字段值视为偏移量。")]),a._v(" "),e("p",[a._v("GridGain源连接器将"),e("strong",[a._v("缓存")]),a._v("作为"),e("strong",[a._v("分区")]),a._v("，通常没有适用于缓存的"),e("strong",[a._v("偏移量")]),a._v("概念。虽然实际Ignite数据模型中可能有缓存具有自增键或自增值字段，但这种情况并不像关系数据库或NoSQL数据模型那样常见，因此Kafka连接器要求所有缓存包含自增字段将严重限制适用性。")]),a._v(" "),e("p",[a._v("因此，GridGain的Kafka连接器暴露了不同的策略来管理故障转移和再平衡，作为性能、资源消耗和数据交付保证之间的折衷，具体可以使用"),e("code",[a._v("failoverPolicy")]),a._v("配置项来指定。")]),a._v(" "),e("p",[e("strong",[a._v("丢弃")])]),a._v(" "),e("p",[a._v("由于故障转移或再平衡而导致连接器停机期间发生的Ignite缓存更新丢失，此选项以丢失数据为代价提供最高性能。")]),a._v(" "),e("p",[e("strong",[a._v("完整快照")])]),a._v(" "),e("p",[a._v("每次连接器启动时都从Ignite缓存拉取所有数据。在再平衡或故障转移后始终重新加载所有数据并不违反Kafka保证：可以将重复数据注入Kafka。不过Ignite旨在存储大量的数据，因此除非所有缓存都非常小，否则每次连接器重启都重新加载所有数据并不可行。")]),a._v(" "),e("p",[e("strong",[a._v("临时缓存")])]),a._v(" "),e("p",[a._v("从最后提交的偏移量恢复。")]),a._v(" "),e("p",[a._v("连接器会在Ignite中创建一个特殊的Kafka临时缓存，其会复制所有的缓存数据并赋予偏移量。Kafka临时缓存由Kafka临时服务管理，该服务在Kafka连接器故障后仍然是在线状态。连接器从Kafka临时缓存中拉取数据，提交已处理的数据偏移量，并在失败或再平衡后从上次提交的偏移量中恢复。在连接器正常停止后，Kafka临时服务会被卸载，同时Kafka临时缓存也会被销毁。配置"),e("code",[a._v("backlogMemoryRegionName")]),a._v("可以对临时缓存的内存区、持久化以及其它的存储选项进行定义。")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://files.readme.io/6adf577-Offset_Management.png",alt:""}})]),a._v(" "),e("p",[a._v("此选项支持"),e("strong",[a._v("只处理一次")]),a._v("的语义，不过会消耗额外的Ignite资源来管理Kafka临时缓存，由于额外的数据编组，效率也不高，并且在Ignite集群重启后会丢失。")]),a._v(" "),e("div",{staticClass:"warning custom-block"},[e("p",{staticClass:"custom-block-title"},[a._v("Ignite中配置Kafka临时缓存的内存区")]),a._v(" "),e("p",[a._v("如果使用Kafka临时缓存管理故障转移，必须在Ignite中配置专用于Kafka临时缓存的内存区，并为该内存区配置退出策略，以避免临时缓存无限增长。可以将内存区最大大小配置为足以避免在最坏情况下丢失数据的值。为了理解“最坏情况”，假定Ignite按照条目注入源缓存的速度将条目推送到Kafka临时缓存，源连接器不断拉取Kafka临时缓存并将数据注入Kafka，如果Kafka达不到Ignite的性能或Kafka不可用，那么数据可能会从临时缓存中退出而不会被注入Kafka。因此，临时缓存内存区的最大值，必须足以使所有数据在最长可能的停机时间内以最大速度注入Kafka。")]),a._v(" "),e("p",[a._v("临时缓存内存区的名字默认是"),e("code",[a._v("kafka-connect")]),a._v("，可以使用配置项"),e("code",[a._v("backlogMemoryRegionName")]),a._v("指定其它的名称。")])]),a._v(" "),e("p",[e("strong",[a._v("动态重新配置")])]),a._v(" "),e("p",[a._v("Kafka连接器会监控在Ignite中创建的匹配"),e("code",[a._v("cacheWhitelist")]),a._v("和"),e("code",[a._v("cacheBlacklist")]),a._v("的新缓存以及在连接器运行时删除的现有缓存，连接器会对自身自动重新配置，如果动态创建或销毁受监控的缓存，Kafka会进行再平衡。")]),a._v(" "),e("p",[e("strong",[a._v("初始数据加载")])]),a._v(" "),e("p",[e("code",[a._v("shallLoadInitialData")]),a._v("配置项控制是否在连接器启动时加载Ignite缓存中已有的数据。")]),a._v(" "),e("h3",{attrs:{id:"_3-3-2-接收连接器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-接收连接器","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.3.2.接收连接器")]),a._v(" "),e("p",[a._v("GridGain接收连接器会从Kafka主题中导出数据，然后注入Ignite缓存，如果该缓存在Ignite中不存在，则会创建。")]),a._v(" "),e("h4",{attrs:{id:"_3-3-2-1-并行化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-1-并行化","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.3.2.1.并行化")]),a._v(" "),e("p",[a._v("接收连接器会启动一个或多个任务（任务数量在"),e("code",[a._v("tasks.max")]),a._v("配置项中指定），并在可用的工作节点中进行分配。每个任务都会从"),e("code",[a._v("topics")]),a._v("配置项中指定的主题中拉取数据，将它们分组成批，然后将批量数据推送到与主题对应的缓存中。")]),a._v(" "),e("h4",{attrs:{id:"_3-3-2-2-故障转移、再平衡和分区偏移量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-2-故障转移、再平衡和分区偏移量","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.3.2.2.故障转移、再平衡和分区偏移量")]),a._v(" "),e("p",[a._v("连接器框架会自动提交已处理数据的偏移量，如果连接器重启，会从最后提交的偏移量中继续从Kafka中拉取数据。这提供了"),e("strong",[a._v("只处理一次")]),a._v("保证。")]),a._v(" "),e("h3",{attrs:{id:"_3-3-3-共同特性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-共同特性","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.3.3.共同特性")]),a._v(" "),e("p",[e("strong",[a._v("序列化和反序列化")])]),a._v(" "),e("p",[a._v("当源连接器将记录注入Kafka时会发生序列化。当接收连接器从Kafka中消费记录时，会发生反序列化。")]),a._v(" "),e("p",[a._v("Kafka会将连接器的序列化分开处理。使用Kafka工作节点的配置项"),e("code",[a._v("key.converter")]),a._v("和"),e("code",[a._v("value.converter")]),a._v("可以指定负责序列化的可插拔"),e("code",[a._v("Converter")]),a._v("模块的类名。")]),a._v(" "),e("p",[a._v("GridGain的Kafka连接器包中包含"),e("code",[a._v("org.gridgain.kafka.IgniteBinaryConverter")]),a._v("，它会使用Ignite的二进制编组器对数据进行序列化。该转换器为无模式数据提供了最大的性能，因为它是连接器使用的原生Ignite二进制对象。"),e("code",[a._v("IgniteBinaryConverter")]),a._v("支持Kafka的模式序列化，因此可以在启用模式时使用。")]),a._v(" "),e("p",[a._v("也可以使用其它供应商的转换器替代，它们可以提供一些丰富的附加功能，例如支持模式版本控制的模式注册等。")]),a._v(" "),e("p",[e("strong",[a._v("过滤")])]),a._v(" "),e("p",[a._v("源和接收连接器都可以对从Ignite缓存中拉取或推送到Ignite缓存的数据进行过滤。")]),a._v(" "),e("p",[a._v("使用"),e("code",[a._v("cacheFilter")]),a._v("配置项可以指定实现"),e("code",[a._v("java.util.function.Predicate<org.gridgain.kafka.CacheEntry>")]),a._v("的自定义过滤器类名。")]),a._v(" "),e("p",[e("strong",[a._v("转换")])]),a._v(" "),e("p",[a._v("Kafka的"),e("strong",[a._v("单消息转换")]),a._v("（SMT）允许基于配置的消息结构和内容更改。参见"),e("a",{attrs:{href:"http://kafka.apache.org/documentation.html#connect_transforms",target:"_self",rel:"noopener noreferrer"}},[a._v("Kafka文档")]),a._v("以了解如何配置SMT。")]),a._v(" "),e("p",[e("strong",[a._v("数据模式")])]),a._v(" "),e("p",[a._v("参见"),e("a",{attrs:{href:"#_3-4-kafka%E8%BF%9E%E6%8E%A5%E5%99%A8%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%BC%8F"}},[a._v("Kafka连接器数据模式")]),a._v("一节。")]),a._v(" "),e("h2",{attrs:{id:"_3-4-kafka连接器数据模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-kafka连接器数据模式","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.4.Kafka连接器数据模式")])])}],!1,null,null,null);n.options.__file="KafkaConnector.md";t.default=n.exports}}]);