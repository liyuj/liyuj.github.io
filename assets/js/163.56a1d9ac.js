(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{353:function(t,a,s){"use strict";s.r(a);var n=s(3),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"osgi支持"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#osgi支持"}},[t._v("#")]),t._v(" OSGi支持")]),t._v(" "),s("h2",{attrs:{id:"_1-在apache-karaf中安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-在apache-karaf中安装"}},[t._v("#")]),t._v(" 1.在Apache Karaf中安装")]),t._v(" "),s("h3",{attrs:{id:"_1-1-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-概述"}},[t._v("#")]),t._v(" 1.1.概述")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://karaf.apache.org/",target:"_self",rel:"noopener noreferrer"}},[t._v("Apache Karaf")]),t._v("是一个轻量级、功能强大的企业级OSGi容器，它支持Eclipse Equinox和Apache Felix运行时。")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("支持Apache Karaf4.0.0版本系列")]),t._v("\nIgnite在Karaf4.0.0版本系列上进行了测试，可能也可以工作于更老的版本上，但是未经过明确的测试。")])]),t._v(" "),s("p",[t._v("为了方便不同Ignite模块的部署（包括它们的依赖），Ignite提供了一套打包进特性库的"),s("a",{attrs:{href:"https://karaf.apache.org/manual/latest/users-guide/provisioning.html",target:"_self",rel:"noopener noreferrer"}},[t._v("Karaf特性")]),t._v("，这使得借助于Karaf Shell的一个命令就可以快速地将Ignite部署进OSGi环境。")]),t._v(" "),s("h3",{attrs:{id:"_1-2-准备步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-准备步骤"}},[t._v("#")]),t._v(" 1.2.准备步骤")]),t._v(" "),s("p",[t._v("首先，Ignite使用了Oracle/Sun JRE的底层包"),s("code",[t._v("sun.nio.ch")]),t._v("(OpenJDK也有效)。")]),t._v(" "),s("p",[t._v("因为这是一个专有的包（并不是Java标准规范的一部分），Apache Kafka默认并没有从"),s("a",{attrs:{href:"http://wiki.osgi.org/wiki/System_Bundle",target:"_self",rel:"noopener noreferrer"}},[t._v("System Bundle")]),t._v("（bundle 0）中导出它，因此必须通过"),s("a",{attrs:{href:"https://karaf.apache.org/manual/latest-2.2.x/users-guide/jre-tuning.html",target:"_self",rel:"noopener noreferrer"}},[t._v("修改${KARAF_BASE}/etc/jre.properties文件")]),t._v("通知Kafka导出它。")]),t._v(" "),s("p",[t._v("定位到使用的JRE版本的"),s("code",[t._v("jre-1.x")]),t._v("属性，然后在最后追加包名，比如：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('jre-1.8= \\\n javax.accessibility, \\\n javax.activation;version="1.1", \\\n ...\n org.xml.sax.helpers, \\\n sun.nio.ch\n')])])]),s("h3",{attrs:{id:"_1-3-安装ignite特性库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-安装ignite特性库"}},[t._v("#")]),t._v(" 1.3.安装Ignite特性库")]),t._v(" "),s("p",[t._v("使用Apache Karaf Shell中的如下命令来安装Ignite特性库，确保容器可以连接到互联网或者一个包含Ignite组件的备用Maven仓库。")]),t._v(" "),s("p",[t._v("将Ignite特性库加入Karaf：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("karaf@root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" feature:repo-add mvn:org.apache.ignite/ignite-osgi-karaf/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ignite.version}")]),t._v("/xml/features\nAdding feature url mvn:org.apache.ignite/ignite-osgi-karaf/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${ignite.version}")]),t._v("/xml/features\nkaraf@root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[t._v("将"),s("code",[t._v("${ignite.version}")]),t._v("替换为实际使用的版本号。")]),t._v(" "),s("p",[t._v("这时可以列出Ignite支持的所有特性：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("karaf@root()> feature:list | grep ignite\nignite-all                    | 1.5.0.SNAPSHOT   |          | Uninstalled | ignite                   | Apache Ignite :: All\nignite-core                   | 1.5.0.SNAPSHOT   |          | Uninstalled | ignite                   | Apache Ignite :: Core\nignite-aop                    | 1.5.0.SNAPSHOT   |          | Uninstalled | ignite                   | Apache Ignite :: AOP\nignite-aws                    | 1.5.0.SNAPSHOT   |          | Uninstalled | ignite                   | Apache Ignite :: AWS\nignite-indexing               | 1.5.0.SNAPSHOT   |          | Uninstalled | ignite                   | Apache Ignite :: Indexing\nignite-hibernate              | 1.5.0.SNAPSHOT   |          | Uninstalled | ignite                   | Apache Ignite :: Hibernate\nignite-jcl                    | 1.5.0.SNAPSHOT   |          | Uninstalled | ignite                   | Apache Ignite :: JCL\nignite-jms11                  | 1.5.0.SNAPSHOT   |          | Uninstalled | ignite                   | Apache Ignite :: JMS 1.1\nignite-jta                    | 1.5.0.SNAPSHOT   |          | Uninstalled | ignite                   | Apache Ignite :: JTA\nignite-kafka                  | 1.5.0.SNAPSHOT   |          | Uninstalled | ignite                   | Apache Ignite :: Kafka\n[...]\nkaraf@root()>\n")])])]),s("h3",{attrs:{id:"_1-4-安装合适的ignite特性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-安装合适的ignite特性"}},[t._v("#")]),t._v(" 1.4.安装合适的Ignite特性")]),t._v(" "),s("p",[t._v("下面的特性是有点特别的：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("ignite-core")]),t._v("：ignite-core模块，它是所有其它特性依赖的，因此不要忘了安装；")]),t._v(" "),s("li",[s("code",[t._v("ignite-all")]),t._v("：安装其它所有特性的一个汇总；")])]),t._v(" "),s("p",[t._v("所有其它的特性包括对应的Ignite模块+依赖，可以通过如下方式安装它们：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("karaf@root()> feature:install ignite-core\nkaraf@root()> feature:install ignite-kafka\nkaraf@root()> feature:install ignite-aop ignite-urideploy\nkaraf@root()>\n")])])]),s("p",[t._v("一些模块是OSGi片段而不是组件，当安装它们时，可能会注意到，Karaf Shell以及/或者"),s("code",[t._v("ignite-core")]),t._v("，其中一个或者两者，重新启动。")]),t._v(" "),s("h3",{attrs:{id:"_1-5-ignite-log4j和pax-logging"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-ignite-log4j和pax-logging"}},[t._v("#")]),t._v(" 1.5.ignite-log4j和Pax Logging")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("当Karaf版本<=4.0.3时如果使用Pax Logging请仔细阅读这个注释")]),t._v("\n安装"),s("code",[t._v("ignite-log4j")]),t._v("这个特性时，Karaf Shell可能显示下面的消息：\nError executing command: Resource has no uri\n这不是一个严重的错误，已经汇报给Karaf社区，问题号是"),s("a",{attrs:{href:"https://issues.apache.org/jira/browse/KARAF-4129",target:"_self",rel:"noopener noreferrer"}},[t._v("KARAF-4129")]),t._v("。\n按照如下的说明可以忽略这个错误。")])]),t._v(" "),s("p",[t._v("Apache Karaf捆绑了"),s("a",{attrs:{href:"https://ops4j1.jira.com/wiki/display/paxlogging/Pax+Logging",target:"_self",rel:"noopener noreferrer"}},[t._v("Pax Logging")]),t._v(",它是一个从其它组件收集和汇总日志输出（通过不同的框架输出，比如slf4j，log4j，JULI，commons-logging等）然后用一个典型的log4j配置处理的框架。")]),t._v(" "),s("p",[s("code",[t._v("ignite-log4j")]),t._v("模块依赖于log4j，Pax Logging默认不输出它，因此开发了一个OSGi片段，SymbolicName为"),s("code",[t._v("ignite-osgi-paxlogging")]),t._v("，它加入了"),s("code",[t._v("ignite-core")]),t._v("然后输出了缺失的包。")]),t._v(" "),s("p",[s("code",[t._v("ignite-log4j")]),t._v("特性也安装了这个片段，但是需要用"),s("code",[t._v("org.ops4j.pax.logging.pax-logging-api")]),t._v("这个名字强制刷新：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("karaf@root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" feature:install ignite-log4j\nkaraf@root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" refresh org.ops4j.pax.logging.pax-logging-api\nkaraf@root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        __ __                  ____\n       / //_/____ __________ _/ __/\n      / ,"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("  / __ "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("/ ___/ __ "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("/ /_\n     / /"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("/ /_/ / /  / /_/ / __/\n    /_/ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("_"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("__,_/_/   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("__,_/_/\n\n  Apache Karaf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.0")]),t._v(".2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nHit "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<tab>'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" a list of available commands\nand "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[cmd] --help'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("help")]),t._v(" on a specific command.\nHit "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<ctrl-d>'")]),t._v(" or "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("type")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'system:shutdown'")]),t._v(" or "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'logout'")]),t._v(" to "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),t._v(" Karaf.\n\nkaraf@root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" la "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" ignite-osgi-paxlogging\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Resolved  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.5")]),t._v(".0.SNAPSHOT                            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" ignite-osgi-paxlogging, Hosts: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nkaraf@root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("h2",{attrs:{id:"_2-支持的模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-支持的模块"}},[t._v("#")]),t._v(" 2.支持的模块")]),t._v(" "),s("p",[t._v("以下的模块已OSGi化：")]),t._v(" "),s("ul",[s("li",[t._v("ignite-core")]),t._v(" "),s("li",[t._v("ignite-aop")]),t._v(" "),s("li",[t._v("ignite-aws")]),t._v(" "),s("li",[t._v("ignite-camel")]),t._v(" "),s("li",[t._v("ignite-flume")]),t._v(" "),s("li",[t._v("ignite-indexing")]),t._v(" "),s("li",[t._v("ignite-hibernate")]),t._v(" "),s("li",[t._v("ignite-jcl")]),t._v(" "),s("li",[t._v("ignite-jms11")]),t._v(" "),s("li",[t._v("ignite-jta")]),t._v(" "),s("li",[t._v("ignite-kafka")]),t._v(" "),s("li",[t._v("ignite-mqtt")]),t._v(" "),s("li",[t._v("ignite-log4j")]),t._v(" "),s("li",[t._v("ignite-rest-http")]),t._v(" "),s("li",[t._v("ignite-scalar-2.11")]),t._v(" "),s("li",[t._v("ignite-scalar-2.10")]),t._v(" "),s("li",[t._v("ignite-schedule")]),t._v(" "),s("li",[t._v("ignite-slf4j")]),t._v(" "),s("li",[t._v("ignite-spring")]),t._v(" "),s("li",[t._v("ignite-ssh")]),t._v(" "),s("li",[t._v("ignite-twitter")]),t._v(" "),s("li",[t._v("ignite-urideploy")]),t._v(" "),s("li",[t._v("ignite-web")]),t._v(" "),s("li",[t._v("ignite-zookeeper")])]),t._v(" "),s("p",[t._v("下面的模块由于各种各样的原因目前还不支持OSGi：")]),t._v(" "),s("ul",[s("li",[t._v("ignite-cloud")]),t._v(" "),s("li",[t._v("ignite-hadoop")]),t._v(" "),s("li",[t._v("ignite-gce")]),t._v(" "),s("li",[t._v("ignite-log4j2")]),t._v(" "),s("li",[t._v("ignite-mesos")]),t._v(" "),s("li",[t._v("ignite-visor-console[-2.10]")]),t._v(" "),s("li",[t._v("ignite-yarn")])]),t._v(" "),s("h2",{attrs:{id:"_3-在osgi容器中启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-在osgi容器中启动"}},[t._v("#")]),t._v(" 3.在OSGi容器中启动")]),t._v(" "),s("h3",{attrs:{id:"_3-1-容器的配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-容器的配置"}},[t._v("#")]),t._v(" 3.1.容器的配置")]),t._v(" "),s("p",[t._v("要在一个OSGi容器中启动Ignite，至少要安装如下的组件：")]),t._v(" "),s("ul",[s("li",[t._v("ignite-core")]),t._v(" "),s("li",[t._v("ignite-osgi")]),t._v(" "),s("li",[t._v("javax cache API")])]),t._v(" "),s("p",[t._v("当在Karaf中部署时，可以通过使用Ignite特性库来快速地安装"),s("code",[t._v("ignite-core")]),t._v("特性，可以参照"),s("a",{attrs:{href:"#_4-1-%E5%9C%A8apache-karaf%E4%B8%AD%E5%AE%89%E8%A3%85"}},[t._v("在Apache Karaf中安装")]),t._v("章节来了解更多的信息。")]),t._v(" "),s("p",[t._v("可以随意地安装额外的Ignite模块来扩展平台的功能，就像在一个标准环境中将模块加入类路径一样。")]),t._v(" "),s("h3",{attrs:{id:"_3-2-实现ignite组件activator"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-实现ignite组件activator"}},[t._v("#")]),t._v(" 3.2.实现Ignite组件Activator")]),t._v(" "),s("p",[t._v("要启动Ignite，通过继承抽象类"),s("code",[t._v("org.apache.ignite.osgi.IgniteAbstractOsgiContextActivator")]),t._v("来实现一个OSGi组件Activator：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("osgi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("examples")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IgniteConfiguration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("osgi")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IgniteAbstractOsgiContextActivator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("osgi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("classloaders")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OsgiClassLoadingStrategyType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyActivator")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IgniteAbstractOsgiContextActivator")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Configure your Ignite instance as you would normally do,\n     * and return it.\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IgniteConfiguration")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("igniteConfiguration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IgniteConfiguration")]),t._v(" config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IgniteConfiguration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setGridName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testGrid"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * Choose the classloading strategy for Ignite to use.\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OsgiClassLoadingStrategyType")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("classLoadingStrategy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OsgiClassLoadingStrategyType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BUNDLE_DELEGATING"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("在OSGi中支持两个不同的类加载策略：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("BUNDLE_DELEGATING")]),t._v("：优先使用包含Activator的组件的类加载器，"),s("code",[t._v("ignite-core")]),t._v("的类加载器作为备选；")]),t._v(" "),s("li",[s("code",[t._v("CONTAINER_SWEEP")]),t._v("：与"),s("code",[t._v("BUNDLE_DELEGATING")]),t._v("一样，但是在类仍然找不到时最终会搜索所有的组件。")])]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("未来的OSGi类加载策略")]),t._v("\n未来可能会考虑在以后的版本中增加其它的类加载策略，比如使用Service Locator机制来定位通过一个文件自发地希望向Ignite的编组器暴露包的组件，类似于JAXB规范中的jaxb.index。")])]),t._v(" "),s("p",[t._v("确保将"),s("code",[t._v("Bundle-Activator")]),t._v("OSGi清单头加入组件，这样才能使OSGi容器在组件启动时调用Activator。")]),t._v(" "),s("p",[t._v("包括Bundle-Activator的OSGi头")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Bundle-SymbolicName: test-bundle\nBundle-Activator: org.apache.ignite.osgi.examples.MyActivator\nImport-Package: ...\n[...]\n")])])]),s("p",[t._v("要生成这个组件，需要包含"),s("code",[t._v("Bundle-Activator")]),t._v("OSGi头，建议在Maven构建中增加"),s("code",[t._v("maven-bundle-plugin")]),t._v("插件，下面是对应的配置：")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.apache.felix"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("maven-bundle-plugin"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${maven.bundle.plugin.version}"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Bundle-SymbolicName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("..."),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("Bundle-SymbolicName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Bundle-Activator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.apache.ignite.osgi.examples.MyActivator"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("Bundle-Activator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    [...]\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("RightPane")],1)}),[],!1,null,null,null);a.default=e.exports}}]);