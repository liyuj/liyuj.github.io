(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{241:function(t,a,s){"use strict";s.r(a);var e=s(3),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"kubernetes部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes部署"}},[t._v("#")]),t._v(" Kubernetes部署")]),t._v(" "),s("h2",{attrs:{id:"_1-kubernetes部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-kubernetes部署"}},[t._v("#")]),t._v(" 1.Kubernetes部署")]),t._v(" "),s("p",[t._v("Ignite集群可以容易地在"),s("a",{attrs:{href:"https://kubernetes.io/",target:"_self",rel:"noopener noreferrer"}},[t._v("Kubernetes")]),t._v("环境中部署和维护，Kubernetes是一个开源的系统，可以自动化地部署、伸缩以及管理容器化的应用。")]),t._v(" "),s("p",[t._v("本章节会引导用户将Ignite部署进Kubernetes环境，还会涉及一些与Ignite有关的特殊性内容。\n首先要确定Ignite的开发和使用方式：")]),t._v(" "),s("ul",[s("li",[t._v("如果使用纯内存方式或者作为第三方数据库（RDBMS, NoSQL）的缓存层，那么需要遵照"),s("code",[t._v("无状态部署")]),t._v("的相关文档；")]),t._v(" "),s("li",[t._v("如果Ignite作为内存数据库，并且开启了持久化，那么需要遵照"),s("code",[t._v("有状态部署")]),t._v("的相关文档。")])]),t._v(" "),s("p",[t._v("如果希望将Kubernetes部署在具体的云环境中，那么需要参照下面的文档：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Microsoft Azure部署")])]),t._v(" "),s("li",[s("code",[t._v("Google Cloud部署")])])]),t._v(" "),s("h2",{attrs:{id:"_2-常规配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-常规配置"}},[t._v("#")]),t._v(" 2.常规配置")]),t._v(" "),s("h3",{attrs:{id:"_2-1-无状态部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-无状态部署"}},[t._v("#")]),t._v(" 2.1.无状态部署")]),t._v(" "),s("p",[t._v("如果使用纯内存方式或者作为第三方数据库（RDBMS, NoSQL）的缓存层，那么需要将其按照无状态的解决方案进行部署。")]),t._v(" "),s("h4",{attrs:{id:"_2-1-1-要求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-要求"}},[t._v("#")]),t._v(" 2.1.1.要求")]),t._v(" "),s("p",[t._v("确保如下事项已经完成")]),t._v(" "),s("ul",[s("li",[t._v("环境中已经部署了Kubernetes集群；")]),t._v(" "),s("li",[t._v("已经配置了RBAC授权；")]),t._v(" "),s("li",[t._v("已经部署了Ignite服务；")])]),t._v(" "),s("h4",{attrs:{id:"_2-1-2-kubernetes-ip探测器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-kubernetes-ip探测器"}},[t._v("#")]),t._v(" 2.1.2.Kubernetes IP探测器")]),t._v(" "),s("p",[t._v("要开启Kubernetes环境下Ignite节点的自动发现，需要在"),s("code",[t._v("IgniteConfiguration")]),t._v("中启用"),s("code",[t._v("TcpDiscoveryKubernetesIpFinder")]),t._v("，下面会创建一个名为"),s("code",[t._v("example-kube-rbac.xml")]),t._v("的配置文件，然后像下面这样定义相关的配置：")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token prolog"}},[t._v('<?xml version="1.0" encoding="UTF-8"?>')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("beans")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("xmlns")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.springframework.org/schema/beans"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("xsi")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.w3.org/2001/XMLSchema-instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("util")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.springframework.org/schema/util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xsi:")]),t._v("schemaLocation")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("\n        http://www.springframework.org/schema/beans\n        http://www.springframework.org/schema/beans/spring-beans.xsd\n        http://www.springframework.org/schema/util\n        http://www.springframework.org/schema/util/spring-util.xsd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.ignite.configuration.IgniteConfiguration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("discoverySpi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("ipFinder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.ignite.spi.discovery.tcp.ipfinder.kubernetes.TcpDiscoveryKubernetesIpFinder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n         "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("beans")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("下面，就可以为Ignite配置组准备一套Kubernetes环境然后部署了。")]),t._v(" "),s("h4",{attrs:{id:"_2-1-3-ignite配置组部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-ignite配置组部署"}},[t._v("#")]),t._v(" 2.1.3.Ignite配置组部署")]),t._v(" "),s("p",[t._v("最后，需要为Ignite配置组定义一个yaml格式配置文件。")]),t._v(" "),s("p",[t._v("ignite-deployment.yaml：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# An example of a Kubernetes configuration for Ignite pods deployment.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" extensions/v1beta1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Custom Ignite cluster's name.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cluster\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# A number of Ignite pods to be started by Kubernetes initially.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Custom Ignite pod name.")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apacheignite/ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2.5.0\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" OPTION_LIBS\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kubernetes\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CONFIG_URI\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//raw.githubusercontent.com/apache/ignite/master/modules/kubernetes/config/example"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("persistence.xml\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Ports to open.")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Might be optional depending on your Kubernetes environment.")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11211 ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# REST port number.")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("47100 ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# communication SPI port number.")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("47500 ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# discovery SPI port number.")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("49112 ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# JMX port number.")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10800 ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SQL port number.")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10900 ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Thin clients port number.")]),t._v("\n")])])]),s("p",[t._v("如上所示，该配置定义了一组环境变量（"),s("code",[t._v("OPTION_LIBS")]),t._v("和"),s("code",[t._v("CONFIG_URIL")]),t._v("），Ignite的Docker镜像使用的一个shell脚本会用到它。Docker镜像的完整配置参数列表可以查看"),s("RouterLink",{attrs:{to:"/doc/2.6.0/java/Deployment.html#_2-docker部署"}},[t._v("Docker部署")]),t._v("的相关章节。")],1),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Ignite Docker镜像版本")]),t._v(" "),s("p",[t._v("Kubernetes支持Ignite的1.9及其以后的版本，一定要使用有效的Docker镜像版本，完整的标签列表在"),s("a",{attrs:{href:"https://hub.docker.com/r/apacheignite/ignite/tags",target:"_self",rel:"noopener noreferrer"}},[t._v("这里")]),t._v("。")])]),t._v(" "),s("p",[t._v("下一步，在Kubernetes中使用上述的配置部署Ignite配置组：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl create -f ignite-deployment.yaml\n")])])]),s("p",[t._v("检查配置组是否启动运行：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl get pods\n")])])]),s("p",[t._v("选择一个可用的配置组的名字：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("NAME                              READY     STATUS    RESTARTS   AGE\nignite-cluster-3454482164-d4m6g   1/1       Running   0          25m\nignite-cluster-3454482164-w0xtx   1/1       Running   0          25m\n")])])]),s("p",[t._v("可以获取日志，确认配置组之间可以在集群内相互发现：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl logs ignite-cluster-3454482164-d4m6g\n")])])]),s("h4",{attrs:{id:"_2-1-4-调整ignite集群大小"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-调整ignite集群大小"}},[t._v("#")]),t._v(" 2.1.4.调整Ignite集群大小")]),t._v(" "),s("p",[t._v("可以使用标准的Kubernetes API随时调整Ignite集群的大小。比如，如果想把集群从2个节点扩容到5个节点，那么可以使用下面的命令：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl scale --replicas"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" -f ignite-deployment.yaml\n")])])]),s("p",[t._v("再次检查集群已经成功扩容：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl get pods\n")])])]),s("p",[t._v("输出会显示有5个配置组正在运行：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("NAME                              READY     STATUS    RESTARTS   AGE\nignite-cluster-3454482164-d4m6g   1/1       Running   0          34m\nignite-cluster-3454482164-ktkrr   1/1       Running   0          58s\nignite-cluster-3454482164-r20f8   1/1       Running   0          58s\nignite-cluster-3454482164-vf8kh   1/1       Running   0          58s\nignite-cluster-3454482164-w0xtx   1/1       Running   0          34m\n")])])]),s("h4",{attrs:{id:"_2-1-5-在microsoft-azure环境中部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-5-在microsoft-azure环境中部署"}},[t._v("#")]),t._v(" 2.1.5.在Microsoft Azure环境中部署")]),t._v(" "),s("p",[t._v("参照"),s("a",{attrs:{href:"https://dzone.com/articles/deploying-apache-ignite-in-kubernetes-on-microsoft",target:"_self",rel:"noopener noreferrer"}},[t._v("Microsoft Azure环境部署")]),t._v("相关章节。")]),t._v(" "),s("h4",{attrs:{id:"_2-1-6-在amazon-aws环境中部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-6-在amazon-aws环境中部署"}},[t._v("#")]),t._v(" 2.1.6.在Amazon AWS环境中部署")]),t._v(" "),s("p",[t._v("参照"),s("a",{attrs:{href:"https://www.gridgain.com/resources/blog/kubernetes-and-apacher-ignitetm-deployment-aws",target:"_self",rel:"noopener noreferrer"}},[t._v("AWS环境部署")]),t._v("相关内容。")]),t._v(" "),s("h4",{attrs:{id:"_2-1-7-在openshift环境中部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-7-在openshift环境中部署"}},[t._v("#")]),t._v(" 2.1.7.在OpenShift环境中部署")]),t._v(" "),s("p",[t._v("对于使用Docker容器的Kubernetes，"),s("a",{attrs:{href:"https://www.openshift.com/",target:"_self",rel:"noopener noreferrer"}},[t._v("OpenShift")]),t._v("也是支持的，但是它有自己的RBAC（基于角色的访问控制）特性，这与Kubernetes直接提供的机制不完全兼容，这也是为什么部分命令会导致"),s("code",[t._v("拒绝访问")]),t._v("错误的原因，这时就需要一些额外的配置，如下：")]),t._v(" "),s("p",[t._v("1.使用OpenShift的CLI创建一个具有"),s("code",[t._v("view")]),t._v("角色的服务账户；")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ oc create sa ignite\n$ oc policy add-role-to-user view system:serviceaccount:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("project"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":ignite\n")])])]),s("p",[t._v("注意，"),s("code",[t._v("<project>")]),t._v("是OpenShift的项目名。\n2.指定TcpDiscoveryKubernetesIpFinder的"),s("code",[t._v("namespace")]),t._v("参数；")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("ignite.cfg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.ignite.configuration.IgniteConfiguration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("discoverySpi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("ipFinder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.ignite.spi.discovery.tcp.ipfinder.kubernetes.TcpDiscoveryKubernetesIpFinder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Set a project name as the namespace. --\x3e")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("<project>"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("3.在部署配置中添加"),s("code",[t._v("serviceAccountName")]),t._v("；")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DeploymentConfig\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cluster\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Start two Ignite nodes by default.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceAccountName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-2-有状态部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-有状态部署"}},[t._v("#")]),t._v(" 2.2.有状态部署")]),t._v(" "),s("p",[t._v("如果Ignite部署为内存数据库，并且打开了原生持久化，那么就需要按照有状态的解决方案进行部署。")]),t._v(" "),s("h4",{attrs:{id:"_2-2-1-要求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-要求"}},[t._v("#")]),t._v(" 2.2.1.要求")]),t._v(" "),s("p",[t._v("确保如下事项已经完成")]),t._v(" "),s("ul",[s("li",[t._v("环境中已经部署了Kubernetes集群；")]),t._v(" "),s("li",[t._v("已经配置了RBAC授权；")]),t._v(" "),s("li",[t._v("已经部署了Ignite服务；")])]),t._v(" "),s("h4",{attrs:{id:"_2-2-2-kubernetes-ip探测器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-kubernetes-ip探测器"}},[t._v("#")]),t._v(" 2.2.2.Kubernetes IP探测器")]),t._v(" "),s("p",[t._v("要开启Kubernetes环境下Ignite节点的自动发现，需要在"),s("code",[t._v("IgniteConfiguration")]),t._v("中启用"),s("code",[t._v("TcpDiscoveryKubernetesIpFinder")]),t._v("，下面会创建一个名为"),s("code",[t._v("example-kube-persistence.xml")]),t._v("的配置文件，然后像下面这样定义相关的配置：")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token prolog"}},[t._v('<?xml version="1.0" encoding="UTF-8"?>')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("beans")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("xmlns")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.springframework.org/schema/beans"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("xsi")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.w3.org/2001/XMLSchema-instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("util")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.springframework.org/schema/util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xsi:")]),t._v("schemaLocation")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("\n        http://www.springframework.org/schema/beans\n        http://www.springframework.org/schema/beans/spring-beans.xsd\n        http://www.springframework.org/schema/util\n        http://www.springframework.org/schema/util/spring-util.xsd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.ignite.configuration.IgniteConfiguration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Enabling Apache Ignite Persistent Store. --\x3e")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dataStorageConfiguration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.ignite.configuration.DataStorageConfiguration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("defaultDataRegionConfiguration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.ignite.configuration.DataRegionConfiguration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("persistenceEnabled"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("true"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Explicitly configure TCP discovery SPI to provide list of initial nodes. --\x3e")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("discoverySpi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("ipFinder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--\n     Enables Kubernetes IP finder and setting custom namespace name.\n     --\x3e")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.ignite.spi.discovery.tcp.ipfinder.kubernetes.TcpDiscoveryKubernetesIpFinder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("namespace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("beans")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("该配置开启了Ignite的原生持久化，确保数据能够保存在磁盘上。")]),t._v(" "),s("p",[t._v("下面，就可以为Ignite配置组准备一套Kubernetes环境然后部署了。")]),t._v(" "),s("h4",{attrs:{id:"_2-2-3-有状态集部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-有状态集部署"}},[t._v("#")]),t._v(" 2.2.3.有状态集部署")]),t._v(" "),s("p",[t._v("最后，需要为Ignite有状态集定义一个YAML格式配置文件：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1beta2\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" StatefulSet\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceAccountName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apacheignite/ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2.5.0\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" OPTION_LIBS\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kubernetes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("http\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CONFIG_URI\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//raw.githubusercontent.com/apache/ignite/master/modules/kubernetes/config/example"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("kube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("persistence.xml\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IGNITE_QUIET\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" JVM_OPTS\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-Djava.net.preferIPv4Stack=true"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11211 ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# JDBC port number.")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("47100 ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# communication SPI port number.")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("47500 ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# discovery SPI port number.")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("49112 ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# JMX port number.")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10800 ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SQL port number.")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080 ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# REST port number.")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10900 ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Thin clients port number.")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/ignite"')]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("storage\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeClaimTemplates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("storage\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ReadWriteOnce"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1Gi\n")])])]),s("p",[t._v("如上所示，该配置定义了一组环境变量（"),s("code",[t._v("OPTION_LIBS")]),t._v("和"),s("code",[t._v("CONFIG_URIL")]),t._v("），Ignite的Docker镜像使用的一个shell脚本会用到它。Docker镜像的完整配置参数列表可以查看"),s("RouterLink",{attrs:{to:"/doc/2.6.0/java/Deployment.html#_2-docker部署"}},[t._v("Docker部署")]),t._v("的相关章节。")],1),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Ignite Docker镜像版本")]),t._v(" "),s("p",[t._v("Kubernetes支持Ignite的1.9及其以后的版本，一定要使用有效的Docker镜像版本，完整的标签列表在"),s("a",{attrs:{href:"https://hub.docker.com/r/apacheignite/ignite/tags",target:"_self",rel:"noopener noreferrer"}},[t._v("这里")]),t._v("。")])]),t._v(" "),s("p",[t._v("下一步，在Kubernetes中使用上述的配置部署有状态集（确保事先配置好了唯一的命名空间和RBAC）：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the stateful set")]),t._v("\nkubectl create -f ignite-stateful-set.yaml\n")])])]),s("p",[t._v("确认Ignite配置组正在运行：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl get pods --namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ignite\n")])])]),s("p",[t._v("选择一个可用的配置组的名字：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("NAME       READY     STATUS    RESTARTS   AGE\nignite-0   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1       Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          7m\nignite-1   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1       Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          4m\n")])])]),s("p",[t._v("然后看下日志，确认配置组之间可以彼此发现：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl logs ignite-0 --namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ignite\n")])])]),s("h4",{attrs:{id:"_2-2-4-调整ignite集群大小"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-调整ignite集群大小"}},[t._v("#")]),t._v(" 2.2.4.调整Ignite集群大小")]),t._v(" "),s("p",[t._v("属于标准的Kubernetes API，可以随时调整Ignite集群的大小。比如希望将集群从2个节点扩容到4个节点，可以使用下面的命令：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl scale sts ignite --replicas"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" --namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ignite\n")])])]),s("p",[t._v("再次确认集群扩容成功：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl get pods --namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ignite\n")])])]),s("p",[t._v("输出显示有4个Ignite配置组正在运行：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("NAME       READY     STATUS    RESTARTS   AGE\nignite-0   1/1       Running   0          21m\nignite-1   1/1       Running   0          18m\nignite-2   1/1       Running   0          12m\nignite-3   1/1       Running   0          9m\n")])])]),s("h4",{attrs:{id:"_2-2-5-ignite集群激活"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-ignite集群激活"}},[t._v("#")]),t._v(" 2.2.5.Ignite集群激活")]),t._v(" "),s("p",[t._v("因为部署使用了Ignite的原生持久化，因此启动之后集群需要激活，怎么做呢，接入一个配置组：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it ignite-0 --namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ignite -- /bin/bash\n")])])]),s("p",[t._v("转到下面的目录：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /opt/ignite/apache-ignite-fabric/bin/\n")])])]),s("p",[t._v("然后使用下面的命令可以激活集群：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./control.sh --activate\n")])])]),s("h3",{attrs:{id:"_2-3-rbac授权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-rbac授权"}},[t._v("#")]),t._v(" 2.3.RBAC授权")]),t._v(" "),s("h4",{attrs:{id:"_2-3-1-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-概述"}},[t._v("#")]),t._v(" 2.3.1.概述")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://kubernetes.io/docs/reference/access-authn-authz/rbac/",target:"_self",rel:"noopener noreferrer"}},[t._v("基于角色的访问控制（RBAC）")]),t._v("是一种企业内基于单个用户的角色来调节对计算机或网络资源访问的常规方法。")]),t._v(" "),s("p",[t._v("RBAC使用"),s("code",[t._v("rbac.authorization.k8s.io")]),t._v("API组来驱动授权决策，允许管理员通过Kubernetes API动态地配置策略。\n建议为Ignite部署配置RBAC，以对部署进行细粒度的控制，避免与安全有关的问题。")]),t._v(" "),s("h4",{attrs:{id:"_2-3-2-要求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-要求"}},[t._v("#")]),t._v(" 2.3.2.要求")]),t._v(" "),s("p",[t._v("假定已经部署好了一套Kubernetes集群环境。")]),t._v(" "),s("h4",{attrs:{id:"_2-3-3-创建命名空间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-创建命名空间"}},[t._v("#")]),t._v(" 2.3.3.创建命名空间")]),t._v(" "),s("p",[t._v("需要为Ignite部署创建一个唯一的命名空间，在本案例中命名空间名字为"),s("code",[t._v("ignite")]),t._v("：")]),t._v(" "),s("p",[t._v("ignite-namespace.yaml：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Namespace\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n")])])]),s("p",[t._v("执行下面的命令配置命名空间：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl create -f ignite-namespace.yaml\n")])])]),s("h4",{attrs:{id:"_2-3-4-创建服务账户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-4-创建服务账户"}},[t._v("#")]),t._v(" 2.3.4.创建服务账户")]),t._v(" "),s("p",[t._v("通过下面的方式配置Ignite服务账户：")]),t._v(" "),s("p",[t._v("ignite-service-account.yaml：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n")])])]),s("p",[t._v("执行下面的命令创建账户：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl create -f ignite-service-account.yaml\n")])])]),s("h4",{attrs:{id:"_2-3-5-创建角色"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-5-创建角色"}},[t._v("#")]),t._v(" 2.3.5.创建角色")]),t._v(" "),s("p",[t._v("通过下面的方式创建Ignite服务使用的角色，该服务用于节点的自动发现，并且用作远程应用的负载平衡器。")]),t._v(" "),s("p",[t._v("ignite-account-role.yaml：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1beta1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroups")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Here are resources you can access")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" pods\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" endpoints\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("verbs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# That is what you can do with them")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" get\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" list\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" watch\n")])])]),s("blockquote",[s("p",[t._v("注意，如果不打算将Ignite服务用作外部应用的负载平衡器，那么建议赋予其更少的权限，具体见"),s("a",{attrs:{href:"https://stackoverflow.com/a/49634686/5515526",target:"_self",rel:"noopener noreferrer"}},[t._v("这里")]),t._v("。")])]),t._v(" "),s("p",[t._v("执行下面的命令创建角色：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl create -f ignite-account-role.yaml\n")])])]),s("p",[t._v("下一步，使用下面的配置将该角色绑定到服务账户和命名空间上：")]),t._v(" "),s("p",[t._v("ignite-role-binding.yaml：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRoleBinding\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1beta1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n")])])]),s("p",[t._v("执行下面的命令执行绑定：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl create -f ignite-role-binding.yaml\n")])])]),s("p",[t._v("最后，将命名空间切换到"),s("code",[t._v("ignite")]),t._v("，然后就可以看到所有所属的资源：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl config set-context "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl config current-context"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" --namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ignite\n")])])]),s("h3",{attrs:{id:"_2-4-ignite服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-ignite服务"}},[t._v("#")]),t._v(" 2.4.Ignite服务")]),t._v(" "),s("p",[t._v("Ignite服务用于Ignite节点的自动发现，还有做为要接入集群的外部应用的负载平衡器。")]),t._v(" "),s("p",[t._v("本章节描述如何配置和部署Ignite服务。")]),t._v(" "),s("h4",{attrs:{id:"_2-4-1-ignite服务部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1-ignite服务部署"}},[t._v("#")]),t._v(" 2.4.1.Ignite服务部署")]),t._v(" "),s("p",[t._v("Ignite的"),s("code",[t._v("KubernetesIPFinder")]),t._v("需要用户配置和部署一个特定的Kubernetes服务，它会维护一个所有有效的Ignite配置组的IP地址列表。")]),t._v(" "),s("p",[t._v("每次启动一个新的Ignite配置组，IP探测器会通过Kubernetes API接入服务来获取已有的Ignite配置组地址列表。通过这些地址，新的节点就可以发现集群中的其它节点从而最终加入Ignite集群。")]),t._v(" "),s("p",[t._v("同时，也可以将该服务复用为预接入集群的外部应用的负载平衡器。")]),t._v(" "),s("p",[t._v("通过下面的方式可以配置服务，它考虑了所有的必要条件：")]),t._v(" "),s("p",[t._v("ignite-service.yaml：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The name must be equal to TcpDiscoveryKubernetesIpFinder.serviceName")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The name must be equal to TcpDiscoveryKubernetesIpFinder.namespaceName")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" LoadBalancer\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rest\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sql\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10800")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10800")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" thinclients\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10900")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10900")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sessionAffinity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClientIP\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Must be equal to the label set for Ignite pods.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n")])])]),s("p",[t._v("然后使用如下的命令将其部署进Kubernetes（确认事先已经配置好了命名空间和RBAC）：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl create -f ignite-service.yaml\n")])])]),s("p",[t._v("确认服务已经正在运行：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v(" kubectl get svc ignite --namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ignite\n")])])]),s("h3",{attrs:{id:"_2-5-kubernetes-ip探测器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-kubernetes-ip探测器"}},[t._v("#")]),t._v(" 2.5.Kubernetes IP探测器")]),t._v(" "),s("h4",{attrs:{id:"_2-5-1-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-1-概述"}},[t._v("#")]),t._v(" 2.5.1.概述")]),t._v(" "),s("p",[t._v("将Ignite节点以Kubernetes配置组的形式进行部署，对Ignite节点的发现机制有一定的要求。因为防火墙通常会阻止组播通信的原因，很可能无法直接使用基于组播的IP探测器。但是，只要Kubernetes动态地分配了地址，就可以列出所有节点的IP地址，然后使用静态IP探测器。")]),t._v(" "),s("p",[t._v("也可以考虑Amazon AWS IP探测器、Google Compute Engine IP探测器或者JClouds IP探测器，但是Kubernetes必须部署在这些云环境中。另外，也可以使用共享文件系统或者关系型数据库用于节点的自动发现，但是必须单独维护数据库或者共享文件系统。")]),t._v(" "),s("p",[t._v("本章节会描述有关针对使用Kubernetes技术容器化的Ignite节点，专门开发的IP探测器，该IP探测器会自动搜索所有在线的Ignite配置组的IP地址，它是通过与一个持有所有最新端点的Kubernetes服务进行通信实现的。")]),t._v(" "),s("h4",{attrs:{id:"_2-5-2-基于kubernetes服务的发现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-2-基于kubernetes服务的发现"}},[t._v("#")]),t._v(" 2.5.2.基于Kubernetes服务的发现")]),t._v(" "),s("p",[t._v("如果要开启Kubernetes环境的节点自动发现，需要在下面的配置中使用"),s("code",[t._v("TcpDiscoveryKubernetesIpFinder")]),t._v("：")]),t._v(" "),s("p",[t._v("XML：")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.ignite.configuration.IgniteConfiguration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t...\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("discoverySpi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("ipFinder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.apache.ignite.spi.discovery.tcp.ipfinder.kubernetes.TcpDiscoveryKubernetesIpFinder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("Java：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Configuring discovery SPI.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TcpDiscoverySpi")]),t._v(" spi "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TcpDiscoverySpi")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Configuring IP finder.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TcpDiscoveryKubernetesIpFinder")]),t._v(" ipFinder "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TcpDiscoveryKubernetesIpFinder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nspi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setIpFinder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ipFinder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IgniteConfiguration")]),t._v(" cfg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IgniteConfiguration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Override default discovery SPI.")]),t._v("\ncfg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setDiscoverySpi")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("spi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Start Ignite node.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Ignition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cfg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Maven构件")]),t._v(" "),s("p",[t._v("如果要使用"),s("code",[t._v("TcpDiscoveryKubernetesIpFinder")]),t._v("，需要在Maven中添加"),s("code",[t._v("ignite-kubernetes")]),t._v("依赖。")])]),t._v(" "),s("p",[t._v("Ignite的"),s("code",[t._v("KubernetesIPFinder")]),t._v("需要用户配置和部署一个特定的Kubernetes服务，它负责维护所有在线Ignite配置组（节点）的IP地址列表。")]),t._v(" "),s("p",[t._v("每当启动一个新的Ignite配置组，IP探测器会通过Kubernetes的API访问Kubernetes服务，获取已有的Ignite配置组的地址列表，通过这些地址，新的节点就可以与其它节点互相连接，然后最终加入集群。")]),t._v(" "),s("p",[t._v("该服务需要手工配置，然后需要优先于Ignite配置组先行启动，下面是代码样例：")]),t._v(" "),s("p",[t._v("Service Configuration：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Name of Ignite Service used by Kubernetes IP finder for IP addresses lookup.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusterIP")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" None "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# custom value.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9042 ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# custom value.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Must be equal to one of the labels set in Ignite pods'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# deployement configuration.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ignite\n")])])]),s("p",[t._v("默认的服务名为"),s("code",[t._v("ignite")]),t._v("，如果修改了名字，一定要同时调用"),s("code",[t._v("TcpDiscoveryKubernetesIpFinder.setServiceName(String)")]),t._v("方法进行修改。")]),t._v(" "),s("p",[t._v("另外，建议通过某种方式对Ignite的配置组打标签，然后在服务的"),s("code",[t._v("selector")]),t._v("配置段中配置标签。比如，通过上面的配置启动的服务，会关注于标注为"),s("code",[t._v("app: ignite")]),t._v("的配置组。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("从外部接入容器化的Ignite集群")]),t._v(" "),s("p",[s("code",[t._v("TcpDiscoveryKubernetesIpFinder")]),t._v("的设计是用于Kubernetes环境内部的，这意味着所有的Ignite节点、与集群交互的应用都需要通过Kubernetes容器化。")])]),t._v(" "),s("p",[t._v("但是，如果希望从Kubernetes外部接入Ignite集群，那么：")]),t._v(" "),s("ol",[s("li",[t._v("需要在Ignite配置组的yaml文件中配置"),s("code",[t._v("hostNetwork=true")]),t._v("，这样就可以从外部与容器化的Ignite配置组建立TCP/IP连接；")]),t._v(" "),s("li",[t._v("在Kubernetes环境外部，使用同样的"),s("code",[t._v("TcpDiscoveryKubernetesIpFinder")]),t._v("。")])]),t._v(" "),s("h4",{attrs:{id:"_2-5-3-配置参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-3-配置参数"}},[t._v("#")]),t._v(" 2.5.3.配置参数")]),t._v(" "),s("p",[t._v("通常，"),s("code",[t._v("TcpDiscoveryKubernetesIpFinder")]),t._v("的设计是直接可用，但是通过下面的参数也可以进行细粒度的控制：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("属性")]),t._v(" "),s("th",[t._v("描述")]),t._v(" "),s("th",[t._v("默认值")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("setServiceName(String)")])]),t._v(" "),s("td",[t._v("配置Kubernetes服务的名字，该服务用于Ignite配置组的IP地址搜索，服务名必须与Kubernetes配置中的服务名一致。")]),t._v(" "),s("td",[s("code",[t._v("ignite")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("setNamespace(String)")])]),t._v(" "),s("td",[t._v("配置Kubernetes服务所属的命名空间。")]),t._v(" "),s("td",[s("code",[t._v("default")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("setMasterUrl(String)")])]),t._v(" "),s("td",[t._v("配置Kubernetes API服务器的主机名。")]),t._v(" "),s("td",[s("code",[t._v("https://kubernetes.default.svc.cluster.local:443")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("setAccountToken(String)")])]),t._v(" "),s("td",[t._v("配置服务令牌文件的路径。")]),t._v(" "),s("td",[s("code",[t._v("/var/run/secrets/kubernetes.io/serviceaccount/token")])])])])]),t._v(" "),s("h2",{attrs:{id:"_3-microsoft-azure部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-microsoft-azure部署"}},[t._v("#")]),t._v(" 3.Microsoft Azure部署")]),t._v(" "),s("h3",{attrs:{id:"_3-1-azure-kubernetes服务部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-azure-kubernetes服务部署"}},[t._v("#")]),t._v(" 3.1.Azure Kubernetes服务部署")]),t._v(" "),s("p",[t._v("第一步是配置Azure Kubernetes服务（AKS）集群，具体可以看下面的资料：")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough-portal",target:"_self",rel:"noopener noreferrer"}},[t._v("通过Azure门户部署AKS集群")])]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough",target:"_self",rel:"noopener noreferrer"}},[t._v("通过Azure命令行部署AKS集群")])])]),t._v(" "),s("p",[t._v("本章节中会讲解如何使用Azure门户进行AKS部署。")]),t._v(" "),s("p",[s("strong",[t._v("AKS配置")])]),t._v(" "),s("p",[t._v("创建Microsoft账号之后，转到"),s("a",{attrs:{href:"https://portal.azure.com/",target:"_self",rel:"noopener noreferrer"}},[t._v("https://portal.azure.com")]),t._v(" 然后选择"),s("code",[t._v("Create a resource")]),t._v(" > 选择 "),s("code",[t._v("Kubernetes Service")]),t._v(" > "),s("code",[t._v("Create")]),t._v("。")]),t._v(" "),s("p",[t._v("在下一页中，配置本次部署的常规参数：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/522e9d8-Screen_Shot_2018-06-28_at_2.46.26_PM.png",alt:""}})]),t._v(" "),s("p",[t._v("本例中，会使用"),s("code",[t._v("IgniteCluster")]),t._v("作为"),s("code",[t._v("Resource group")]),t._v("和"),s("code",[t._v("Kubernetes cluster name")]),t._v("的名字。\n该页面中还需要选择AKS集群的节点数量。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/948dd86-Screen_Shot_2018-06-28_at_2.50.22_PM.png",alt:""}})]),t._v(" "),s("p",[t._v("本例中，集群由4个节点组成，每个节点2个虚拟CPU和8G RAM。")]),t._v(" "),s("p",[t._v("下一步，转到"),s("code",[t._v("Networking")]),t._v("配置页，配置需要的网络信息，如果没有什么特别的网络参数那么可以使用下面的默认值：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/f5bc018-Screen_Shot_2018-06-28_at_2.52.01_PM.png",alt:""}})]),t._v(" "),s("p",[t._v("之后转到"),s("code",[t._v("Monitoring")]),t._v("配置页，建议打开监控，这样可以在Azure门户中获取集群的状态：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/f46f1f8-Screen_Shot_2018-06-28_at_2.55.06_PM.png",alt:""}})]),t._v(" "),s("p",[t._v("下一页中，可以配置应用的标签，然后点击"),s("code",[t._v("Review + create")]),t._v("按钮，再次检查配置参数之后，点击"),s("code",[t._v("Create")]),t._v("按钮。")]),t._v(" "),s("p",[t._v("转到"),s("code",[t._v("All Resources")]),t._v(" -> "),s("code",[t._v("IgniteCluster")]),t._v("，Azure部署集群需要点时间：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/6e31786-Screen_Shot_2018-06-28_at_3.00.06_PM.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("Kubernetes仪表盘配置")])]),t._v(" "),s("p",[t._v("Kubernetes仪表盘是一个有助于从本地或者其它环境监控Kubernetes的简单工具。")]),t._v(" "),s("p",[t._v("如果要使用仪表盘，需要安装Azure CLI，如果未安装，可以参照这个"),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest",target:"_self",rel:"noopener noreferrer"}},[t._v("文档")]),t._v("。")]),t._v(" "),s("p",[t._v("Azure CLI安装完成之后，按照下面的步骤操作：")]),t._v(" "),s("p",[t._v("首先，通过下面的命令获取集群的凭据：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("az aks get-credentials --resource-group IgniteCluster --name IgniteCluster\n")])])]),s("p",[t._v("下一步，通过下面的命令检查所有的节点是否处于"),s("code",[t._v("Ready")]),t._v("状态：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl get nodes\n")])])]),s("p",[t._v("输出大致如下：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("aks-agentpool-41298956-0   Ready     agent     1m        v1.10.3\naks-agentpool-41298956-1   Ready     agent     1m        v1.10.3\naks-agentpool-41298956-2   Ready     agent     1m        v1.10.3\naks-agentpool-41298956-3   Ready     agent     1m        v1.10.3\n")])])]),s("p",[t._v("最后，通过下面的命令启动Kubernetes仪表盘：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("az aks browse --resource-group IgniteCluster --name IgniteCluster\n")])])]),s("p",[t._v("打开仪表盘之后，转到"),s("code",[t._v("Cluster")]),t._v("->"),s("code",[t._v("Nodes")]),t._v("，确认是否可以看到正在运行的AKS集群的所有节点。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/c08ab74-Screen_Shot_2018-06-28_at_3.19.27_PM.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_3-2-ignite集群部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-ignite集群部署"}},[t._v("#")]),t._v(" 3.2.Ignite集群部署")]),t._v(" "),s("p",[t._v("要在Azure Kubernetes服务中部署Ignite集群，需要至少3步：")]),t._v(" "),s("ul",[s("li",[t._v("配置RBAC授权；")]),t._v(" "),s("li",[t._v("在Kubernetes中部署用于Ignite节点自动发现的Ignite服务，同时它也会作为外部应用的负载平衡器；")]),t._v(" "),s("li",[t._v("将Ignite集群部署为有状态或者无状态的方案。")])]),t._v(" "),s("p",[s("strong",[t._v("RBAC授权")])]),t._v(" "),s("p",[t._v("根据"),s("code",[t._v("20.2.3.RBAC授权")]),t._v("章节介绍的内容，创建一个Ignite专用的命名空间、服务账号和角色。")]),t._v(" "),s("p",[t._v("配置RBAC之后打开Kubernetes仪表盘，转到"),s("code",[t._v("Cluster")]),t._v("->"),s("code",[t._v("Roles")]),t._v("，确认哪有一个Ignite专用的角色。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/f515543-Screen_Shot_2018-06-28_at_3.49.31_PM.png",alt:""}})]),t._v(" "),s("p",[t._v("通过选择"),s("code",[t._v("Namespace")]),t._v("->"),s("code",[t._v("ignite")]),t._v("，在Kubernetes仪表盘中切换当前命名空间到"),s("code",[t._v("ignite")]),t._v("。还有，通过下面的命令，也可以通过Azure CLI切换命名空间：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl config set-context "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl config current-context"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" --namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ignite\n")])])]),s("p",[s("strong",[t._v("Ignite服务部署")])]),t._v(" "),s("p",[t._v("部署一个专用的Ignite服务，用于Ignite节点的自动发现，同时也可以作为外部应用的负载平衡器，具体可以看"),s("code",[t._v("20.2.4.Ignite服务")]),t._v("章节。")]),t._v(" "),s("p",[t._v("服务部署之后，转到"),s("code",[t._v("Discovery and Load Balancing")]),t._v("->"),s("code",[t._v("Services")]),t._v("，确认在Kubernetes仪表盘中可以看到这个服务。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/398171c-Screen_Shot_2018-06-28_at_5.01.08_PM.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("Ignite有状态集部署")])]),t._v(" "),s("p",[t._v("Ignite有状态集部署可以用于将Ignite部署为开启持久化的、以内存为中心的数据库，具体可以看"),s("code",[t._v("20.2.2.有状态部署")]),t._v("章节。\n常规的文档假定AKS会提供存储空间，用于Ignite的数据持久化。转到"),s("code",[t._v("Cluster")]),t._v("->"),s("code",[t._v("Persistence Volumes")]),t._v("，可以看到为集群分配的驱动类型，比如，页面大体如下：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/28062de-Screen_Shot_2018-06-28_at_5.05.45_PM.png",alt:""}})]),t._v(" "),s("p",[t._v("配置组部署之后，可以尝试如下的命令对集群进行扩容：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl scale sts ignite --replicas"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n")])])]),s("p",[t._v("集群扩容并且磁盘加载之后，就会在Kubernetes仪表盘的"),s("code",[t._v("Workloads")]),t._v("->"),s("code",[t._v("Pods")]),t._v("页面看到如下内容：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/e2108a4-Screen_Shot_2018-06-28_at_5.10.04_PM.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("Ignite集群激活")])]),t._v(" "),s("p",[t._v("因为集群使用了Ignite的原生持久化，因此启动之后需要对集群进行激活，怎么弄呢？接入其中任意一个配置组：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it ignite-0 --namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ignite -- /bin/bash\n")])])]),s("p",[t._v("转到如下的目录：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /opt/ignite/apache-ignite-fabric/bin/\n")])])]),s("p",[t._v("然后通过执行如下的命令激活集群：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./control.sh --activate\n")])])]),s("h3",{attrs:{id:"_3-3-从外部应用接入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-从外部应用接入"}},[t._v("#")]),t._v(" 3.3.从外部应用接入")]),t._v(" "),s("p",[t._v("下面会从外部应用（未部署在Kubernetes中）接入集群，本示例会使用SQL接口通过JDBC驱动接入Ignite。")]),t._v(" "),s("p",[t._v("首先，找到Ignite服务的外部地址，比如，转到"),s("code",[t._v("Discovery and Load Balancing")]),t._v("->"),s("code",[t._v("Services")]),t._v("，然后通过端口号10800选择一个外部端点（这是IgniteSQL驱动的默认端口）。")]),t._v(" "),s("p",[t._v("下一步，下载一个Ignite版本，转到"),s("code",[t._v("{ignite_release}/bin")]),t._v("然后使用SQLline工具通过如下的命令可以接入集群：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./sqlline.sh --verbose"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true -u jdbc:ignite:thin://"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("EXTERNAL_IP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(":10800\n")])])]),s("p",[t._v("接入之后，使用SQLLine工具，通过下面的命令进行数据预加载：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("run "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/examples/sql/world.sql\n")])])]),s("p",[t._v("之后，就可以使用SQL与集群进行交互了，比如：")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" country"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" city"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("MAX")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("city"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("population"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" max_pop "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" country\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" city "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" city"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("countrycode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" country"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" country"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'USA'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'RUS'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'CHN'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GROUP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" country"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" city"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ORDER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" max_pop "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DESC")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LIMIT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"_4-google-cloud部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-google-cloud部署"}},[t._v("#")]),t._v(" 4.Google Cloud部署")]),t._v(" "),s("h3",{attrs:{id:"_4-1-google-kubernetes引擎部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-google-kubernetes引擎部署"}},[t._v("#")]),t._v(" 4.1.Google Kubernetes引擎部署")]),t._v(" "),s("p",[t._v("第一步是按照Google的说明配置Google Kubernetes引擎（GKE）集群：")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://cloud.google.com/kubernetes-engine/docs/how-to/creating-a-cluster",target:"_self",rel:"noopener noreferrer"}},[t._v("创建集群")])])]),t._v(" "),s("p",[t._v("在本章节中，会使用Google云控制台进行GKE的部署。")]),t._v(" "),s("p",[s("strong",[t._v("GKE配置")])]),t._v(" "),s("p",[t._v("创建Google账号之后，转到"),s("a",{attrs:{href:"https://console.cloud.google.com/",target:"_self",rel:"noopener noreferrer"}},[t._v("https://console.cloud.google.com/")]),t._v(" ，然后选择"),s("code",[t._v("Kubernetes Engine")]),t._v(" > 选择 "),s("code",[t._v("Clusters")]),t._v(" > "),s("code",[t._v("Create cluster")]),t._v("。")]),t._v(" "),s("p",[t._v("下一页中会配置一些部署所需的常规参数。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/1d3c0ba-general_parameters.png",alt:""}})]),t._v(" "),s("p",[t._v("在本例中，会使用"),s("code",[t._v("ignitecluster")]),t._v("作为Kubernetes集群的名字。")]),t._v(" "),s("p",[t._v("同一个页面中还需要选择GKE集群中的节点数量。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/01a8093-nodes_configuration.png",alt:""}})]),t._v(" "),s("p",[t._v("本例中，集群包含4个节点，每个节点有2个虚拟CPU和7.5GB内存。")]),t._v(" "),s("p",[t._v("建议打开"),s("code",[t._v("StackDriver")]),t._v("监控，这样就可以从Google云控制台里面看到集群的状态。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/18b7a61-monitoring_configuration.png",alt:""}})]),t._v(" "),s("p",[t._v("下一步，点击"),s("code",[t._v("More")]),t._v("之后可以为应用配置需要的标签。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/1f72403-labels.png",alt:""}})]),t._v(" "),s("p",[t._v("再次检查配置参数，然后点击"),s("code",[t._v("Create")]),t._v("按钮。")]),t._v(" "),s("p",[t._v("转到"),s("code",[t._v("Kubernetes Engine")]),t._v(" > "),s("code",[t._v("Clusters")]),t._v("，注意GKE部署集群需要点时间。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/bed652e-cluster_info.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("访问Kubernetes集群")])]),t._v(" "),s("p",[t._v("按照这个"),s("a",{attrs:{href:"https://cloud.google.com/sdk/docs/quickstarts",target:"_self",rel:"noopener noreferrer"}},[t._v("文档")]),t._v("，可以安装Google云的SDK CLI。\nGoogle云SDK CLI安装完之后，可以按照下面的步骤操作。")]),t._v(" "),s("p",[t._v("转到"),s("code",[t._v("Kubernetes Engine")]),t._v(" > "),s("code",[t._v("Clusters")]),t._v("，然后点击集群的"),s("code",[t._v("Connect")]),t._v("按钮。")]),t._v(" "),s("p",[t._v("然后按照指令访问集群：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/e900a2a-cluster_access.png",alt:""}})]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Kubernetes仪表盘已经不推荐使用")]),t._v(" "),s("p",[t._v("在"),s("a",{attrs:{href:"https://cloud.google.com/kubernetes-engine/docs/concepts/dashboards",target:"_self",rel:"noopener noreferrer"}},[t._v("这里")]),t._v("可以看到Google云平台控制台仪表盘的更多信息。")])]),t._v(" "),s("p",[t._v("下一步，通过下面的命令检查所有的节点是否处于"),s("code",[t._v("Ready")]),t._v("状态：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl get nodes\n")])])]),s("p",[t._v("输出大体如下：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("NAME                                          STATUS    ROLES     AGE       VERSION\ngke-ignitecluster-default-pool-4b1a4860-nb1f   Ready     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("    1m       v1.10.4-gke.2\ngke-ignitecluster-default-pool-4b1a4860-v719   Ready     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("    1m       v1.10.4-gke.2\ngke-ignitecluster-default-pool-4b1a4860-xltc   Ready     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("    1m       v1.10.4-gke.2\ngke-ignitecluster-default-pool-4b1a4860-z9vs   Ready     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("    1m       v1.10.4-gke.2\n")])])]),s("h3",{attrs:{id:"_4-2-ignite集群部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-ignite集群部署"}},[t._v("#")]),t._v(" 4.2.Ignite集群部署")]),t._v(" "),s("p",[t._v("要在Google Kubernetes引擎中部署Ignite集群，需要至少三步操作：")]),t._v(" "),s("ul",[s("li",[t._v("配置RBAC授权；")]),t._v(" "),s("li",[t._v("部署一个Ignite服务，用于Ignite节点的Kubernetes环境自动发现以及外部应用的负载平衡；")]),t._v(" "),s("li",[t._v("将Ignite集群部署为无状态或者有状态的方案。")])]),t._v(" "),s("p",[s("strong",[t._v("RBAC授权")])]),t._v(" "),s("p",[t._v("根据"),s("code",[t._v("20.2.3.RBAC授权")]),t._v("章节介绍的内容，创建一个Ignite专用的命名空间、服务账号和角色。")]),t._v(" "),s("p",[t._v("对于GKE部署，首先执行下面的命令：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl create clusterrolebinding cluster-admin-binding "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  --clusterrole cluster-admin --user "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("YOUR_USERNAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("通过运行下面的命令，可以将当前的命名空间切换到"),s("code",[t._v("ignite")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl config set-context "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("kubectl config current-context"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" --namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ignite\n")])])]),s("p",[s("strong",[t._v("Ignite服务部署")])]),t._v(" "),s("p",[t._v("部署一个专用的Ignite服务，用于Ignite节点的自动发现，同时也可以作为外部应用的负载平衡器，具体可以看"),s("code",[t._v("20.2.4.Ignite服务")]),t._v("章节。")]),t._v(" "),s("p",[t._v("服务部署完成之后，转到"),s("code",[t._v("Kubernetes Engine")]),t._v(" > "),s("code",[t._v("Clusters")]),t._v("，确认从Kubernetes引擎服务仪表盘中可以看到该服务。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/bd68550-ignite_service.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("Ignite无状态部署")])]),t._v(" "),s("p",[t._v("Ignite无状态部署可以用于将Ignite部署为禁用持久化的、以内存为中心的数据库，具体可以看"),s("code",[t._v("20.2.1.无状态部署")]),t._v("章节。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/6bbaa4c-stateless_deployment.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("Ignite有状态集部署")])]),t._v(" "),s("p",[t._v("Ignite有状态集部署可以用于将Ignite部署为开启持久化的、以内存为中心的数据库，具体可以看"),s("code",[t._v("20.2.2.有状态部署")]),t._v("章节。")]),t._v(" "),s("p",[t._v("常规的文档假定GKE会提供存储空间，用于Ignite的数据持久化。转到"),s("code",[t._v("Kubernetes Engine")]),t._v("->"),s("code",[t._v("Storage")]),t._v("，可以看到为集群分配的驱动类型，比如，页面大体如下：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/df8a665-storage.png",alt:""}})]),t._v(" "),s("p",[t._v("配置组部署之后，可以尝试如下的命令对集群进行扩容：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl scale sts ignite --replicas"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n")])])]),s("p",[t._v("集群扩容并且磁盘加载之后，就会在Google云平台控制台的"),s("code",[t._v("Kubernetes Engine")]),t._v("->"),s("code",[t._v("Workloads")]),t._v("页面看到如下内容：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://files.readme.io/9201088-stateful_deployment.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("Ignite集群激活")])]),t._v(" "),s("p",[t._v("因为集群使用了Ignite的原生持久化，因此启动之后需要对集群进行激活，怎么弄呢？接入其中任意一个配置组：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it ignite-0 --namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ignite -- /bin/bash\n")])])]),s("p",[t._v("转到如下的目录：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /opt/ignite/apache-ignite-fabric/bin/\n")])])]),s("p",[t._v("然后通过执行如下的命令激活集群：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./control.sh --activate\n")])])]),s("h3",{attrs:{id:"_4-3-从外部应用接入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-从外部应用接入"}},[t._v("#")]),t._v(" 4.3.从外部应用接入")]),t._v(" "),s("p",[t._v("下面会从外部应用（未部署在Kubernetes中）接入集群，本示例会使用SQL接口通过JDBC驱动接入Ignite。")]),t._v(" "),s("p",[t._v("首先，找到Ignite服务的外部地址，比如，转到"),s("code",[t._v("Kubernetes Engine")]),t._v(" > "),s("code",[t._v("Services")]),t._v("，然后通过端口号10800选择一个外部端点（这是IgniteSQL驱动的默认端口）。")]),t._v(" "),s("p",[t._v("下一步，下载一个Ignite版本，转到"),s("code",[t._v("{ignite_release}/bin")]),t._v("然后使用SQLline工具通过如下的命令可以接入集群：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./sqlline.sh --verbose"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true -u jdbc:ignite:thin://"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("EXTERNAL_IP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(":10800\n")])])]),s("p",[t._v("接入之后，使用SQLLine工具，通过下面的命令进行数据预加载：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("run "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/examples/sql/world.sql\n")])])]),s("p",[t._v("之后，就可以使用SQL与集群进行交互了，比如：")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" country"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" city"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("MAX")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("city"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("population"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" max_pop "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" country\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" city "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" city"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("countrycode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" country"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" country"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'USA'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'RUS'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'CHN'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GROUP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" country"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" city"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ORDER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" max_pop "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DESC")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LIMIT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);